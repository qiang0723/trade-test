# 6小时变化计算说明

## 📊 变化周期调整

已将持仓量、成交量、成交额的变化计算从 **24小时** 调整为 **6小时**。

---

## 🔢 计算方法详解

### 1️⃣ **持仓量变化**（仅合约）

#### 数据获取
```python
API: futures_open_interest_hist()
参数: 
  - period: '1h' (1小时间隔)
  - limit: 7 (获取7个数据点)
```

#### 计算逻辑
```python
# 获取7个小时的持仓量数据
oi_history[0] = 6小时前的持仓量
oi_history[6] = 最新小时的持仓量

# 计算变化
change_percent = (当前持仓量 - 6h前持仓量) / 6h前持仓量 × 100
```

#### 时间轴示例
```
时间         持仓量        说明
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
06:00      80.0M BTR    ← 6小时前（基准）
07:00      79.5M BTR
08:00      78.0M BTR
09:00      76.5M BTR
10:00      74.0M BTR
11:00      72.5M BTR
12:00      70.3M BTR    ← 当前

变化: 70.3 - 80.0 = -9.7M
变化%: -9.7 / 80.0 × 100 = -12.1%
```

---

### 2️⃣ **成交量变化**（现货+合约）

#### 数据获取
```python
API: get_klines() / futures_klines()
参数:
  - interval: '1h'
  - limit: 7
```

#### 计算逻辑
```python
# 获取7个小时的K线数据
klines[0:3] = 前3小时（6-4小时前）
klines[4:7] = 后3小时（最近3小时）

# 计算前3小时累计成交量
prev_volume = sum(klines[0:3]的成交量)

# 计算后3小时累计成交量
curr_volume = sum(klines[4:7]的成交量)

# 计算变化
change_percent = (curr_volume - prev_volume) / prev_volume × 100
```

#### 时间轴示例
```
时间      成交量      累计      说明
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
06:00     5.0M      5.0M     ┐
07:00     4.5M      9.5M     ├ 前3小时
08:00     4.0M     13.5M     ┘ = 13.5M
09:00     ─────    ─────     （中间间隔）
10:00     8.0M      8.0M     ┐
11:00     9.5M     17.5M     ├ 后3小时  
12:00    10.0M     27.5M     ┘ = 27.5M

变化: 27.5 - 13.5 = +14.0M
变化%: 14.0 / 13.5 × 100 = +103.7%
```

**含义**: 最近3小时的交易活跃度是之前3小时的2倍

---

### 3️⃣ **成交额变化**（现货+合约）

计算方法与成交量相同，只是数据字段不同：
- 使用K线数据的 `quote_volume` 字段
- 单位：USDT

---

## 📈 BTR实际数据示例

### 当前数据（2026-01-19 12:20）

```
┌─────────────────────────────────────┐
│ 📊 持仓量                            │
│ 70.3M BTR                           │
│ BTR 📉-11.67%  ← 6小时变化          │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 💹 24h成交量                         │
│ 311.9M BTR                          │
│ BTR 📈+277.84%  ← 6小时变化         │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 💵 24h成交额                         │
│ $21.4M                              │
│ USDT 📈+257.61%  ← 6小时变化        │
└─────────────────────────────────────┘
```

---

## 💡 数据含义解读

### 持仓量 -11.67%

```
6小时前: 约80M BTR
当前: 70.3M BTR
减少: 9.7M BTR

含义:
✓ 6小时内大量仓位被平仓
✓ 可能是止损或获利了结
✓ 市场情绪转向谨慎
```

### 成交量 +277.84%

```
前3小时累计: 约85M BTR
后3小时累计: 约321M BTR
增加: 236M BTR (约3.77倍)

含义:
✓ 最近3小时交易活跃度激增
✓ 市场波动加大，参与者增多
✓ 可能伴随价格剧烈波动
```

### 成交额 +257.61%

```
前3小时累计: 约$6M USDT
后3小时累计: 约$21.5M USDT
增加: $15.5M (约3.58倍)

含义:
✓ 资金流入显著增加
✓ 大额交易增多
✓ 市场关注度提升
```

---

## ⚙️ 为什么改为6小时？

### 优势

#### 1. **更敏感的市场变化捕捉** 📊
```
24小时: 可能掩盖短期趋势
6小时: 快速反映市场变化
```

#### 2. **更适合短线交易** ⚡
```
24小时: 适合中长线
6小时: 适合日内交易
```

#### 3. **及时发现转折点** 🎯
```
6小时能更快发现:
- 持仓量异常变化
- 成交量突然放大/缩小
- 市场情绪转变
```

### 对比

| 指标 | 24小时 | 6小时 | 说明 |
|------|--------|-------|------|
| **持仓量变化** | -20.52% | -11.67% | 6h更反映近期趋势 |
| **成交量变化** | +57.80% | +277.84% | 6h显示活跃度激增 |
| **敏感度** | 低 | 高 | 6h更快捕捉变化 |
| **适用场景** | 趋势判断 | 短线交易 | 各有优势 |

---

## 🎨 前端显示优化

### 鼠标悬停提示

```javascript
volumeChangeElement.title = '6小时变化'
quoteVolumeChangeElement.title = '6小时变化'
openInterestChangeElement.title = '6小时变化'
```

**效果**: 鼠标悬停在变化百分比上时，会显示"6小时变化"

### 显示效果

```
💹 24h成交量           ← 总量（24小时累计）
311.9M BTR            
BTR 📈+277.84%        ← 6小时变化（悬停显示"6小时变化"）
```

---

## 📋 市场分析调整

### 阈值优化

由于改为6小时，相应调整了分析阈值：

| 指标 | 24小时阈值 | 6小时阈值 | 调整理由 |
|------|-----------|----------|---------|
| **持仓量大幅变化** | ±10% | ±5% | 6h变化约为24h的40-50% |
| **持仓量小幅变化** | ±3% | ±2% | 同比例调整 |
| **成交量激增** | ±30% | ±20% | 6h波动更大 |
| **成交量小幅变化** | - | ±10% | 新增档位 |

### 分析文本更新

```python
# 修改前
"📈 持仓量大幅增加 +15.23%"

# 修改后
"📈 6h持仓量大幅增加 +8.52%"  ← 标注6h
```

---

## 🔍 数据验证

### 测试结果（BTR）

```
时间: 2026-01-19 12:20

持仓量:
  当前: 70,307,652 BTR
  6h前: 约80M BTR
  变化: -11.67% ✅

成交量（最近3h vs 之前3h）:
  之前3h累计: 约85M BTR
  最近3h累计: 约321M BTR
  变化: +277.84% ✅

成交额（最近3h vs 之前3h）:
  之前3h累计: 约$6M
  最近3h累计: 约$21.5M
  变化: +257.61% ✅
```

---

## 🚀 服务状态

```
容器名称: trade-info-app
容器ID: b39aedfda959
状态: ✅ 运行中（健康）
端口: 5001
变化周期: ✅ 已改为6小时
```

### 🌐 访问地址

```
http://localhost:5001
```

---

## 💡 使用建议

### 如何理解新的变化值

#### **持仓量变化 -11.67%**
```
✓ 6小时内持仓量减少11.67%
✓ 比24小时的-20.52%更关注近期
✓ 更适合判断当前市场状态
```

#### **成交量变化 +277.84%**
```
✓ 最近3小时比之前3小时活跃2.77倍
✓ 说明市场交易突然变得非常活跃
✓ 可能伴随重要行情或消息
```

### 交易决策参考

#### **开仓时机**
- 6小时持仓量持续增加 → 趋势可能延续
- 6小时成交量激增 → 市场活跃，流动性好

#### **止损信号**
- 6小时持仓量突然大降 → 主力撤离
- 6小时成交量萎缩 → 市场兴趣减退

#### **反转信号**
- 持仓量变化方向与价格背离
- 成交量激增但价格不动

---

## 🎯 完整功能列表

| 功能 | 变化周期 | 状态 |
|------|---------|------|
| **价格** | 24h | ✅ 保持 |
| **最高/最低价** | 24h | ✅ 保持 |
| **成交量** | 24h累计 + 6h变化 | ✅ 新增 |
| **成交额** | 24h累计 + 6h变化 | ✅ 新增 |
| **持仓量** | 实时 + 6h变化 | ✅ 新增 |
| **资金费率** | 实时 | ✅ 保持 |
| **市场分析** | 综合6h数据 | ✅ 优化 |

---

## 📚 相关文档

- **`BTR持仓量计算详解.md`** - 详细计算过程（24h版本）
- **`数据更新机制说明.md`** - 完整更新机制
- **`6小时变化计算说明.md`** - 当前文档（6h版本）

---

**6小时变化机制已上线！** ✅⚡📊

更敏感、更及时、更适合短线交易！
