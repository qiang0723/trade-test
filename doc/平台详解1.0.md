# åŠ å¯†è´§å¸äº¤æ˜“å†³ç­–å¹³å°è¯¦è§£ 1.0

**ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-20  
**ç³»ç»Ÿåç§°**: L1 Advisory Layer (äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ)

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#2-æ ¸å¿ƒåŠŸèƒ½)
3. [ç­–ç•¥çš„è®¾è®¡ç†å¿µå’Œå®ç°æ–¹å¼](#3-ç­–ç•¥çš„è®¾è®¡ç†å¿µå’Œå®ç°æ–¹å¼)
4. [æŠ€æœ¯æ¶æ„](#4-æŠ€æœ¯æ¶æ„)
5. [åŠŸèƒ½å®ç°æ–¹å¼](#5-åŠŸèƒ½å®ç°æ–¹å¼)
6. [Webå±•ç¤ºæ•ˆæœ](#6-webå±•ç¤ºæ•ˆæœ)
7. [å­—æ®µè§„èŒƒ](#7-å­—æ®µè§„èŒƒ)
8. [APIæ¥å£](#8-apiæ¥å£)
9. [æ•°æ®åº“è®¾è®¡](#9-æ•°æ®åº“è®¾è®¡)
10. [é…ç½®ç®¡ç†](#10-é…ç½®ç®¡ç†)
11. [éƒ¨ç½²æ–¹å¼](#11-éƒ¨ç½²æ–¹å¼)
12. [æµ‹è¯•è¦†ç›–](#12-æµ‹è¯•è¦†ç›–)
13. [ä½¿ç”¨æŒ‡å—](#13-ä½¿ç”¨æŒ‡å—)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä½

**L1 Advisory Layer** æ˜¯ä¸€ä¸ªåŸºäºå¤šç»´åº¦å¸‚åœºæ•°æ®çš„**äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ**ï¼Œä¸“æ³¨äºä¸ºåŠ å¯†è´§å¸äº¤æ˜“æä¾›**å®‰å…¨ã€å¯è¿½æº¯ã€é«˜è´¨é‡**çš„æ–¹å‘æ€§å»ºè®®ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ›¡ï¸ **Safety First**: å®‰å…¨ä¼˜å…ˆï¼Œå¤šå±‚é—¸é—¨é˜²æŠ¤
- ğŸ¯ **å•ä¸€èŒè´£**: ä»…è¾“å‡ºæ–¹å‘å†³ç­–ï¼ˆLONG/SHORT/NO_TRADEï¼‰ï¼Œä¸æ¶‰åŠæ‰§è¡Œ
- ğŸ“Š **æ•°æ®é©±åŠ¨**: åŸºäºå®æ—¶Binanceå¸‚åœºæ•°æ®
- ğŸ” **å¯è¿½æº¯æ€§**: æ¯ä¸ªå†³ç­–éƒ½æœ‰æ˜ç¡®çš„reason_tags
- âš™ï¸ **å¯é…ç½®**: æ‰€æœ‰é˜ˆå€¼å¤–éƒ¨åŒ–ï¼Œæ”¯æŒçƒ­æ›´æ–°
- ğŸš€ **é«˜æ€§èƒ½**: Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå¥åº·æ£€æŸ¥æœºåˆ¶

### 1.2 ç³»ç»Ÿè¾¹ç•Œ

**L1åšä»€ä¹ˆ**ï¼š
- âœ… åˆ†æå¸‚åœºç¯å¢ƒï¼ˆè¶‹åŠ¿/éœ‡è¡/æç«¯ï¼‰
- âœ… è¯„ä¼°é£é™©å‡†å…¥ï¼ˆé£é™©é—¸é—¨ï¼‰
- âœ… è¯„ä¼°äº¤æ˜“è´¨é‡ï¼ˆè´¨é‡é—¸é—¨ï¼‰
- âœ… åˆ¤æ–­äº¤æ˜“æ–¹å‘ï¼ˆLONG/SHORT/NO_TRADEï¼‰
- âœ… è®¡ç®—ç½®ä¿¡åº¦ï¼ˆHIGH/MEDIUM/LOWï¼‰
- âœ… æä¾›æ‰§è¡Œè®¸å¯ï¼ˆexecutableæ ‡å¿—ï¼‰

**L1ä¸åšä»€ä¹ˆ**ï¼š
- âŒ ä¸è¾“å‡ºä»“ä½å¤§å°
- âŒ ä¸è¾“å‡ºå…¥åœºç‚¹ä½
- âŒ ä¸è¾“å‡ºæ­¢æŸæ­¢ç›ˆ
- âŒ ä¸è®¡ç®—æ æ†å€æ•°
- âŒ ä¸ä¸‹å•æ‰§è¡Œ
- âŒ ä¸ç®¡ç†æŒä»“

### 1.3 ä¸‰å±‚æ¶æ„æ„¿æ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1 Advisory Layer (å½“å‰å®ç°)            â”‚
â”‚  - æ–¹å‘å†³ç­–å’¨è¯¢                          â”‚
â”‚  - å®‰å…¨é—¸é—¨                              â”‚
â”‚  - ç½®ä¿¡åº¦è¯„ä¼°                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2 Selection Layer (æœªæ¥)               â”‚
â”‚  - è‡ªåŠ¨é€‰å¸                              â”‚
â”‚  - å€™é€‰æ± ç®¡ç†                            â”‚
â”‚  - å¤šå¸ç§æ’åº                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3 Execution Layer (æœªæ¥)               â”‚
â”‚  - è‡ªåŠ¨äº¤æ˜“                              â”‚
â”‚  - ä»“ä½ç®¡ç†                              â”‚
â”‚  - åšå¸‚ç­–ç•¥                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æ ¸å¿ƒåŠŸèƒ½

### 2.1 åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½æè¿° | å®ç°çŠ¶æ€ |
|---------|---------|---------|
| **å¸‚åœºç¯å¢ƒè¯†åˆ«** | è‡ªåŠ¨è¯†åˆ«TREND/RANGE/EXTREMEä¸‰ç§å¸‚åœºçŠ¶æ€ | âœ… å·²å®ç° |
| **é£é™©å‡†å…¥è¯„ä¼°** | æ£€æµ‹æ¸…ç®—ã€æ‹¥æŒ¤ã€æç«¯æˆäº¤é‡ç­‰é£é™© | âœ… å·²å®ç° |
| **äº¤æ˜“è´¨é‡è¯„ä¼°** | æ£€æµ‹å¸çº³ã€å™ªéŸ³ã€è½®åŠ¨ã€å¼±ä¿¡å·ç­‰è´¨é‡é—®é¢˜ | âœ… å·²å®ç° |
| **æ–¹å‘åˆ¤æ–­** | åŸºäºä¹°å–å¤±è¡¡ã€æŒä»“é‡ã€ä»·æ ¼å˜åŒ–åˆ¤æ–­æ–¹å‘ | âœ… å·²å®ç° |
| **èµ„é‡‘è´¹ç‡é™çº§** | èµ„é‡‘è´¹ç‡ä¸å†ä½œä¸ºä¸»è¦è§¦å‘æ¡ä»¶ï¼Œä»…ç”¨äºæ ‡è®° | âœ… å·²å®ç° |
| **ç½®ä¿¡åº¦è®¡ç®—** | å·¥ç¨‹åŒ–ç½®ä¿¡åº¦ï¼ˆHIGH/MEDIUM/LOWï¼‰ | âœ… å·²å®ç° |
| **æ‰§è¡Œè®¸å¯** | ä¸ºL3æä¾›executableæ ‡å¿— | âœ… å·²å®ç° |
| **çŠ¶æ€æœºç®¡ç†** | ç®¡ç†INIT/WAIT/ACTIVE/COOL_DOWNçŠ¶æ€ | âœ… å·²å®ç° |
| **å†³ç­–ç®¡é“å¯è§†åŒ–** | 8æ­¥å†³ç­–ç®¡é“å®æ—¶å±•ç¤º | âœ… å·²å®ç° |
| **å†å²å†³ç­–æŸ¥è¯¢** | 48å°æ—¶å†å²å†³ç­–è®°å½• | âœ… å·²å®ç° |
| **é…ç½®çƒ­æ›´æ–°** | ä¿®æ”¹YAMLé…ç½®æ— éœ€é‡å¯ | âœ… å·²å®ç° |
| **å¤šå¸ç§æ”¯æŒ** | æ”¯æŒBTC/ETH/BNB/SOLç­‰ä¸»æµå¸ç§ | âœ… å·²å®ç° |
| **ç°è´§/åˆçº¦åˆ‡æ¢** | æ”¯æŒç°è´§å’Œåˆçº¦å¸‚åœº | âœ… å·²å®ç° |
| **RESTful API** | å®Œæ•´çš„APIæ¥å£ | âœ… å·²å®ç° |
| **æ•°æ®æŒä¹…åŒ–** | SQLiteæ•°æ®åº“å­˜å‚¨ | âœ… å·²å®ç° |
| **Dockeréƒ¨ç½²** | å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¸€é”®å¯åŠ¨ | âœ… å·²å®ç° |
| **å•å…ƒæµ‹è¯•** | 35ä¸ªæµ‹è¯•ç”¨ä¾‹ | âœ… å·²å®ç° |

### 2.2 æ ¸å¿ƒå†³ç­–æµç¨‹

```
è¾“å…¥å¸‚åœºæ•°æ®
    â†“
[1] æ•°æ®éªŒè¯
    â†“
[2] å¸‚åœºç¯å¢ƒè¯†åˆ« â†’ TREND/RANGE/EXTREME
    â†“
[3] é£é™©å‡†å…¥è¯„ä¼° â†’ risk_exposure_allowed (True/False)
    â†“ (False â†’ NO_TRADE)
[4] äº¤æ˜“è´¨é‡è¯„ä¼° â†’ trade_quality (GOOD/POOR)
    â†“ (POOR â†’ NO_TRADE)
[5] æ–¹å‘è¯„ä¼°
    â”œâ”€ åšç©ºä¿¡å·æ£€æŸ¥
    â””â”€ åšå¤šä¿¡å·æ£€æŸ¥
    â†“
[6] ä¼˜å…ˆçº§å†³ç­–
    â”œâ”€ å†²çª â†’ NO_TRADE
    â”œâ”€ æ— ä¿¡å· â†’ NO_TRADE
    â””â”€ å•ä¸€ä¿¡å· â†’ LONG/SHORT
    â†“
[7] çŠ¶æ€æœºçº¦æŸæ£€æŸ¥
    â†“ (è¿è§„ â†’ NO_TRADE)
[8] ç½®ä¿¡åº¦è®¡ç®— â†’ HIGH/MEDIUM/LOW
    â†“
è¾“å‡º AdvisoryResult
```

---

## 3. ç­–ç•¥çš„è®¾è®¡ç†å¿µå’Œå®ç°æ–¹å¼

### 3.1 æ ¸å¿ƒè®¾è®¡ç†å¿µ

L1 Advisory Layerçš„ç­–ç•¥è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒç†å¿µï¼š

#### 3.1.1 Safety Firstï¼ˆå®‰å…¨ä¼˜å…ˆï¼‰

**ç†å¿µ**ï¼š
> "å®å¯é”™è¿‡æœºä¼šï¼Œä¸å¯æ‰¿æ‹…ä¸å¿…è¦çš„é£é™©"

**è®¾è®¡ä½“ç°**ï¼š
- **å¤šå±‚é—¸é—¨æœºåˆ¶**ï¼šé£é™©å‡†å…¥ â†’ äº¤æ˜“è´¨é‡ â†’ æ–¹å‘åˆ¤æ–­ â†’ çŠ¶æ€çº¦æŸï¼Œä»»ä½•ä¸€å±‚å¤±è´¥éƒ½è¾“å‡ºNO_TRADE
- **ä¿å®ˆé˜ˆå€¼**ï¼šæ‰€æœ‰é˜ˆå€¼åˆå§‹å€¼éƒ½è®¾ç½®ä¸ºä¿å®ˆæ°´å¹³ï¼Œå®å¯å°‘å‘ä¿¡å·ï¼Œä¸å¯å‘é”™ä¿¡å·
- **æç«¯ç¯å¢ƒè¯†åˆ«**ï¼šå•ç‹¬è¯†åˆ«EXTREMEå¸‚åœºç¯å¢ƒï¼Œç›´æ¥æ‹’ç»æ‰€æœ‰äº¤æ˜“ä¿¡å·
- **å†·å´æœŸæœºåˆ¶**ï¼šæ¯æ¬¡ä¿¡å·æ¿€æ´»åè¿›å…¥60åˆ†é’Ÿå†·å´æœŸï¼Œé¿å…é¢‘ç¹äº¤æ˜“
- **æ‰§è¡Œè®¸å¯åˆ†ç¦»**ï¼šå³ä½¿æœ‰æ–¹å‘å†³ç­–ï¼Œä¹Ÿéœ€è¦é€šè¿‡æ‰€æœ‰æ£€æŸ¥æ‰èƒ½è·å¾—executable=true

**ä»£ç ä½“ç°**ï¼š
```python
# é£é™©å‡†å…¥ - ç¬¬ä¸€é“é—¸é—¨
if regime == MarketRegime.EXTREME:
    return False, [ReasonTag.EXTREME_REGIME]

# è´¨é‡è¯„ä¼° - ç¬¬äºŒé“é—¸é—¨
if trade_quality == TradeQuality.POOR:
    return Decision.NO_TRADE, tags

# çŠ¶æ€æœºçº¦æŸ - ç¬¬ä¸‰é“é—¸é—¨
if self.current_state == SystemState.COOL_DOWN:
    return False, [ReasonTag.COOL_DOWN_ACTIVE]
```

#### 3.1.2 Data-Drivenï¼ˆæ•°æ®é©±åŠ¨ï¼‰

**ç†å¿µ**ï¼š
> "å†³ç­–å®Œå…¨åŸºäºå®¢è§‚å¸‚åœºæ•°æ®ï¼Œä¸ä¾èµ–ä¸»è§‚åˆ¤æ–­"

**æ•°æ®ç»´åº¦**ï¼š
1. **ä»·æ ¼æ•°æ®**ï¼š1h/6hä»·æ ¼å˜åŒ–ç‡
2. **æˆäº¤é‡æ•°æ®**ï¼š1h/24hæˆäº¤é‡å¯¹æ¯”
3. **æŒä»“é‡æ•°æ®**ï¼š1h/6hæŒä»“é‡å˜åŒ–ç‡
4. **è®¢å•æµæ•°æ®**ï¼šä¹°å–å¤±è¡¡åº¦ï¼ˆåŸºäºæœ€è¿‘500ç¬”æˆäº¤ï¼‰
5. **èµ„é‡‘è´¹ç‡**ï¼šå½“å‰è´¹ç‡å’Œå†å²æ³¢åŠ¨ç‡

**æ•°æ®æº**ï¼š
- **Binance API**ï¼šå®æ—¶å¸‚åœºæ•°æ®
- **MarketDataCache**ï¼š6å°æ—¶å†å²æ•°æ®ç”¨äºè®¡ç®—å˜åŒ–ç‡
- **æ•°æ®éªŒè¯**ï¼šæ‰€æœ‰è¾“å…¥æ•°æ®å¿…é¡»ç»è¿‡å®Œæ•´æ€§æ£€æŸ¥

**é¿å…çš„é™·é˜±**ï¼š
- âŒ ä¸ä½¿ç”¨"æ„Ÿè§‰"æˆ–"ç»éªŒ"
- âŒ ä¸ä½¿ç”¨å•ä¸€æŒ‡æ ‡
- âŒ ä¸ä½¿ç”¨æ»åæŒ‡æ ‡ï¼ˆå¦‚MAã€MACDï¼‰
- âœ… ä½¿ç”¨å¤šç»´åº¦å®æ—¶æ•°æ®
- âœ… ä½¿ç”¨é¢†å…ˆæŒ‡æ ‡ï¼ˆæŒä»“é‡ã€è®¢å•æµï¼‰

#### 3.1.3 Traceabilityï¼ˆå¯è¿½æº¯æ€§ï¼‰

**ç†å¿µ**ï¼š
> "æ¯ä¸ªå†³ç­–éƒ½èƒ½æ¸…æ™°è¿½æº¯åˆ°å…·ä½“åŸå› "

**å®ç°æ–¹å¼**ï¼š
- **ReasonTagæšä¸¾**ï¼š19ç§æ ‡å‡†åŒ–åŸå› æ ‡ç­¾
- **æ ‡ç­¾åˆ†ç±»**ï¼šé£é™©å¦å†³ã€è´¨é‡å¦å†³ã€æ–¹å‘å†²çªã€çŠ¶æ€çº¦æŸã€è¾…åŠ©ä¿¡æ¯
- **ç®¡é“å¯è§†åŒ–**ï¼š8æ­¥å†³ç­–ç®¡é“æ¯ä¸€æ­¥çš„çŠ¶æ€éƒ½å¯æŸ¥çœ‹
- **å†å²è®°å½•**ï¼š48å°æ—¶å®Œæ•´å†³ç­–å†å²

**ç¤ºä¾‹**ï¼š
```json
{
  "decision": "no_trade",
  "reason_tags": [
    "weak_signal_in_range",
    "low_funding_rate"
  ]
}
```

ç”¨æˆ·å¯ä»¥æ¸…æ¥šçŸ¥é“ï¼š
1. ä¸ºä»€ä¹ˆæ˜¯NO_TRADEï¼Ÿâ†’ éœ‡è¡å¸‚ä¸­ä¿¡å·å¼ºåº¦ä¸è¶³
2. å½“å‰èµ„é‡‘è´¹ç‡å¦‚ä½•ï¼Ÿâ†’ è¾ƒä½ï¼ˆè¾…åŠ©ä¿¡æ¯ï¼‰

#### 3.1.4 Separation of Concernsï¼ˆå…³æ³¨ç‚¹åˆ†ç¦»ï¼‰

**ç†å¿µ**ï¼š
> "L1åªè´Ÿè´£å†³ç­–å’¨è¯¢ï¼Œä¸æ¶‰åŠæ‰§è¡Œç»†èŠ‚"

**èŒè´£è¾¹ç•Œ**ï¼š

| L1è´Ÿè´£ | L1ä¸è´Ÿè´£ |
|-------|---------|
| âœ… æ–¹å‘å†³ç­–ï¼ˆLONG/SHORT/NO_TRADEï¼‰ | âŒ ä»“ä½å¤§å° |
| âœ… ç½®ä¿¡åº¦ï¼ˆHIGH/MEDIUM/LOWï¼‰ | âŒ å…¥åœºç‚¹ä½ |
| âœ… é£é™©å‡†å…¥ï¼ˆå…è®¸/æ‹’ç»ï¼‰ | âŒ æ­¢æŸæ­¢ç›ˆ |
| âœ… äº¤æ˜“è´¨é‡ï¼ˆGOOD/POORï¼‰ | âŒ æ æ†å€æ•° |
| âœ… æ‰§è¡Œè®¸å¯ï¼ˆexecutableæ ‡å¿—ï¼‰ | âŒ è®¢å•ä¸‹è¾¾ |

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- ğŸ¯ **ä¸“æ³¨æ€§**ï¼šL1ä¸“æ³¨äºåšå¥½æ–¹å‘å†³ç­–
- ğŸ§© **æ¨¡å—åŒ–**ï¼šæœªæ¥L2/L3å¯ç‹¬ç«‹å¼€å‘
- ğŸ”§ **å¯æµ‹è¯•æ€§**ï¼šL1é€»è¾‘ç‹¬ç«‹ï¼Œæ˜“äºæµ‹è¯•
- ğŸ”„ **å¯æ›¿æ¢æ€§**ï¼šL1å¯ä»¥è¢«å…¶ä»–å†³ç­–å¼•æ“æ›¿æ¢

#### 3.1.5 Configuration Over Codeï¼ˆé…ç½®ä¼˜äºä»£ç ï¼‰

**ç†å¿µ**ï¼š
> "ä¸šåŠ¡é€»è¾‘å‚æ•°åŒ–ï¼Œé¿å…ç¡¬ç¼–ç "

**é…ç½®å¤–éƒ¨åŒ–**ï¼š
- **YAMLé…ç½®æ–‡ä»¶**ï¼šæ‰€æœ‰é˜ˆå€¼ã€å‚æ•°éƒ½åœ¨`config/l1_thresholds.yaml`
- **çƒ­æ›´æ–°**ï¼šä¿®æ”¹é…ç½®æ— éœ€é‡å¯æœåŠ¡
- **APIæ›´æ–°**ï¼šæ”¯æŒé€šè¿‡APIåŠ¨æ€è°ƒæ•´é˜ˆå€¼
- **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒå¯ä½¿ç”¨ä¸åŒé…ç½®

**é…ç½®é¡¹ç¤ºä¾‹**ï¼š
```yaml
market_regime:
  extreme_price_change_1h: 5.0  # å¯è°ƒæ•´
  trend_price_change_6h: 3.0    # å¯è°ƒæ•´

risk_exposure:
  liquidation:
    price_change: 5.0           # å¯è°ƒæ•´
    oi_drop: -15.0              # å¯è°ƒæ•´
```

**ä¼˜åŠ¿**ï¼š
- ğŸ›ï¸ å¿«é€Ÿè°ƒä¼˜ï¼šæ— éœ€ä¿®æ”¹ä»£ç 
- ğŸ§ª A/Bæµ‹è¯•ï¼šä¸åŒç­–ç•¥å‚æ•°å¯¹æ¯”
- ğŸ”™ å¿«é€Ÿå›æ»šï¼šé…ç½®é”™è¯¯å¯ç«‹å³æ¢å¤
- ğŸ“Š å›æµ‹ä¼˜åŒ–ï¼šé€šè¿‡å†å²æ•°æ®ä¼˜åŒ–å‚æ•°

### 3.2 ç­–ç•¥è®¾è®¡åŸåˆ™

#### 3.2.1 å›ºåŒ–å†³ç­–ç®¡é“

**åŸåˆ™**ï¼šå†³ç­–æµç¨‹å›ºå®šä¸º8æ­¥ï¼Œä¸å¯è·³è¿‡æˆ–æ‰“ä¹±é¡ºåº

**8æ­¥ç®¡é“**ï¼š
```
1. æ•°æ®éªŒè¯ â†’ 2. å¸‚åœºç¯å¢ƒè¯†åˆ« â†’ 3. é£é™©å‡†å…¥è¯„ä¼° â†’ 4. äº¤æ˜“è´¨é‡è¯„ä¼° â†’
5. æ–¹å‘è¯„ä¼° â†’ 6. ä¼˜å…ˆçº§å†³ç­– â†’ 7. çŠ¶æ€æœºçº¦æŸ â†’ 8. ç½®ä¿¡åº¦è®¡ç®—
```

**è®¾è®¡åŸå› **ï¼š
- âœ… **ç¡®å®šæ€§**ï¼šç›¸åŒè¾“å…¥å¿…ç„¶äº§ç”Ÿç›¸åŒè¾“å‡º
- âœ… **å¯å®¡è®¡**ï¼šæ¯ä¸€æ­¥éƒ½å¯ç‹¬ç«‹æ£€æŸ¥
- âœ… **å¯ä¼˜åŒ–**ï¼šé’ˆå¯¹ç‰¹å®šæ­¥éª¤ä¼˜åŒ–ï¼Œä¸å½±å“å…¨å±€
- âœ… **å¯ç†è§£**ï¼šæ¸…æ™°çš„é€»è¾‘æµç¨‹ï¼Œæ˜“äºç»´æŠ¤

**å®ç°**ï¼š
```python
def on_new_tick(self, symbol: str, data: Dict) -> AdvisoryResult:
    # Step 1: æ•°æ®éªŒè¯
    valid, tags = self._validate_data(data)
    if not valid:
        return self._build_no_trade_result(tags)
    
    # Step 2: å¸‚åœºç¯å¢ƒè¯†åˆ«
    regime = self._detect_market_regime(data)
    
    # Step 3: é£é™©å‡†å…¥è¯„ä¼°
    risk_ok, risk_tags = self._eval_risk_exposure_allowed(data, regime)
    if not risk_ok:
        return self._build_no_trade_result(risk_tags)
    
    # Step 4: äº¤æ˜“è´¨é‡è¯„ä¼°
    quality, quality_tags = self._eval_trade_quality(data, regime)
    if quality == TradeQuality.POOR:
        return self._build_no_trade_result(quality_tags)
    
    # ... åç»­æ­¥éª¤
```

#### 3.2.2 èµ„é‡‘è´¹ç‡é™çº§

**åŸåˆ™**ï¼šèµ„é‡‘è´¹ç‡ä¸å†ä½œä¸ºä¸»è¦è§¦å‘æ¡ä»¶ï¼Œä»…ç”¨äºè¾…åŠ©åˆ¤æ–­å’Œæ ‡è®°

**ä¼ ç»Ÿåšæ³•ï¼ˆv3.0ä¹‹å‰ï¼‰**ï¼š
```python
# âŒ æ—§é€»è¾‘ï¼šèµ„é‡‘è´¹ç‡æ˜¯åšå¤š/åšç©ºçš„ä¸»è¦æ¡ä»¶
if funding_rate < -0.0001:
    return Decision.LONG  # èµ„é‡‘è´¹ç‡ä½å°±åšå¤š
```

**æ–°åšæ³•ï¼ˆL1ï¼‰**ï¼š
```python
# âœ… æ–°é€»è¾‘ï¼šèµ„é‡‘è´¹ç‡ä»…ä½œä¸ºè¾…åŠ©æ ‡è®°
if imbalance > 0.6 and oi_change > 5.0 and price_change > 1.0:
    # ä¸»è¦æ¡ä»¶ï¼šå¤±è¡¡ã€æŒä»“å¢é•¿ã€ä»·æ ¼ä¸Šæ¶¨
    if funding_rate < -0.0001:
        tags.append(ReasonTag.LOW_FUNDING_RATE)  # ä»…æ ‡è®°
    return True  # åšå¤šä¿¡å·
```

**è®¾è®¡åŸå› **ï¼š
- ğŸ’° **è´¹ç‡æ»åæ€§**ï¼šèµ„é‡‘è´¹ç‡æ˜¯8å°æ—¶ç»“ç®—ä¸€æ¬¡çš„æ»åæŒ‡æ ‡
- ğŸ“Š **å¸‚åœºæ“çºµ**ï¼šè´¹ç‡å®¹æ˜“è¢«å¤§æˆ·æ“çºµ
- ğŸ¯ **æ›´ç›´æ¥æŒ‡æ ‡**ï¼šè®¢å•æµå¤±è¡¡ã€æŒä»“é‡å˜åŒ–æ›´å®æ—¶
- ğŸ·ï¸ **ä¿ç•™ä»·å€¼**ï¼šè´¹ç‡ä»æœ‰å‚è€ƒä»·å€¼ï¼Œä½œä¸ºè¾…åŠ©ä¿¡æ¯ä¿ç•™

**å®é™…æ•ˆæœ**ï¼š
- å‡å°‘å› è´¹ç‡è¯¯å¯¼å¯¼è‡´çš„é”™è¯¯ä¿¡å·
- æé«˜ä¿¡å·çš„æ—¶æ•ˆæ€§
- ä¿æŒå¯¹å¸‚åœºæƒ…ç»ªçš„æ„ŸçŸ¥ï¼ˆé€šè¿‡æ ‡è®°ï¼‰

#### 3.2.3 é—¸é—¨ä¼˜å…ˆçº§

**åŸåˆ™**ï¼šé£é™©é—¸é—¨ > è´¨é‡é—¸é—¨ > æ–¹å‘åˆ¤æ–­

**é€»è¾‘é¡ºåº**ï¼š
```
é£é™©å‡†å…¥ (risk_exposure_allowed)
    â†“ False â†’ NO_TRADE (ç›´æ¥æ‹’ç»ï¼Œä¸å†ç»§ç»­)
äº¤æ˜“è´¨é‡ (trade_quality)
    â†“ POOR â†’ NO_TRADE (ç›´æ¥æ‹’ç»ï¼Œä¸å†ç»§ç»­)
æ–¹å‘åˆ¤æ–­ (long_flag, short_flag)
    â†“ æ‰è¿›è¡Œæ–¹å‘è¯„ä¼°
```

**è®¾è®¡åŸå› **ï¼š
- ğŸ›¡ï¸ **å®‰å…¨ç¬¬ä¸€**ï¼šç³»ç»Ÿæ€§é£é™©æœ€å±é™©ï¼Œå¿…é¡»æœ€å…ˆæ£€æŸ¥
- ğŸ¯ **æ•ˆç‡ä¼˜åŒ–**ï¼šé£é™©æ‹’ç»åæ— éœ€è®¡ç®—æ–¹å‘ï¼ŒèŠ‚çœè®¡ç®—èµ„æº
- ğŸ“Š **å†³ç­–è´¨é‡**ï¼šç¡®ä¿å³ä½¿æœ‰æ–¹å‘ä¿¡å·ï¼Œä¹Ÿå¿…é¡»é€šè¿‡é£é™©å’Œè´¨é‡æ£€æŸ¥

**ç¤ºä¾‹åœºæ™¯**ï¼š
```
åœºæ™¯1ï¼šEXTREMEè¡Œæƒ…
- ä»·æ ¼1hæ¶¨7% â†’ EXTREME
- ä¹°å–å¤±è¡¡0.8ï¼ˆå¼ºä¹°å‹ï¼‰â†’ åšå¤šä¿¡å·å¼º
- æŒä»“é‡å¢é•¿20% â†’ åšå¤šä¿¡å·å¼º
- ç»“æœï¼šé£é™©é—¸é—¨æ‹’ç» â†’ NO_TRADE
- åŸå› ï¼šæç«¯è¡Œæƒ…é£é™©ä¼˜å…ˆçº§æœ€é«˜

åœºæ™¯2ï¼šå¸çº³é£é™©
- é£é™©å‡†å…¥é€šè¿‡
- ä¹°å–å¤±è¡¡0.9ï¼ˆæå¼ºä¹°å‹ï¼‰â†’ åšå¤šä¿¡å·
- ä½†æˆäº¤é‡æä½ï¼ˆä»…24hå‡å€¼20%ï¼‰â†’ å¸çº³é£é™©
- ç»“æœï¼šè´¨é‡é—¸é—¨æ‹’ç» â†’ NO_TRADE
- åŸå› ï¼šå¯èƒ½æ˜¯è¯±å¤šæŒ‚å•
```

#### 3.2.4 ç½®ä¿¡åº¦å·¥ç¨‹åŒ–

**åŸåˆ™**ï¼šç½®ä¿¡åº¦ä¸æ˜¯"æ„Ÿè§‰"ï¼Œè€Œæ˜¯åŸºäºå¸‚åœºç¯å¢ƒå’Œç³»ç»ŸçŠ¶æ€çš„å·¥ç¨‹åŒ–è®¡ç®—

**ç½®ä¿¡åº¦çŸ©é˜µ**ï¼š

| å¸‚åœºç¯å¢ƒ | ç³»ç»ŸçŠ¶æ€ | ç½®ä¿¡åº¦ | è¯´æ˜ |
|---------|---------|--------|------|
| TREND | LONG_ACTIVE / SHORT_ACTIVE | **HIGH** | è¶‹åŠ¿å¸‚ + ä¿¡å·æ¿€æ´» = æœ€é«˜ç½®ä¿¡ |
| TREND | WAIT | **MEDIUM** | è¶‹åŠ¿å¸‚ + ç­‰å¾…çŠ¶æ€ = ä¸­ç­‰ç½®ä¿¡ |
| RANGE | LONG_ACTIVE / SHORT_ACTIVE | **MEDIUM** | éœ‡è¡å¸‚ + ä¿¡å·æ¿€æ´» = ä¸­ç­‰ç½®ä¿¡ |
| RANGE | WAIT | **LOW** | éœ‡è¡å¸‚ + ç­‰å¾…çŠ¶æ€ = ä½ç½®ä¿¡ |
| EXTREME | - | **LOW** | æç«¯è¡Œæƒ… = ä½ç½®ä¿¡ï¼ˆå®é™…ä¼šNO_TRADEï¼‰ |
| - | COOL_DOWN | **LOW** | å†·å´æœŸ = ä½ç½®ä¿¡ï¼ˆå®é™…ä¼šNO_TRADEï¼‰ |

**è®¾è®¡åŸå› **ï¼š
- ğŸ“Š **å®¢è§‚é‡åŒ–**ï¼šåŸºäºæ˜ç¡®çš„å¸‚åœºçŠ¶æ€ï¼Œä¸æ˜¯ä¸»è§‚åˆ¤æ–­
- ğŸ¯ **å¯é¢„æµ‹**ï¼šç”¨æˆ·å¯ä»¥æå‰çŸ¥é“ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæœ‰é«˜ç½®ä¿¡åº¦
- ğŸ”§ **å¯è°ƒæ•´**ï¼šæœªæ¥å¯ä»¥å¼•å…¥æ›´å¤æ‚çš„ç½®ä¿¡åº¦æ¨¡å‹
- ğŸ“ˆ **å¯ç»Ÿè®¡**ï¼šé«˜ç½®ä¿¡åº¦ä¿¡å·çš„èƒœç‡å¯ä»¥ç»Ÿè®¡éªŒè¯

**å®é™…åº”ç”¨**ï¼š
```python
# é«˜ç½®ä¿¡åº¦ç¤ºä¾‹
{
  "decision": "long",
  "confidence": "high",
  "market_regime": "trend",
  "system_state": "long_active",
  "executable": true  # å¯æ‰§è¡Œ
}

# ä½ç½®ä¿¡åº¦ç¤ºä¾‹
{
  "decision": "short",
  "confidence": "low",
  "market_regime": "range",
  "system_state": "wait",
  "executable": false  # ä¸å¯æ‰§è¡Œ
}
```

#### 3.2.5 çŠ¶æ€æœºçº¦æŸ

**åŸåˆ™**ï¼šé€šè¿‡çŠ¶æ€æœºç®¡ç†ä¿¡å·ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…é¢‘ç¹åˆ‡æ¢

**çŠ¶æ€è½¬æ¢å›¾**ï¼š
```
        INIT
         â†“
        WAIT â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†™     â†˜                â”‚
LONG_ACTIVE  SHORT_ACTIVE    â”‚
      â†˜     â†™                â”‚
     COOL_DOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     (60åˆ†é’Ÿ)
```

**è½¬æ¢è§„åˆ™**ï¼š
1. **INIT â†’ WAIT**ï¼šç³»ç»Ÿå¯åŠ¨åè¿›å…¥ç­‰å¾…
2. **WAIT â†’ LONG_ACTIVE**ï¼šæ”¶åˆ°LONGä¿¡å·
3. **WAIT â†’ SHORT_ACTIVE**ï¼šæ”¶åˆ°SHORTä¿¡å·
4. **LONG_ACTIVE â†’ COOL_DOWN**ï¼š
   - æ”¶åˆ°SHORTä¿¡å·ï¼ˆæ–¹å‘å†²çªï¼‰
   - ä¿¡å·è¶…æ—¶ï¼ˆ30åˆ†é’Ÿæ— æ–°ä¿¡å·ï¼‰
5. **SHORT_ACTIVE â†’ COOL_DOWN**ï¼š
   - æ”¶åˆ°LONGä¿¡å·ï¼ˆæ–¹å‘å†²çªï¼‰
   - ä¿¡å·è¶…æ—¶ï¼ˆ30åˆ†é’Ÿæ— æ–°ä¿¡å·ï¼‰
6. **COOL_DOWN â†’ WAIT**ï¼š60åˆ†é’Ÿå†·å´æœŸç»“æŸ

**çº¦æŸè§„åˆ™**ï¼š
- âŒ LONG_ACTIVEçŠ¶æ€ä¸‹ä¸èƒ½ç›´æ¥åˆ‡æ¢åˆ°SHORT_ACTIVE
- âŒ COOL_DOWNæœŸé—´æ‹’ç»æ‰€æœ‰æ–°ä¿¡å·
- âœ… å¿…é¡»ç»è¿‡COOL_DOWNæ‰èƒ½æ”¹å˜æ–¹å‘
- âœ… æ¯æ¬¡æ¿€æ´»åè‡³å°‘å†·å´60åˆ†é’Ÿ

**è®¾è®¡åŸå› **ï¼š
- ğŸ”’ **é¿å…é¢‘ç¹äº¤æ˜“**ï¼šå¼ºåˆ¶å†·å´æœŸ
- ğŸ¯ **é˜²æ­¢æ¥å›æ‰“è„¸**ï¼šä¸å…è®¸æ–¹å‘ç›´æ¥åè½¬
- ğŸ“Š **ä¿¡å·è´¨é‡ä¿è¯**ï¼šåªæœ‰æŒç»­çš„å¼ºä¿¡å·æ‰èƒ½ä¿æŒACTIVE
- ğŸ’° **é™ä½æˆæœ¬**ï¼šå‡å°‘æ‰‹ç»­è´¹å’Œæ»‘ç‚¹æŸå¤±

**å®ç°**ï¼š
```python
def _check_state_transition(self, decision: Decision) -> Tuple[bool, List[ReasonTag]]:
    # COOL_DOWNæœŸé—´æ‹’ç»æ‰€æœ‰ä¿¡å·
    if self.current_state == SystemState.COOL_DOWN:
        elapsed = (datetime.now() - self.state_enter_time).total_seconds() / 60
        if elapsed < 60:
            return False, [ReasonTag.COOL_DOWN_ACTIVE]
        else:
            self.current_state = SystemState.WAIT
    
    # æ£€æŸ¥æ–¹å‘å†²çª
    if decision == Decision.LONG and self.current_state == SystemState.SHORT_ACTIVE:
        return False, [ReasonTag.STATE_TRANSITION_DENIED]
    
    if decision == Decision.SHORT and self.current_state == SystemState.LONG_ACTIVE:
        return False, [ReasonTag.STATE_TRANSITION_DENIED]
    
    return True, []
```

### 3.3 ç­–ç•¥å®ç°ç»†èŠ‚

#### 3.3.1 å¸‚åœºç¯å¢ƒè¯†åˆ«ç­–ç•¥

**ç›®æ ‡**ï¼šå¿«é€Ÿå‡†ç¡®è¯†åˆ«å¸‚åœºå¤„äºè¶‹åŠ¿ã€éœ‡è¡è¿˜æ˜¯æç«¯çŠ¶æ€

**è¯†åˆ«é€»è¾‘**ï¼š
```python
def _detect_market_regime(data: Dict) -> MarketRegime:
    price_change_1h = abs(data['price_change_1h'])
    price_change_6h = abs(data['price_change_6h'])
    
    # ä¼˜å…ˆçº§1: EXTREMEï¼ˆæœ€å±é™©ï¼‰
    if price_change_1h > 5.0:
        return MarketRegime.EXTREME
    
    # ä¼˜å…ˆçº§2: TRENDï¼ˆæœ‰æ–¹å‘æ€§ï¼‰
    if price_change_6h > 3.0:
        return MarketRegime.TREND
    
    # é»˜è®¤: RANGEï¼ˆéœ‡è¡ï¼‰
    return MarketRegime.RANGE
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

1. **1h vs 6h**ï¼š
   - 1hç”¨äºè¯†åˆ«EXTREMEï¼šçŸ­æ—¶é—´å¤§å¹…æ³¢åŠ¨æ˜¯æç«¯è¡Œæƒ…ç‰¹å¾
   - 6hç”¨äºè¯†åˆ«TRENDï¼šä¸­æœŸæŒç»­å˜åŒ–æ‰æ˜¯çœŸè¶‹åŠ¿

2. **é˜ˆå€¼é€‰æ‹©**ï¼š
   - 5%ï¼ˆEXTREMEï¼‰ï¼šåŸºäºå†å²æ•°æ®ï¼Œ1hæ¶¨è·Œ5%åœ¨åŠ å¯†è´§å¸å¸‚åœºå·²å±æç«¯
   - 3%ï¼ˆTRENDï¼‰ï¼š6hæ¶¨è·Œ3%è¯´æ˜æœ‰æ˜ç¡®æ–¹å‘ï¼Œä½†ä¸ç®—æç«¯

3. **ä¼˜å…ˆçº§é¡ºåº**ï¼š
   - EXTREMEä¼˜å…ˆçº§æœ€é«˜ï¼šå®‰å…¨ç¬¬ä¸€
   - TRENDæ¬¡ä¹‹ï¼šæœ‰åˆ©äºè¶‹åŠ¿è·Ÿè¸ª
   - RANGEå…œåº•ï¼šé»˜è®¤ä¿å®ˆç­–ç•¥

**é€‚åº”æ€§**ï¼š
- éœ‡è¡å¸‚ï¼ˆ80%æ—¶é—´ï¼‰ï¼šRANGEç­–ç•¥ï¼Œæ›´ä¸¥æ ¼çš„å…¥åœºæ¡ä»¶
- è¶‹åŠ¿å¸‚ï¼ˆ15%æ—¶é—´ï¼‰ï¼šTRENDç­–ç•¥ï¼Œç§¯ææŠŠæ¡æœºä¼š
- æç«¯å¸‚ï¼ˆ5%æ—¶é—´ï¼‰ï¼šEXTREMEç­–ç•¥ï¼Œå®Œå…¨è§„é¿é£é™©

#### 3.3.2 é£é™©è¯†åˆ«ç­–ç•¥

**ç›®æ ‡**ï¼šè¯†åˆ«ç³»ç»Ÿæ€§é£é™©ï¼Œé¿å…åœ¨å±é™©æ—¶åˆ»äº¤æ˜“

**1. æ¸…ç®—é˜¶æ®µæ£€æµ‹**

**ç‰¹å¾**ï¼š
- ä»·æ ¼æ€¥å‰§å˜åŒ–ï¼ˆ>5%ï¼‰
- æŒä»“é‡éª¤é™ï¼ˆ<-15%ï¼‰

**åŸç†**ï¼š
å¤§è§„æ¨¡æ¸…ç®—å‘ç”Ÿæ—¶ï¼Œä»·æ ¼å‰§çƒˆæ³¢åŠ¨ï¼ŒåŒæ—¶å¤§é‡ä»“ä½è¢«å¼ºå¹³å¯¼è‡´æŒä»“é‡ä¸‹é™ã€‚è¿™ç§æ—¶å€™å¸‚åœºæåº¦æ··ä¹±ï¼Œä¸å®œäº¤æ˜“ã€‚

**ä»£ç **ï¼š
```python
if (abs(price_change_1h) > 5.0 and oi_change_1h < -15.0):
    return False, [ReasonTag.LIQUIDATION_PHASE]
```

**2. æ‹¥æŒ¤é£é™©æ£€æµ‹**

**ç‰¹å¾**ï¼š
- èµ„é‡‘è´¹ç‡æç«¯ï¼ˆ>0.1%ï¼‰
- æŒä»“é‡å¿«é€Ÿå¢é•¿ï¼ˆ>30%ï¼‰

**åŸç†**ï¼š
å½“å¤§é‡èµ„é‡‘æ¶Œå…¥åŒä¸€æ–¹å‘æ—¶ï¼Œèµ„é‡‘è´¹ç‡é£™å‡ï¼ŒæŒä»“é‡å¿«é€Ÿå¢é•¿ã€‚è¿™ç§"æ‹¥æŒ¤äº¤æ˜“"ä¸€æ—¦åè½¬ï¼Œä¼šå¼•å‘è¿é”æ¸…ç®—ã€‚

**ä»£ç **ï¼š
```python
if (abs(funding_rate) > 0.001 and oi_change_6h > 30.0):
    return False, [ReasonTag.CROWDING_RISK]
```

**3. æç«¯æˆäº¤é‡æ£€æµ‹**

**ç‰¹å¾**ï¼š
- 1hæˆäº¤é‡ > 24hå¹³å‡å€¼ Ã— 10å€

**åŸç†**ï¼š
æˆäº¤é‡çªç„¶æ”¾å¤§10å€é€šå¸¸æ„å‘³ç€ï¼š
- é‡å¤§æ–°é—»å‘å¸ƒ
- å¤§æˆ·é›†ä¸­æ“ä½œ
- å¸‚åœºææ…Œæˆ–ç‹‚çƒ­

è¿™ç§æ—¶å€™ä»·æ ¼å‘ç°æœºåˆ¶å¤±æ•ˆï¼Œä¸å®œäº¤æ˜“ã€‚

**ä»£ç **ï¼š
```python
if (volume_1h > volume_24h / 24 * 10.0):
    return False, [ReasonTag.EXTREME_VOLUME]
```

#### 3.3.3 è´¨é‡è¯„ä¼°ç­–ç•¥

**ç›®æ ‡**ï¼šè¯†åˆ«ä¿¡å·è´¨é‡é—®é¢˜ï¼Œè¿‡æ»¤ä½è´¨é‡æœºä¼š

**1. å¸çº³é£é™©ï¼ˆAbsorption Riskï¼‰**

**ç‰¹å¾**ï¼š
- ä¹°å–ä¸¥é‡å¤±è¡¡ï¼ˆ>70%ï¼‰
- ä½†æˆäº¤é‡å¾ˆä½ï¼ˆ<24hå‡å€¼50%ï¼‰

**åŸç†**ï¼š
è¿™ç§æƒ…å†µé€šå¸¸æ˜¯å¤§æˆ·åœ¨ä½æˆäº¤é‡æ—¶æ®µæŒ‚å‡ºå•è¾¹è¯±å¯¼æ€§è®¢å•ï¼Œåˆ¶é€ å‡è±¡å¼•è¯±æ•£æˆ·è¿›åœºï¼Œç„¶åå¤§æˆ·åœ¨å¯¹æ‰‹ç›˜å‡ºç°åæ’¤å•æˆ–åå‘å¼€ä»“ã€‚

**ä»£ç **ï¼š
```python
if (abs(imbalance) > 0.7 and volume_ratio < 0.5):
    return TradeQuality.POOR, [ReasonTag.ABSORPTION_RISK]
```

**2. å™ªéŸ³å¸‚åœºï¼ˆNoisy Marketï¼‰**

**ç‰¹å¾**ï¼š
- èµ„é‡‘è´¹ç‡æ³¢åŠ¨å¤§ï¼ˆ>0.05%ï¼‰
- ä½†å½“å‰è´¹ç‡æ¥è¿‘0ï¼ˆ<0.01%ï¼‰

**åŸç†**ï¼š
è´¹ç‡å‰§çƒˆæ³¢åŠ¨ä½†æ— æ˜ç¡®æ–¹å‘ï¼Œè¯´æ˜å¸‚åœºæƒ…ç»ªæ··ä¹±ï¼Œå¤šç©ºåŠ›é‡åå¤æ‹‰é”¯ï¼Œæ²¡æœ‰ä¸»å¯¼æ–¹å‘ã€‚

**ä»£ç **ï¼š
```python
if (funding_volatility > 0.0005 and abs(funding_rate) < 0.0001):
    return TradeQuality.POOR, [ReasonTag.NOISY_MARKET]
```

**3. è½®åŠ¨é£é™©ï¼ˆRotation Riskï¼‰**

**ç‰¹å¾**ï¼š
- ä»·æ ¼æœ‰æ˜æ˜¾å˜åŒ–ï¼ˆ>2%ï¼‰
- ä½†æŒä»“é‡å˜åŒ–å¾ˆå°ï¼ˆ<5%ï¼‰

**åŸç†**ï¼š
ä»·æ ¼æ¶¨ä½†æŒä»“é‡ä¸æ¶¨ï¼Œè¯´æ˜ä¸æ˜¯æ–°èµ„é‡‘è¿›åœºæ¨åŠ¨ï¼Œè€Œæ˜¯å­˜é‡èµ„é‡‘åœ¨ä¸åŒå¸ç§é—´è½®åŠ¨ã€‚è¿™ç§æ¶¨åŠ¿æŒç»­æ€§å·®ã€‚

**ä»£ç **ï¼š
```python
if (abs(price_change_6h) > 2.0 and abs(oi_change_6h) < 5.0):
    return TradeQuality.POOR, [ReasonTag.ROTATION_RISK]
```

**4. éœ‡è¡å¼±ä¿¡å·ï¼ˆWeak Signal in Rangeï¼‰**

**ç‰¹å¾**ï¼ˆåœ¨RANGEå¸‚åœºä¸­ï¼‰ï¼š
- ä¹°å–å¤±è¡¡ä¸å¤Ÿå¼ºï¼ˆ<60%ï¼‰
- æˆ–æŒä»“é‡å˜åŒ–ä¸å¤Ÿå¤§ï¼ˆ<10%ï¼‰

**åŸç†**ï¼š
éœ‡è¡å¸‚æœ¬èº«æ–¹å‘æ€§å°±å¼±ï¼Œå¦‚æœä¿¡å·å¼ºåº¦å†ä¸å¤Ÿï¼ŒæˆåŠŸæ¦‚ç‡å¾ˆä½ã€‚å¿…é¡»åœ¨éœ‡è¡å¸‚ä¸­æé«˜ä¿¡å·å¼ºåº¦è¦æ±‚ã€‚

**ä»£ç **ï¼š
```python
if regime == MarketRegime.RANGE:
    if (abs(imbalance) < 0.6 or abs(oi_change_6h) < 10.0):
        return TradeQuality.POOR, [ReasonTag.WEAK_SIGNAL_IN_RANGE]
```

#### 3.3.4 æ–¹å‘åˆ¤æ–­ç­–ç•¥

**ç›®æ ‡**ï¼šåŸºäºå¤šç»´åº¦æ•°æ®åˆ¤æ–­åšå¤šæˆ–åšç©º

**åšå¤šä¿¡å·æ¡ä»¶**ï¼š

**åœ¨TRENDå¸‚åœº**ï¼š
```python
return (
    imbalance > 0.6 and        # ä¹°æ–¹åŠ›é‡å ä¼˜ï¼ˆ60%ä»¥ä¸Šï¼‰
    oi_change_1h > 5.0 and     # æŒä»“é‡å¢é•¿ï¼ˆæ–°èµ„é‡‘è¿›åœºï¼‰
    price_change_1h > 1.0      # ä»·æ ¼ä¸Šæ¶¨ï¼ˆè¶‹åŠ¿ç¡®è®¤ï¼‰
)
```

**é€»è¾‘é“¾æ¡**ï¼š
1. ä¹°æ–¹åŠ›é‡å¼ºï¼ˆè®¢å•æµå¤±è¡¡ï¼‰â†’ éœ€æ±‚æ—ºç››
2. æŒä»“é‡å¢é•¿ â†’ æ–°èµ„é‡‘çœ‹å¤šè¿›åœº
3. ä»·æ ¼ä¸Šæ¶¨ â†’ è¶‹åŠ¿å·²ç»å½¢æˆ

ä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ï¼Œå½¢æˆå…±æŒ¯ï¼Œåšå¤šä¿¡å·å¯é æ€§é«˜ã€‚

**åœ¨RANGEå¸‚åœº**ï¼š
```python
return (
    imbalance > 0.7 and        # ä¹°æ–¹åŠ›é‡æ›´å¼ºï¼ˆ70%ä»¥ä¸Šï¼‰
    oi_change_1h > 10.0        # æŒä»“é‡å¢é•¿æ›´å¤šï¼ˆ10%ä»¥ä¸Šï¼‰
    # ä¸è¦æ±‚ä»·æ ¼å˜åŒ–
)
```

**ä¸ºä»€ä¹ˆæ›´ä¸¥æ ¼ï¼Ÿ**
- éœ‡è¡å¸‚æ–¹å‘æ€§å¼±ï¼Œå¿…é¡»è¦æ±‚æ›´å¼ºçš„ä¿¡å·
- ä¸è¦æ±‚ä»·æ ¼å˜åŒ–ï¼Œå› ä¸ºéœ‡è¡å¸‚ä»·æ ¼æœ¬å°±æ¥å›æ³¢åŠ¨
- æ›´å…³æ³¨è®¢å•æµå’ŒæŒä»“é‡ï¼ˆæ›´é¢†å…ˆçš„æŒ‡æ ‡ï¼‰

**åšç©ºä¿¡å·æ¡ä»¶**ï¼ˆé€»è¾‘ç±»ä¼¼ï¼Œæ–¹å‘ç›¸åï¼‰ï¼š

**åœ¨TRENDå¸‚åœº**ï¼š
```python
return (
    imbalance < -0.6 and       # å–æ–¹åŠ›é‡å ä¼˜
    oi_change_1h > 5.0 and     # æŒä»“é‡å¢é•¿ï¼ˆæ–°èµ„é‡‘åšç©ºè¿›åœºï¼‰
    price_change_1h < -1.0     # ä»·æ ¼ä¸‹è·Œï¼ˆè¶‹åŠ¿ç¡®è®¤ï¼‰
)
```

**åœ¨RANGEå¸‚åœº**ï¼š
```python
return (
    imbalance < -0.7 and       # å–æ–¹åŠ›é‡æ›´å¼º
    oi_change_1h > 10.0        # æŒä»“é‡å¢é•¿æ›´å¤š
)
```

**èµ„é‡‘è´¹ç‡çš„è¾…åŠ©ä½œç”¨**ï¼š
```python
# æ£€æµ‹åˆ°åšå¤šä¿¡å·å
if funding_rate < -0.0001:
    tags.append(ReasonTag.LOW_FUNDING_RATE)  # æ ‡è®°ï¼šè´¹ç‡ä½ï¼Œåˆ©äºåšå¤š
elif funding_rate > 0.0001:
    tags.append(ReasonTag.HIGH_FUNDING_RATE)  # æ ‡è®°ï¼šè´¹ç‡é«˜ï¼Œåšå¤šæˆæœ¬é«˜
```

#### 3.3.5 å†²çªå¤„ç†ç­–ç•¥

**åœºæ™¯**ï¼šåšå¤šå’Œåšç©ºä¿¡å·åŒæ—¶å‡ºç°

**ç­–ç•¥**ï¼šä¿å®ˆå¤„ç†ï¼Œè¾“å‡ºNO_TRADE

**ä»£ç **ï¼š
```python
def _decide_priority(long_flag: bool, short_flag: bool) -> Decision:
    if long_flag and short_flag:
        # å†²çªï¼šä¸¤ä¸ªä¿¡å·éƒ½æœ‰
        return Decision.NO_TRADE, [ReasonTag.CONFLICTING_SIGNALS]
    
    if long_flag:
        return Decision.LONG, []
    
    if short_flag:
        return Decision.SHORT, []
    
    # æ— ä¿¡å·
    return Decision.NO_TRADE, [ReasonTag.NO_CLEAR_DIRECTION]
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

1. **å®‰å…¨ä¼˜å…ˆ**ï¼šä¿¡å·å†²çªè¯´æ˜å¸‚åœºæ··ä¹±ï¼Œå®å¯é”™è¿‡
2. **é¿å…è¯¯å¯¼**ï¼šå¼ºè¡Œé€‰æ‹©ä¸€ä¸ªæ–¹å‘å¯èƒ½è¯¯å¯¼L3æ‰§è¡Œå±‚
3. **æç¤ºç”¨æˆ·**ï¼šé€šè¿‡CONFLICTING_SIGNALSæ ‡ç­¾å‘ŠçŸ¥ç”¨æˆ·åŸå› 
4. **ç­‰å¾…æ¸…æ™°ä¿¡å·**ï¼šå¸‚åœºæ–¹å‘æ˜ç¡®åè‡ªç„¶ä¼šå‡ºç°å•ä¸€ä¿¡å·

**å®é™…æ¡ˆä¾‹**ï¼š
```
å¸‚åœºæ•°æ®ï¼š
- ä¹°å–å¤±è¡¡ï¼š0.7ï¼ˆä¹°æ–¹å¼ºï¼‰â†’ åšå¤šä¿¡å·
- æŒä»“é‡å˜åŒ–ï¼š+12%ï¼ˆå¢é•¿ï¼‰â†’ åšå¤šä¿¡å·
- ä»·æ ¼å˜åŒ–ï¼š-2%ï¼ˆä¸‹è·Œï¼‰â†’ åšç©ºä¿¡å·

åˆ†æï¼š
- ä¹°æ–¹åŠ›é‡å¼ºï¼ŒæŒä»“é‡å¢é•¿ï¼Œä½†ä»·æ ¼å´åœ¨è·Œ
- å¯èƒ½åŸå› ï¼šå¤§æˆ·å¸ç­¹ï¼ˆä¹°å…¥ä½†å‹ä»·ï¼‰æˆ–å¤šå¤´è¢«å¥—ï¼ˆä¸æ„¿æ­¢æŸï¼‰
- å†³ç­–ï¼šä¿¡å·å†²çªï¼Œæš‚æ—¶è§‚æœ›

è¾“å‡ºï¼š
{
  "decision": "no_trade",
  "reason_tags": ["conflicting_signals"]
}
```

### 3.4 ç­–ç•¥ä¼˜åŠ¿ä¸å±€é™

#### 3.4.1 ç­–ç•¥ä¼˜åŠ¿

**1. é«˜å®‰å…¨æ€§**
- âœ… å¤šå±‚é—¸é—¨é˜²æŠ¤
- âœ… ä¿å®ˆé˜ˆå€¼è®¾è®¡
- âœ… å¼ºåˆ¶å†·å´æœŸ
- âœ… æç«¯ç¯å¢ƒè¯†åˆ«

**2. é«˜å¯é æ€§**
- âœ… å›ºåŒ–å†³ç­–æµç¨‹
- âœ… å¤šç»´åº¦æ•°æ®éªŒè¯
- âœ… çŠ¶æ€æœºçº¦æŸ
- âœ… å……åˆ†æµ‹è¯•è¦†ç›–

**3. é«˜å¯ç»´æŠ¤æ€§**
- âœ… é…ç½®å¤–éƒ¨åŒ–
- âœ… æ¸…æ™°çš„ä»£ç ç»“æ„
- âœ… å®Œå–„çš„æ–‡æ¡£
- âœ… æ ‡å‡†åŒ–è¾“å‡º

**4. é«˜é€‚åº”æ€§**
- âœ… è¯†åˆ«ä¸åŒå¸‚åœºç¯å¢ƒ
- âœ… åŠ¨æ€è°ƒæ•´ä¿¡å·é˜ˆå€¼
- âœ… æ”¯æŒçƒ­æ›´æ–°
- âœ… æ˜“äºä¼˜åŒ–

**5. é«˜é€æ˜åº¦**
- âœ… æ¯ä¸ªå†³ç­–éƒ½å¯è¿½æº¯
- âœ… ç®¡é“å¯è§†åŒ–
- âœ… å®Œæ•´å†å²è®°å½•
- âœ… æ ‡å‡†åŒ–æ ‡ç­¾

#### 3.4.2 ç­–ç•¥å±€é™

**1. ä¿å®ˆæ€§**
- âš ï¸ å¯èƒ½é”™è¿‡éƒ¨åˆ†æœºä¼š
- âš ï¸ ä¿¡å·é¢‘ç‡è¾ƒä½
- âš ï¸ éœ€è¦æ˜ç¡®çš„å¸‚åœºæ¡ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é€šè¿‡å›æµ‹ä¼˜åŒ–é˜ˆå€¼
- æ ¹æ®å®é™…è¡¨ç°è°ƒæ•´å‚æ•°
- æœªæ¥å¯å¢åŠ "æ¿€è¿›æ¨¡å¼"é…ç½®

**2. æ»åæ€§**
- âš ï¸ éœ€è¦ç­‰å¾…ç¡®è®¤ä¿¡å·
- âš ï¸ ä¸è¿½æ±‚æœ€ä½³å…¥åœºç‚¹
- âš ï¸ è¶‹åŠ¿åˆæœŸå¯èƒ½é”™è¿‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
- L1å®šä½å°±æ˜¯"å’¨è¯¢"ï¼Œä¸è¿½æ±‚æè‡´
- L2/L3å±‚å¯ä»¥ä¼˜åŒ–æ‰§è¡Œæ—¶æœº
- æ³¨é‡ä¿¡å·è´¨é‡è€Œéé€Ÿåº¦

**3. ä¾èµ–æ•°æ®è´¨é‡**
- âš ï¸ ä¾èµ–Binance APIç¨³å®šæ€§
- âš ï¸ å¼‚å¸¸æ•°æ®å½±å“å†³ç­–
- âš ï¸ ç¼“å­˜æ•°æ®å¯èƒ½è¿‡æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®Œå–„çš„æ•°æ®éªŒè¯æœºåˆ¶
- å¼‚å¸¸å¤„ç†å’Œå®¹é”™
- æœªæ¥å¯å¢åŠ å¤šæ•°æ®æº

**4. å•ä¸€å¸‚åœº**
- âš ï¸ ç›®å‰ä»…æ”¯æŒBinance
- âš ï¸ ä¸åŒäº¤æ˜“æ‰€ç‰¹æ€§ä¸åŒ
- âš ï¸ å¥—åˆ©æœºä¼šæ— æ³•æ•æ‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æœªæ¥æ‰©å±•å¤šäº¤æ˜“æ‰€æ”¯æŒ
- L2å±‚å¤„ç†è·¨äº¤æ˜“æ‰€ç­–ç•¥
- å½“å‰ä¸“æ³¨å•ä¸€å¸‚åœºåšç²¾

### 3.5 ç­–ç•¥æ¼”è¿›æ–¹å‘

#### 3.5.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ3ä¸ªæœˆå†…ï¼‰

1. **å›æµ‹æ¡†æ¶é›†æˆ**
   - å†å²æ•°æ®å›æ”¾
   - ç­–ç•¥è¡¨ç°è¯„ä¼°
   - å‚æ•°ä¼˜åŒ–å»ºè®®

2. **ä¿¡å·è´¨é‡è¯„åˆ†**
   - ä¸ºæ¯ä¸ªä¿¡å·è®¡ç®—è´¨é‡åˆ†æ•°ï¼ˆ0-100ï¼‰
   - åŸºäºå†å²å‡†ç¡®ç‡åŠ¨æ€è°ƒæ•´
   - æä¾›æ›´ç»†ç²’åº¦çš„ç½®ä¿¡åº¦

3. **å¤šå‘¨æœŸåˆ†æ**
   - å¢åŠ 15åˆ†é’Ÿã€4å°æ—¶å‘¨æœŸ
   - å¤šå‘¨æœŸå…±æŒ¯å¢å¼ºä¿¡å·
   - å‡å°‘å‡ä¿¡å·

#### 3.5.2 ä¸­æœŸæ¼”è¿›ï¼ˆ6-12ä¸ªæœˆï¼‰

1. **æœºå™¨å­¦ä¹ æ¨¡å‹**
   - ç‰¹å¾å·¥ç¨‹ï¼šæå–æ›´å¤šç»´åº¦ç‰¹å¾
   - æ¨¡å‹è®­ç»ƒï¼šä½¿ç”¨å†å²æ•°æ®è®­ç»ƒ
   - æ··åˆæ¨¡å‹ï¼šè§„åˆ™ + MLåŒé‡éªŒè¯

2. **æƒ…ç»ªæŒ‡æ ‡**
   - ç¤¾äº¤åª’ä½“æƒ…ç»ªåˆ†æ
   - é“¾ä¸Šæ•°æ®æ•´åˆ
   - å·¨é²¸è¡Œä¸ºè¿½è¸ª

3. **å¸‚åœºå¾®è§‚ç»“æ„**
   - è®¢å•ç°¿æ·±åº¦åˆ†æ
   - å¤§å•è¿½è¸ª
   - æµåŠ¨æ€§è¯„ä¼°

#### 3.5.3 é•¿æœŸæ„¿æ™¯ï¼ˆ12ä¸ªæœˆ+ï¼‰

1. **L2é€‰å¸å±‚**
   - è‡ªåŠ¨æ‰«æå¤šä¸ªå¸ç§
   - è¯„åˆ†æ’åº
   - å€™é€‰æ± ç®¡ç†

2. **L3æ‰§è¡Œå±‚**
   - æ™ºèƒ½ä»“ä½ç®¡ç†
   - åŠ¨æ€æ­¢æŸæ­¢ç›ˆ
   - åšå¸‚ç­–ç•¥

3. **è‡ªé€‚åº”ç­–ç•¥**
   - æ ¹æ®å¸‚åœºçŠ¶æ€è‡ªåŠ¨åˆ‡æ¢ç­–ç•¥
   - ä¸ªæ€§åŒ–å‚æ•°è°ƒæ•´
   - æŒç»­å­¦ä¹ ä¼˜åŒ–

---

## 4. æŠ€æœ¯æ¶æ„

### 4.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|-----|------|------|------|
| **åç«¯æ¡†æ¶** | Flask | 2.0+ | Webåº”ç”¨æ¡†æ¶ |
| **æ•°æ®æº** | Binance API | - | å®æ—¶å¸‚åœºæ•°æ® |
| **æ•°æ®åº“** | SQLite | 3 | å†å²å†³ç­–å­˜å‚¨ |
| **ç¼“å­˜** | å†…å­˜deque | - | å†å²æ•°æ®ç¼“å­˜ |
| **é…ç½®ç®¡ç†** | PyYAML | 6.0+ | YAMLé…ç½®è§£æ |
| **æ–‡ä»¶ç›‘æ§** | Watchdog | 2.1+ | é…ç½®çƒ­æ›´æ–° |
| **å®šæ—¶ä»»åŠ¡** | APScheduler | 3.9+ | æ•°æ®åº“æ¸…ç† |
| **å®¹å™¨åŒ–** | Docker | - | åº”ç”¨éƒ¨ç½² |
| **ç¼–æ’** | Docker Compose | - | å¤šå®¹å™¨ç®¡ç† |
| **æµ‹è¯•** | Pytest | 7.0+ | å•å…ƒæµ‹è¯• |
| **å‰ç«¯** | åŸç”ŸJS + CSS3 | - | Web UI |
| **è·¨åŸŸ** | Flask-CORS | 3.0+ | APIè·¨åŸŸæ”¯æŒ |

### 4.2 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Container                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Flask Web Application                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         L1AdvisoryEngine (æ ¸å¿ƒå¼•æ“)         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - 8æ­¥å†³ç­–ç®¡é“                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - é£é™©/è´¨é‡è¯„ä¼°                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - ç½®ä¿¡åº¦è®¡ç®—                               â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                      â†“                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚      BinanceDataFetcher (æ•°æ®è·å–å™¨)       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - Binance APIè°ƒç”¨                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - æ•°æ®æ ¼å¼åŒ–                               â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                      â†“                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚     MarketDataCache (æ•°æ®ç¼“å­˜)             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - 6å°æ—¶å†å²æ•°æ®                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - å˜åŒ–ç‡è®¡ç®—                               â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                      â†“                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚        L1Database (æ•°æ®åº“è®¿é—®å±‚)           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - å†³ç­–ç»“æœæŒä¹…åŒ–                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - å†å²æŸ¥è¯¢                                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  Volume Mounts:                                          â”‚
â”‚  - ./data/db â†’ /app/data/db (æ•°æ®åº“æŒä¹…åŒ–)              â”‚
â”‚  - ./config â†’ /app/config (é…ç½®çƒ­æ›´æ–°)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“                           â†‘
         Port 5001                   Binance API
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Web Browser    â”‚
    â”‚  (ç”¨æˆ·ç•Œé¢)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ ¸å¿ƒæ¨¡å—

#### 4.3.1 L1AdvisoryEngine (æ ¸å¿ƒå†³ç­–å¼•æ“)

**æ–‡ä»¶**: `market_state_machine_l1.py`

**èŒè´£**:
- å®ç°8æ­¥å›ºåŒ–å†³ç­–ç®¡é“
- å¸‚åœºç¯å¢ƒè¯†åˆ«
- é£é™©å‡†å…¥è¯„ä¼°
- äº¤æ˜“è´¨é‡è¯„ä¼°
- æ–¹å‘åˆ¤æ–­ï¼ˆèµ„é‡‘è´¹ç‡é™çº§ï¼‰
- ç½®ä¿¡åº¦è®¡ç®—
- è¾“å‡ºæ ‡å‡†åŒ–AdvisoryResult

**å…³é”®æ–¹æ³•**:
```python
def on_new_tick(symbol: str, data: Dict) -> AdvisoryResult
def _validate_data(data: Dict) -> Tuple[bool, List[ReasonTag]]
def _detect_market_regime(data: Dict) -> MarketRegime
def _eval_risk_exposure_allowed(data: Dict, regime: MarketRegime) -> Tuple[bool, List[ReasonTag]]
def _eval_trade_quality(data: Dict, regime: MarketRegime) -> Tuple[TradeQuality, List[ReasonTag]]
def _eval_long_direction(data: Dict, regime: MarketRegime) -> bool
def _eval_short_direction(data: Dict, regime: MarketRegime) -> bool
def _decide_priority(long_flag: bool, short_flag: bool) -> Decision
def _check_state_transition(decision: Decision) -> Tuple[bool, List[ReasonTag]]
def _compute_confidence(decision: Decision, regime: MarketRegime, state: SystemState) -> Confidence
```

#### 4.3.2 BinanceDataFetcher (æ•°æ®è·å–å™¨)

**æ–‡ä»¶**: `binance_data_fetcher.py`

**èŒè´£**:
- è°ƒç”¨Binance APIè·å–å®æ—¶æ•°æ®
- è®¡ç®—ä¹°å–å¤±è¡¡åº¦
- ä¸MarketDataCacheé›†æˆ
- å¼‚å¸¸å¤„ç†

**å…³é”®æ–¹æ³•**:
```python
def fetch_futures_data(symbol: str) -> Optional[dict]
def fetch_spot_data(symbol: str) -> Optional[dict]
```

#### 4.3.3 MarketDataCache (æ•°æ®ç¼“å­˜)

**æ–‡ä»¶**: `data_cache.py`

**èŒè´£**:
- å­˜å‚¨6å°æ—¶å†å²tickæ•°æ®
- è®¡ç®—1h/6hä»·æ ¼å˜åŒ–ç‡
- è®¡ç®—1h/6hæŒä»“é‡å˜åŒ–ç‡
- è®¡ç®—1hæˆäº¤é‡
- çº¿ç¨‹å®‰å…¨

**å…³é”®æ–¹æ³•**:
```python
def store_tick(symbol: str, data: dict, timestamp: datetime)
def get_price_change(symbol: str, hours: int) -> float
def get_oi_change(symbol: str, hours: int) -> float
def get_volume_1h(symbol: str) -> float
def enhance_data(symbol: str, current_data: dict) -> dict
```

#### 4.3.4 L1Database (æ•°æ®åº“è®¿é—®å±‚)

**æ–‡ä»¶**: `database_l1.py`

**èŒè´£**:
- åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“è¡¨
- ä¿å­˜AdvisoryResult
- æŸ¥è¯¢å†å²å†³ç­–
- æ•°æ®æ¸…ç†ï¼ˆ48å°æ—¶ï¼‰

**å…³é”®æ–¹æ³•**:
```python
def save_advisory_result(symbol: str, result: AdvisoryResult) -> int
def get_latest_advisory(symbol: str) -> Optional[AdvisoryResult]
def get_history_advisory(symbol: str, hours: int) -> List[AdvisoryResult]
def cleanup_old_records(hours: int)
```

#### 4.3.5 Flask Web Application

**æ–‡ä»¶**: `btc_web_app_l1.py`

**èŒè´£**:
- æä¾›Web UIç•Œé¢
- æä¾›RESTful API
- é…ç½®çƒ­æ›´æ–°ç›‘æ§
- å®šæ—¶æ•°æ®åº“æ¸…ç†

**è·¯ç”±**:
- `GET /` - Web UIä¸»é¡µ
- `GET /api/l1/advisory/<symbol>` - è·å–æœ€æ–°å†³ç­–
- `GET /api/l1/history/<symbol>` - è·å–å†å²å†³ç­–
- `GET /api/l1/pipeline-status/<symbol>` - è·å–ç®¡é“çŠ¶æ€
- `GET /api/l1/reason-tags/explain` - è·å–æ ‡ç­¾è§£é‡Š
- `GET /api/l1/thresholds` - è·å–é…ç½®é˜ˆå€¼
- `POST /api/l1/thresholds` - æ›´æ–°é…ç½®é˜ˆå€¼

---

## 5. åŠŸèƒ½å®ç°æ–¹å¼

### 5.1 å¸‚åœºç¯å¢ƒè¯†åˆ«

**å®ç°é€»è¾‘**:
```python
def _detect_market_regime(data: Dict) -> MarketRegime:
    price_change_1h = abs(data.get('price_change_1h', 0))
    price_change_6h = abs(data.get('price_change_6h', 0))
    
    # EXTREME: 1hå˜åŒ– > 5%
    if price_change_1h > self.thresholds['market_regime.extreme_price_change_1h']:
        return MarketRegime.EXTREME
    
    # TREND: 6hå˜åŒ– > 3%
    if price_change_6h > self.thresholds['market_regime.trend_price_change_6h']:
        return MarketRegime.TREND
    
    # RANGE: é»˜è®¤
    return MarketRegime.RANGE
```

**é˜ˆå€¼é…ç½®** (`config/l1_thresholds.yaml`):
```yaml
market_regime:
  extreme_price_change_1h: 5.0  # 5%
  trend_price_change_6h: 3.0    # 3%
```

### 5.2 é£é™©å‡†å…¥è¯„ä¼°

**æ£€æµ‹é¡¹**:
1. **æç«¯è¡Œæƒ…**: `market_regime == EXTREME` â†’ æ‹’ç»
2. **æ¸…ç®—é˜¶æ®µ**: ä»·æ ¼æ€¥å˜ + OIéª¤é™ â†’ æ‹’ç»
3. **æ‹¥æŒ¤é£é™©**: èµ„é‡‘è´¹ç‡æç«¯ + OIå¿«é€Ÿå¢é•¿ â†’ æ‹’ç»
4. **æç«¯æˆäº¤é‡**: 1hæˆäº¤é‡ > 24hå‡å€¼ Ã— 10 â†’ æ‹’ç»

**å®ç°é€»è¾‘**:
```python
def _eval_risk_exposure_allowed(data: Dict, regime: MarketRegime) -> Tuple[bool, List[ReasonTag]]:
    tags = []
    
    # 1. æç«¯è¡Œæƒ…
    if regime == MarketRegime.EXTREME:
        tags.append(ReasonTag.EXTREME_REGIME)
        return False, tags
    
    # 2. æ¸…ç®—é˜¶æ®µ
    price_change_1h = abs(data.get('price_change_1h', 0))
    oi_change_1h = data.get('oi_change_1h', 0)
    if (price_change_1h > self.thresholds['risk_exposure.liquidation.price_change'] and
        oi_change_1h < self.thresholds['risk_exposure.liquidation.oi_drop']):
        tags.append(ReasonTag.LIQUIDATION_PHASE)
        return False, tags
    
    # 3. æ‹¥æŒ¤é£é™©
    funding_rate = abs(data.get('funding_rate', 0))
    oi_change_6h = data.get('oi_change_6h', 0)
    if (funding_rate > self.thresholds['risk_exposure.crowding.funding_abs'] and
        oi_change_6h > self.thresholds['risk_exposure.crowding.oi_growth']):
        tags.append(ReasonTag.CROWDING_RISK)
        return False, tags
    
    # 4. æç«¯æˆäº¤é‡
    volume_1h = data.get('volume_1h', 0)
    volume_24h = data.get('volume_24h', 1)
    if volume_1h > volume_24h / 24 * self.thresholds['risk_exposure.extreme_volume.multiplier']:
        tags.append(ReasonTag.EXTREME_VOLUME)
        return False, tags
    
    return True, tags
```

### 5.3 äº¤æ˜“è´¨é‡è¯„ä¼°

**æ£€æµ‹é¡¹**:
1. **å¸çº³é£é™©**: å¤±è¡¡ä¸¥é‡ä½†æˆäº¤é‡ä½ â†’ POOR
2. **å™ªéŸ³å¸‚åœº**: èµ„é‡‘è´¹ç‡æ³¢åŠ¨å¤§ä½†æ— æ–¹å‘ â†’ POOR
3. **è½®åŠ¨é£é™©**: OIä¸ä»·æ ¼èµ°åŠ¿èƒŒç¦» â†’ POOR
4. **éœ‡è¡å¼±ä¿¡å·**: RANGEå¸‚åœºä¸­ä¿¡å·ä¸è¶³ â†’ POOR

**å®ç°é€»è¾‘**:
```python
def _eval_trade_quality(data: Dict, regime: MarketRegime) -> Tuple[TradeQuality, List[ReasonTag]]:
    tags = []
    
    # 1. å¸çº³é£é™©
    imbalance = abs(data.get('buy_sell_imbalance', 0))
    volume_1h = data.get('volume_1h', 0)
    volume_24h = data.get('volume_24h', 1)
    volume_ratio = volume_1h / (volume_24h / 24)
    
    if (imbalance > self.thresholds['trade_quality.absorption.imbalance'] and
        volume_ratio < self.thresholds['trade_quality.absorption.volume_ratio']):
        tags.append(ReasonTag.ABSORPTION_RISK)
        return TradeQuality.POOR, tags
    
    # 2. å™ªéŸ³å¸‚åœº
    funding_rate = abs(data.get('funding_rate', 0))
    funding_volatility = data.get('funding_volatility', 0)
    if (funding_volatility > self.thresholds['trade_quality.noise.funding_volatility'] and
        funding_rate < self.thresholds['trade_quality.noise.funding_abs']):
        tags.append(ReasonTag.NOISY_MARKET)
        return TradeQuality.POOR, tags
    
    # 3. è½®åŠ¨é£é™©
    price_change_6h = data.get('price_change_6h', 0)
    oi_change_6h = data.get('oi_change_6h', 0)
    if (abs(price_change_6h) > self.thresholds['trade_quality.rotation.price_threshold'] and
        abs(oi_change_6h) < self.thresholds['trade_quality.rotation.oi_threshold']):
        tags.append(ReasonTag.ROTATION_RISK)
        return TradeQuality.POOR, tags
    
    # 4. éœ‡è¡å¼±ä¿¡å·
    if regime == MarketRegime.RANGE:
        if (imbalance < self.thresholds['trade_quality.range_weak.imbalance'] or
            abs(oi_change_6h) < self.thresholds['trade_quality.range_weak.oi']):
            tags.append(ReasonTag.WEAK_SIGNAL_IN_RANGE)
            return TradeQuality.POOR, tags
    
    return TradeQuality.GOOD, tags
```

### 5.4 æ–¹å‘åˆ¤æ–­ï¼ˆèµ„é‡‘è´¹ç‡é™çº§ï¼‰

**åšå¤šä¿¡å·**:
- ä¹°å–å¤±è¡¡ > é˜ˆå€¼ï¼ˆä¹°æ–¹å¼ºï¼‰
- æŒä»“é‡å¢é•¿ > é˜ˆå€¼
- ä»·æ ¼ä¸Šæ¶¨ > é˜ˆå€¼ï¼ˆä»…TRENDå¸‚ï¼‰

**åšç©ºä¿¡å·**:
- ä¹°å–å¤±è¡¡ < -é˜ˆå€¼ï¼ˆå–æ–¹å¼ºï¼‰
- æŒä»“é‡å¢é•¿ > é˜ˆå€¼
- ä»·æ ¼ä¸‹è·Œ > é˜ˆå€¼ï¼ˆä»…TRENDå¸‚ï¼‰

**èµ„é‡‘è´¹ç‡è§’è‰²**:
- âŒ ä¸å†ä½œä¸ºä¸»è¦è§¦å‘æ¡ä»¶
- âœ… ä»…ç”¨äºè¾…åŠ©æ ‡è®°ï¼ˆHIGH_FUNDING_RATE / LOW_FUNDING_RATEï¼‰

**å®ç°é€»è¾‘**:
```python
def _eval_long_direction(data: Dict, regime: MarketRegime) -> bool:
    imbalance = data.get('buy_sell_imbalance', 0)
    oi_change_1h = data.get('oi_change_1h', 0)
    price_change_1h = data.get('price_change_1h', 0)
    
    if regime == MarketRegime.TREND:
        return (imbalance > self.thresholds['direction.trend.long.imbalance'] and
                oi_change_1h > self.thresholds['direction.trend.long.oi_change'] and
                price_change_1h > self.thresholds['direction.trend.long.price_change'])
    
    elif regime == MarketRegime.RANGE:
        return (imbalance > self.thresholds['direction.range.long.imbalance'] and
                oi_change_1h > self.thresholds['direction.range.long.oi_change'])
    
    return False

def _eval_short_direction(data: Dict, regime: MarketRegime) -> bool:
    imbalance = data.get('buy_sell_imbalance', 0)
    oi_change_1h = data.get('oi_change_1h', 0)
    price_change_1h = data.get('price_change_1h', 0)
    
    if regime == MarketRegime.TREND:
        return (imbalance < -self.thresholds['direction.trend.short.imbalance'] and
                oi_change_1h > self.thresholds['direction.trend.short.oi_change'] and
                price_change_1h < -self.thresholds['direction.trend.short.price_change'])
    
    elif regime == MarketRegime.RANGE:
        return (imbalance < -self.thresholds['direction.range.short.imbalance'] and
                oi_change_1h > self.thresholds['direction.range.short.oi_change'])
    
    return False
```

### 5.5 ç½®ä¿¡åº¦è®¡ç®—

**è§„åˆ™**:
- **HIGH**: TRENDå¸‚ + ACTIVEçŠ¶æ€
- **MEDIUM**: TRENDå¸‚ + WAITçŠ¶æ€ï¼Œæˆ– RANGEå¸‚ + ACTIVEçŠ¶æ€
- **LOW**: RANGEå¸‚ + WAITçŠ¶æ€ï¼Œæˆ–å…¶ä»–æƒ…å†µ

**å®ç°é€»è¾‘**:
```python
def _compute_confidence(decision: Decision, regime: MarketRegime, state: SystemState) -> Confidence:
    if decision == Decision.NO_TRADE:
        return Confidence.LOW
    
    # HIGH: è¶‹åŠ¿å¸‚ + æ¿€æ´»çŠ¶æ€
    if regime == MarketRegime.TREND and state in [SystemState.LONG_ACTIVE, SystemState.SHORT_ACTIVE]:
        return Confidence.HIGH
    
    # MEDIUM: è¶‹åŠ¿å¸‚ + ç­‰å¾…çŠ¶æ€ï¼Œæˆ–éœ‡è¡å¸‚ + æ¿€æ´»çŠ¶æ€
    if (regime == MarketRegime.TREND and state == SystemState.WAIT) or \
       (regime == MarketRegime.RANGE and state in [SystemState.LONG_ACTIVE, SystemState.SHORT_ACTIVE]):
        return Confidence.MEDIUM
    
    # LOW: å…¶ä»–æƒ…å†µ
    return Confidence.LOW
```

### 5.6 æ‰§è¡Œè®¸å¯è®¡ç®—

**è§„åˆ™**:
- NO_TRADE â†’ False
- risk_exposure_allowed = False â†’ False
- trade_quality = POOR â†’ False
- confidence = LOW â†’ False
- confidence = HIGH/MEDIUM â†’ True

**å®ç°é€»è¾‘**:
```python
def compute_executable(self) -> bool:
    if self.decision == Decision.NO_TRADE:
        return False
    
    if not self.risk_exposure_allowed:
        return False
    
    if self.trade_quality == TradeQuality.POOR:
        return False
    
    if self.confidence in [Confidence.HIGH, Confidence.MEDIUM]:
        return True
    
    return False
```

### 5.7 çŠ¶æ€æœºç®¡ç†

**çŠ¶æ€å®šä¹‰**:
- `INIT`: åˆå§‹åŒ–çŠ¶æ€
- `WAIT`: ç­‰å¾…ä¿¡å·
- `LONG_ACTIVE`: åšå¤šä¿¡å·æ¿€æ´»
- `SHORT_ACTIVE`: åšç©ºä¿¡å·æ¿€æ´»
- `COOL_DOWN`: å†·å´æœŸï¼ˆ60åˆ†é’Ÿï¼‰

**è½¬æ¢è§„åˆ™**:
```
INIT â†’ WAIT
WAIT â†’ LONG_ACTIVE (æ”¶åˆ°LONGä¿¡å·)
WAIT â†’ SHORT_ACTIVE (æ”¶åˆ°SHORTä¿¡å·)
LONG_ACTIVE â†’ COOL_DOWN (æ”¶åˆ°ç›¸åä¿¡å·æˆ–è¶…æ—¶)
SHORT_ACTIVE â†’ COOL_DOWN (æ”¶åˆ°ç›¸åä¿¡å·æˆ–è¶…æ—¶)
COOL_DOWN â†’ WAIT (60åˆ†é’Ÿå)
```

**å®ç°é€»è¾‘**:
```python
def _check_state_transition(decision: Decision) -> Tuple[bool, List[ReasonTag]]:
    tags = []
    
    # COOL_DOWNæœŸé—´æ‹’ç»æ‰€æœ‰ä¿¡å·
    if self.current_state == SystemState.COOL_DOWN:
        elapsed = (datetime.now() - self.state_enter_time).total_seconds() / 60
        if elapsed < self.thresholds.get('state_machine.cool_down_minutes', 60):
            tags.append(ReasonTag.COOL_DOWN_ACTIVE)
            return False, tags
        else:
            self.current_state = SystemState.WAIT
            self.state_enter_time = datetime.now()
    
    # çŠ¶æ€è½¬æ¢é€»è¾‘
    if decision == Decision.LONG:
        if self.current_state in [SystemState.INIT, SystemState.WAIT]:
            self.current_state = SystemState.LONG_ACTIVE
            self.state_enter_time = datetime.now()
        elif self.current_state == SystemState.SHORT_ACTIVE:
            tags.append(ReasonTag.STATE_TRANSITION_DENIED)
            return False, tags
    
    elif decision == Decision.SHORT:
        if self.current_state in [SystemState.INIT, SystemState.WAIT]:
            self.current_state = SystemState.SHORT_ACTIVE
            self.state_enter_time = datetime.now()
        elif self.current_state == SystemState.LONG_ACTIVE:
            tags.append(ReasonTag.STATE_TRANSITION_DENIED)
            return False, tags
    
    return True, tags
```

---

## 6. Webå±•ç¤ºæ•ˆæœ

### 6.1 é¡µé¢å¸ƒå±€

**è®¿é—®åœ°å€**: `http://localhost:5001/`

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ L1 Advisory Layer                          â”‚
â”‚  äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ | Safety First               â”‚
â”‚  æœ€åæ›´æ–°: 2026-01-20 17:45:32  [ğŸ”„ åˆ·æ–°å†³ç­–]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š å¸ç§: [BTC] [ETH] [BNB] [SOL]              â”‚
â”‚  ğŸ’¹ å¸‚åœºç±»å‹: [ç°è´§] [åˆçº¦]                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¯ L1 å’¨è¯¢å†³ç­–                    [BTC]        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         âšª NO_TRADE                      â”‚  â”‚
â”‚  â”‚         ç½®ä¿¡åº¦: LOW â–“â–‘â–‘â–‘â–‘â–‘ 33%           â”‚  â”‚
â”‚  â”‚         å†³ç­–æ—¶é—´: 2026-01-20 17:45:32    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ›¡ï¸ å®‰å…¨é—¸é—¨çŠ¶æ€                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ âœ… é£é™© â”‚ â”‚ âš ï¸ è´¨é‡ â”‚ â”‚ â›” æ‰§è¡Œ â”‚          â”‚
â”‚  â”‚ å‡†å…¥é€šè¿‡â”‚ â”‚ è´¨é‡è¾ƒå·®â”‚ â”‚ ä¸å¯æ‰§è¡Œâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ·ï¸ å†³ç­–åŸå› æ ‡ç­¾                               â”‚
â”‚  [ğŸ“‰ éœ‡è¡å¼±ä¿¡å·] éœ‡è¡å¸‚ä¸­ä¿¡å·å¼ºåº¦ä¸è¶³          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” å†³ç­–ç®¡é“å¯è§†åŒ–                             â”‚
â”‚  âœ… æ•°æ®éªŒè¯ â†’ âœ… å¸‚åœºè¯†åˆ«(RANGE) â†’            â”‚
â”‚  âœ… é£é™©è¯„ä¼° â†’ âš ï¸ è´¨é‡è¯„ä¼°(POOR) â†’            â”‚
â”‚  â­ï¸ æ–¹å‘è¯„ä¼° â†’ â­ï¸ ä¼˜å…ˆå†³ç­– â†’                 â”‚
â”‚  â­ï¸ çŠ¶æ€æ£€æŸ¥ â†’ â­ï¸ ç½®ä¿¡åº¦è®¡ç®—                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š å¸‚åœºç¯å¢ƒ                                   â”‚
â”‚  å¸‚åœºçŠ¶æ€: RANGE (éœ‡è¡å¸‚)                      â”‚
â”‚  ç³»ç»ŸçŠ¶æ€: WAIT (ç­‰å¾…)                         â”‚
â”‚  ä»·æ ¼: $91,000.00                              â”‚
â”‚  1hå˜åŒ–: -0.01%  6hå˜åŒ–: +0.50%               â”‚
â”‚  èµ„é‡‘è´¹ç‡: 0.0066%                             â”‚
â”‚  æŒä»“é‡: 97,912 BTC                            â”‚
â”‚  1h OIå˜åŒ–: +0.5%  6h OIå˜åŒ–: +2.3%           â”‚
â”‚  ä¹°å–å¤±è¡¡: -0.31 (å–æ–¹ç¨å¼º)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“œ å†å²å†³ç­–è®°å½• (æœ€è¿‘48å°æ—¶)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âšª â”‚ âšª â”‚ âšª â”‚ ğŸŸ¢ â”‚ ğŸŸ¢ â”‚ âšª â”‚ âšª â”‚ âšª â”‚    â”‚
â”‚  â”‚ NO â”‚ NO â”‚ NO â”‚LONGâ”‚LONGâ”‚ NO â”‚ NO â”‚ NO â”‚    â”‚
â”‚  â”‚17:45â”‚17:30â”‚17:15â”‚17:00â”‚16:45â”‚16:30â”‚...â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ ¸å¿ƒå±•ç¤ºæ¨¡å—

#### 6.2.1 å†³ç­–ä¿¡å·åŒº

**å±•ç¤ºå†…å®¹**:
- å†³ç­–å›¾æ ‡å’Œæ–‡å­—ï¼ˆLONG ğŸŸ¢ / SHORT ğŸ”´ / NO_TRADE âšªï¼‰
- ç½®ä¿¡åº¦ï¼ˆHIGH/MEDIUM/LOWï¼‰
- ç½®ä¿¡åº¦è¿›åº¦æ¡ï¼ˆè§†è§‰åŒ–ï¼‰
- å†³ç­–æ—¶é—´æˆ³

**é¢œè‰²æ–¹æ¡ˆ**:
- LONG: ç»¿è‰² (#10b981)
- SHORT: çº¢è‰² (#ef4444)
- NO_TRADE: ç°è‰² (#6b7280)

#### 6.2.2 å®‰å…¨é—¸é—¨çŠ¶æ€

**ä¸‰ä¸ªé—¸é—¨å¡ç‰‡**:
1. **é£é™©å‡†å…¥é—¸é—¨**
   - âœ… å‡†å…¥é€šè¿‡ (ç»¿è‰²)
   - â›” å‡†å…¥æ‹’ç» (çº¢è‰²)
   - æç¤º: "ç³»ç»Ÿæ€§é£é™©è¯„ä¼°"

2. **äº¤æ˜“è´¨é‡é—¸é—¨**
   - âœ… è´¨é‡è‰¯å¥½ (ç»¿è‰²)
   - âš ï¸ è´¨é‡è¾ƒå·® (é»„è‰²)
   - æç¤º: "ä¿¡å·è´¨é‡è¯„ä¼°"

3. **L3æ‰§è¡Œè®¸å¯**
   - âœ… Executable (ç»¿è‰²)
   - â›” Not Executable (çº¢è‰²)
   - æç¤º: "ä¸ºL3æ‰§è¡Œå±‚æä¾›æ˜ç¡®è®¸å¯"

#### 6.2.3 å†³ç­–åŸå› æ ‡ç­¾

**æ ‡ç­¾åˆ†ç±»æŸ“è‰²**:
- ğŸš¨ **é£é™©å¦å†³ç±»** (çº¢è‰²): EXTREME_REGIME, LIQUIDATION_PHASE, CROWDING_RISK, EXTREME_VOLUME
- âš ï¸ **è´¨é‡å¦å†³ç±»** (æ©™è‰²): ABSORPTION_RISK, NOISY_MARKET, ROTATION_RISK, WEAK_SIGNAL_IN_RANGE
- ğŸ”€ **æ–¹å‘å†²çªç±»** (é»„è‰²): CONFLICTING_SIGNALS, NO_CLEAR_DIRECTION
- ğŸš« **çŠ¶æ€çº¦æŸç±»** (ç´«è‰²): COOL_DOWN_ACTIVE, STATE_TRANSITION_DENIED
- ğŸŸ¢ **æ­£å‘ä¿¡æ¯ç±»** (ç»¿è‰²): STRONG_BUY_PRESSURE, STRONG_SELL_PRESSURE, OI_GROWING
- â„¹ï¸ **è¾…åŠ©ä¿¡æ¯ç±»** (è“è‰²): HIGH_FUNDING_RATE, LOW_FUNDING_RATE, OI_DECLINING

**å±•ç¤ºæ ¼å¼**:
```
[ğŸ·ï¸ æ ‡ç­¾å›¾æ ‡] æ ‡ç­¾åç§°
è¯¦ç»†è§£é‡Šæ–‡å­—
```

#### 6.2.4 å†³ç­–ç®¡é“å¯è§†åŒ–

**8æ­¥ç®¡é“å±•ç¤º**:
```
âœ… æ•°æ®éªŒè¯ â†’ âœ… å¸‚åœºè¯†åˆ«(RANGE) â†’ âœ… é£é™©è¯„ä¼° â†’ âš ï¸ è´¨é‡è¯„ä¼°(POOR) â†’
â­ï¸ æ–¹å‘è¯„ä¼° â†’ â­ï¸ ä¼˜å…ˆå†³ç­– â†’ â­ï¸ çŠ¶æ€æ£€æŸ¥ â†’ â­ï¸ ç½®ä¿¡åº¦è®¡ç®—
```

**çŠ¶æ€å›¾æ ‡**:
- âœ… é€šè¿‡ (ç»¿è‰²)
- âš ï¸ è­¦å‘Š (é»„è‰²)
- âŒ å¤±è´¥ (çº¢è‰²)
- â­ï¸ è·³è¿‡ (ç°è‰²)

#### 6.2.5 å¸‚åœºç¯å¢ƒä¿¡æ¯

**å±•ç¤ºå­—æ®µ**:
- å¸‚åœºçŠ¶æ€ (TREND/RANGE/EXTREME)
- ç³»ç»ŸçŠ¶æ€ (INIT/WAIT/LONG_ACTIVE/SHORT_ACTIVE/COOL_DOWN)
- å½“å‰ä»·æ ¼
- 1h/6hä»·æ ¼å˜åŒ–ç‡
- èµ„é‡‘è´¹ç‡
- æŒä»“é‡
- 1h/6hæŒä»“é‡å˜åŒ–ç‡
- ä¹°å–å¤±è¡¡åº¦

#### 6.2.6 å†å²å†³ç­–è®°å½•

**å±•ç¤ºæ–¹å¼**: æ¨ªå‘æ—¶é—´çº¿

**æ¯æ¡è®°å½•æ˜¾ç¤º**:
- å†³ç­–å›¾æ ‡ï¼ˆğŸŸ¢ LONG / ğŸ”´ SHORT / âšª NO_TRADEï¼‰
- å†³ç­–æ–‡å­—
- æ—¶é—´æˆ³
- ç½®ä¿¡åº¦ï¼ˆæ‚¬æµ®æç¤ºï¼‰

**äº¤äº’**:
- ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
- è‡ªåŠ¨åˆ·æ–°ï¼ˆå¯é…ç½®é—´éš”ï¼‰
- æœ€å¤šæ˜¾ç¤º48å°æ—¶è®°å½•

### 6.3 å“åº”å¼è®¾è®¡

**æ”¯æŒè®¾å¤‡**:
- æ¡Œé¢æµè§ˆå™¨ (â‰¥1200px)
- å¹³æ¿è®¾å¤‡ (768px - 1199px)
- ç§»åŠ¨è®¾å¤‡ (â‰¤767px)

**è‡ªé€‚åº”ç‰¹æ€§**:
- å¡ç‰‡è‡ªåŠ¨æ¢è¡Œ
- å­—ä½“å¤§å°è°ƒæ•´
- è§¦æ‘¸å‹å¥½çš„æŒ‰é’®å°ºå¯¸

---

## 7. å­—æ®µè§„èŒƒ

### 7.1 è¾“å…¥å­—æ®µï¼ˆå¸‚åœºæ•°æ®ï¼‰

| å­—æ®µå | ç±»å‹ | å•ä½ | èŒƒå›´ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|------|------|
| `price` | float | USD | >0 | å½“å‰ä»·æ ¼ | 91000.00 |
| `price_change_1h` | float | % | -100~100 | 1å°æ—¶ä»·æ ¼å˜åŒ–ç‡ | -0.01 |
| `price_change_6h` | float | % | -100~100 | 6å°æ—¶ä»·æ ¼å˜åŒ–ç‡ | 0.50 |
| `volume_1h` | float | å¸ | â‰¥0 | 1å°æ—¶æˆäº¤é‡ | 1234.56 |
| `volume_24h` | float | USDT | â‰¥0 | 24å°æ—¶æˆäº¤é¢ | 12345678.90 |
| `buy_sell_imbalance` | float | æ— é‡çº² | -1~1 | ä¹°å–å¤±è¡¡åº¦ | -0.31 |
| `funding_rate` | float | å°æ•° | -1~1 | èµ„é‡‘è´¹ç‡ | 0.000066 |
| `oi_change_1h` | float | % | -100~100 | 1å°æ—¶æŒä»“é‡å˜åŒ–ç‡ | 0.50 |
| `oi_change_6h` | float | % | -100~100 | 6å°æ—¶æŒä»“é‡å˜åŒ–ç‡ | 2.30 |
| `open_interest` | float | å¸ | â‰¥0 | å½“å‰æŒä»“é‡ | 97912.0 |
| `buy_volume` | float | å¸ | â‰¥0 | ä¹°æ–¹æˆäº¤é‡ | 500.0 |
| `sell_volume` | float | å¸ | â‰¥0 | å–æ–¹æˆäº¤é‡ | 734.0 |

**å­—æ®µè¯´æ˜**:

1. **price_change_1h / price_change_6h**:
   - å•ä½: ç™¾åˆ†æ¯” (%)
   - æ­£å€¼è¡¨ç¤ºä¸Šæ¶¨ï¼Œè´Ÿå€¼è¡¨ç¤ºä¸‹è·Œ
   - è®¡ç®—å…¬å¼: `(current_price - old_price) / old_price * 100`

2. **buy_sell_imbalance**:
   - å•ä½: æ— é‡çº²ï¼ŒèŒƒå›´ [-1, 1]
   - è®¡ç®—å…¬å¼: `(buy_volume - sell_volume) / (buy_volume + sell_volume)`
   - æ­£å€¼è¡¨ç¤ºä¹°æ–¹å¼ºï¼Œè´Ÿå€¼è¡¨ç¤ºå–æ–¹å¼º
   - 0è¡¨ç¤ºå¹³è¡¡

3. **funding_rate**:
   - å•ä½: å°æ•°ï¼ˆéç™¾åˆ†æ¯”ï¼‰
   - 0.0001 = 0.01%
   - æ­£å€¼è¡¨ç¤ºå¤šå¤´æ”¯ä»˜ç©ºå¤´ï¼Œè´Ÿå€¼è¡¨ç¤ºç©ºå¤´æ”¯ä»˜å¤šå¤´

4. **oi_change_1h / oi_change_6h**:
   - å•ä½: ç™¾åˆ†æ¯” (%)
   - æ­£å€¼è¡¨ç¤ºæŒä»“é‡å¢é•¿ï¼Œè´Ÿå€¼è¡¨ç¤ºæŒä»“é‡ä¸‹é™

### 7.2 è¾“å‡ºå­—æ®µï¼ˆAdvisoryResultï¼‰

| å­—æ®µå | ç±»å‹ | å¯é€‰å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|--------|------|------|
| `decision` | string | long, short, no_trade | äº¤æ˜“å†³ç­– | "no_trade" |
| `confidence` | string | high, medium, low | ç½®ä¿¡åº¦ | "low" |
| `market_regime` | string | trend, range, extreme | å¸‚åœºç¯å¢ƒ | "range" |
| `system_state` | string | init, wait, long_active, short_active, cool_down | ç³»ç»ŸçŠ¶æ€ | "wait" |
| `risk_exposure_allowed` | boolean | true, false | é£é™©å‡†å…¥ | true |
| `trade_quality` | string | good, poor | äº¤æ˜“è´¨é‡ | "poor" |
| `reason_tags` | array[string] | è§ReasonTagæšä¸¾ | å†³ç­–åŸå› æ ‡ç­¾ | ["weak_signal_in_range"] |
| `timestamp` | string | ISO 8601 | å†³ç­–æ—¶é—´ | "2026-01-20T17:45:32.123456" |
| `executable` | boolean | true, false | L3æ‰§è¡Œè®¸å¯ | false |

**å­—æ®µè¯´æ˜**:

1. **decision**:
   - `long`: å»ºè®®åšå¤š
   - `short`: å»ºè®®åšç©º
   - `no_trade`: å»ºè®®è§‚æœ›

2. **confidence**:
   - `high`: é«˜ç½®ä¿¡åº¦ï¼ˆTRENDå¸‚ + ACTIVEçŠ¶æ€ï¼‰
   - `medium`: ä¸­ç­‰ç½®ä¿¡åº¦ï¼ˆTRENDå¸‚ + WAITçŠ¶æ€ï¼Œæˆ–RANGEå¸‚ + ACTIVEçŠ¶æ€ï¼‰
   - `low`: ä½ç½®ä¿¡åº¦ï¼ˆå…¶ä»–æƒ…å†µï¼‰

3. **market_regime**:
   - `trend`: è¶‹åŠ¿å¸‚ï¼ˆ6hä»·æ ¼å˜åŒ– > 3%ï¼‰
   - `range`: éœ‡è¡å¸‚ï¼ˆé»˜è®¤ï¼‰
   - `extreme`: æç«¯è¡Œæƒ…ï¼ˆ1hä»·æ ¼å˜åŒ– > 5%ï¼‰

4. **system_state**:
   - `init`: åˆå§‹åŒ–çŠ¶æ€
   - `wait`: ç­‰å¾…ä¿¡å·
   - `long_active`: åšå¤šä¿¡å·æ¿€æ´»
   - `short_active`: åšç©ºä¿¡å·æ¿€æ´»
   - `cool_down`: å†·å´æœŸï¼ˆ60åˆ†é’Ÿï¼‰

5. **risk_exposure_allowed**:
   - `true`: é£é™©å‡†å…¥é€šè¿‡
   - `false`: é£é™©å‡†å…¥æ‹’ç»ï¼ˆä¼šå¯¼è‡´NO_TRADEï¼‰

6. **trade_quality**:
   - `good`: äº¤æ˜“è´¨é‡è‰¯å¥½
   - `poor`: äº¤æ˜“è´¨é‡è¾ƒå·®ï¼ˆä¼šå¯¼è‡´NO_TRADEï¼‰

7. **executable**:
   - `true`: L3å¯æ‰§è¡Œï¼ˆdecisionéNO_TRADE + confidenceéLOW + risk_ok + quality_goodï¼‰
   - `false`: L3ä¸å¯æ‰§è¡Œ

### 7.3 ReasonTagæšä¸¾

| æ ‡ç­¾å€¼ | åˆ†ç±» | ä¸­æ–‡è¯´æ˜ |
|-------|------|---------|
| `invalid_data` | æ•°æ®éªŒè¯ | æ•°æ®æ— æ•ˆæˆ–ç¼ºå¤± |
| `extreme_regime` | é£é™©å¦å†³ | æç«¯è¡Œæƒ… |
| `liquidation_phase` | é£é™©å¦å†³ | æ¸…ç®—é˜¶æ®µ |
| `crowding_risk` | é£é™©å¦å†³ | æ‹¥æŒ¤é£é™© |
| `extreme_volume` | é£é™©å¦å†³ | æç«¯æˆäº¤é‡ |
| `absorption_risk` | è´¨é‡å¦å†³ | å¸çº³é£é™© |
| `noisy_market` | è´¨é‡å¦å†³ | å™ªéŸ³å¸‚åœº |
| `rotation_risk` | è´¨é‡å¦å†³ | è½®åŠ¨é£é™© |
| `weak_signal_in_range` | è´¨é‡å¦å†³ | éœ‡è¡å¼±ä¿¡å· |
| `conflicting_signals` | æ–¹å‘å†²çª | ä¿¡å·å†²çª |
| `no_clear_direction` | æ–¹å‘å†²çª | æ–¹å‘ä¸æ˜ |
| `cool_down_active` | çŠ¶æ€çº¦æŸ | å†·å´æœŸæ¿€æ´» |
| `state_transition_denied` | çŠ¶æ€çº¦æŸ | çŠ¶æ€è½¬æ¢æ‹’ç» |
| `high_funding_rate` | è¾…åŠ©ä¿¡æ¯ | é«˜èµ„é‡‘è´¹ç‡ |
| `low_funding_rate` | è¾…åŠ©ä¿¡æ¯ | ä½èµ„é‡‘è´¹ç‡ |
| `strong_buy_pressure` | è¾…åŠ©ä¿¡æ¯ | å¼ºä¹°å‹ |
| `strong_sell_pressure` | è¾…åŠ©ä¿¡æ¯ | å¼ºå–å‹ |
| `oi_growing` | è¾…åŠ©ä¿¡æ¯ | æŒä»“å¢é•¿ |
| `oi_declining` | è¾…åŠ©ä¿¡æ¯ | æŒä»“ä¸‹é™ |

---

## 8. APIæ¥å£

### 8.1 APIåˆ—è¡¨

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ |
|-----|------|------|------|
| `/api/l1/advisory/<symbol>` | GET | è·å–æœ€æ–°å†³ç­– | å…¬å¼€ |
| `/api/l1/history/<symbol>` | GET | è·å–å†å²å†³ç­– | å…¬å¼€ |
| `/api/l1/pipeline-status/<symbol>` | GET | è·å–ç®¡é“çŠ¶æ€ | å…¬å¼€ |
| `/api/l1/reason-tags/explain` | GET | è·å–æ ‡ç­¾è§£é‡Š | å…¬å¼€ |
| `/api/l1/thresholds` | GET | è·å–é…ç½®é˜ˆå€¼ | å…¬å¼€ |
| `/api/l1/thresholds` | POST | æ›´æ–°é…ç½®é˜ˆå€¼ | éœ€è®¤è¯ |
| `/api/markets` | GET | è·å–æ”¯æŒçš„å¸‚åœºåˆ—è¡¨ | å…¬å¼€ |

### 8.2 APIè¯¦ç»†è¯´æ˜

#### 8.2.1 è·å–æœ€æ–°å†³ç­–

**è¯·æ±‚**:
```http
GET /api/l1/advisory/BTC?market_type=futures
```

**å‚æ•°**:
- `symbol` (è·¯å¾„å‚æ•°): å¸ç§ç¬¦å·ï¼Œå¦‚ BTC, ETH
- `market_type` (æŸ¥è¯¢å‚æ•°): å¸‚åœºç±»å‹ï¼Œå¯é€‰ `spot` æˆ– `futures`ï¼Œé»˜è®¤ `futures`

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "decision": "no_trade",
    "confidence": "low",
    "market_regime": "range",
    "system_state": "wait",
    "risk_exposure_allowed": true,
    "trade_quality": "poor",
    "reason_tags": ["weak_signal_in_range"],
    "timestamp": "2026-01-20T17:45:32.123456",
    "executable": false
  },
  "timestamp": "2026-01-20T17:45:32.123456"
}
```

#### 8.2.2 è·å–å†å²å†³ç­–

**è¯·æ±‚**:
```http
GET /api/l1/history/BTC?hours=48
```

**å‚æ•°**:
- `symbol` (è·¯å¾„å‚æ•°): å¸ç§ç¬¦å·
- `hours` (æŸ¥è¯¢å‚æ•°): æŸ¥è¯¢æ—¶é—´èŒƒå›´ï¼ˆå°æ—¶ï¼‰ï¼Œé»˜è®¤48

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 123,
      "decision": "no_trade",
      "confidence": "low",
      "market_regime": "range",
      "system_state": "wait",
      "risk_exposure_allowed": true,
      "trade_quality": "poor",
      "reason_tags": ["weak_signal_in_range"],
      "timestamp": "2026-01-20T17:45:32.123456",
      "executable": false
    },
    {
      "id": 122,
      "decision": "long",
      "confidence": "high",
      "market_regime": "trend",
      "system_state": "long_active",
      "risk_exposure_allowed": true,
      "trade_quality": "good",
      "reason_tags": ["strong_buy_pressure", "oi_growing"],
      "timestamp": "2026-01-20T17:00:00.000000",
      "executable": true
    }
  ],
  "count": 2,
  "timestamp": "2026-01-20T17:45:32.123456"
}
```

#### 8.2.3 è·å–ç®¡é“çŠ¶æ€

**è¯·æ±‚**:
```http
GET /api/l1/pipeline-status/BTC
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "steps": [
      {
        "step": 1,
        "name": "æ•°æ®éªŒè¯",
        "status": "pass",
        "message": "æ•°æ®å®Œæ•´æœ‰æ•ˆ"
      },
      {
        "step": 2,
        "name": "å¸‚åœºè¯†åˆ«",
        "status": "pass",
        "message": "RANGE (éœ‡è¡å¸‚)"
      },
      {
        "step": 3,
        "name": "é£é™©è¯„ä¼°",
        "status": "pass",
        "message": "é£é™©å‡†å…¥é€šè¿‡"
      },
      {
        "step": 4,
        "name": "è´¨é‡è¯„ä¼°",
        "status": "warning",
        "message": "POOR (è´¨é‡è¾ƒå·®: weak_signal_in_range)"
      },
      {
        "step": 5,
        "name": "æ–¹å‘è¯„ä¼°",
        "status": "skip",
        "message": "å› è´¨é‡é—®é¢˜è·³è¿‡"
      },
      {
        "step": 6,
        "name": "ä¼˜å…ˆå†³ç­–",
        "status": "skip",
        "message": "å› è´¨é‡é—®é¢˜è·³è¿‡"
      },
      {
        "step": 7,
        "name": "çŠ¶æ€æ£€æŸ¥",
        "status": "skip",
        "message": "å› è´¨é‡é—®é¢˜è·³è¿‡"
      },
      {
        "step": 8,
        "name": "ç½®ä¿¡åº¦è®¡ç®—",
        "status": "skip",
        "message": "å› è´¨é‡é—®é¢˜è·³è¿‡"
      }
    ]
  },
  "timestamp": "2026-01-20T17:45:32.123456"
}
```

#### 8.2.4 è·å–æ ‡ç­¾è§£é‡Š

**è¯·æ±‚**:
```http
GET /api/l1/reason-tags/explain
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "invalid_data": "âŒ æ•°æ®æ— æ•ˆï¼šè¾“å…¥æ•°æ®ç¼ºå¤±æˆ–å¼‚å¸¸",
    "extreme_regime": "ğŸš¨ æç«¯è¡Œæƒ…ï¼šå¸‚åœºæ³¢åŠ¨è¶…è¿‡å®‰å…¨é˜ˆå€¼ï¼Œæš‚åœäº¤æ˜“",
    "liquidation_phase": "âš¡ æ¸…ç®—é˜¶æ®µï¼šä»·æ ¼æ€¥å˜ä¸”æŒä»“é‡éª¤é™ï¼Œç–‘ä¼¼å¤§è§„æ¨¡æ¸…ç®—",
    "weak_signal_in_range": "ğŸ“‰ éœ‡è¡å¼±ä¿¡å·ï¼šéœ‡è¡å¸‚ä¸­ä¿¡å·å¼ºåº¦ä¸è¶³ï¼Œä¸å®œäº¤æ˜“",
    ...
  },
  "timestamp": "2026-01-20T17:45:32.123456"
}
```

#### 8.2.5 è·å–é…ç½®é˜ˆå€¼

**è¯·æ±‚**:
```http
GET /api/l1/thresholds
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "market_regime.extreme_price_change_1h": 5.0,
    "market_regime.trend_price_change_6h": 3.0,
    "risk_exposure.liquidation.price_change": 5.0,
    "risk_exposure.liquidation.oi_drop": -15.0,
    "risk_exposure.crowding.funding_abs": 0.001,
    "risk_exposure.crowding.oi_growth": 30.0,
    ...
  },
  "timestamp": "2026-01-20T17:45:32.123456"
}
```

#### 8.2.6 æ›´æ–°é…ç½®é˜ˆå€¼

**è¯·æ±‚**:
```http
POST /api/l1/thresholds
Content-Type: application/json

{
  "market_regime.extreme_price_change_1h": 6.0,
  "risk_exposure.crowding.funding_abs": 0.0015
}
```

**å“åº”**:
```json
{
  "success": true,
  "message": "Thresholds updated successfully",
  "updated_count": 2,
  "timestamp": "2026-01-20T17:45:32.123456"
}
```

---

## 9. æ•°æ®åº“è®¾è®¡

### 9.1 æ•°æ®åº“ç±»å‹

**SQLite 3** - è½»é‡çº§ã€æ— éœ€ç‹¬ç«‹æœåŠ¡ã€é€‚åˆå•æœºéƒ¨ç½²

**æ•°æ®åº“æ–‡ä»¶è·¯å¾„**: `data/db/l1_advisory.db`

### 9.2 è¡¨ç»“æ„

#### 8.2.1 l1_advisory_results

**ç”¨é€”**: å­˜å‚¨L1å†³ç­–ç»“æœ

**è¡¨ç»“æ„**:
```sql
CREATE TABLE l1_advisory_results (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol TEXT NOT NULL,
    timestamp TEXT NOT NULL,
    decision TEXT NOT NULL,
    confidence TEXT NOT NULL,
    market_regime TEXT NOT NULL,
    system_state TEXT NOT NULL,
    risk_exposure_allowed INTEGER NOT NULL,
    trade_quality TEXT NOT NULL,
    reason_tags TEXT NOT NULL,
    executable INTEGER DEFAULT 0,
    created_at TEXT DEFAULT (datetime('now'))
);
```

**å­—æ®µè¯´æ˜**:
| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|-------|------|------|------|
| `id` | INTEGER | PRIMARY KEY | è‡ªå¢ä¸»é”® |
| `symbol` | TEXT | NOT NULL | å¸ç§ç¬¦å· |
| `timestamp` | TEXT | NOT NULL | å†³ç­–æ—¶é—´ï¼ˆISO 8601ï¼‰ |
| `decision` | TEXT | NOT NULL | å†³ç­–ï¼ˆlong/short/no_tradeï¼‰ |
| `confidence` | TEXT | NOT NULL | ç½®ä¿¡åº¦ï¼ˆhigh/medium/lowï¼‰ |
| `market_regime` | TEXT | NOT NULL | å¸‚åœºç¯å¢ƒ |
| `system_state` | TEXT | NOT NULL | ç³»ç»ŸçŠ¶æ€ |
| `risk_exposure_allowed` | INTEGER | NOT NULL | é£é™©å‡†å…¥ï¼ˆ0/1ï¼‰ |
| `trade_quality` | TEXT | NOT NULL | äº¤æ˜“è´¨é‡ |
| `reason_tags` | TEXT | NOT NULL | åŸå› æ ‡ç­¾ï¼ˆJSONæ•°ç»„å­—ç¬¦ä¸²ï¼‰ |
| `executable` | INTEGER | DEFAULT 0 | æ‰§è¡Œè®¸å¯ï¼ˆ0/1ï¼‰ |
| `created_at` | TEXT | DEFAULT now | è®°å½•åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•**:
```sql
CREATE INDEX idx_l1_symbol_timestamp ON l1_advisory_results(symbol, timestamp DESC);
CREATE INDEX idx_l1_created_at ON l1_advisory_results(created_at DESC);
CREATE INDEX idx_l1_decision ON l1_advisory_results(decision);
```

### 8.3 æ•°æ®ç»´æŠ¤

**è‡ªåŠ¨æ¸…ç†ç­–ç•¥**:
- ä¿ç•™æ—¶é—´: 48å°æ—¶
- æ¸…ç†é¢‘ç‡: æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
- æ¸…ç†æ–¹å¼: åˆ é™¤ `created_at` è¶…è¿‡48å°æ—¶çš„è®°å½•

**å®ç°**:
```python
# APSchedulerå®šæ—¶ä»»åŠ¡
scheduler = BackgroundScheduler()
scheduler.add_job(
    func=lambda: l1_db.cleanup_old_records(hours=48),
    trigger='interval',
    hours=1,
    id='cleanup_old_records'
)
scheduler.start()
```

---

## 9. é…ç½®ç®¡ç†

### 9.1 é…ç½®æ–‡ä»¶

**æ–‡ä»¶è·¯å¾„**: `config/l1_thresholds.yaml`

**é…ç½®ç»“æ„**:
```yaml
# å¸‚åœºç¯å¢ƒè¯†åˆ«é˜ˆå€¼
market_regime:
  extreme_price_change_1h: 5.0
  trend_price_change_6h: 3.0

# é£é™©å‡†å…¥é˜ˆå€¼
risk_exposure:
  liquidation:
    price_change: 5.0
    oi_drop: -15.0
  crowding:
    funding_abs: 0.001
    oi_growth: 30.0
  extreme_volume:
    multiplier: 10.0

# äº¤æ˜“è´¨é‡é˜ˆå€¼
trade_quality:
  absorption:
    imbalance: 0.7
    volume_ratio: 0.5
  noise:
    funding_volatility: 0.0005
    funding_abs: 0.0001
  rotation:
    price_threshold: 2.0
    oi_threshold: 5.0
  range_weak:
    imbalance: 0.6
    oi: 10.0

# æ–¹å‘è¯„ä¼°é˜ˆå€¼
direction:
  trend:
    long:
      imbalance: 0.6
      oi_change: 5.0
      price_change: 1.0
    short:
      imbalance: 0.6
      oi_change: 5.0
      price_change: 1.0
  range:
    long:
      imbalance: 0.7
      oi_change: 10.0
    short:
      imbalance: 0.7
      oi_change: 10.0

# çŠ¶æ€æœºé…ç½®
state_machine:
  cool_down_minutes: 60
  signal_timeout_minutes: 30
```

### 9.2 çƒ­æ›´æ–°æœºåˆ¶

**å®ç°æ–¹å¼**: Watchdogæ–‡ä»¶ç›‘æ§

**å·¥ä½œæµç¨‹**:
1. Watchdogç›‘æ§ `config/l1_thresholds.yaml` æ–‡ä»¶
2. æ£€æµ‹åˆ°æ–‡ä»¶ä¿®æ”¹äº‹ä»¶
3. é‡æ–°åŠ è½½YAMLæ–‡ä»¶
4. æ‰å¹³åŒ–é˜ˆå€¼é…ç½®
5. æ›´æ–° `L1AdvisoryEngine.thresholds`
6. è®°å½•æ—¥å¿—

**ä¼˜ç‚¹**:
- âœ… æ— éœ€é‡å¯åº”ç”¨
- âœ… å®æ—¶ç”Ÿæ•ˆ
- âœ… æ”¯æŒå›æ»šï¼ˆä¿®æ”¹å›æ—§å€¼ï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆYAMLè¯­æ³•é”™è¯¯ä¸å½±å“è¿è¡Œï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# 1. ä¿®æ”¹é…ç½®æ–‡ä»¶
vim config/l1_thresholds.yaml

# 2. ä¿å­˜åè‡ªåŠ¨ç”Ÿæ•ˆï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰
docker logs -f l1-advisory-layer
# è¾“å‡º: âœ… Config reloaded successfully: 25 thresholds updated
```

### 9.3 é…ç½®API

**é€šè¿‡APIåŠ¨æ€æ›´æ–°**:
```bash
curl -X POST http://localhost:5001/api/l1/thresholds \
  -H "Content-Type: application/json" \
  -d '{
    "market_regime.extreme_price_change_1h": 6.0,
    "risk_exposure.crowding.funding_abs": 0.0015
  }'
```

**æ³¨æ„**: APIæ›´æ–°ä»…ä¿®æ”¹å†…å­˜ä¸­çš„é˜ˆå€¼ï¼Œä¸ä¼šæŒä¹…åŒ–åˆ°YAMLæ–‡ä»¶ã€‚å¦‚éœ€æŒä¹…åŒ–ï¼Œéœ€æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚

---

## 10. éƒ¨ç½²æ–¹å¼

### 10.1 Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

**å‰ææ¡ä»¶**:
- Docker Desktop å·²å®‰è£…å¹¶è¿è¡Œ
- Docker Compose å·²å®‰è£…

**éƒ¨ç½²æ­¥éª¤**:

1. **æ„å»ºé•œåƒ**:
```bash
./docker-l1-build.sh
```

2. **å¯åŠ¨æœåŠ¡**:
```bash
./docker-l1-run.sh
```

3. **æŸ¥çœ‹æ—¥å¿—**:
```bash
docker logs -f l1-advisory-layer
```

4. **åœæ­¢æœåŠ¡**:
```bash
./docker-l1-stop.sh
```

**Dockeré…ç½®æ–‡ä»¶**:

- `Dockerfile.l1`: é•œåƒæ„å»ºæ–‡ä»¶
- `docker-compose-l1.yml`: å®¹å™¨ç¼–æ’é…ç½®
- `docker-l1-build.sh`: æ„å»ºè„šæœ¬
- `docker-l1-run.sh`: å¯åŠ¨è„šæœ¬
- `docker-l1-stop.sh`: åœæ­¢è„šæœ¬

**å®¹å™¨ä¿¡æ¯**:
- å®¹å™¨åç§°: `l1-advisory-layer`
- é•œåƒåç§°: `trade-info-l1:latest`
- ç«¯å£æ˜ å°„: `5001:5001`
- ç½‘ç»œ: `l1-network` (bridge)
- é‡å¯ç­–ç•¥: `unless-stopped`

**æ•°æ®æŒä¹…åŒ–**:
```yaml
volumes:
  - ./data/db:/app/data/db          # æ•°æ®åº“
  - ./config:/app/config            # é…ç½®æ–‡ä»¶
  - ./logs:/app/logs                # æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
```

**å¥åº·æ£€æŸ¥**:
```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:5001/api/l1/advisory/BTC"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 20s
```

### 10.2 æœ¬åœ°éƒ¨ç½²

**å‰ææ¡ä»¶**:
- Python 3.12+
- pip

**éƒ¨ç½²æ­¥éª¤**:

1. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**:
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows
```

2. **å®‰è£…ä¾èµ–**:
```bash
pip install -r requirements.txt
```

3. **å¯åŠ¨æœåŠ¡**:
```bash
python btc_web_app_l1.py
```

4. **è®¿é—®æœåŠ¡**:
```
http://localhost:5001/
```

### 10.3 ç”Ÿäº§ç¯å¢ƒå»ºè®®

**å®‰å…¨åŠ å›º**:
1. ä½¿ç”¨Nginxåå‘ä»£ç†
2. å¯ç”¨HTTPSï¼ˆSSLè¯ä¹¦ï¼‰
3. é…ç½®é˜²ç«å¢™è§„åˆ™
4. é™åˆ¶APIè®¿é—®é¢‘ç‡
5. æ·»åŠ èº«ä»½è®¤è¯

**æ€§èƒ½ä¼˜åŒ–**:
1. ä½¿ç”¨Gunicorn/uWSGIæ›¿ä»£Flaskå¼€å‘æœåŠ¡å™¨
2. é…ç½®å¤šworkerè¿›ç¨‹
3. å¯ç”¨Redisç¼“å­˜ï¼ˆæ›¿ä»£å†…å­˜ç¼“å­˜ï¼‰
4. æ•°æ®åº“è¿ç§»åˆ°PostgreSQLï¼ˆå¦‚éœ€é«˜å¹¶å‘ï¼‰

**ç›‘æ§å‘Šè­¦**:
1. é›†æˆPrometheus + Grafana
2. é…ç½®å¥åº·æ£€æŸ¥å‘Šè­¦
3. æ—¥å¿—èšåˆï¼ˆELK Stackï¼‰
4. æ€§èƒ½æŒ‡æ ‡ç›‘æ§

---

## 11. æµ‹è¯•è¦†ç›–

### 11.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `tests/test_l1_advisory.py`

**æµ‹è¯•æ¡†æ¶**: Pytest 7.0+

**æµ‹è¯•ç”¨ä¾‹æ•°**: 35ä¸ª

**æµ‹è¯•è¦†ç›–æ¨¡å—**:

1. **æ•°æ®éªŒè¯** (5ä¸ªç”¨ä¾‹)
   - å®Œæ•´æ•°æ®éªŒè¯
   - ç¼ºå¤±priceå­—æ®µ
   - ç¼ºå¤±buy_sell_imbalanceå­—æ®µ
   - ç¼ºå¤±oi_change_1hå­—æ®µ
   - ç©ºæ•°æ®å­—å…¸

2. **å¸‚åœºç¯å¢ƒè¯†åˆ«** (3ä¸ªç”¨ä¾‹)
   - EXTREMEè¯†åˆ«ï¼ˆ1hå˜åŒ–>5%ï¼‰
   - TRENDè¯†åˆ«ï¼ˆ6hå˜åŒ–>3%ï¼‰
   - RANGEè¯†åˆ«ï¼ˆé»˜è®¤ï¼‰

3. **é£é™©å‡†å…¥è¯„ä¼°** (8ä¸ªç”¨ä¾‹)
   - æ­£å¸¸å¸‚åœºé€šè¿‡
   - EXTREMEå¸‚åœºæ‹’ç»
   - æ¸…ç®—é˜¶æ®µæ£€æµ‹
   - æ‹¥æŒ¤é£é™©æ£€æµ‹
   - æç«¯æˆäº¤é‡æ£€æµ‹
   - å¤šé‡é£é™©å åŠ 
   - è¾¹ç•Œå€¼æµ‹è¯•
   - è´Ÿå‘æµ‹è¯•

4. **äº¤æ˜“è´¨é‡è¯„ä¼°** (6ä¸ªç”¨ä¾‹)
   - æ­£å¸¸è´¨é‡é€šè¿‡
   - å¸çº³é£é™©æ£€æµ‹
   - å™ªéŸ³å¸‚åœºæ£€æµ‹
   - è½®åŠ¨é£é™©æ£€æµ‹
   - éœ‡è¡å¼±ä¿¡å·æ£€æµ‹
   - è´¨é‡é—®é¢˜ç»„åˆ

5. **æ–¹å‘è¯„ä¼°** (4ä¸ªç”¨ä¾‹)
   - TRENDå¸‚åšå¤šä¿¡å·
   - TRENDå¸‚åšç©ºä¿¡å·
   - RANGEå¸‚åšå¤šä¿¡å·
   - RANGEå¸‚åšç©ºä¿¡å·

6. **å†³ç­–ä¼˜å…ˆçº§** (3ä¸ªç”¨ä¾‹)
   - å•ä¸€LONGä¿¡å·
   - å•ä¸€SHORTä¿¡å·
   - å†²çªä¿¡å·å¤„ç†

7. **ç½®ä¿¡åº¦è®¡ç®—** (3ä¸ªç”¨ä¾‹)
   - HIGHç½®ä¿¡åº¦ï¼ˆTREND + ACTIVEï¼‰
   - MEDIUMç½®ä¿¡åº¦ï¼ˆTREND + WAITï¼‰
   - LOWç½®ä¿¡åº¦ï¼ˆRANGE + WAITï¼‰

8. **executableå­—æ®µ** (3ä¸ªç”¨ä¾‹)
   - NO_TRADEä¸å¯æ‰§è¡Œ
   - HIGHç½®ä¿¡åº¦å¯æ‰§è¡Œ
   - LOWç½®ä¿¡åº¦ä¸å¯æ‰§è¡Œ

**è¿è¡Œæµ‹è¯•**:
```bash
# åœ¨å®¹å™¨ä¸­è¿è¡Œ
docker exec l1-advisory-layer python -m pytest tests/test_l1_advisory.py -v

# æœ¬åœ°è¿è¡Œ
pytest tests/test_l1_advisory.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/test_l1_advisory.py --cov=market_state_machine_l1 --cov-report=html
```

### 11.2 é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
1. APIç«¯ç‚¹æµ‹è¯•
2. æ•°æ®åº“è¯»å†™æµ‹è¯•
3. Binance APIè°ƒç”¨æµ‹è¯•
4. é…ç½®çƒ­æ›´æ–°æµ‹è¯•
5. çŠ¶æ€æœºè½¬æ¢æµ‹è¯•

**æµ‹è¯•å·¥å…·**:
- Postman / curl
- pytest-flask
- pytest-mock

### 11.3 å‹åŠ›æµ‹è¯•

**æµ‹è¯•æŒ‡æ ‡**:
- QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰
- å“åº”æ—¶é—´ï¼ˆP50/P95/P99ï¼‰
- é”™è¯¯ç‡
- å†…å­˜ä½¿ç”¨
- CPUä½¿ç”¨

**æµ‹è¯•å·¥å…·**:
- Apache Bench (ab)
- Locust
- wrk

---

## 12. ä½¿ç”¨æŒ‡å—

### 12.1 å¿«é€Ÿå¼€å§‹

**5åˆ†é’Ÿä¸Šæ‰‹**:

1. **å¯åŠ¨æœåŠ¡**:
```bash
./docker-l1-run.sh
```

2. **è®¿é—®Webç•Œé¢**:
```
http://localhost:5001/
```

3. **é€‰æ‹©å¸ç§å’Œå¸‚åœº**:
   - ç‚¹å‡»å¸ç§æŒ‰é’®ï¼ˆBTC/ETH/BNB/SOLï¼‰
   - é€‰æ‹©å¸‚åœºç±»å‹ï¼ˆç°è´§/åˆçº¦ï¼‰

4. **æŸ¥çœ‹å†³ç­–**:
   - æ ¸å¿ƒå†³ç­–ä¿¡å·ï¼ˆLONG/SHORT/NO_TRADEï¼‰
   - ç½®ä¿¡åº¦ï¼ˆHIGH/MEDIUM/LOWï¼‰
   - å®‰å…¨é—¸é—¨çŠ¶æ€
   - å†³ç­–åŸå› æ ‡ç­¾

5. **æŸ¥çœ‹å†å²**:
   - æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
   - æŸ¥çœ‹48å°æ—¶å†å²å†³ç­–æ—¶é—´çº¿

### 12.2 APIä½¿ç”¨ç¤ºä¾‹

**è·å–BTCæœ€æ–°å†³ç­–**:
```bash
curl http://localhost:5001/api/l1/advisory/BTC?market_type=futures
```

**è·å–ETHå†å²å†³ç­–ï¼ˆ24å°æ—¶ï¼‰**:
```bash
curl http://localhost:5001/api/l1/history/ETH?hours=24
```

**æŸ¥çœ‹å†³ç­–ç®¡é“çŠ¶æ€**:
```bash
curl http://localhost:5001/api/l1/pipeline-status/BTC
```

### 12.3 é…ç½®è°ƒä¼˜

**ä¿®æ”¹é˜ˆå€¼**:

1. **ç¼–è¾‘é…ç½®æ–‡ä»¶**:
```bash
vim config/l1_thresholds.yaml
```

2. **ä¿®æ”¹ç›®æ ‡é˜ˆå€¼**:
```yaml
market_regime:
  extreme_price_change_1h: 6.0  # ä»5.0è°ƒæ•´åˆ°6.0
```

3. **ä¿å­˜æ–‡ä»¶**ï¼ˆè‡ªåŠ¨ç”Ÿæ•ˆï¼‰

4. **éªŒè¯ç”Ÿæ•ˆ**:
```bash
curl http://localhost:5001/api/l1/thresholds | grep extreme_price_change_1h
```

### 12.4 å¸¸è§é—®é¢˜

**Q1: ä¸ºä»€ä¹ˆä¸€ç›´æ˜¾ç¤ºNO_TRADEï¼Ÿ**

A: å¯èƒ½åŸå› ï¼š
1. å¸‚åœºå¤„äºéœ‡è¡æœŸï¼ˆRANGEï¼‰ï¼Œä¿¡å·ä¸è¶³
2. é£é™©é—¸é—¨æ‹’ç»ï¼ˆæ£€æŸ¥reason_tagsï¼‰
3. è´¨é‡é—¸é—¨æ‹’ç»ï¼ˆæ£€æŸ¥trade_qualityï¼‰
4. ç³»ç»Ÿå¤„äºå†·å´æœŸï¼ˆCOOL_DOWNï¼‰

è§£å†³æ–¹æ³•ï¼š
- æŸ¥çœ‹å†³ç­–åŸå› æ ‡ç­¾ï¼ˆreason_tagsï¼‰
- æŸ¥çœ‹å†³ç­–ç®¡é“å¯è§†åŒ–
- ç­‰å¾…å¸‚åœºç¯å¢ƒæ”¹å–„

**Q2: å¦‚ä½•ç†è§£ç½®ä¿¡åº¦ï¼Ÿ**

A:
- **HIGH**: è¶‹åŠ¿å¸‚ + ä¿¡å·æ¿€æ´»ï¼Œå¯ä¿¡åº¦æœ€é«˜
- **MEDIUM**: è¶‹åŠ¿å¸‚ + ç­‰å¾…çŠ¶æ€ï¼Œæˆ–éœ‡è¡å¸‚ + ä¿¡å·æ¿€æ´»
- **LOW**: éœ‡è¡å¸‚ + ç­‰å¾…çŠ¶æ€ï¼Œæˆ–NO_TRADEå†³ç­–

**Q3: executableå­—æ®µä»€ä¹ˆæ—¶å€™ä¸ºtrueï¼Ÿ**

A: åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
1. decision â‰  NO_TRADE
2. confidence = HIGH æˆ– MEDIUM
3. risk_exposure_allowed = true
4. trade_quality = GOOD

**Q4: å¦‚ä½•å›æµ‹å†å²å†³ç­–å‡†ç¡®æ€§ï¼Ÿ**

A:
1. æŸ¥è¯¢å†å²å†³ç­–API
2. å¯¹æ¯”å†³ç­–æ—¶é—´ç‚¹åçš„ä»·æ ¼èµ°åŠ¿
3. ç»Ÿè®¡LONGä¿¡å·åä¸Šæ¶¨æ¯”ä¾‹
4. ç»Ÿè®¡SHORTä¿¡å·åä¸‹è·Œæ¯”ä¾‹
5. è®¡ç®—å‡†ç¡®ç‡å’Œæ”¶ç›Šç‡

**Q5: å¯ä»¥æ·»åŠ æ–°çš„å¸ç§å—ï¼Ÿ**

A: å¯ä»¥ï¼Œåªéœ€ï¼š
1. åœ¨å‰ç«¯ `static/js/app_l1.js` çš„ `SYMBOLS` æ•°ç»„ä¸­æ·»åŠ å¸ç§ç¬¦å·
2. ç¡®ä¿Binance APIæ”¯æŒè¯¥å¸ç§ï¼ˆå¦‚SOLUSDTï¼‰
3. åˆ·æ–°é¡µé¢å³å¯

### 12.5 æœ€ä½³å®è·µ

**å†³ç­–ä½¿ç”¨å»ºè®®**:

1. **å®‰å…¨ä¼˜å…ˆ**:
   - å§‹ç»ˆæ£€æŸ¥ `risk_exposure_allowed` å’Œ `trade_quality`
   - é£é™©æ‹’ç»æˆ–è´¨é‡å·®æ—¶ï¼Œä¸å»ºè®®äº¤æ˜“

2. **ç½®ä¿¡åº¦å‚è€ƒ**:
   - HIGHç½®ä¿¡åº¦ï¼šå¯è€ƒè™‘è¾ƒå¤§ä»“ä½
   - MEDIUMç½®ä¿¡åº¦ï¼šå¯è€ƒè™‘ä¸­ç­‰ä»“ä½
   - LOWç½®ä¿¡åº¦ï¼šå»ºè®®è§‚æœ›æˆ–å°ä»“ä½è¯•æ¢

3. **reason_tagsè¿½æº¯**:
   - ä»”ç»†é˜…è¯»å†³ç­–åŸå› æ ‡ç­¾
   - ç†è§£å¸‚åœºå½“å‰çŠ¶æ€
   - é¿å…ç›²ç›®è·Ÿéšä¿¡å·

4. **çŠ¶æ€æœºç†è§£**:
   - COOL_DOWNæœŸé—´ä¸ä¼šäº§ç”Ÿæ–°ä¿¡å·
   - ACTIVEçŠ¶æ€è¡¨ç¤ºä¿¡å·å·²æ¿€æ´»
   - çŠ¶æ€è½¬æ¢æœ‰ä¸¥æ ¼è§„åˆ™

5. **é…ç½®è°ƒä¼˜**:
   - åˆå§‹ä½¿ç”¨ä¿å®ˆé˜ˆå€¼
   - é€šè¿‡å›æµ‹ä¼˜åŒ–é˜ˆå€¼
   - å®šæœŸè¯„ä¼°å†³ç­–å‡†ç¡®ç‡
   - æ ¹æ®å¸‚åœºç‰¹æ€§è°ƒæ•´

---

## é™„å½•

### A. æ–‡ä»¶æ¸…å•

**æ ¸å¿ƒæ–‡ä»¶**:
- `btc_web_app_l1.py` - Flaskåº”ç”¨ä¸»æ–‡ä»¶
- `market_state_machine_l1.py` - L1å†³ç­–å¼•æ“
- `binance_data_fetcher.py` - Binanceæ•°æ®è·å–å™¨
- `data_cache.py` - å¸‚åœºæ•°æ®ç¼“å­˜
- `database_l1.py` - æ•°æ®åº“è®¿é—®å±‚

**æ¨¡å‹å®šä¹‰**:
- `models/__init__.py` - æ¨¡å‹åŒ…åˆå§‹åŒ–
- `models/enums.py` - æšä¸¾å®šä¹‰
- `models/reason_tags.py` - åŸå› æ ‡ç­¾å®šä¹‰
- `models/advisory_result.py` - å†³ç­–ç»“æœæ•°æ®ç±»

**å‰ç«¯æ–‡ä»¶**:
- `templates/index_l1.html` - Web UIæ¨¡æ¿
- `static/css/style_l1.css` - æ ·å¼æ–‡ä»¶
- `static/js/app_l1.js` - å‰ç«¯é€»è¾‘

**é…ç½®æ–‡ä»¶**:
- `config/l1_thresholds.yaml` - é˜ˆå€¼é…ç½®
- `requirements.txt` - Pythonä¾èµ–
- `Dockerfile.l1` - Dockeré•œåƒæ„å»ºæ–‡ä»¶
- `docker-compose-l1.yml` - Dockerç¼–æ’é…ç½®

**è„šæœ¬æ–‡ä»¶**:
- `docker-l1-build.sh` - Dockeræ„å»ºè„šæœ¬
- `docker-l1-run.sh` - Dockerå¯åŠ¨è„šæœ¬
- `docker-l1-stop.sh` - Dockeråœæ­¢è„šæœ¬
- `run_l1.sh` - æœ¬åœ°å¯åŠ¨è„šæœ¬

**æµ‹è¯•æ–‡ä»¶**:
- `tests/test_l1_advisory.py` - å•å…ƒæµ‹è¯•

**æ–‡æ¡£æ–‡ä»¶**:
- `doc/å¹³å°è¯¦è§£1.0.md` - æœ¬æ–‡æ¡£
- `doc/L1_Advisory_Layerä½¿ç”¨æŒ‡å—.md` - ä½¿ç”¨æŒ‡å—
- `doc/L1_APIå®Œæ•´æ–‡æ¡£.md` - APIæ–‡æ¡£
- `doc/L1å­—æ®µè§„èŒƒ.md` - å­—æ®µè§„èŒƒ
- `doc/L1å®æ–½æ€»ç»“.md` - å®æ–½æ€»ç»“
- `doc/L1å‰ç«¯æ”¹é€ å®ŒæˆæŠ¥å‘Š.md` - å‰ç«¯æŠ¥å‘Š

### B. æŠ€æœ¯å€ºåŠ¡

**å·²çŸ¥é™åˆ¶**:
1. å†…å­˜ç¼“å­˜åœ¨å®¹å™¨é‡å¯åä¸¢å¤±ï¼ˆæœªæ¥å¯è¿ç§»åˆ°Redisï¼‰
2. SQLiteä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼ˆæœªæ¥å¯è¿ç§»åˆ°PostgreSQLï¼‰
3. å•æœºéƒ¨ç½²ï¼Œæ— æ³•æ°´å¹³æ‰©å±•ï¼ˆæœªæ¥å¯æ”¯æŒåˆ†å¸ƒå¼ï¼‰
4. ç¼ºå°‘ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
5. ç¼ºå°‘APIé™æµæœºåˆ¶

**æœªæ¥æ”¹è¿›æ–¹å‘**:
1. L2é€‰å¸å±‚å¼€å‘
2. L3æ‰§è¡Œå±‚å¼€å‘
3. å›æµ‹æ¡†æ¶é›†æˆ
4. æœºå™¨å­¦ä¹ æ¨¡å‹é›†æˆ
5. å¤šäº¤æ˜“æ‰€æ”¯æŒ
6. WebSocketå®æ—¶æ¨é€
7. ç§»åŠ¨ç«¯App

### C. æ›´æ–°æ—¥å¿—

**v1.0 (2026-01-20)**:
- âœ… L1 Advisory Layerå®Œæ•´å®ç°
- âœ… 8æ­¥å›ºåŒ–å†³ç­–ç®¡é“
- âœ… é£é™©å‡†å…¥å’Œäº¤æ˜“è´¨é‡è¯„ä¼°
- âœ… èµ„é‡‘è´¹ç‡é™çº§
- âœ… ç½®ä¿¡åº¦å·¥ç¨‹åŒ–
- âœ… executableå­—æ®µ
- âœ… Web UIé‡æ–°è®¾è®¡
- âœ… Dockerå®¹å™¨åŒ–éƒ¨ç½²
- âœ… é…ç½®çƒ­æ›´æ–°
- âœ… 35ä¸ªå•å…ƒæµ‹è¯•
- âœ… å®Œæ•´APIæ–‡æ¡£

---

## è”ç³»æ–¹å¼

**é¡¹ç›®åœ°å€**: `/Users/wangqiang/learning/trade-info`

**Webè®¿é—®**: `http://localhost:5001/`

**APIæ–‡æ¡£**: è§ `doc/L1_APIå®Œæ•´æ–‡æ¡£.md`

**æŠ€æœ¯æ”¯æŒ**: æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–æäº¤Issue

---

**æ–‡æ¡£ç»“æŸ**

*æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†L1 Advisory Layer v1.0çš„æ‰€æœ‰åŠŸèƒ½ã€å®ç°æ–¹å¼ã€Webå±•ç¤ºå’Œå­—æ®µè§„èŒƒã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚*
