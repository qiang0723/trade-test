# 交易信号弹窗功能说明

**版本**: 1.0.0  
**日期**: 2026-01-21

---

## 📋 功能概述

前端新增交易信号实时弹窗提示功能，当L1系统检测到新的交易信号（LONG或SHORT）时，会自动弹出通知窗口，帮助用户及时捕捉交易机会。

---

## ✨ 核心功能

### 1. 信号检测

系统会自动检测以下情况并触发提示：

| 触发条件 | 说明 |
|---------|------|
| **新信号出现** | 从NO_TRADE变为LONG或SHORT |
| **方向反转** | LONG ↔ SHORT 方向改变 |

### 2. 多种提示方式

- **🔔 页面弹窗**: 右上角弹出通知卡片
- **🔊 声音提示**: 不同信号使用不同音调
- **💻 浏览器通知**: 系统级通知（需授权）

### 3. 可自定义控制

用户可以独立控制：
- ✅ 开启/关闭弹窗通知
- ✅ 开启/关闭声音提示
- ✅ 设置会自动保存

---

## 🎨 界面展示

### 弹窗样式

```
┌─────────────────────────────────────┐
│ 🟢 做多信号                          │  ← 绿色头部（做多）
│                                  ×  │
├─────────────────────────────────────┤
│ BTC                                 │  ← 币种名称
│                                     │
│ 置信度: 高    ✓ 可执行              │  ← 关键信息
│                                     │
│ [查看详情]  [关闭]                  │  ← 操作按钮
└─────────────────────────────────────┘
```

**做空信号**: 红色头部 + 🔴 图标

---

## 🔧 使用方法

### 1. 启用功能

页面右上角有两个控制按钮：

```
🔔 通知已开启    🔊 声音已开启
```

**点击按钮可切换状态**：
- 🔔 → 🔕（通知关闭）
- 🔊 → 🔇（声音关闭）

### 2. 授权浏览器通知

首次使用时，浏览器会请求通知权限：

```
[允许] [阻止]
```

**建议选择"允许"**，这样即使页面在后台，也能收到通知。

### 3. 查看信号详情

弹窗出现后，有两种方式查看详情：

1. **点击"查看详情"按钮** → 打开详细决策面板
2. **点击币种卡片** → 查看完整决策信息

### 4. 关闭弹窗

- **手动关闭**: 点击右上角 ×
- **自动关闭**: 10秒后自动消失

---

## 📊 信号类型

### LONG信号（做多）

**特征**:
- 🟢 绿色弹窗
- 高音调提示音（800Hz）
- 标题："做多信号"

**触发条件**:
- L1决策从NO_TRADE变为LONG
- 或从SHORT反转为LONG

### SHORT信号（做空）

**特征**:
- 🔴 红色弹窗
- 低音调提示音（600Hz）
- 标题："做空信号"

**触发条件**:
- L1决策从NO_TRADE变为SHORT
- 或从LONG反转为SHORT

### 方向反转

当信号方向改变时，弹窗会显示：

```
🟢 做多信号 (方向反转)
```

---

## ⚙️ 配置说明

### 设置保存

用户的设置会自动保存到浏览器本地存储（localStorage）：

```javascript
// 保存的设置
signalNotificationEnabled: true/false  // 通知开关
soundEnabled: true/false               // 声音开关
```

**优点**:
- 刷新页面后设置不丢失
- 不同浏览器独立设置
- 无需登录账号

### 默认设置

```yaml
通知: 开启
声音: 开启
浏览器通知: 需要用户授权
```

---

## 🔊 声音提示

### 音调设计

| 信号类型 | 频率 | 时长 | 说明 |
|---------|------|------|------|
| LONG | 800Hz | 3秒 | 较高音调 |
| SHORT | 600Hz | 3秒 | 较低音调 |

### 音量控制

- 音量固定为30%（0.3）
- 渐弱效果（exponential ramp）
- 不会过度打扰

### 兼容性

使用Web Audio API，支持：
- ✅ Chrome/Edge
- ✅ Firefox
- ✅ Safari
- ✅ Opera

---

## 💻 浏览器通知

### 通知内容

```
标题: BTC - 做多信号
内容: 置信度: high
     ✓ 可执行
```

### 交互

- **点击通知** → 聚焦页面并显示详情
- **自动关闭** → 3秒后消失

### 权限管理

**授权方式**:
1. 页面加载时自动请求
2. 用户选择"允许"或"阻止"

**修改权限**:
- Chrome: 地址栏左侧 🔒 → 网站设置 → 通知
- Firefox: 地址栏左侧 🔒 → 权限 → 通知
- Safari: 偏好设置 → 网站 → 通知

---

## 🎯 使用场景

### 场景1: 日内交易

**需求**: 快速捕捉短期机会

**设置**:
```
🔔 通知: 开启
🔊 声音: 开启
```

**效果**: 信号出现立即提醒，不错过任何机会

---

### 场景2: 长线持仓

**需求**: 只关注方向反转

**设置**:
```
🔔 通知: 开启
🔊 声音: 关闭（避免打扰）
```

**效果**: 方向改变时弹窗提示，但无声音

---

### 场景3: 后台监控

**需求**: 页面在后台也能收到通知

**设置**:
```
🔔 通知: 开启
浏览器通知: 允许
```

**效果**: 即使切换到其他标签页，也能收到系统通知

---

### 场景4: 专注工作

**需求**: 不希望被打扰

**设置**:
```
🔔 通知: 关闭
🔊 声音: 关闭
```

**效果**: 完全静默，手动刷新查看

---

## 🐛 常见问题

### Q1: 没有收到弹窗提示？

**检查**:
1. 通知按钮是否显示"🔔 通知已开启"
2. 是否有新的交易信号（不是NO_TRADE）
3. 浏览器控制台是否有错误

**解决**:
- 点击"🔔"按钮确保开启
- 等待自动刷新（60秒）或手动刷新

---

### Q2: 没有声音？

**检查**:
1. 声音按钮是否显示"🔊 声音已开启"
2. 浏览器是否静音
3. 系统音量是否打开

**解决**:
- 点击"🔊"按钮确保开启
- 检查浏览器音量设置
- 测试其他网页声音是否正常

---

### Q3: 浏览器通知不显示？

**检查**:
1. 是否授权了通知权限
2. 浏览器设置是否允许通知
3. 系统通知是否开启

**解决**:
- 重新授权通知权限
- 检查浏览器设置 → 隐私和安全 → 网站设置 → 通知
- 检查操作系统通知设置

---

### Q4: 弹窗太多怎么办？

**原因**: 多个币种同时出现信号

**解决**:
- 弹窗会自动延迟显示（每个间隔0.5秒）
- 10秒后自动关闭
- 可以手动点击关闭
- 或临时关闭通知

---

### Q5: 设置丢失了？

**原因**: 
- 清除了浏览器缓存
- 使用了隐私/无痕模式

**解决**:
- 重新设置即可
- 避免清除localStorage
- 使用正常模式

---

## 🔒 隐私和安全

### 数据存储

- ✅ 所有设置仅保存在本地浏览器
- ✅ 不上传到服务器
- ✅ 不涉及个人信息

### 权限使用

- ✅ 通知权限仅用于显示交易信号
- ✅ 不会发送其他通知
- ✅ 可随时撤销权限

---

## 📱 移动端支持

### 响应式设计

弹窗会自动适配小屏幕：

```
桌面端: 360px 宽度，右上角固定
移动端: 全宽（减去边距），自适应
```

### 触摸优化

- 按钮大小适合触摸
- 弹窗可滑动关闭（未来功能）

---

## 🚀 未来优化

### 计划功能

- [ ] 自定义提示音
- [ ] 弹窗位置可调
- [ ] 历史信号记录
- [ ] 信号过滤（只提示高置信度）
- [ ] 微信/Telegram推送（需后端支持）

---

## 📚 技术实现

### 核心技术

| 技术 | 用途 |
|------|------|
| JavaScript | 信号检测逻辑 |
| Web Audio API | 声音生成 |
| Notification API | 浏览器通知 |
| localStorage | 设置保存 |
| CSS3 Animation | 弹窗动画 |

### 代码位置

```
static/js/app_l1.js
  - checkForNewSignals()      # 信号检测
  - showSignalPopup()          # 显示弹窗
  - playNotificationSound()    # 播放声音
  - showBrowserNotification()  # 浏览器通知

static/css/style_l1.css
  - .signal-popup              # 弹窗样式
  - .signal-long/.signal-short # 颜色主题

templates/index_l1.html
  - 通知控制按钮              # UI控件
```

---

## 📝 更新日志

### v1.0.0 (2026-01-21)

**新增功能**:
- ✅ 交易信号自动检测
- ✅ 页面弹窗提示
- ✅ 声音提示
- ✅ 浏览器通知
- ✅ 通知开关控制
- ✅ 设置本地保存

**优化**:
- ✅ 响应式设计
- ✅ 平滑动画效果
- ✅ 多信号延迟显示

---

## 🤝 反馈和建议

如有问题或建议，欢迎反馈！

---

**祝交易顺利！** 📈
