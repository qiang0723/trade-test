# åŠ å¯†è´§å¸äº¤æ˜“å†³ç­–å¹³å°è¯¦è§£ 2.0

**ç‰ˆæœ¬**: 2.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-20  
**ç³»ç»Ÿåç§°**: L1 Advisory Layer (äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ)  
**æ›´æ–°å†…å®¹**: å®Œæˆ10ä¸ªPRä¼˜åŒ–ã€4å±‚ç½®ä¿¡åº¦ã€3å±‚è´¨é‡ã€å¤šå¸ç§æ”¯æŒã€AWSéƒ¨ç½²

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [ç‰ˆæœ¬æ¼”è¿›](#2-ç‰ˆæœ¬æ¼”è¿›)
3. [æ ¸å¿ƒåŠŸèƒ½](#3-æ ¸å¿ƒåŠŸèƒ½)
4. [ç­–ç•¥è®¾è®¡ç†å¿µ](#4-ç­–ç•¥è®¾è®¡ç†å¿µ)
5. [æŠ€æœ¯æ¶æ„](#5-æŠ€æœ¯æ¶æ„)
6. [å†³ç­–ç®¡é“](#6-å†³ç­–ç®¡é“)
7. [æ•°æ®è´¨é‡ä¿éšœ](#7-æ•°æ®è´¨é‡ä¿éšœ)
8. [ç½®ä¿¡åº¦ç³»ç»Ÿ](#8-ç½®ä¿¡åº¦ç³»ç»Ÿ)
9. [è´¨é‡è¯„ä¼°ç³»ç»Ÿ](#9-è´¨é‡è¯„ä¼°ç³»ç»Ÿ)
10. [å¤šå¸ç§æ”¯æŒ](#10-å¤šå¸ç§æ”¯æŒ)
11. [æ•°æ®æŒä¹…åŒ–](#11-æ•°æ®æŒä¹…åŒ–)
12. [Webç•Œé¢](#12-webç•Œé¢)
13. [APIæ¥å£](#13-apiæ¥å£)
14. [é…ç½®ç®¡ç†](#14-é…ç½®ç®¡ç†)
15. [éƒ¨ç½²æ¶æ„](#15-éƒ¨ç½²æ¶æ„)
16. [å¼€å‘æµç¨‹](#16-å¼€å‘æµç¨‹)
17. [æµ‹è¯•è¦†ç›–](#17-æµ‹è¯•è¦†ç›–)
18. [ä½¿ç”¨æŒ‡å—](#18-ä½¿ç”¨æŒ‡å—)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä½

**L1 Advisory Layer** æ˜¯ä¸€ä¸ªåŸºäºå¤šç»´åº¦å¸‚åœºæ•°æ®çš„**äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ**ï¼Œä¸“æ³¨äºä¸ºåŠ å¯†è´§å¸äº¤æ˜“æä¾›**å®‰å…¨ã€å¯è¿½æº¯ã€é«˜è´¨é‡**çš„æ–¹å‘æ€§å»ºè®®ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ›¡ï¸ **Safety First**: å®‰å…¨ä¼˜å…ˆï¼Œå¤šå±‚é—¸é—¨é˜²æŠ¤
- ğŸ¯ **å•ä¸€èŒè´£**: ä»…è¾“å‡ºæ–¹å‘å†³ç­–ï¼ˆLONG/SHORT/NO_TRADEï¼‰ï¼Œä¸æ¶‰åŠæ‰§è¡Œ
- ğŸ“Š **æ•°æ®é©±åŠ¨**: åŸºäºå®æ—¶Binanceåˆçº¦å¸‚åœºæ•°æ®
- ğŸ” **å¯è¿½æº¯æ€§**: æ¯ä¸ªå†³ç­–éƒ½æœ‰æ˜ç¡®çš„reason_tagså’Œ8æ­¥ç®¡é“è¿½æº¯
- âš™ï¸ **å¯é…ç½®**: æ‰€æœ‰é˜ˆå€¼å¤–éƒ¨åŒ–ï¼Œæ”¯æŒçƒ­æ›´æ–°
- ğŸŒ **å¤šå¸ç§**: æ”¯æŒBTCã€ETHã€BNBã€SOLã€XRPç­‰ä¸»æµå¸ç§
- ğŸš€ **ç”Ÿäº§å°±ç»ª**: Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼ŒAWSç”Ÿäº§ç¯å¢ƒè¿è¡Œ

### 1.2 ç³»ç»Ÿè¾¹ç•Œ

**L1åšä»€ä¹ˆ**ï¼š
- âœ… æ•°æ®è´¨é‡éªŒè¯ï¼ˆæ–°é²œåº¦ã€è§„èŒƒåŒ–ï¼‰
- âœ… åˆ†æå¸‚åœºç¯å¢ƒï¼ˆTREND/RANGE/EXTREMEï¼‰
- âœ… è¯„ä¼°é£é™©å‡†å…¥ï¼ˆæ¸…ç®—/æ‹¥æŒ¤/æç«¯æˆäº¤é‡ï¼‰
- âœ… è¯„ä¼°äº¤æ˜“è´¨é‡ï¼ˆGOOD/UNCERTAIN/POORï¼‰
- âœ… åˆ¤æ–­äº¤æ˜“æ–¹å‘ï¼ˆLONG/SHORT/NO_TRADEï¼‰
- âœ… è®¡ç®—ç½®ä¿¡åº¦ï¼ˆULTRA/HIGH/MEDIUM/LOWï¼‰
- âœ… æä¾›æ‰§è¡Œè®¸å¯ï¼ˆexecutableæ ‡å¿—ï¼‰
- âœ… å†³ç­–ç®¡é“è¿½æº¯ï¼ˆ8æ­¥å¯è§†åŒ–ï¼‰

**L1ä¸åšä»€ä¹ˆ**ï¼š
- âŒ ä¸è¾“å‡ºä»“ä½å¤§å°
- âŒ ä¸è¾“å‡ºå…¥åœºç‚¹ä½
- âŒ ä¸è¾“å‡ºæ­¢æŸæ­¢ç›ˆ
- âŒ ä¸è®¡ç®—æ æ†å€æ•°
- âŒ ä¸ä¸‹å•æ‰§è¡Œ
- âŒ ä¸ç®¡ç†æŒä»“

### 1.3 ä¸‰å±‚æ¶æ„æ„¿æ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1 Advisory Layer (âœ… å·²å®Œæˆ)           â”‚
â”‚  - æ–¹å‘å†³ç­–å’¨è¯¢                          â”‚
â”‚  - å®‰å…¨é—¸é—¨ï¼ˆé£é™©+è´¨é‡ï¼‰                  â”‚
â”‚  - 4å±‚ç½®ä¿¡åº¦è¯„ä¼°                         â”‚
â”‚  - 8æ­¥å†³ç­–ç®¡é“                           â”‚
â”‚  - å¤šå¸ç§æ”¯æŒ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2 Selection Layer (è§„åˆ’ä¸­)             â”‚
â”‚  - è‡ªåŠ¨é€‰å¸                              â”‚
â”‚  - å€™é€‰æ± ç®¡ç†                            â”‚
â”‚  - å¤šå¸ç§æ’åº                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3 Execution Layer (è§„åˆ’ä¸­)             â”‚
â”‚  - è‡ªåŠ¨äº¤æ˜“                              â”‚
â”‚  - ä»“ä½ç®¡ç†                              â”‚
â”‚  - é£æ§æ‰§è¡Œ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç‰ˆæœ¬æ¼”è¿›

### 2.1 ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | 1.0 | 2.0 |
|-----|-----|-----|
| **ç½®ä¿¡åº¦ç­‰çº§** | 3å±‚ï¼ˆHIGH/MEDIUM/LOWï¼‰ | 4å±‚ï¼ˆULTRA/HIGH/MEDIUM/LOWï¼‰ |
| **è´¨é‡ç­‰çº§** | 2å±‚ï¼ˆGOOD/POORï¼‰ | 3å±‚ï¼ˆGOOD/UNCERTAIN/POORï¼‰ |
| **æ•°æ®éªŒè¯** | åŸºç¡€æ ¡éªŒ | æ–°é²œåº¦æ£€æŸ¥ + è§„èŒƒåŒ– |
| **å†³ç­–è¿½æº¯** | å†…å­˜æ­¥éª¤ | DBæŒä¹…åŒ– + å‰ç«¯å¯è§†åŒ– |
| **æ•°æ®ä¿ç•™** | æ— é™åˆ¶ | 24å°æ—¶çƒ­å­˜å‚¨ + è‡ªåŠ¨æ¸…ç† |
| **å¸ç§æ”¯æŒ** | å•å¸ç§ï¼ˆBTCï¼‰ | å¤šå¸ç§ï¼ˆ5+å¯é…ç½®ï¼‰ |
| **éƒ¨ç½²ç¯å¢ƒ** | æœ¬åœ°å¼€å‘ | æœ¬åœ°å¼€å‘ + AWSç”Ÿäº§ |
| **å‰ç«¯äº¤äº’** | é™æ€å±•ç¤º | å¤šå¸ç§åˆ‡æ¢ + ç®¡é“å¯è§†åŒ– |

### 2.2 æ ¸å¿ƒPRå®æ–½è®°å½•

**P0 ä¼˜å…ˆçº§**ï¼ˆåŸºç¡€è®¾æ–½ï¼‰ï¼š
- **PR-001**: æŒ‡æ ‡è§„èŒƒåŒ– - ç»Ÿä¸€ç™¾åˆ†æ¯”å’Œå°æ•°æ ¼å¼
- **PR-002**: æ•°æ®æ–°é²œåº¦é—¨æ§ - æ‹’ç»è¿‡æœŸæ•°æ®ï¼ˆ120ç§’ï¼‰
- **PR-003**: ReasonTagç»Ÿä¸€ - 23ä¸ªæ ‡å‡†åŒ–æ ‡ç­¾

**P1 ä¼˜å…ˆçº§**ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰ï¼š
- **PR-004**: 3å±‚è´¨é‡ä½“ç³» - æ–°å¢UNCERTAINç­‰çº§
- **PR-005**: 4å±‚ç½®ä¿¡åº¦ - æ–°å¢ULTRAç­‰çº§ï¼Œç²¾ç»†åŒ–æ‰“åˆ†
- **PR-006**: å¯æ‰§è¡Œé—¸é—¨ - L3æ‰§è¡Œè®¸å¯é€»è¾‘

**P2 ä¼˜å…ˆçº§**ï¼ˆå¯è§‚æµ‹æ€§ï¼‰ï¼š
- **PR-007**: Step TraceæŒä¹…åŒ– - å†³ç­–ç®¡é“å­˜å‚¨åˆ°DB
- **PR-008**: å†·çƒ­å­˜å‚¨ - 24å°æ—¶æ•°æ®è‡ªåŠ¨æ¸…ç†
- **PR-009**: Step Traceå‰ç«¯ - 8æ­¥ç®¡é“å¯è§†åŒ–
- **PR-010**: Symbol Universe - å¤šå¸ç§é…ç½®åŒ–æ”¯æŒ

---

## 3. æ ¸å¿ƒåŠŸèƒ½

### 3.1 åŠŸèƒ½çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½æè¿° | å®ç°çŠ¶æ€ | PRå…³è” |
|---------|---------|---------|--------|
| **æ•°æ®è§„èŒƒåŒ–** | ç™¾åˆ†æ¯”/å°æ•°è‡ªåŠ¨è½¬æ¢ï¼Œå¼‚å¸¸æ£€æµ‹ | âœ… å·²å®ç° | PR-001 |
| **æ•°æ®æ–°é²œåº¦** | 120ç§’è¿‡æœŸæ£€æµ‹ï¼ŒDATA_STALEæ ‡è®° | âœ… å·²å®ç° | PR-002 |
| **ReasonTagç»Ÿä¸€** | 23ä¸ªæ ‡å‡†åŒ–æ ‡ç­¾ï¼Œ3å¤§ç±»ï¼ˆé£é™©/è´¨é‡/ä¿¡å·ï¼‰ | âœ… å·²å®ç° | PR-003 |
| **å¸‚åœºç¯å¢ƒè¯†åˆ«** | TREND/RANGE/EXTREMEä¸‰æ€è¯†åˆ« | âœ… å·²å®ç° | - |
| **é£é™©å‡†å…¥è¯„ä¼°** | æ¸…ç®—/æ‹¥æŒ¤/æç«¯æˆäº¤é‡é£é™©é—¸é—¨ | âœ… å·²å®ç° | - |
| **3å±‚è´¨é‡è¯„ä¼°** | GOOD/UNCERTAIN/POORè´¨é‡åˆ†çº§ | âœ… å·²å®ç° | PR-004 |
| **4å±‚ç½®ä¿¡åº¦** | ULTRA/HIGH/MEDIUM/LOWç²¾ç»†åŒ–æ‰“åˆ† | âœ… å·²å®ç° | PR-005 |
| **æ‰§è¡Œè®¸å¯** | åªæœ‰ULTRA/HIGH+æ— POORæ‰å¯æ‰§è¡Œ | âœ… å·²å®ç° | PR-006 |
| **å†³ç­–ç®¡é“è¿½æº¯** | 8æ­¥ç®¡é“DBæŒä¹…åŒ– | âœ… å·²å®ç° | PR-007 |
| **å†·çƒ­å­˜å‚¨** | 24å°æ—¶è‡ªåŠ¨æ¸…ç†å†å²æ•°æ® | âœ… å·²å®ç° | PR-008 |
| **ç®¡é“å¯è§†åŒ–** | å‰ç«¯å®æ—¶å±•ç¤º8æ­¥æ‰§è¡ŒçŠ¶æ€ | âœ… å·²å®ç° | PR-009 |
| **å¤šå¸ç§æ”¯æŒ** | 5+å¸ç§å¯é…ç½®åˆ‡æ¢ | âœ… å·²å®ç° | PR-010 |
| **çŠ¶æ€æœºç®¡ç†** | INIT/WAIT/ACTIVE/COOL_DOWN | âœ… å·²å®ç° | - |
| **é…ç½®çƒ­æ›´æ–°** | Watchdogç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ– | âœ… å·²å®ç° | - |

### 3.2 æ”¯æŒçš„å¸ç§

å½“å‰é…ç½®æ”¯æŒçš„å¸ç§ï¼ˆå¯åœ¨ `config/l1_thresholds.yaml` ä¸­é…ç½®ï¼‰ï¼š

| å¸ç§ | åç§° | å¸‚åœºç±»å‹ | çŠ¶æ€ |
|-----|------|---------|------|
| BTC | æ¯”ç‰¹å¸ | åˆçº¦ | âœ… å·²å¯ç”¨ |
| ETH | ä»¥å¤ªåŠ | åˆçº¦ | âœ… å·²å¯ç”¨ |
| BNB | å¸å®‰å¸ | åˆçº¦ | âœ… å·²å¯ç”¨ |
| SOL | Solana | åˆçº¦ | âœ… å·²å¯ç”¨ |
| XRP | ç‘æ³¢å¸ | åˆçº¦ | âœ… å·²å¯ç”¨ |

**æ³¨æ„**: L1 Advisory Layer ç›®å‰åªæ”¯æŒåˆçº¦å¸‚åœºï¼ˆBinance Futuresï¼‰ï¼Œä¸æ”¯æŒç°è´§å¸‚åœºã€‚

---

## 4. ç­–ç•¥è®¾è®¡ç†å¿µ

### 4.1 Safety First åŸåˆ™

å†³ç­–æµç¨‹éµå¾ªä¸¥æ ¼çš„å®‰å…¨ä¼˜å…ˆé¡ºåºï¼š

```
æ•°æ®è´¨é‡éªŒè¯
    â†“
é£é™©å‡†å…¥è¯„ä¼°ï¼ˆRisk Gateï¼‰
    â†“
äº¤æ˜“è´¨é‡è¯„ä¼°ï¼ˆQuality Gateï¼‰
    â†“
æ–¹å‘åˆ¤æ–­
    â†“
ç½®ä¿¡åº¦è®¡ç®—
    â†“
æ‰§è¡Œè®¸å¯åˆ¤å®š
```

**å±‚å±‚æŠŠå…³**ï¼š
1. **æ•°æ®å±‚**: æ‹’ç»è¿‡æœŸ/å¼‚å¸¸æ•°æ®
2. **é£é™©å±‚**: æ‹’ç»é«˜é£é™©ç¯å¢ƒ
3. **è´¨é‡å±‚**: é™çº§ä½è´¨é‡ä¿¡å·
4. **æ‰§è¡Œå±‚**: åªå…è®¸ULTRA/HIGH+GOODæ‰§è¡Œ

### 4.2 å¯è¿½æº¯æ€§è®¾è®¡

æ¯ä¸ªå†³ç­–éƒ½åŒ…å«å®Œæ•´çš„è¿½æº¯ä¿¡æ¯ï¼š

```json
{
  "decision": "long",
  "confidence": "high",
  "reason_tags": [
    "STRONG_BUYING",
    "FUNDING_SUPPORT",
    "TREND_MARKET"
  ],
  "pipeline_steps": [
    {"step": 1, "name": "æ•°æ®éªŒè¯", "status": "success", "result": "è§„èŒƒåŒ–å®Œæˆ"},
    {"step": 2, "name": "ç¯å¢ƒè¯†åˆ«", "status": "success", "result": "TREND"},
    // ... 8æ­¥å®Œæ•´è®°å½•
  ]
}
```

### 4.3 èµ„é‡‘è´¹ç‡é™çº§å“²å­¦

**1.0ç‰ˆæœ¬é—®é¢˜**ï¼š
- è¿‡åº¦ä¾èµ–èµ„é‡‘è´¹ç‡è§¦å‘å†³ç­–
- å¯¼è‡´é”™è¿‡ä½è´¹ç‡çš„ä¼˜è´¨ä¿¡å·

**2.0ç‰ˆæœ¬æ”¹è¿›**ï¼š
- èµ„é‡‘è´¹ç‡ä»…ä½œä¸º**è¾…åŠ©æ ‡è®°**ï¼ˆFUNDING_SUPPORT/FUNDING_RESISTANCEï¼‰
- ä¸»è¦ä¾èµ–**ä¹°å–å¤±è¡¡ + æŒä»“é‡å˜åŒ– + ä»·æ ¼å˜åŒ–**çš„ä¸‰è§’éªŒè¯
- è´¹ç‡ä»…åœ¨æç«¯æƒ…å†µä¸‹ä½œä¸ºé£é™©å‡†å…¥çš„å¦å†³æ¡ä»¶

---

## 5. æŠ€æœ¯æ¶æ„

### 5.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Web Browser                          â”‚
â”‚  (index_l1.html + app_l1.js + style_l1.css)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ HTTP/JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Flask Application (btc_web_app_l1.py)      â”‚
â”‚  - /api/l1/advisory/<symbol>                           â”‚
â”‚  - /api/l1/history/<symbol>                            â”‚
â”‚  - /api/l1/pipeline/<symbol>                           â”‚
â”‚  - /api/markets                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         L1AdvisoryEngine (market_state_machine_l1.py)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  8æ­¥å†³ç­–ç®¡é“:                                     â”‚  â”‚
â”‚  â”‚  1. æ•°æ®éªŒè¯ï¼ˆè§„èŒƒåŒ– + æ–°é²œåº¦ï¼‰                   â”‚  â”‚
â”‚  â”‚  2. ç¯å¢ƒè¯†åˆ«ï¼ˆTREND/RANGE/EXTREMEï¼‰              â”‚  â”‚
â”‚  â”‚  3. é£é™©è¯„ä¼°ï¼ˆæ¸…ç®—/æ‹¥æŒ¤/æç«¯æˆäº¤é‡ï¼‰              â”‚  â”‚
â”‚  â”‚  4. è´¨é‡è¯„ä¼°ï¼ˆGOOD/UNCERTAIN/POORï¼‰              â”‚  â”‚
â”‚  â”‚  5. æ–¹å‘åˆ¤æ–­ï¼ˆLONG/SHORT/NO_TRADEï¼‰              â”‚  â”‚
â”‚  â”‚  6. ä¼˜å…ˆçº§æ’åºï¼ˆå†²çªè§£å†³ï¼‰                        â”‚  â”‚
â”‚  â”‚  7. çŠ¶æ€æ£€æŸ¥ï¼ˆWAIT/ACTIVE/COOL_DOWNï¼‰            â”‚  â”‚
â”‚  â”‚  8. ç½®ä¿¡åº¦è®¡ç®—ï¼ˆULTRA/HIGH/MEDIUM/LOWï¼‰          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MetricsNormalizer    â”‚   â”‚  DataCache                â”‚
â”‚  (metrics_normalizer) â”‚   â”‚  (data_cache.py)          â”‚
â”‚  - ç™¾åˆ†æ¯”è§„èŒƒåŒ–        â”‚   â”‚  - å¸‚åœºæ•°æ®ç¼“å­˜           â”‚
â”‚  - å¼‚å¸¸æ£€æµ‹           â”‚   â”‚  - OI/ä»·æ ¼å˜åŒ–è®¡ç®—        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Binance API (binance_data_fetcher.py)           â”‚
â”‚  - åˆçº¦å¸‚åœºæ•°æ®                                          â”‚
â”‚  - èµ„é‡‘è´¹ç‡                                              â”‚
â”‚  - Kçº¿æ•°æ®                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SQLite Database (database_l1.py)           â”‚
â”‚  - l1_advisory_results (å†³ç­–ç»“æœè¡¨)                     â”‚
â”‚  - l1_pipeline_steps (ç®¡é“æ­¥éª¤è¡¨)                       â”‚
â”‚  - 24å°æ—¶è‡ªåŠ¨æ¸…ç†                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜

| æ¨¡å— | æ–‡ä»¶ | èŒè´£ | ä¾èµ– |
|-----|------|------|------|
| **WebæœåŠ¡** | `btc_web_app_l1.py` | Flask APIã€å‰ç«¯æœåŠ¡ | æ‰€æœ‰æ¨¡å— |
| **å†³ç­–å¼•æ“** | `market_state_machine_l1.py` | 8æ­¥å†³ç­–ç®¡é“ã€çŠ¶æ€æœº | normalizer, cache, models |
| **æ•°æ®è§„èŒƒåŒ–** | `metrics_normalizer.py` | ç™¾åˆ†æ¯”è½¬æ¢ã€å¼‚å¸¸æ£€æµ‹ | - |
| **æ•°æ®ç¼“å­˜** | `data_cache.py` | å¸‚åœºæ•°æ®ç¼“å­˜ã€OI/ä»·æ ¼è®¡ç®— | fetcher |
| **æ•°æ®è·å–** | `binance_data_fetcher.py` | Binance APIè°ƒç”¨ | requests |
| **æ•°æ®åº“** | `database_l1.py` | å†³ç­–ç»“æœã€ç®¡é“æ­¥éª¤æŒä¹…åŒ– | sqlite3 |
| **æ•°æ®æ¨¡å‹** | `models/*.py` | Enumã€AdvisoryResultã€ReasonTag | - |
| **é…ç½®** | `config/l1_thresholds.yaml` | é˜ˆå€¼é…ç½®ã€å¸ç§é…ç½® | - |
| **æ—¥å¿—** | `logger_config.py` | ç»Ÿä¸€æ—¥å¿—é…ç½® | logging |

### 5.3 æ•°æ®æµå›¾

```
Binance API
    â†“
[BinanceDataFetcher] è·å–åŸå§‹æ•°æ®
    â†“
[DataCache] ç¼“å­˜ + è®¡ç®—OI/ä»·æ ¼å˜åŒ–
    â†“
[MetricsNormalizer] è§„èŒƒåŒ– + å¼‚å¸¸æ£€æµ‹
    â†“
[L1AdvisoryEngine] 8æ­¥å†³ç­–ç®¡é“
    â†“
[AdvisoryResult] æ ‡å‡†åŒ–è¾“å‡º
    â†“
[L1Database] æŒä¹…åŒ–ï¼ˆç»“æœ + æ­¥éª¤ï¼‰
    â†“
[Flask API] JSONå“åº”
    â†“
Web Browser æ¸²æŸ“å±•ç¤º
```

---

## 6. å†³ç­–ç®¡é“

### 6.1 8æ­¥ç®¡é“è¯¦è§£

#### Step 1: æ•°æ®éªŒè¯

**è¾“å…¥**: åŸå§‹å¸‚åœºæ•°æ®  
**å¤„ç†**:
1. è°ƒç”¨ `MetricsNormalizer.normalize()` è§„èŒƒåŒ–ç™¾åˆ†æ¯”å­—æ®µ
2. æ£€æµ‹æ··åˆå°ºåº¦å¼‚å¸¸ï¼ˆå¦‚åŒæ—¶å­˜åœ¨5.0å’Œ0.05ï¼‰
3. æ£€æŸ¥æ•°æ®æ–°é²œåº¦ï¼ˆ`source_timestamp` vs å½“å‰æ—¶é—´ï¼‰
4. è¶…è¿‡120ç§’æ ‡è®°ä¸º `DATA_STALE`

**è¾“å‡º**: 
- è§„èŒƒåŒ–åçš„æ•°æ® + `is_valid` + å¯é€‰çš„ `ReasonTag.DATA_STALE`

**ç¤ºä¾‹**:
```python
# è¾“å…¥
data = {
    "price_change_1h": 5.0,  # ç™¾åˆ†ç‚¹
    "funding_rate": 0.0001,  # å°æ•°
    "source_timestamp": "2026-01-20T10:00:00"
}

# è¾“å‡º
normalized_data = {
    "price_change_1h": 0.05,  # è½¬æ¢ä¸ºå°æ•°
    "funding_rate": 0.0001,   # ä¿æŒä¸å˜
    "computed_at": "2026-01-20T10:01:00"
}
# is_valid = True (å‡è®¾æœªè¿‡æœŸ)
```

#### Step 2: ç¯å¢ƒè¯†åˆ«

**è¾“å…¥**: è§„èŒƒåŒ–åçš„æ•°æ®  
**é€»è¾‘**:
```python
if abs(price_change_1h) > 0.05:  # 5%
    regime = MarketRegime.EXTREME
elif abs(price_change_6h) > 0.03:  # 3%
    regime = MarketRegime.TREND
else:
    regime = MarketRegime.RANGE
```

**è¾“å‡º**: `MarketRegime` (TREND/RANGE/EXTREME)

#### Step 3: é£é™©è¯„ä¼°

**æ£€æµ‹ä¸‰ç±»é£é™©**:

1. **æ¸…ç®—é£é™©** (LIQUIDATION_RISK):
   - `abs(price_change_1h) > 5%` AND `oi_change_1h < -15%`

2. **æ‹¥æŒ¤é£é™©** (CROWDING_RISK):
   - `abs(funding_rate) > 0.001` AND `oi_change_6h > 30%`

3. **æç«¯æˆäº¤é‡** (EXTREME_VOLUME):
   - `volume_1h > 10 * volume_24h_avg`

**è¾“å‡º**: 
- `risk_exposure_allowed`: bool
- `reason_tags`: List[ReasonTag] (é£é™©æ ‡ç­¾)

#### Step 4: è´¨é‡è¯„ä¼°

**æ£€æµ‹è´¨é‡é—®é¢˜**:

1. **å¸çº³è´¨é‡å·®** (ABSORPTION_QUALITY_ISSUE):
   - OIä¸Šå‡ä½†ä»·æ ¼ä¸æ¶¨ â†’ å¸‚åœºåœ¨å¸çº³ï¼ˆåšç©ºç›˜ï¼‰

2. **å™ªéŸ³å¸‚åœº** (NOISY_MARKET):
   - éœ‡è¡å¸‚åœº + ä¹°å–å¤±è¡¡æ³¢åŠ¨å¤§

3. **è½®åŠ¨é£é™©** (ROTATION_RISK):
   - æŒä»“é‡å‰§çƒˆå˜åŒ–ï¼Œå¯èƒ½æ˜¯èµ„é‡‘è½®åŠ¨

4. **å¼±ä¿¡å·** (WEAK_SIGNAL):
   - ä¹°å–å¤±è¡¡è¾ƒå°

**è¯„çº§é€»è¾‘**:
```python
if has_ABSORPTION or has_ROTATION:
    quality = TradeQuality.POOR
elif has_NOISY:
    quality = TradeQuality.UNCERTAIN
else:
    quality = TradeQuality.GOOD
```

**è¾“å‡º**: 
- `trade_quality`: GOOD/UNCERTAIN/POOR
- `reason_tags`: List[ReasonTag] (è´¨é‡æ ‡ç­¾)

#### Step 5: æ–¹å‘åˆ¤æ–­

**æ ¸å¿ƒé€»è¾‘** (ä¸‰è§’éªŒè¯):

```python
# åšå¤šä¿¡å·
if (buy_sell_imbalance > 0.6 AND     # ä¹°ç›˜å ä¼˜
    oi_change_1h > 5% AND            # æŒä»“é‡ä¸Šå‡
    price_change_1h > 2%):           # ä»·æ ¼ä¸Šæ¶¨
    direction = Decision.LONG
    tags.append(ReasonTag.STRONG_BUYING)

# åšç©ºä¿¡å·
elif (buy_sell_imbalance < 0.4 AND   # å–ç›˜å ä¼˜
      oi_change_1h > 5% AND          # æŒä»“é‡ä¸Šå‡
      price_change_1h < -2%):        # ä»·æ ¼ä¸‹è·Œ
    direction = Decision.SHORT
    tags.append(ReasonTag.STRONG_SELLING)

else:
    direction = Decision.NO_TRADE
```

**è¾…åŠ©æ ‡è®°** (èµ„é‡‘è´¹ç‡):
- `funding_rate > 0.0005` â†’ `FUNDING_RESISTANCE` (åšç©ºæ”¯æ’‘)
- `funding_rate < -0.0005` â†’ `FUNDING_SUPPORT` (åšå¤šæ”¯æ’‘)

**è¾“å‡º**: 
- `decision`: LONG/SHORT/NO_TRADE
- `reason_tags`: List[ReasonTag] (ä¿¡å·æ ‡ç­¾)

#### Step 6: å†³ç­–ä¼˜å…ˆçº§

å¤„ç†å†²çªä¿¡å·çš„ä¼˜å…ˆçº§æ’åºï¼ˆå½“å‰ç‰ˆæœ¬ä¿ç•™æ¥å£ï¼Œæœªå®é™…ä½¿ç”¨ï¼‰ã€‚

#### Step 7: çŠ¶æ€æ£€æŸ¥

**çŠ¶æ€æœºç®¡ç†**:

```
INIT â†’ WAIT â†’ LONG_ACTIVE/SHORT_ACTIVE â†’ COOL_DOWN â†’ WAIT
```

**å½“å‰ç‰ˆæœ¬**: ç®€åŒ–ä¸ºå§‹ç»ˆè¿”å› `SystemState.WAIT`ï¼ˆä¸ºæœªæ¥L3æ‰§è¡Œå±‚é¢„ç•™ï¼‰ã€‚

#### Step 8: ç½®ä¿¡åº¦è®¡ç®—

**4å±‚ç½®ä¿¡åº¦æ‰“åˆ†ç³»ç»Ÿ** (PR-005):

```python
score = 0

# åŸºç¡€åˆ†ï¼ˆå†³ç­–ç±»å‹ï¼‰
if decision == LONG or decision == SHORT:
    score += 30
else:
    score += 0

# å¸‚åœºç¯å¢ƒåˆ†
if regime == TREND:
    score += 30
elif regime == RANGE:
    score += 10
else:  # EXTREME
    score += 0

# è´¨é‡åˆ†
if quality == GOOD:
    score += 30
elif quality == UNCERTAIN:
    score += 15
else:  # POOR
    score += 0

# ReasonTagåŠ åˆ†
if STRONG_BUYING or STRONG_SELLING in tags:
    score += 10

# æœ€ç»ˆæ˜ å°„
if score >= 90:
    confidence = Confidence.ULTRA
elif score >= 65:
    confidence = Confidence.HIGH
elif score >= 40:
    confidence = Confidence.MEDIUM
else:
    confidence = Confidence.LOW
```

**ç­‰çº§è¯´æ˜**:

| ç­‰çº§ | åˆ†æ•°èŒƒå›´ | å«ä¹‰ | L3æ‰§è¡Œè®¸å¯ |
|-----|---------|------|-----------|
| ULTRA | 90+ | æœ€å¼ºä¿¡å· | âœ… å¯æ‰§è¡Œ |
| HIGH | 65-89 | å¼ºä¿¡å· | âœ… å¯æ‰§è¡Œ |
| MEDIUM | 40-64 | ä¸­ç­‰ä¿¡å· | âŒ ä¸å¯æ‰§è¡Œ |
| LOW | <40 | å¼±ä¿¡å· | âŒ ä¸å¯æ‰§è¡Œ |

**è¾“å‡º**: 
- `confidence`: ULTRA/HIGH/MEDIUM/LOW

### 6.2 ç®¡é“æ­¥éª¤æŒä¹…åŒ–

**æ•°æ®åº“è¡¨ç»“æ„** (PR-007):

```sql
CREATE TABLE l1_pipeline_steps (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    advisory_id INTEGER NOT NULL,  -- å…³è”åˆ° l1_advisory_results.id
    step INTEGER NOT NULL,          -- 1-8
    name TEXT NOT NULL,             -- æ­¥éª¤åç§°
    status TEXT NOT NULL,           -- success/failed/warning/pending
    result TEXT,                    -- æ­¥éª¤ç»“æœ
    message TEXT,                   -- è¯¦ç»†ä¿¡æ¯
    timestamp TEXT NOT NULL,
    FOREIGN KEY (advisory_id) REFERENCES l1_advisory_results(id)
);
```

**ç¤ºä¾‹æ•°æ®**:

```json
[
  {
    "step": 1,
    "name": "æ•°æ®éªŒè¯",
    "status": "success",
    "result": "è§„èŒƒåŒ–å®Œæˆ",
    "message": "ä»·æ ¼å˜åŒ–: 5.0% â†’ 0.05"
  },
  {
    "step": 2,
    "name": "ç¯å¢ƒè¯†åˆ«",
    "status": "success",
    "result": "TREND",
    "message": "6hä»·æ ¼å˜åŒ–è¶…è¿‡3%"
  },
  // ...
]
```

---

## 7. æ•°æ®è´¨é‡ä¿éšœ

### 7.1 æŒ‡æ ‡è§„èŒƒåŒ– (PR-001)

**é—®é¢˜èƒŒæ™¯**:
- Binance APIè¿”å›çš„ç™¾åˆ†æ¯”å­—æ®µæ ¼å¼ä¸ç»Ÿä¸€
- æœ‰çš„æ˜¯ç™¾åˆ†ç‚¹ï¼ˆå¦‚ `5.0` è¡¨ç¤º5%ï¼‰ï¼Œæœ‰çš„æ˜¯å°æ•°ï¼ˆå¦‚ `0.05` è¡¨ç¤º5%ï¼‰
- æ··åˆä½¿ç”¨ä¼šå¯¼è‡´ç­–ç•¥è®¡ç®—é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:

```python
# metrics_normalizer.py
class MetricsNormalizer:
    PERCENTAGE_FIELDS = [
        'price_change_1h', 
        'price_change_6h', 
        'oi_change_1h', 
        'oi_change_6h'
    ]
    
    DECIMAL_FIELDS = [
        'funding_rate', 
        'buy_sell_imbalance'
    ]
    
    @classmethod
    def normalize(cls, data):
        normalized = data.copy()
        
        # ç™¾åˆ†æ¯”å­—æ®µï¼šå¦‚æœ > 1.0ï¼Œè§†ä¸ºç™¾åˆ†ç‚¹ï¼Œè½¬æ¢ä¸ºå°æ•°
        for field in cls.PERCENTAGE_FIELDS:
            value = normalized.get(field)
            if value and abs(value) > 1.0:
                normalized[field] = value / 100.0
        
        return normalized, True, ""
```

**æ£€æµ‹å¼‚å¸¸**:

```python
# å¦‚æœåŒä¸€æ•°æ®ä¸­å­˜åœ¨æ··åˆå°ºåº¦ï¼ŒæŠ¥é”™
if price_change_1h = 5.0 and oi_change_1h = 0.05:
    # ä¸€ä¸ªæ˜¯ç™¾åˆ†ç‚¹ï¼Œä¸€ä¸ªæ˜¯å°æ•° â†’ å¼‚å¸¸
    return None, False, "Mixed scale detected"
```

### 7.2 æ•°æ®æ–°é²œåº¦æ£€æŸ¥ (PR-002)

**é—®é¢˜èƒŒæ™¯**:
- ç½‘ç»œå»¶è¿Ÿæˆ–APIæ•…éšœå¯èƒ½å¯¼è‡´æ•°æ®è¿‡æœŸ
- ä½¿ç”¨è¿‡æœŸæ•°æ®åšå†³ç­–ä¼šäº§ç”Ÿè¯¯å¯¼

**è§£å†³æ–¹æ¡ˆ**:

1. **æ—¶é—´æˆ³å­—æ®µ**:
   - `source_timestamp`: æ•°æ®æºæ—¶é—´ï¼ˆBinance APIè¿”å›çš„æ—¶é—´ï¼‰
   - `computed_at`: æ•°æ®è®¡ç®—æ—¶é—´ï¼ˆæœ¬åœ°æ—¶é—´ï¼‰

2. **æ–°é²œåº¦æ£€æŸ¥**:
   ```python
   max_staleness = 120  # ç§’
   age = (computed_at - source_timestamp).total_seconds()
   
   if age > max_staleness:
       reason_tags.append(ReasonTag.DATA_STALE)
       # é™çº§ä¸º NO_TRADE
   ```

3. **é…ç½®åŒ–**:
   ```yaml
   # config/l1_thresholds.yaml
   data_quality:
     max_staleness_seconds: 120
   ```

**ReasonTag**:
- `DATA_STALE`: æ•°æ®è¿‡æœŸï¼ˆè¶…è¿‡120ç§’ï¼‰

---

## 8. ç½®ä¿¡åº¦ç³»ç»Ÿ

### 8.1 4å±‚ç½®ä¿¡åº¦è®¾è®¡ (PR-005)

**å‡çº§ç†ç”±**:
- 3å±‚ç½®ä¿¡åº¦ï¼ˆHIGH/MEDIUM/LOWï¼‰åŒºåˆ†åº¦ä¸å¤Ÿ
- éœ€è¦è¯†åˆ«"æœ€å¼ºä¿¡å·"ä»¥æä¾›ç»™L3ä¼˜å…ˆæ‰§è¡Œ

**æ–°å¢ç­‰çº§**:
- **ULTRA**: 90+åˆ†ï¼Œæœ€å¼ºä¿¡å·ï¼ˆTREND + GOOD + å¼ºä¹°å–ä¿¡å·ï¼‰
- **HIGH**: 65-89åˆ†ï¼Œå¼ºä¿¡å·
- **MEDIUM**: 40-64åˆ†ï¼Œä¸­ç­‰ä¿¡å·
- **LOW**: <40åˆ†ï¼Œå¼±ä¿¡å·

### 8.2 æ‰“åˆ†ç³»ç»Ÿè¯¦è§£

**è¯„åˆ†ç»´åº¦**:

| ç»´åº¦ | æœ€é«˜åˆ† | è¯„åˆ†è§„åˆ™ |
|-----|-------|---------|
| **å†³ç­–ç±»å‹** | 30 | LONG/SHORT=30, NO_TRADE=0 |
| **å¸‚åœºç¯å¢ƒ** | 30 | TREND=30, RANGE=10, EXTREME=0 |
| **äº¤æ˜“è´¨é‡** | 30 | GOOD=30, UNCERTAIN=15, POOR=0 |
| **ä¿¡å·å¼ºåº¦** | 10 | STRONG_BUYING/SELLING=+10 |

**ç¤ºä¾‹1: ULTRAç½®ä¿¡åº¦**:
```python
decision = Decision.LONG          # +30
regime = MarketRegime.TREND       # +30
quality = TradeQuality.GOOD       # +30
tags = [ReasonTag.STRONG_BUYING]  # +10
# æ€»åˆ† = 100 â†’ ULTRA
```

**ç¤ºä¾‹2: MEDIUMç½®ä¿¡åº¦**:
```python
decision = Decision.LONG              # +30
regime = MarketRegime.RANGE           # +10
quality = TradeQuality.UNCERTAIN      # +15
tags = []                             # +0
# æ€»åˆ† = 55 â†’ MEDIUM
```

### 8.3 æ‰§è¡Œè®¸å¯é€»è¾‘ (PR-006)

**è§„åˆ™**:
```python
def compute_executable(self):
    # åªæœ‰ ULTRA æˆ– HIGH æ‰å¯èƒ½æ‰§è¡Œ
    if self.confidence not in [Confidence.ULTRA, Confidence.HIGH]:
        self.executable = False
        return
    
    # è´¨é‡å¿…é¡»æ˜¯ GOOD æˆ– UNCERTAINï¼ˆPOORç›´æ¥æ‹’ç»ï¼‰
    if self.trade_quality == TradeQuality.POOR:
        self.executable = False
        return
    
    # é£é™©å¿…é¡»é€šè¿‡
    if not self.risk_exposure_allowed:
        self.executable = False
        return
    
    # å†³ç­–å¿…é¡»æ˜¯ LONG æˆ– SHORT
    if self.decision == Decision.NO_TRADE:
        self.executable = False
        return
    
    # é€šè¿‡æ‰€æœ‰æ£€æŸ¥
    self.executable = True
```

**çœŸå€¼è¡¨**:

| Confidence | Quality | Risk | Decision | Executable |
|-----------|---------|------|----------|-----------|
| ULTRA | GOOD | âœ… | LONG | âœ… |
| ULTRA | UNCERTAIN | âœ… | LONG | âœ… |
| ULTRA | POOR | âœ… | LONG | âŒ |
| HIGH | GOOD | âœ… | SHORT | âœ… |
| MEDIUM | GOOD | âœ… | LONG | âŒ |
| LOW | GOOD | âœ… | LONG | âŒ |

---

## 9. è´¨é‡è¯„ä¼°ç³»ç»Ÿ

### 9.1 3å±‚è´¨é‡è®¾è®¡ (PR-004)

**å‡çº§ç†ç”±**:
- 2å±‚è´¨é‡ï¼ˆGOOD/POORï¼‰è¿‡äºç²—ç³™
- éœ‡è¡å¸‚åœºï¼ˆNOISY_MARKETï¼‰ä¸åº”ç›´æ¥æ ‡è®°ä¸ºPOORï¼Œè€Œæ˜¯UNCERTAIN

**æ–°å¢ç­‰çº§**:
- **GOOD**: æ— è´¨é‡é—®é¢˜
- **UNCERTAIN**: å­˜åœ¨å™ªéŸ³ï¼Œä½†ä¸æ˜¯è‡´å‘½ç¼ºé™·
- **POOR**: ä¸¥é‡è´¨é‡é—®é¢˜ï¼ˆå¸çº³ã€è½®åŠ¨ï¼‰

### 9.2 è´¨é‡é—®é¢˜è¯¦è§£

#### 9.2.1 ABSORPTION_QUALITY_ISSUE (å¸çº³è´¨é‡å·®)

**å®šä¹‰**: OIä¸Šå‡ä½†ä»·æ ¼ä¸æ¶¨ï¼Œè¯´æ˜å¸‚åœºåœ¨å¸çº³ï¼ˆåšç©ºç›˜ï¼‰ã€‚

**æ£€æµ‹æ¡ä»¶**:
```python
if (oi_change_1h > 5% and       # OIä¸Šå‡
    price_change_1h < 1%):      # ä½†ä»·æ ¼å‡ ä¹ä¸å˜
    # å¸‚åœºåœ¨å¸çº³ç©ºå¤´ï¼Œè´¨é‡å·®
    tags.append(ReasonTag.ABSORPTION_QUALITY_ISSUE)
    quality = TradeQuality.POOR
```

**å«ä¹‰**: 
- ä»·æ ¼ä¸Šæ¶¨ä¹åŠ›ï¼Œå¯èƒ½æ˜¯ä¸»åŠ›åœ¨å¸ç­¹æˆ–åšç©ºç›˜å¤ªé‡
- ä¸é€‚åˆåšå¤š

#### 9.2.2 NOISY_MARKET (å™ªéŸ³å¸‚åœº)

**å®šä¹‰**: éœ‡è¡å¸‚åœº + ä¹°å–å¤±è¡¡æ³¢åŠ¨å¤§ã€‚

**æ£€æµ‹æ¡ä»¶**:
```python
if (regime == MarketRegime.RANGE and      # éœ‡è¡å¸‚åœº
    abs(buy_sell_imbalance - 0.5) < 0.1): # ä¹°å–åŠ›é‡æ¥è¿‘å¹³è¡¡
    tags.append(ReasonTag.NOISY_MARKET)
    quality = TradeQuality.UNCERTAIN
```

**å«ä¹‰**: 
- æ–¹å‘ä¸æ˜ç¡®ï¼Œå®¹æ˜“æ¥å›æ‰“è„¸
- é™çº§ä¸ºUNCERTAINï¼Œä½†ä¸ç›´æ¥æ‹’ç»

#### 9.2.3 ROTATION_RISK (è½®åŠ¨é£é™©)

**å®šä¹‰**: æŒä»“é‡å‰§çƒˆå˜åŒ–ï¼Œå¯èƒ½æ˜¯èµ„é‡‘åœ¨ä¸åŒå¸ç§é—´è½®åŠ¨ã€‚

**æ£€æµ‹æ¡ä»¶**:
```python
if abs(oi_change_1h) > 20%:  # 1å°æ—¶å†…OIå˜åŒ–è¶…è¿‡20%
    tags.append(ReasonTag.ROTATION_RISK)
    quality = TradeQuality.POOR
```

**å«ä¹‰**: 
- å¯èƒ½æ˜¯å¤§èµ„é‡‘å¿«é€Ÿè¿›å‡º
- é£é™©è¾ƒé«˜ï¼Œä¸é€‚åˆè·Ÿå•

#### 9.2.4 WEAK_SIGNAL (å¼±ä¿¡å·)

**å®šä¹‰**: ä¹°å–å¤±è¡¡ä¸æ˜æ˜¾ã€‚

**æ£€æµ‹æ¡ä»¶**:
```python
if abs(buy_sell_imbalance - 0.5) < 0.05:  # æ¥è¿‘50:50
    tags.append(ReasonTag.WEAK_SIGNAL)
    quality = TradeQuality.UNCERTAIN
```

**å«ä¹‰**: 
- ä¹°å–åŠ›é‡å‡è¡¡ï¼Œæ–¹å‘ä¸æ˜ç¡®

### 9.3 è´¨é‡è¯„çº§é€»è¾‘

```python
def _eval_trade_quality(self, data, regime):
    tags = []
    
    # æ£€æµ‹è´¨é‡é—®é¢˜
    if self._check_absorption_issue(data):
        tags.append(ReasonTag.ABSORPTION_QUALITY_ISSUE)
    
    if self._check_rotation_risk(data):
        tags.append(ReasonTag.ROTATION_RISK)
    
    if self._check_noisy_market(data, regime):
        tags.append(ReasonTag.NOISY_MARKET)
    
    if self._check_weak_signal(data):
        tags.append(ReasonTag.WEAK_SIGNAL)
    
    # è¯„çº§
    if ReasonTag.ABSORPTION_QUALITY_ISSUE in tags or \
       ReasonTag.ROTATION_RISK in tags:
        quality = TradeQuality.POOR
    elif ReasonTag.NOISY_MARKET in tags or \
         ReasonTag.WEAK_SIGNAL in tags:
        quality = TradeQuality.UNCERTAIN
    else:
        quality = TradeQuality.GOOD
    
    return quality, tags
```

---

## 10. å¤šå¸ç§æ”¯æŒ

### 10.1 Symbol Universe è®¾è®¡ (PR-010)

**é…ç½®åŒ–ç®¡ç†**:

```yaml
# config/l1_thresholds.yaml
symbol_universe:
  enabled_symbols:
    - BTC
    - ETH
    - BNB
    - SOL
    - XRP
  default_symbol: BTC
```

**åç«¯API**:

```python
@app.route('/api/markets')
def get_markets():
    config = advisory_engine.config
    enabled_symbols = config['symbol_universe']['enabled_symbols']
    default_symbol = config['symbol_universe']['default_symbol']
    
    return {
        "symbols": enabled_symbols,
        "default_symbol": default_symbol,
        "markets": {
            symbol: {"spot": False, "futures": True}
            for symbol in enabled_symbols
        }
    }
```

### 10.2 å‰ç«¯å¸ç§åˆ‡æ¢

**å¸ç§é€‰æ‹©å™¨**:

```html
<div class="symbol-selector">
    <span class="selector-label">ğŸ“Š å¸ç§ï¼ˆåˆçº¦å¸‚åœºï¼‰</span>
    <div class="selector-buttons" id="symbolButtons">
        <!-- åŠ¨æ€ç”Ÿæˆ -->
        <button class="active" data-symbol="BTC">BTC/USDT</button>
        <button data-symbol="ETH">ETH/USDT</button>
        <button data-symbol="BNB">BNB/USDT</button>
        <button data-symbol="SOL">SOL/USDT</button>
        <button data-symbol="XRP">XRP/USDT</button>
    </div>
</div>
```

**åˆ‡æ¢é€»è¾‘**:

```javascript
function selectSymbol(symbol) {
    currentSymbol = symbol;
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('#symbolButtons button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.symbol === symbol) {
            btn.classList.add('active');
        }
    });
    
    // åˆ·æ–°æ•°æ®
    refreshAdvisory();
}
```

### 10.3 å¸ç§æ•°æ®ç‹¬ç«‹æ€§

æ¯ä¸ªå¸ç§çš„æ•°æ®å®Œå…¨ç‹¬ç«‹ï¼š
- ç‹¬ç«‹çš„å†³ç­–ç»“æœ
- ç‹¬ç«‹çš„å†å²è®°å½•
- ç‹¬ç«‹çš„ç®¡é“æ­¥éª¤
- ç‹¬ç«‹çš„çŠ¶æ€æœºçŠ¶æ€

**æ•°æ®åº“è®¾è®¡**:

```sql
-- æ¯æ¡è®°å½•éƒ½æœ‰ symbol å­—æ®µ
CREATE TABLE l1_advisory_results (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL,  -- BTC, ETH, etc.
    decision TEXT NOT NULL,
    confidence TEXT NOT NULL,
    -- ...
);

-- æŸ¥è¯¢æ—¶æŒ‰ symbol è¿‡æ»¤
SELECT * FROM l1_advisory_results 
WHERE symbol = 'BTC' 
ORDER BY timestamp DESC 
LIMIT 30;
```

---

## 11. æ•°æ®æŒä¹…åŒ–

### 11.1 æ•°æ®åº“è¡¨ç»“æ„

#### è¡¨1: l1_advisory_results (å†³ç­–ç»“æœ)

```sql
CREATE TABLE l1_advisory_results (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol TEXT NOT NULL,                    -- å¸ç§
    decision TEXT NOT NULL,                  -- long/short/no_trade
    confidence TEXT NOT NULL,                -- ultra/high/medium/low
    market_regime TEXT NOT NULL,             -- trend/range/extreme
    system_state TEXT NOT NULL,              -- wait/active/cool_down
    risk_exposure_allowed INTEGER NOT NULL,  -- 0/1
    trade_quality TEXT NOT NULL,             -- good/uncertain/poor
    executable INTEGER NOT NULL,             -- 0/1
    reason_tags TEXT NOT NULL,               -- JSONæ•°ç»„
    timestamp TEXT NOT NULL                  -- ISO8601
);

-- ç´¢å¼•
CREATE INDEX idx_symbol_timestamp ON l1_advisory_results(symbol, timestamp DESC);
CREATE INDEX idx_timestamp ON l1_advisory_results(timestamp DESC);
```

#### è¡¨2: l1_pipeline_steps (ç®¡é“æ­¥éª¤)

```sql
CREATE TABLE l1_pipeline_steps (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    advisory_id INTEGER NOT NULL,         -- å…³è” advisory_results.id
    step INTEGER NOT NULL,                -- 1-8
    name TEXT NOT NULL,                   -- æ­¥éª¤åç§°
    status TEXT NOT NULL,                 -- success/failed/warning/pending
    result TEXT,                          -- æ­¥éª¤ç»“æœ
    message TEXT,                         -- è¯¦ç»†ä¿¡æ¯
    timestamp TEXT NOT NULL,              -- ISO8601
    FOREIGN KEY (advisory_id) REFERENCES l1_advisory_results(id)
);

-- ç´¢å¼•
CREATE INDEX idx_advisory_id ON l1_pipeline_steps(advisory_id);
```

### 11.2 å†·çƒ­å­˜å‚¨ (PR-008)

**è®¾è®¡åŸåˆ™**:
- **çƒ­å­˜å‚¨**: æœ€è¿‘24å°æ—¶çš„æ•°æ®ï¼Œç”¨äºå‰ç«¯å±•ç¤º
- **å†·å­˜å‚¨**: è¶…è¿‡24å°æ—¶çš„æ•°æ®ï¼Œè‡ªåŠ¨æ¸…ç†ï¼ˆæœªæ¥å¯è¿ç§»åˆ°å½’æ¡£ï¼‰

**è‡ªåŠ¨æ¸…ç†è°ƒåº¦**:

```python
from apscheduler.schedulers.background import BackgroundScheduler

scheduler = BackgroundScheduler()

# æ¯å°æ—¶æ¸…ç†ä¸€æ¬¡
scheduler.add_job(
    func=lambda: l1_db.cleanup_old_records(hours=24),
    trigger='interval',
    hours=1,
    id='cleanup_old_records'
)

scheduler.start()
```

**æ¸…ç†é€»è¾‘**:

```python
def cleanup_old_records(self, hours=24):
    cutoff_time = datetime.now() - timedelta(hours=hours)
    
    # åˆ é™¤æ—§çš„å†³ç­–ç»“æœ
    deleted_advisories = self.conn.execute(
        "DELETE FROM l1_advisory_results WHERE timestamp < ?",
        (cutoff_time.isoformat(),)
    ).rowcount
    
    # åˆ é™¤å­¤ç«‹çš„ç®¡é“æ­¥éª¤
    deleted_steps = self.conn.execute(
        """DELETE FROM l1_pipeline_steps 
           WHERE advisory_id NOT IN (SELECT id FROM l1_advisory_results)"""
    ).rowcount
    
    self.conn.commit()
    logger.info(f"Cleaned up {deleted_advisories} advisories, {deleted_steps} steps")
```

### 11.3 æ•°æ®æŸ¥è¯¢ç¤ºä¾‹

**æŸ¥è¯¢æœ€è¿‘30æ¡å†³ç­–**:

```python
# API: GET /api/l1/history/BTC?hours=24&limit=30
results = l1_db.get_advisory_history(
    symbol='BTC',
    hours=24,
    limit=30
)
```

**æŸ¥è¯¢ç‰¹å®šå†³ç­–çš„ç®¡é“æ­¥éª¤**:

```python
# API: GET /api/l1/pipeline/BTC?advisory_id=12345
steps = l1_db.get_pipeline_steps(advisory_id=12345)
```

---

## 12. Webç•Œé¢

### 12.1 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ L1 Advisory Layer                            â”‚
â”‚  äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ | Safety First                  â”‚
â”‚  æœ€åæ›´æ–°: 19:30:00    [ğŸ”„ åˆ·æ–°å†³ç­–]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š å¸ç§ï¼ˆåˆçº¦å¸‚åœºï¼‰                              â”‚
â”‚  [BTC] [ETH] [BNB] [SOL] [XRP]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¯ L1 å’¨è¯¢å†³ç­–          [BTC/USDT]              â”‚
â”‚                                                  â”‚
â”‚         ğŸŸ¢ LONG                                  â”‚
â”‚                                                  â”‚
â”‚  ç½®ä¿¡åº¦: HIGH  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%                    â”‚
â”‚  å†³ç­–æ—¶é—´: 2026-01-20 19:30:00                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ›¡ï¸ å®‰å…¨é—¸é—¨çŠ¶æ€                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚é£é™©å‡†å…¥  â”‚äº¤æ˜“è´¨é‡  â”‚å¸‚åœºç¯å¢ƒ  â”‚ç³»ç»ŸçŠ¶æ€  â”‚     â”‚
â”‚  â”‚âœ…Allowedâ”‚âœ…GOOD   â”‚ğŸ“ˆTREND  â”‚ğŸŸ¢ACTIVE â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚      L3æ‰§è¡Œè®¸å¯: âœ… Executable       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ å†³ç­–è¿½æº¯                                      â”‚
â”‚  [STRONG_BUYING] [FUNDING_SUPPORT] [TREND_MARKET]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” å†³ç­–ç®¡é“é€è§†                                  â”‚
â”‚  [ğŸ“¥æ•°æ®éªŒè¯âœ…] â†’ [ğŸŒ¡ï¸ç¯å¢ƒè¯†åˆ«âœ…] â†’ [ğŸ›¡ï¸é£é™©è¯„ä¼°âœ…]â”‚
â”‚  â†’ [âœ¨è´¨é‡è¯„ä¼°âœ…] â†’ [ğŸ¯æ–¹å‘åˆ¤æ–­âœ…] â†’ [ğŸ“Šå†³ç­–ä¼˜å…ˆçº§âœ…]â”‚
â”‚  â†’ [ğŸ”€çŠ¶æ€æ£€æŸ¥âœ…] â†’ [âœ…ç½®ä¿¡åº¦è®¡ç®—âœ…]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â±ï¸ å†å²å†³ç­–æ—¶é—´è½´ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰                 â”‚
â”‚  [19:30ğŸŸ¢] [19:29âšª] [19:28ğŸŸ¢] ...               â”‚
â”‚  [å±•å¼€æ›´å¤šå†å²è®°å½• (120)]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¹ å¸‚åœºæ•°æ®æ¦‚è§ˆ â–¼                               â”‚
â”‚  å½“å‰ä»·æ ¼: $50,000  |  24hæ¶¨è·Œ: +5.2%            â”‚
â”‚  èµ„é‡‘è´¹ç‡: 0.01%    |  æŒä»“é‡: 1.2B             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 æ ¸å¿ƒç»„ä»¶

#### 12.2.1 å¸ç§é€‰æ‹©å™¨

**CSSæ ·å¼**:
```css
.selector-buttons button {
    padding: 8px 16px;
    border: 2px solid #ddd;
    background: white;
    cursor: pointer;
    transition: all 0.3s;
}

.selector-buttons button.active {
    background: #4CAF50;
    color: white;
    border-color: #4CAF50;
}

.selector-buttons button.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f5f5f5;
}
```

**äº¤äº’é€»è¾‘**:
- ç‚¹å‡»å¸ç§æŒ‰é’®åˆ‡æ¢å½“å‰å¸ç§
- è‡ªåŠ¨åˆ·æ–°å†³ç­–æ•°æ®å’Œå†å²è®°å½•
- æ”¯æŒé”®ç›˜å¿«æ·é”®ï¼ˆæœªæ¥æ‰©å±•ï¼‰

#### 12.2.2 å†³ç­–ä¿¡å·é¢æ¿

**ä¸åŒå†³ç­–çš„é¢œè‰²**:
- ğŸŸ¢ LONG: ç»¿è‰²
- ğŸ”´ SHORT: çº¢è‰²
- âšª NO_TRADE: ç°è‰²

**ç½®ä¿¡åº¦é¢œè‰²**:
- ULTRA: æ·±ç»¿è‰²ï¼ˆ#2E7D32ï¼‰
- HIGH: ç»¿è‰²ï¼ˆ#4CAF50ï¼‰
- MEDIUM: æ©™è‰²ï¼ˆ#FF9800ï¼‰
- LOW: ç°è‰²ï¼ˆ#9E9E9Eï¼‰

#### 12.2.3 å®‰å…¨é—¸é—¨å¡ç‰‡

**é—¸é—¨çŠ¶æ€**:
- âœ… é€šè¿‡: ç»¿è‰²è¾¹æ¡†
- âš ï¸ è­¦å‘Š: æ©™è‰²è¾¹æ¡†
- âŒ æ‹’ç»: çº¢è‰²è¾¹æ¡†

**L3æ‰§è¡Œè®¸å¯**:
- å¤§å·å¡ç‰‡ï¼Œçªå‡ºæ˜¾ç¤º
- âœ… Executable: ç»¿è‰²
- â›” Not Executable: çº¢è‰²

#### 12.2.4 å†³ç­–ç®¡é“å¯è§†åŒ–

**8æ­¥æµç¨‹å›¾**:
```
ğŸ“¥ â†’ ğŸŒ¡ï¸ â†’ ğŸ›¡ï¸ â†’ âœ¨ â†’ ğŸ¯ â†’ ğŸ“Š â†’ ğŸ”€ â†’ âœ…
```

**æ­¥éª¤çŠ¶æ€**:
- âœ… success: ç»¿è‰²èƒŒæ™¯
- âš ï¸ warning: æ©™è‰²èƒŒæ™¯
- âŒ failed: çº¢è‰²èƒŒæ™¯
- â³ pending: ç°è‰²èƒŒæ™¯

**é¼ æ ‡æ‚¬åœ**:
- æ˜¾ç¤ºè¯¦ç»†çš„æ­¥éª¤ç»“æœå’Œæ¶ˆæ¯

#### 12.2.5 å†å²æ—¶é—´è½´

**æŠ˜å å±•å¼€**:
- é»˜è®¤æ˜¾ç¤ºæœ€è¿‘30æ¡
- è¶…è¿‡30æ¡æ˜¾ç¤º"å±•å¼€æ›´å¤š"æŒ‰é’®
- ç‚¹å‡»å±•å¼€æ˜¾ç¤ºå…¨éƒ¨å†å²

**ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…**:
```javascript
function showHistoryDetail(item) {
    alert(`
å†³ç­–: ${item.decision.toUpperCase()}
ç½®ä¿¡åº¦: ${item.confidence.toUpperCase()}
å¸‚åœºç¯å¢ƒ: ${item.market_regime.toUpperCase()}
å†³ç­–ä¾æ®: ${item.reason_tags.join(', ')}
æ—¶é—´: ${new Date(item.timestamp).toLocaleString()}
    `);
}
```

### 12.3 è‡ªåŠ¨åˆ·æ–°

**åˆ·æ–°é¢‘ç‡**: 60ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡

```javascript
function startAutoRefresh() {
    // ç«‹å³åˆ·æ–°ä¸€æ¬¡
    refreshAdvisory();
    
    // æ¯60ç§’åˆ·æ–°ä¸€æ¬¡
    setInterval(() => {
        refreshAdvisory();
    }, 60000);
}
```

**æ‰‹åŠ¨åˆ·æ–°**: ç‚¹å‡»"ğŸ”„ åˆ·æ–°å†³ç­–"æŒ‰é’®

---

## 13. APIæ¥å£

### 13.1 APIåˆ—è¡¨

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/api/markets` | GET | è·å–æ”¯æŒçš„å¸ç§åˆ—è¡¨ |
| `/api/l1/advisory/<symbol>` | GET | è·å–æœ€æ–°å†³ç­– |
| `/api/l1/history/<symbol>` | GET | è·å–å†å²å†³ç­– |
| `/api/l1/pipeline/<symbol>` | GET | è·å–å†³ç­–ç®¡é“æ­¥éª¤ |
| `/api/l1/reason-tags/explain` | GET | è·å–ReasonTagè§£é‡Š |
| `/health` | GET | å¥åº·æ£€æŸ¥ |

### 13.2 APIè¯¦ç»†è¯´æ˜

#### 13.2.1 GET /api/markets

**æè¿°**: è·å–æ”¯æŒçš„å¸ç§åˆ—è¡¨å’Œé»˜è®¤å¸ç§

**è¯·æ±‚**: æ— å‚æ•°

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "symbols": ["BTC", "ETH", "BNB", "SOL", "XRP"],
    "default_symbol": "BTC",
    "markets": {
      "BTC": {"spot": false, "futures": true},
      "ETH": {"spot": false, "futures": true},
      "BNB": {"spot": false, "futures": true},
      "SOL": {"spot": false, "futures": true},
      "XRP": {"spot": false, "futures": true}
    }
  },
  "message": null
}
```

#### 13.2.2 GET /api/l1/advisory/<symbol>

**æè¿°**: è·å–æŒ‡å®šå¸ç§çš„æœ€æ–°å†³ç­–

**è¯·æ±‚å‚æ•°**:
- `symbol`: å¸ç§ä»£ç ï¼ˆBTC, ETH, BNB, SOL, XRPï¼‰

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "symbol": "BTC",
    "decision": "long",
    "confidence": "high",
    "market_regime": "trend",
    "system_state": "wait",
    "risk_exposure_allowed": true,
    "trade_quality": "good",
    "executable": true,
    "reason_tags": [
      "STRONG_BUYING",
      "FUNDING_SUPPORT",
      "TREND_MARKET"
    ],
    "timestamp": "2026-01-20T19:30:00+08:00"
  },
  "message": null
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µ | ç±»å‹ | å¯é€‰å€¼ | è¯´æ˜ |
|-----|------|--------|------|
| `symbol` | string | BTC/ETH/... | å¸ç§ä»£ç  |
| `decision` | string | long/short/no_trade | å†³ç­–æ–¹å‘ |
| `confidence` | string | ultra/high/medium/low | ç½®ä¿¡åº¦ |
| `market_regime` | string | trend/range/extreme | å¸‚åœºç¯å¢ƒ |
| `system_state` | string | wait/active/cool_down | ç³»ç»ŸçŠ¶æ€ |
| `risk_exposure_allowed` | bool | true/false | é£é™©æ˜¯å¦é€šè¿‡ |
| `trade_quality` | string | good/uncertain/poor | äº¤æ˜“è´¨é‡ |
| `executable` | bool | true/false | L3æ˜¯å¦å¯æ‰§è¡Œ |
| `reason_tags` | array | [tag1, tag2, ...] | å†³ç­–ä¾æ®æ ‡ç­¾ |
| `timestamp` | string | ISO8601 | å†³ç­–æ—¶é—´ |

#### 13.2.3 GET /api/l1/history/<symbol>

**æè¿°**: è·å–æŒ‡å®šå¸ç§çš„å†å²å†³ç­–

**è¯·æ±‚å‚æ•°**:
- `symbol`: å¸ç§ä»£ç 
- `hours`: å†å²èŒƒå›´ï¼ˆå°æ—¶ï¼‰ï¼Œé»˜è®¤24
- `limit`: è¿”å›æ•°é‡ï¼Œé»˜è®¤100

**ç¤ºä¾‹**: `/api/l1/history/BTC?hours=24&limit=30`

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 12345,
      "symbol": "BTC",
      "decision": "long",
      "confidence": "high",
      "market_regime": "trend",
      "reason_tags": ["STRONG_BUYING"],
      "timestamp": "2026-01-20T19:30:00+08:00"
    },
    // ... æ›´å¤šè®°å½•
  ],
  "message": null
}
```

#### 13.2.4 GET /api/l1/pipeline/<symbol>

**æè¿°**: è·å–æŒ‡å®šå¸ç§çš„å†³ç­–ç®¡é“æ­¥éª¤

**è¯·æ±‚å‚æ•°**:
- `symbol`: å¸ç§ä»£ç 
- `advisory_id`: (å¯é€‰) ç‰¹å®šå†³ç­–çš„IDï¼Œå¦‚æœä¸æä¾›åˆ™è¿”å›æœ€æ–°çš„

**ç¤ºä¾‹**: 
- `/api/l1/pipeline/BTC` (æœ€æ–°çš„)
- `/api/l1/pipeline/BTC?advisory_id=12345` (å†å²çš„)

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "symbol": "BTC",
    "advisory_id": 12345,
    "steps": [
      {
        "step": 1,
        "name": "æ•°æ®éªŒè¯",
        "status": "success",
        "result": "è§„èŒƒåŒ–å®Œæˆ",
        "message": "ä»·æ ¼å˜åŒ–: 5.0% â†’ 0.05",
        "timestamp": "2026-01-20T19:30:00.100+08:00"
      },
      {
        "step": 2,
        "name": "ç¯å¢ƒè¯†åˆ«",
        "status": "success",
        "result": "TREND",
        "message": "6hä»·æ ¼å˜åŒ–è¶…è¿‡3%",
        "timestamp": "2026-01-20T19:30:00.200+08:00"
      },
      // ... 8æ­¥å®Œæ•´è®°å½•
    ]
  },
  "message": null
}
```

#### 13.2.5 GET /api/l1/reason-tags/explain

**æè¿°**: è·å–æ‰€æœ‰ReasonTagçš„è§£é‡Š

**è¯·æ±‚**: æ— å‚æ•°

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "LIQUIDATION_RISK": {
      "category": "risk",
      "explanation": "æ£€æµ‹åˆ°æ¸…ç®—é£é™©"
    },
    "STRONG_BUYING": {
      "category": "signal",
      "explanation": "å¼ºä¹°ç›˜ä¿¡å·"
    },
    // ... 23ä¸ªæ ‡ç­¾
  },
  "message": null
}
```

---

## 14. é…ç½®ç®¡ç†

### 14.1 é…ç½®æ–‡ä»¶ç»“æ„

**æ–‡ä»¶è·¯å¾„**: `config/l1_thresholds.yaml`

```yaml
# ==================
# Symbol Universeï¼ˆå¸ç§å®‡å®™ï¼‰
# ==================
symbol_universe:
  enabled_symbols:
    - BTC
    - ETH
    - BNB
    - SOL
    - XRP
  default_symbol: BTC

# ==================
# æ•°æ®è´¨é‡é˜ˆå€¼
# ==================
data_quality:
  max_staleness_seconds: 120

# ==================
# å¸‚åœºç¯å¢ƒè¯†åˆ«é˜ˆå€¼
# ==================
market_regime:
  extreme_price_change_1h: 5.0    # 1hä»·æ ¼å˜åŒ– > 5% â†’ EXTREME
  trend_price_change_6h: 3.0      # 6hä»·æ ¼å˜åŒ– > 3% â†’ TREND

# ==================
# é£é™©å‡†å…¥é˜ˆå€¼
# ==================
risk_exposure:
  liquidation:
    price_change: 5.0
    oi_drop: -15.0
  crowding:
    funding_abs: 0.001
    oi_growth: 30.0
  extreme_volume:
    multiplier: 10.0

# ==================
# äº¤æ˜“è´¨é‡é˜ˆå€¼
# ==================
trade_quality:
  absorption_price_threshold: 1.0
  absorption_oi_threshold: 5.0
  weak_imbalance_threshold: 0.05
  rotation_oi_change_threshold: 20.0

# ==================
# æ–¹å‘åˆ¤æ–­é˜ˆå€¼
# ==================
direction_thresholds:
  long:
    buy_imbalance_min: 0.6
    oi_change_1h_min: 5.0
    price_change_1h_min: 2.0
  short:
    sell_imbalance_max: 0.4
    oi_change_1h_min: 5.0
    price_change_1h_max: -2.0
  funding_rate:
    resistance_threshold: 0.0005
    support_threshold: -0.0005

# ==================
# çŠ¶æ€æœºé…ç½®
# ==================
state_machine:
  cool_down_seconds: 300

# ==================
# ç½®ä¿¡åº¦é…ç½®
# ==================
confidence_scoring:
  decision_score: 30
  regime_trend_score: 30
  regime_range_score: 10
  regime_extreme_score: 0
  quality_good_score: 30
  quality_uncertain_score: 15
  quality_poor_score: 0
  strong_signal_bonus: 10
  thresholds:
    ultra: 90
    high: 65
    medium: 40
```

### 14.2 é…ç½®çƒ­æ›´æ–°

**å®ç°æ–¹å¼**: Watchdogç›‘å¬æ–‡ä»¶å˜åŒ–

```python
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler

class ConfigReloadHandler(FileSystemEventHandler):
    def on_modified(self, event):
        if event.src_path.endswith('l1_thresholds.yaml'):
            logger.info("Config file changed, reloading...")
            advisory_engine.reload_config()

observer = Observer()
observer.schedule(ConfigReloadHandler(), path='./config', recursive=False)
observer.start()
```

**é‡è½½é€»è¾‘**:
```python
def reload_config(self):
    with open(self.config_path, 'r', encoding='utf-8') as f:
        new_config = yaml.safe_load(f)
    
    self.config = new_config
    self.thresholds = self._flatten_thresholds(new_config)
    
    logger.info(f"Config reloaded: {len(self.thresholds)} thresholds")
```

### 14.3 é…ç½®ä¿®æ”¹ç¤ºä¾‹

**ç¤ºä¾‹1: æ·»åŠ æ–°å¸ç§**

```yaml
symbol_universe:
  enabled_symbols:
    - BTC
    - ETH
    - BNB
    - SOL
    - XRP
    - DOGE  # æ–°å¢
  default_symbol: BTC
```

**ç”Ÿæ•ˆ**: ä¿å­˜æ–‡ä»¶åï¼Œæ— éœ€é‡å¯æœåŠ¡ï¼Œå‰ç«¯åˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°æ–°å¸ç§ã€‚

**ç¤ºä¾‹2: è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼**

```yaml
confidence_scoring:
  thresholds:
    ultra: 95   # ä»90æé«˜åˆ°95
    high: 70    # ä»65æé«˜åˆ°70
    medium: 45  # ä»40æé«˜åˆ°45
```

**æ•ˆæœ**: æé«˜äº†ç½®ä¿¡åº¦è¯„çº§çš„é—¨æ§›ï¼Œæ›´ä¸¥æ ¼ã€‚

---

## 15. éƒ¨ç½²æ¶æ„

### 15.1 éƒ¨ç½²ç¯å¢ƒ

| ç¯å¢ƒ | ç”¨é€” | è®¿é—®æ–¹å¼ |
|-----|------|---------|
| **æœ¬åœ°å¼€å‘** | æ—¥å¸¸å¼€å‘ã€æµ‹è¯• | http://localhost:8001 |
| **AWSç”Ÿäº§** | ç”Ÿäº§æœåŠ¡ | http://43.212.176.169:8001 (å†…ç½‘) |

### 15.2 Dockeréƒ¨ç½²

**Dockerfile** (`Dockerfile.l1`):

```dockerfile
FROM python:3.12-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && \
    apt-get install -y --no-install-recommends gcc curl && \
    rm -rf /var/lib/apt/lists/*

# å®‰è£…Pythonä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY btc_web_app_l1.py .
COPY market_state_machine_l1.py .
COPY database_l1.py .
COPY data_cache.py .
COPY binance_data_fetcher.py .
COPY metrics_normalizer.py .
COPY logger_config.py .
COPY models/ ./models/
COPY config/ ./config/
COPY static/ ./static/
COPY templates/ ./templates/

# åˆ›å»ºæ•°æ®ç›®å½•
RUN mkdir -p data/db

EXPOSE 5001

HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:5001/health || exit 1

CMD ["python", "btc_web_app_l1.py"]
```

**Docker Compose** (`docker-compose-l1.yml`):

```yaml
services:
  l1-advisory:
    build:
      context: .
      dockerfile: Dockerfile.l1
    image: trade-info-l1:latest
    container_name: l1-advisory-layer
    ports:
      - "8001:5001"  # å¤–éƒ¨8001æ˜ å°„åˆ°å†…éƒ¨5001
    volumes:
      - ./data/db:/app/data/db
      - ./config:/app/config
    restart: unless-stopped
    networks:
      - l1-network

networks:
  l1-network:
    driver: bridge
```

### 15.3 éƒ¨ç½²è„šæœ¬

**æœ¬åœ°å¯åŠ¨** (`docker-l1-run.sh`):

```bash
#!/bin/bash
echo "ğŸš€ å¯åŠ¨L1 Advisory LayeræœåŠ¡..."
docker compose -f docker-compose-l1.yml up -d --build
sleep 3
echo "âœ… L1 Advisory Layer æœåŠ¡å¯åŠ¨æˆåŠŸï¼"
echo "è®¿é—®åœ°å€: http://localhost:8001"
```

**æœ¬åœ°åœæ­¢** (`docker-l1-stop.sh`):

```bash
#!/bin/bash
echo "ğŸ›‘ åœæ­¢L1 Advisory LayeræœåŠ¡..."
docker compose -f docker-compose-l1.yml down
echo "âœ… L1 Advisory Layer æœåŠ¡å·²åœæ­¢"
```

**AWSéƒ¨ç½²** (`aws-connect.sh deploy`):

```bash
#!/bin/bash
KEY_PATH="../john-test.pem"
SERVER="ubuntu@43.212.176.169"
REMOTE_DIR="~/trade-info-l1"

echo "ğŸ“¦ åŒæ­¥ä»£ç åˆ°AWSæœåŠ¡å™¨..."
rsync -avz --exclude 'data/db/*.db' --exclude '.git' \
    -e "ssh -i $KEY_PATH -o StrictHostKeyChecking=no" \
    ./ $SERVER:$REMOTE_DIR/

echo "ğŸ”„ é‡å¯AWSæœåŠ¡..."
ssh -i $KEY_PATH -o StrictHostKeyChecking=no $SERVER \
    "cd $REMOTE_DIR && ./docker-l1-stop.sh && ./docker-l1-run.sh"

echo "âœ… AWSéƒ¨ç½²å®Œæˆï¼"
```

### 15.4 AWSæœåŠ¡å™¨é…ç½®

**æœåŠ¡å™¨ä¿¡æ¯**:
- IP: 43.212.176.169
- ç³»ç»Ÿ: Ubuntu
- ç”¨æˆ·: ubuntu
- è®¤è¯: SSHå¯†é’¥ (john-test.pem)

**å·²å®‰è£…ç»„ä»¶**:
- Docker
- Docker Compose
- Python 3.12
- Git

**æœåŠ¡ç®¡ç†**:

```bash
# æŸ¥çœ‹æ—¥å¿—
ssh -i ../john-test.pem ubuntu@43.212.176.169 \
    "docker logs -f l1-advisory-layer"

# æŸ¥çœ‹çŠ¶æ€
ssh -i ../john-test.pem ubuntu@43.212.176.169 \
    "docker compose -f ~/trade-info-l1/docker-compose-l1.yml ps"

# é‡å¯æœåŠ¡
ssh -i ../john-test.pem ubuntu@43.212.176.169 \
    "cd ~/trade-info-l1 && ./docker-l1-run.sh"
```

---

## 16. å¼€å‘æµç¨‹

### 16.1 æ ‡å‡†å·¥ä½œæµ

```
æœ¬åœ°å¼€å‘ â†’ æœ¬åœ°æµ‹è¯• â†’ Gitæäº¤ â†’ AWSéƒ¨ç½²
```

**è¯¦ç»†æ­¥éª¤**:

1. **æœ¬åœ°å¼€å‘**:
   ```bash
   # å¯åŠ¨æœ¬åœ°æœåŠ¡
   ./docker-l1-run.sh
   
   # è®¿é—®æœ¬åœ°æœåŠ¡
   open http://localhost:8001
   
   # ä¿®æ”¹ä»£ç ...
   
   # é‡å¯æœåŠ¡éªŒè¯
   ./docker-l1-stop.sh
   ./docker-l1-run.sh
   ```

2. **è¿è¡Œæµ‹è¯•**:
   ```bash
   # æ–¹å¼1: åœ¨Dockerå®¹å™¨å†…è¿è¡Œ
   docker exec -it l1-advisory-layer python tests/test_pr_batch1_standalone.py
   
   # æ–¹å¼2: ç›´æ¥è¿è¡Œ
   python3 tests/test_pr_batch1_standalone.py
   ```

3. **Gitæäº¤**:
   ```bash
   git add .
   git commit -m "æè¿°æ€§çš„æäº¤ä¿¡æ¯"
   git push origin main
   ```

4. **AWSéƒ¨ç½²**:
   ```bash
   # æ–¹å¼1: ä½¿ç”¨å¿«æ·è„šæœ¬
   ./aws-connect.sh deploy
   
   # æ–¹å¼2: æ‰‹åŠ¨éƒ¨ç½²
   rsync -avz -e "ssh -i ../john-test.pem" ./ ubuntu@43.212.176.169:~/trade-info-l1/
   ssh -i ../john-test.pem ubuntu@43.212.176.169 "cd ~/trade-info-l1 && ./docker-l1-run.sh"
   ```

### 16.2 é…ç½®ä¿®æ”¹æµç¨‹

**åœºæ™¯**: ä¿®æ”¹é…ç½®æ–‡ä»¶ `config/l1_thresholds.yaml`

**æœ¬åœ°æµ‹è¯•**:
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
2. ä¿å­˜ï¼ˆè‡ªåŠ¨çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯ï¼‰
3. åˆ·æ–°æµè§ˆå™¨éªŒè¯

**AWSéƒ¨ç½²**:
1. ä¿®æ”¹æœ¬åœ°é…ç½®æ–‡ä»¶
2. Gitæäº¤
3. ä½¿ç”¨ `./aws-connect.sh deploy` éƒ¨ç½²
4. é…ç½®è‡ªåŠ¨çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯æœåŠ¡

### 16.3 æ–°å¢å¸ç§æµç¨‹

**åœºæ™¯**: æ·»åŠ æ–°å¸ç§DOGE

1. **ä¿®æ”¹é…ç½®**:
   ```yaml
   symbol_universe:
     enabled_symbols:
       - BTC
       - ETH
       - BNB
       - SOL
       - XRP
       - DOGE  # æ–°å¢
   ```

2. **æœ¬åœ°éªŒè¯**:
   - è®¿é—® http://localhost:8001
   - æŸ¥çœ‹å¸ç§é€‰æ‹©å™¨æ˜¯å¦å‡ºç°DOGEæŒ‰é’®
   - ç‚¹å‡»DOGEï¼ŒæŸ¥çœ‹å†³ç­–æ˜¯å¦æ­£å¸¸

3. **éƒ¨ç½²ä¸Šçº¿**:
   ```bash
   git add config/l1_thresholds.yaml
   git commit -m "æ–°å¢DOGEå¸ç§æ”¯æŒ"
   git push origin main
   ./aws-connect.sh deploy
   ```

---

## 17. æµ‹è¯•è¦†ç›–

### 17.1 æµ‹è¯•æ–‡ä»¶åˆ—è¡¨

| æµ‹è¯•æ–‡ä»¶ | è¦†ç›–PR | æµ‹è¯•æ•°é‡ | é€šè¿‡ç‡ |
|---------|--------|---------|--------|
| `test_pr_batch1_standalone.py` | PR-001, PR-002, PR-003 | 11 | 100% |
| `test_pr_batch2_standalone.py` | PR-004, PR-005, PR-006 | 8 | 100% |
| `test_pr_batch3_standalone.py` | PR-007, PR-008, PR-009, PR-010 | 9 | 100% |
| **æ€»è®¡** | **10ä¸ªPR** | **28** | **100%** |

### 17.2 æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

#### æµ‹è¯•1: æŒ‡æ ‡è§„èŒƒåŒ–

```python
def test_normalize_percentage_to_decimal():
    """PR-001: ç™¾åˆ†ç‚¹ â†’ å°æ•°"""
    data = {
        "price_change_1h": 5.0,  # 5%
        "oi_change_1h": -3.0,    # -3%
    }
    normalized, valid, msg = MetricsNormalizer.normalize(data)
    
    assert valid == True
    assert normalized["price_change_1h"] == 0.05
    assert normalized["oi_change_1h"] == -0.03
```

#### æµ‹è¯•2: æ•°æ®æ–°é²œåº¦

```python
def test_data_freshness_stale():
    """PR-002: è¿‡æœŸæ•°æ®æ£€æµ‹"""
    old_time = (datetime.now() - timedelta(seconds=150)).isoformat()
    data = {
        "source_timestamp": old_time,
        "price": 50000,
        # ...
    }
    
    result = engine.on_new_tick(data)
    
    assert result.decision == Decision.NO_TRADE
    assert ReasonTag.DATA_STALE in result.reason_tags
```

#### æµ‹è¯•3: 4å±‚ç½®ä¿¡åº¦

```python
def test_confidence_ultra():
    """PR-005: ULTRAç½®ä¿¡åº¦"""
    # æ¨¡æ‹Ÿæœ€å¼ºä¿¡å·
    result = engine._compute_confidence(
        decision=Decision.LONG,
        regime=MarketRegime.TREND,
        quality=TradeQuality.GOOD,
        reason_tags=[ReasonTag.STRONG_BUYING]
    )
    
    assert result == Confidence.ULTRA
```

#### æµ‹è¯•4: æ‰§è¡Œè®¸å¯

```python
def test_executable_gate():
    """PR-006: åªæœ‰HIGH+GOODæ‰å¯æ‰§è¡Œ"""
    result = AdvisoryResult(
        decision=Decision.LONG,
        confidence=Confidence.HIGH,
        trade_quality=TradeQuality.GOOD,
        risk_exposure_allowed=True,
        # ...
    )
    result.compute_executable()
    
    assert result.executable == True
```

### 17.3 è¿è¡Œæµ‹è¯•

**Dockerç¯å¢ƒå†…è¿è¡Œ**:
```bash
docker exec -it l1-advisory-layer python tests/test_pr_batch1_standalone.py
docker exec -it l1-advisory-layer python tests/test_pr_batch2_standalone.py
docker exec -it l1-advisory-layer python tests/test_pr_batch3_standalone.py
```

**æœ¬åœ°è¿è¡Œ**:
```bash
python3 tests/test_pr_batch1_standalone.py
python3 tests/test_pr_batch2_standalone.py
python3 tests/test_pr_batch3_standalone.py
```

---

## 18. ä½¿ç”¨æŒ‡å—

### 18.1 å¿«é€Ÿå¼€å§‹

**æœ¬åœ°å¼€å‘**:

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/qiang0723/trade-test.git
cd trade-test

# 2. å¯åŠ¨æœåŠ¡
./docker-l1-run.sh

# 3. è®¿é—®Webç•Œé¢
open http://localhost:8001
```

**AWSç”Ÿäº§ç¯å¢ƒ**:

```bash
# éƒ¨ç½²åˆ°AWS
./aws-connect.sh deploy

# æŸ¥çœ‹AWSæœåŠ¡æ—¥å¿—
./aws-connect.sh logs

# æŸ¥çœ‹AWSæœåŠ¡çŠ¶æ€
./aws-connect.sh status
```

### 18.2 å¸¸è§æ“ä½œ

#### 18.2.1 åˆ‡æ¢å¸ç§

1. æ‰“å¼€Webç•Œé¢ http://localhost:8001
2. ç‚¹å‡»é¡¶éƒ¨å¸ç§é€‰æ‹©å™¨ä¸­çš„å¸ç§æŒ‰é’®ï¼ˆå¦‚ETH/USDTï¼‰
3. é¡µé¢è‡ªåŠ¨åˆ·æ–°å¹¶æ˜¾ç¤ºè¯¥å¸ç§çš„å†³ç­–

#### 18.2.2 æŸ¥çœ‹å†å²å†³ç­–

1. æ»šåŠ¨åˆ°"å†å²å†³ç­–æ—¶é—´è½´"åŒºåŸŸ
2. é»˜è®¤æ˜¾ç¤ºæœ€è¿‘30æ¡
3. ç‚¹å‡»"å±•å¼€æ›´å¤šå†å²è®°å½•"æŸ¥çœ‹å…¨éƒ¨
4. ç‚¹å‡»å•æ¡å†å²è®°å½•æŸ¥çœ‹è¯¦æƒ…

#### 18.2.3 æŸ¥çœ‹å†³ç­–ç®¡é“

1. æŸ¥çœ‹"å†³ç­–ç®¡é“é€è§†"åŒºåŸŸ
2. 8ä¸ªæ­¥éª¤å®æ—¶æ˜¾ç¤ºæ‰§è¡ŒçŠ¶æ€
3. é¼ æ ‡æ‚¬åœåœ¨æ­¥éª¤ä¸ŠæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

#### 18.2.4 ä¿®æ”¹é…ç½®

```bash
# 1. ç¼–è¾‘é…ç½®æ–‡ä»¶
vim config/l1_thresholds.yaml

# 2. ä¿å­˜ï¼ˆè‡ªåŠ¨çƒ­æ›´æ–°ï¼‰

# 3. åˆ·æ–°æµè§ˆå™¨éªŒè¯
```

#### 18.2.5 æ·»åŠ æ–°å¸ç§

```yaml
# ç¼–è¾‘ config/l1_thresholds.yaml
symbol_universe:
  enabled_symbols:
    - BTC
    - ETH
    - BNB
    - SOL
    - XRP
    - DOGE  # æ–°å¢

# ä¿å­˜åï¼Œåˆ·æ–°æµè§ˆå™¨å³å¯çœ‹åˆ°æ–°å¸ç§
```

### 18.3 æ•…éšœæ’æŸ¥

#### é—®é¢˜1: å¸ç§æŒ‰é’®æ˜¯ç°è‰²ï¼Œæ— æ³•ç‚¹å‡»

**åŸå› **: å‰ç«¯æ•°æ®åŠ è½½é”™è¯¯æˆ–APIè¿”å›é”™è¯¯ã€‚

**æ’æŸ¥**:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹Consoleæ˜¯å¦æœ‰é”™è¯¯
3. æ£€æŸ¥Networkæ ‡ç­¾ï¼ŒæŸ¥çœ‹`/api/markets`è¯·æ±‚æ˜¯å¦æˆåŠŸ
4. æ£€æŸ¥æœåŠ¡æ—¥å¿—: `docker logs l1-advisory-layer`

#### é—®é¢˜2: å†³ç­–ä¸€ç›´æ˜¾ç¤ºNO_TRADE

**åŸå› **: 
- æ•°æ®è¿‡æœŸï¼ˆDATA_STALEï¼‰
- é£é™©é—¸é—¨æ‹’ç»
- ä¹°å–å¤±è¡¡ä¸è¶³

**æ’æŸ¥**:
1. æŸ¥çœ‹"å†³ç­–è¿½æº¯"åŒºåŸŸçš„reason_tags
2. æŸ¥çœ‹"å®‰å…¨é—¸é—¨çŠ¶æ€"æ˜¯å¦æœ‰çº¢è‰²æ ‡è®°
3. æŸ¥çœ‹"å†³ç­–ç®¡é“é€è§†"å“ªä¸€æ­¥å¤±è´¥äº†

#### é—®é¢˜3: æœåŠ¡æ— æ³•å¯åŠ¨

**æ’æŸ¥**:
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs l1-advisory-layer

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8001

# é‡æ–°æ„å»º
./docker-l1-stop.sh
docker compose -f docker-compose-l1.yml build --no-cache
./docker-l1-run.sh
```

### 18.4 æœ€ä½³å®è·µ

#### 18.4.1 é…ç½®è°ƒä¼˜

**ä¿å®ˆèµ·ç‚¹** â†’ **é€æ­¥æ”¾æ¾**:

```yaml
# åˆå§‹é…ç½®ï¼ˆä¿å®ˆï¼‰
direction_thresholds:
  long:
    buy_imbalance_min: 0.65  # 65%ä¹°ç›˜
    oi_change_1h_min: 8.0    # 8% OIå¢é•¿
    price_change_1h_min: 3.0 # 3%ä»·æ ¼ä¸Šæ¶¨

# ä¼˜åŒ–åï¼ˆé€‚ä¸­ï¼‰
direction_thresholds:
  long:
    buy_imbalance_min: 0.60  # 60%ä¹°ç›˜
    oi_change_1h_min: 5.0    # 5% OIå¢é•¿
    price_change_1h_min: 2.0 # 2%ä»·æ ¼ä¸Šæ¶¨
```

#### 18.4.2 å¤šå¸ç§ç­–ç•¥

**ä¸åŒå¸ç§ä½¿ç”¨ä¸åŒé˜ˆå€¼** (æœªæ¥æ‰©å±•):

```yaml
# æœªæ¥å¯ä»¥æ”¯æŒ
symbol_specific_thresholds:
  BTC:
    direction_thresholds:
      long:
        buy_imbalance_min: 0.60
  ETH:
    direction_thresholds:
      long:
        buy_imbalance_min: 0.65  # ETHæ›´ä¿å®ˆ
```

#### 18.4.3 ç›‘æ§å’Œå‘Šè­¦

**å…³é”®æŒ‡æ ‡**:
- å†³ç­–é¢‘ç‡ï¼ˆper hourï¼‰
- LONG/SHORT/NO_TRADEæ¯”ä¾‹
- æ‰§è¡Œè®¸å¯ç‡
- æ•°æ®æ–°é²œåº¦

**å‘Šè­¦æ¡ä»¶**:
- è¿ç»­10æ¬¡NO_TRADE â†’ æ£€æŸ¥æ•°æ®æº
- DATA_STALEé¢‘ç¹å‡ºç° â†’ æ£€æŸ¥ç½‘ç»œ
- æ‰§è¡Œè®¸å¯ç‡<5% â†’ é˜ˆå€¼è¿‡ä¸¥

---

## é™„å½•A: ReasonTagå®Œæ•´åˆ—è¡¨

### A.1 é£é™©ç±»ï¼ˆRiskï¼‰

| Tag | å«ä¹‰ | è§¦å‘æ¡ä»¶ |
|-----|------|---------|
| `LIQUIDATION_RISK` | æ¸…ç®—é£é™© | price_change_1h > 5% AND oi_drop < -15% |
| `CROWDING_RISK` | æ‹¥æŒ¤é£é™© | abs(funding_rate) > 0.001 AND oi_growth > 30% |
| `EXTREME_VOLUME` | æç«¯æˆäº¤é‡ | volume_1h > 10x volume_24h_avg |
| `DATA_STALE` | æ•°æ®è¿‡æœŸ | æ•°æ®æ—¶é—´æˆ³è¶…è¿‡120ç§’ |

### A.2 è´¨é‡ç±»ï¼ˆQualityï¼‰

| Tag | å«ä¹‰ | è§¦å‘æ¡ä»¶ |
|-----|------|---------|
| `ABSORPTION_QUALITY_ISSUE` | å¸çº³è´¨é‡å·® | oi_change_1h > 5% BUT price_change_1h < 1% |
| `NOISY_MARKET` | å™ªéŸ³å¸‚åœº | RANGE market AND imbalanceæ³¢åŠ¨å¤§ |
| `ROTATION_RISK` | è½®åŠ¨é£é™© | abs(oi_change_1h) > 20% |
| `WEAK_SIGNAL` | å¼±ä¿¡å· | buy_sell_imbalanceæ¥è¿‘0.5 |

### A.3 ä¿¡å·ç±»ï¼ˆSignalï¼‰

| Tag | å«ä¹‰ | è§¦å‘æ¡ä»¶ |
|-----|------|---------|
| `STRONG_BUYING` | å¼ºä¹°ç›˜ | imbalance > 0.6 AND oi_up AND price_up |
| `STRONG_SELLING` | å¼ºå–ç›˜ | imbalance < 0.4 AND oi_up AND price_down |
| `FUNDING_RESISTANCE` | èµ„é‡‘è´¹ç‡é˜»åŠ› | funding_rate > 0.0005ï¼ˆåšç©ºå‹åŠ›ï¼‰ |
| `FUNDING_SUPPORT` | èµ„é‡‘è´¹ç‡æ”¯æ’‘ | funding_rate < -0.0005ï¼ˆåšå¤šæ”¯æ’‘ï¼‰ |
| `TREND_MARKET` | è¶‹åŠ¿å¸‚åœº | MarketRegime.TREND |
| `RANGE_MARKET` | éœ‡è¡å¸‚åœº | MarketRegime.RANGE |
| `EXTREME_MARKET` | æç«¯å¸‚åœº | MarketRegime.EXTREME |

---

## é™„å½•B: å­—æ®µè§„èŒƒé€ŸæŸ¥è¡¨

| å­—æ®µ | å•ä½ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|-----|------|------|------|------|
| `price` | USDT | float | 50000.0 | å½“å‰ä»·æ ¼ |
| `price_change_1h` | å°æ•° | float | 0.05 | 1å°æ—¶ä»·æ ¼å˜åŒ–ï¼ˆ5% = 0.05ï¼‰ |
| `price_change_6h` | å°æ•° | float | 0.03 | 6å°æ—¶ä»·æ ¼å˜åŒ–ï¼ˆ3% = 0.03ï¼‰ |
| `oi_change_1h` | å°æ•° | float | 0.08 | 1å°æ—¶OIå˜åŒ–ï¼ˆ8% = 0.08ï¼‰ |
| `oi_change_6h` | å°æ•° | float | -0.15 | 6å°æ—¶OIå˜åŒ–ï¼ˆ-15% = -0.15ï¼‰ |
| `funding_rate` | å°æ•° | float | 0.0001 | èµ„é‡‘è´¹ç‡ï¼ˆ0.01% = 0.0001ï¼‰ |
| `buy_sell_imbalance` | å°æ•° | float | 0.65 | ä¹°å–å¤±è¡¡ï¼ˆ65% = 0.65ï¼‰ |
| `volume_1h` | USDT | float | 1000000 | 1å°æ—¶æˆäº¤é‡ |
| `volume_24h` | USDT | float | 20000000 | 24å°æ—¶æˆäº¤é‡ |

---

## é™„å½•C: ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### v2.0 (2026-01-20)

**æ–°å¢åŠŸèƒ½**:
- âœ… 4å±‚ç½®ä¿¡åº¦ç³»ç»Ÿï¼ˆULTRA/HIGH/MEDIUM/LOWï¼‰
- âœ… 3å±‚è´¨é‡ç³»ç»Ÿï¼ˆGOOD/UNCERTAIN/POORï¼‰
- âœ… æŒ‡æ ‡è§„èŒƒåŒ–ï¼ˆè‡ªåŠ¨è½¬æ¢ç™¾åˆ†æ¯”æ ¼å¼ï¼‰
- âœ… æ•°æ®æ–°é²œåº¦æ£€æŸ¥ï¼ˆ120ç§’è¿‡æœŸï¼‰
- âœ… å†³ç­–ç®¡é“æŒä¹…åŒ–ï¼ˆ8æ­¥å­˜å‚¨åˆ°DBï¼‰
- âœ… å†·çƒ­å­˜å‚¨ï¼ˆ24å°æ—¶è‡ªåŠ¨æ¸…ç†ï¼‰
- âœ… å†³ç­–ç®¡é“å¯è§†åŒ–ï¼ˆå‰ç«¯å®æ—¶å±•ç¤ºï¼‰
- âœ… å¤šå¸ç§æ”¯æŒï¼ˆ5+å¯é…ç½®ï¼‰
- âœ… AWSç”Ÿäº§éƒ¨ç½²

**ä¼˜åŒ–æ”¹è¿›**:
- ğŸ”§ èµ„é‡‘è´¹ç‡é™çº§ï¼ˆä»ä¸»è¦è§¦å‘é™ä¸ºè¾…åŠ©æ ‡è®°ï¼‰
- ğŸ”§ ReasonTagç»Ÿä¸€ï¼ˆ23ä¸ªæ ‡å‡†åŒ–æ ‡ç­¾ï¼‰
- ğŸ”§ æ‰§è¡Œè®¸å¯é€»è¾‘ï¼ˆæ˜ç¡®L3æ‰§è¡Œæ¡ä»¶ï¼‰
- ğŸ”§ é…ç½®çƒ­æ›´æ–°ï¼ˆWatchdogç›‘å¬ï¼‰

**PRå®æ–½**:
- PR-001: æŒ‡æ ‡è§„èŒƒåŒ–
- PR-002: æ•°æ®æ–°é²œåº¦é—¨æ§
- PR-003: ReasonTagç»Ÿä¸€
- PR-004: 3å±‚è´¨é‡ä½“ç³»
- PR-005: 4å±‚ç½®ä¿¡åº¦
- PR-006: å¯æ‰§è¡Œé—¸é—¨
- PR-007: Step TraceæŒä¹…åŒ–
- PR-008: å†·çƒ­å­˜å‚¨
- PR-009: Step Traceå‰ç«¯
- PR-010: Symbol Universe

**æµ‹è¯•è¦†ç›–**:
- âœ… 28ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100%é€šè¿‡

### v1.0 (2026-01-18)

**åˆå§‹å®ç°**:
- âœ… 8æ­¥å†³ç­–ç®¡é“
- âœ… 3å±‚ç½®ä¿¡åº¦ï¼ˆHIGH/MEDIUM/LOWï¼‰
- âœ… 2å±‚è´¨é‡ï¼ˆGOOD/POORï¼‰
- âœ… é£é™©å‡†å…¥è¯„ä¼°
- âœ… çŠ¶æ€æœºç®¡ç†
- âœ… Webç•Œé¢
- âœ… Dockeréƒ¨ç½²

---

## é™„å½•D: è”ç³»æ–¹å¼

**é¡¹ç›®åœ°å€**: https://github.com/qiang0723/trade-test  
**ç³»ç»Ÿåç§°**: L1 Advisory Layer  
**å½“å‰ç‰ˆæœ¬**: 2.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-20

---

**æ–‡æ¡£ç»“æŸ**
