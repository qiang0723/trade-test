# ğŸ¯ å½“å‰å¸‚åœºåˆ†æé€»è¾‘ä¸æŠ€æœ¯å®ç°æ€»ç»“

> æœ€åæ›´æ–°ï¼š2026-01-20  
> ç‰ˆæœ¬ï¼šv3.0 çŠ¶æ€æœºæ¶æ„  
> ä½œè€…ï¼šTrade Info System

---

## ğŸ“š ç›®å½•

1. [æ ¸å¿ƒè®¾è®¡ç†å¿µ](#æ ¸å¿ƒè®¾è®¡ç†å¿µ)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [çŠ¶æ€æœºè®¾è®¡](#çŠ¶æ€æœºè®¾è®¡)
4. [å¸‚åœºç¯å¢ƒåˆ¤å®š](#å¸‚åœºç¯å¢ƒåˆ¤å®š)
5. [äº¤æ˜“å†³ç­–é€»è¾‘](#äº¤æ˜“å†³ç­–é€»è¾‘)
6. [æ•°æ®å¤„ç†æµç¨‹](#æ•°æ®å¤„ç†æµç¨‹)
7. [æŠ€æœ¯å®ç°ç»†èŠ‚](#æŠ€æœ¯å®ç°ç»†èŠ‚)
8. [ç³»ç»Ÿä¿æŠ¤æœºåˆ¶](#ç³»ç»Ÿä¿æŠ¤æœºåˆ¶)

---

## ğŸ¨ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### è®¾è®¡å“²å­¦

```text
è¿™æ˜¯ä¸€ä¸ª"æœ‰è®°å¿†ã€æœ‰è€å¿ƒã€ä¼šæ‹’ç»äº¤æ˜“"çš„çŠ¶æ€æœºï¼Œä¸æ˜¯ä¿¡å·æ‰«æå™¨ã€‚
```

### å››å¤§æ ¸å¿ƒçº¦æŸ

1. **ç³»ç»Ÿæ˜¯çŠ¶æ€æœºï¼Œä¸æ˜¯ä¸€æ¬¡æ€§åˆ¤æ–­å™¨**
   - æ¯æ¬¡åˆ†æéƒ½åŸºäºå†å²çŠ¶æ€
   - çŠ¶æ€è½¬æ¢æœ‰ä¸¥æ ¼è§„åˆ™
   - ä¸å…è®¸è·³è·ƒå¼çŠ¶æ€åˆ‡æ¢

2. **æ‰€æœ‰ä¿¡å·å¿…é¡»ç»è¿‡ System_State**
   - ä¿¡å·è¾“å‡ºç”±ç³»ç»ŸçŠ¶æ€å†³å®š
   - ä¸åŒçŠ¶æ€ä¸‹åŒæ ·æ•°æ®å¯èƒ½è¾“å‡ºä¸åŒä¿¡å·
   - çŠ¶æ€ä¼˜å…ˆçº§é«˜äºæ•°æ®åˆ¤æ–­

3. **æ‰€æœ‰é˜ˆå€¼è§£é‡Šå¿…é¡»æœä» Market_Regime**
   - å¸‚åœºç¯å¢ƒå†³å®šé˜ˆå€¼ä¸¥æ ¼ç¨‹åº¦
   - TRENDã€RANGEã€EXTREME ä¸‰ç§ç¯å¢ƒ
   - é˜ˆå€¼åŠ¨æ€è°ƒæ•´

4. **ä»»ä¸€å¼‚å¸¸ï¼Œé»˜è®¤ NO_TRADE**
   - å®‰å…¨ä¼˜å…ˆåŸåˆ™
   - æ•°æ®å¼‚å¸¸ç«‹å³æš‚åœä¿¡å·
   - ä¿æŠ¤æœºåˆ¶é«˜äºäº¤æ˜“æœºä¼š

### å†³ç­–ä¼˜å…ˆçº§

```text
NO_TRADE > SHORT > LONG
```

**è®¾è®¡åŸåˆ™ï¼š**
- åªåšçŠ¶æ€åˆ¤æ–­ï¼Œä¸åšä»·æ ¼é¢„æµ‹
- è¾“å‡ºä»…é™ï¼šLONG / SHORT / NO_TRADE
- ä¸è¿½æ±‚é«˜é¢‘ï¼Œä¸è¿½æ±‚å…¨è¦†ç›–
- ä¼˜å…ˆé™ä½é”™è¯¯äº¤æ˜“æ¦‚ç‡

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Web å‰ç«¯ (index_multi.html)              â”‚
â”‚  - å®æ—¶è¡Œæƒ…å±•ç¤º                                           â”‚
â”‚  - å¸‚åœºåˆ†æé¢æ¿ï¼ˆ60ç§’è‡ªåŠ¨åˆ·æ–° + å€’è®¡æ—¶ï¼‰                    â”‚
â”‚  - ç»¼åˆKçº¿å›¾ï¼ˆä»·æ ¼/æˆäº¤é‡/æŒä»“é‡ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ AJAX API Calls
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Flask åç«¯ (btc_web_app_multi.py)            â”‚
â”‚  - APIè·¯ç”±ç®¡ç†                                            â”‚
â”‚  - æ•°æ®è·å–ä¸é¢„å¤„ç†                                        â”‚
â”‚  - çŠ¶æ€æœºè°ƒç”¨ä¸ç»“æœå°è£…                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  State Machine    â”‚  â”‚  Binance API     â”‚
â”‚ (çŠ¶æ€æœºæ ¸å¿ƒé€»è¾‘)   â”‚  â”‚  (å¸‚åœºæ•°æ®æº)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SQLite æ•°æ®åº“           â”‚
â”‚  - market_state.db         â”‚
â”‚    (çŠ¶æ€æŒä¹…åŒ–)            â”‚
â”‚  - market_signals.db       â”‚
â”‚    (å†å²ä¿¡å·è®°å½•)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—åˆ’åˆ†

#### **1. å‰ç«¯æ¨¡å— (static/js/app_multi.js)**
- **èŒè´£**ï¼šç”¨æˆ·ç•Œé¢äº¤äº’ã€æ•°æ®å±•ç¤ºã€å®šæ—¶åˆ·æ–°
- **å…³é”®åŠŸèƒ½**ï¼š
  - `loadMarketAnalysis()` - åŠ è½½å¸‚åœºåˆ†æ
  - 60ç§’è‡ªåŠ¨åˆ·æ–° + å€’è®¡æ—¶æ˜¾ç¤º
  - Chart.js å›¾è¡¨æ¸²æŸ“
  - åŠ¨æ€å¸ç§åˆ‡æ¢

#### **2. åç«¯æœåŠ¡ (btc_web_app_multi.py)**
- **èŒè´£**ï¼šAPIæœåŠ¡ã€æ•°æ®è·å–ã€çŠ¶æ€æœºè°ƒç”¨
- **å…³é”®ç±»**ï¼š`BinanceMarketAPI`
- **å…³é”®æ–¹æ³•**ï¼š
  - `get_futures_ticker()` - è·å–åˆçº¦è¡Œæƒ…
  - `get_futures_klines()` - è·å–Kçº¿æ•°æ®
  - `get_futures_funding_rate()` - è·å–èµ„é‡‘è´¹ç‡
  - `get_futures_oi_history()` - è·å–æŒä»“é‡å†å²
  - `analyze_futures_market()` - å¸‚åœºåˆ†æå…¥å£

#### **3. çŠ¶æ€æœºæ¨¡å— (market_state_machine.py)**
- **èŒè´£**ï¼šæ ¸å¿ƒå†³ç­–é€»è¾‘ã€çŠ¶æ€ç®¡ç†
- **å…³é”®ç±»**ï¼š
  - `MarketStateMachine` - çŠ¶æ€æœºæ ¸å¿ƒ
  - `StateStorage` - çŠ¶æ€æŒä¹…åŒ–
  - `StateMachineConfig` - é…ç½®å‚æ•°

#### **4. æ•°æ®åº“æ¨¡å— (database.py)**
- **èŒè´£**ï¼šå†å²ä¿¡å·è®°å½•ã€æŸ¥è¯¢ç»Ÿè®¡
- **å…³é”®ç±»**ï¼š`SignalDB`
- **åŠŸèƒ½**ï¼š
  - ä¿¡å·è‡ªåŠ¨ä¿å­˜
  - å†å²æŸ¥è¯¢
  - ç»Ÿè®¡åˆ†æ

---

## ğŸ”„ çŠ¶æ€æœºè®¾è®¡

### æšä¸¾å®šä¹‰

#### **MarketRegimeï¼ˆå¸‚åœºç¯å¢ƒï¼‰**

```python
class MarketRegime(Enum):
    TREND = "TREND"      # è¶‹åŠ¿å¸‚åœºï¼šä»·æ ¼è¿ç»­ã€æ³¢åŠ¨é€‚ä¸­
    RANGE = "RANGE"      # éœ‡è¡å¸‚åœºï¼šæ³¢åŠ¨å°æˆ–æ— æ˜æ˜¾æ–¹å‘
    EXTREME = "EXTREME"  # æç«¯å¸‚åœºï¼šå‰§çƒˆæ³¢åŠ¨æˆ–å¼‚å¸¸æ”¾é‡
```

#### **SystemStateï¼ˆç³»ç»ŸçŠ¶æ€ï¼‰**

```python
class SystemState(Enum):
    INIT = "INIT"                # åˆå§‹åŒ–ï¼šç³»ç»Ÿå¯åŠ¨çŠ¶æ€
    WAIT = "WAIT"                # ç­‰å¾…ï¼šå¯ä»¥å¼€ä»“çš„çŠ¶æ€
    LONG_ACTIVE = "LONG_ACTIVE"  # åšå¤šæ´»è·ƒï¼šæŒæœ‰åšå¤šä¿¡å·
    SHORT_ACTIVE = "SHORT_ACTIVE"# åšç©ºæ´»è·ƒï¼šæŒæœ‰åšç©ºä¿¡å·
    COOL_DOWN = "COOL_DOWN"      # å†·å´æœŸï¼šå¼ºåˆ¶ä¼‘çœ çŠ¶æ€
```

#### **Decisionï¼ˆäº¤æ˜“å†³ç­–ï¼‰**

```python
class Decision(Enum):
    LONG = "LONG"           # åšå¤šä¿¡å·
    SHORT = "SHORT"         # åšç©ºä¿¡å·
    NO_TRADE = "NO_TRADE"   # ä¸äº¤æ˜“
```

### çŠ¶æ€è½¬æ¢å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   INIT   â”‚ (ç³»ç»Ÿå¯åŠ¨)
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ è‡ªåŠ¨
                         â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”Œâ”€â”€â”€â”€â”€â”€â†’â”‚   WAIT   â”‚â†â”€â”€â”€â”€â”€â”€â”
            â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
            â”‚            â”‚              â”‚
            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
            â”‚    â†“                â†“    â”‚
            â”‚  æ»¡è¶³åšå¤šæ¡ä»¶    æ»¡è¶³åšç©ºæ¡ä»¶ â”‚
            â”‚    â†“                â†“    â”‚
      å¤±æ•ˆ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å¤±æ•ˆ
      â”€â”€â”€â”€â”€â”¼â”€â”¤LONG_ACTIVEâ”‚  â”‚SHORT_ACTIVEâ”œâ”€â”¤
            â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
            â”‚       â”‚            â”‚        â”‚
            â”‚   ç»“æ„æ€§å¤±è´¥   ç»“æ„æ€§å¤±è´¥    â”‚
            â”‚       â”‚            â”‚        â”‚
            â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜        â”‚
            â”‚                â†“            â”‚
            â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤COOL_DOWN â”‚â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                            â”‚ å†·å´å®Œæˆï¼ˆ3ä¸ªå‘¨æœŸï¼‰
                            â””â”€â”€â†’ è¿”å› WAIT

ã€çŠ¶æ€è½¬æ¢é“å¾‹ã€‘
1. LONG_ACTIVE â†” SHORT_ACTIVE ä¸èƒ½ç›´æ¥åˆ‡æ¢
2. å¿…é¡»é€šè¿‡ WAIT çŠ¶æ€è¿‡æ¸¡
3. ä»»ä½•å¼‚å¸¸ â†’ COOL_DOWN
4. COOL_DOWN åªèƒ½ â†’ WAIT
```

### çŠ¶æ€æŒä¹…åŒ–

#### **æ•°æ®åº“è¡¨ç»“æ„**

```sql
CREATE TABLE system_state (
    symbol VARCHAR(10) PRIMARY KEY,
    system_state VARCHAR(20) NOT NULL,
    market_regime VARCHAR(20) NOT NULL,
    cooldown_counter INTEGER DEFAULT 0,
    last_decision VARCHAR(20),
    state_entry_time DATETIME,
    last_update_time DATETIME,
    state_history TEXT,  -- JSONæ ¼å¼ï¼Œå­˜å‚¨å†å²çŠ¶æ€
    extra_data TEXT      -- JSONæ ¼å¼ï¼Œå­˜å‚¨é¢å¤–æ•°æ®
);
```

#### **çŠ¶æ€ä¿å­˜æ—¶æœº**

- æ¯æ¬¡çŠ¶æ€è½¬æ¢
- æ¯æ¬¡å†³ç­–æ›´æ–°
- å†·å´æœŸè®¡æ•°å™¨å˜åŒ–

---

## ğŸŒ å¸‚åœºç¯å¢ƒåˆ¤å®š

### Market Regime æ£€æµ‹é€»è¾‘

```python
def detect_market_regime(data):
    """
    åˆ¤å®šä¼˜å…ˆçº§ï¼šEXTREME > TREND > RANGE
    """
    
    # Step 1: æç«¯å¸‚åœºåˆ¤å®šï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    if data['volatility'] > 8%:
        return EXTREME  # æ³¢åŠ¨ç‡è¿‡å¤§
    
    if data['volume'] > data['volume_avg'] * 5:
        return EXTREME  # æˆäº¤é‡å¼‚å¸¸æ”¾å¤§
    
    # Step 2: è¶‹åŠ¿å¸‚åœºåˆ¤å®š
    if (ä»·æ ¼ç»“æ„è¿ç»­) and (1% <= volatility <= 5%):
        return TREND
    
    # Step 3: é»˜è®¤éœ‡è¡å¸‚åœº
    return RANGE
```

### é…ç½®å‚æ•°

| å‚æ•° | é˜ˆå€¼ | è¯´æ˜ |
|------|------|------|
| `VOLATILITY_EXTREME_THRESHOLD` | 8% | æç«¯æ³¢åŠ¨ç‡é˜ˆå€¼ |
| `VOLUME_EXTREME_MULTIPLIER` | 5.0x | å¼‚å¸¸æ”¾é‡å€æ•° |
| `VOLATILITY_NORMAL_RANGE` | 1%-5% | æ­£å¸¸æ³¢åŠ¨ç‡èŒƒå›´ |

### ç¯å¢ƒå½±å“

#### **EXTREME å¸‚åœº**
- âŒ ç¦æ­¢æ‰€æœ‰å¼€ä»“æ“ä½œ
- âœ… å¼ºåˆ¶è¿›å…¥ COOL_DOWN çŠ¶æ€
- â±ï¸ å†·å´æœŸï¼š3ä¸ªå‘¨æœŸï¼ˆ3åˆ†é’Ÿï¼‰

#### **RANGE å¸‚åœº**
- ğŸ“Š ä½¿ç”¨æ›´ä¸¥æ ¼çš„é˜ˆå€¼
- ğŸ”’ ä¹°å•å¼ºåŠ¿è¦æ±‚ä»60% â†’ 65%
- ğŸ“ˆ æˆäº¤é‡çªç ´è¦æ±‚ä»1.5x â†’ 2.25x

#### **TREND å¸‚åœº**
- âœ… ä½¿ç”¨æ ‡å‡†é˜ˆå€¼
- ğŸ¯ æ›´å®¹æ˜“äº§ç”Ÿäº¤æ˜“ä¿¡å·

---

## ğŸ¯ äº¤æ˜“å†³ç­–é€»è¾‘

### å†³ç­–æµç¨‹

```
æ¯æ¬¡åˆ†æ (on_new_tick)
    â”‚
    â”œâ”€â†’ 1. åŠ è½½å½“å‰çŠ¶æ€ï¼ˆä»æ•°æ®åº“ï¼‰
    â”‚
    â”œâ”€â†’ 2. æ£€æµ‹å¸‚åœºç¯å¢ƒ (Market Regime)
    â”‚       â””â”€â†’ EXTREME? â†’ å¼ºåˆ¶ COOL_DOWN â†’ è¾“å‡º NO_TRADE
    â”‚
    â”œâ”€â†’ 3. æ ¹æ®ç³»ç»ŸçŠ¶æ€åˆ†æ´¾å¤„ç†
    â”‚       â”œâ”€â†’ INIT â†’ è½¬åˆ° WAIT
    â”‚       â”œâ”€â†’ WAIT â†’ æ£€æŸ¥å¼€ä»“æ¡ä»¶
    â”‚       â”œâ”€â†’ LONG_ACTIVE â†’ æ£€æŸ¥å¤±æ•ˆæ¡ä»¶
    â”‚       â”œâ”€â†’ SHORT_ACTIVE â†’ æ£€æŸ¥å¤±æ•ˆæ¡ä»¶
    â”‚       â””â”€â†’ COOL_DOWN â†’ å†·å´è®¡æ•°å™¨-1
    â”‚
    â”œâ”€â†’ 4. æ£€æµ‹ç»“æ„æ€§å¤±è´¥
    â”‚       â””â”€â†’ å¤±è´¥? â†’ è½¬åˆ° COOL_DOWN
    â”‚
    â”œâ”€â†’ 5. åº”ç”¨æ–¹å‘åˆ¤æ–­è§„åˆ™
    â”‚       â”œâ”€â†’ allow_long() - åšå¤šæ¡ä»¶
    â”‚       â””â”€â†’ allow_short() - åšç©ºæ¡ä»¶
    â”‚
    â”œâ”€â†’ 6. ä¿å­˜æ–°çŠ¶æ€åˆ°æ•°æ®åº“
    â”‚
    â””â”€â†’ 7. è¿”å›å†³ç­–ç»“æœ
```

### åšå¤šæ¡ä»¶ï¼ˆallow_longï¼‰

#### **æ ¸å¿ƒé€»è¾‘**
```
æ–°å¤šå¤´æ˜¯å¦åœ¨æ›´é«˜ä»·ä½æŒç»­è¿›åœºï¼Ÿ
```

#### **åˆ¤æ–­è§„åˆ™ï¼ˆ4ä¸ªæ¡ä»¶ï¼‰**

1. **æˆäº¤é‡æ”¾å¤§**
   - æ¡ä»¶ï¼š`volume > volume_avg * 1.5`
   - RANGEå¸‚åœºï¼š`volume > volume_avg * 2.25`

2. **OI å¥åº·å¢é•¿**
   - æ¡ä»¶ï¼š`oi_change_6h > 0 AND oi_delta_rate < 30%`
   - è¯´æ˜ï¼šæŒä»“é‡å¢åŠ ä½†ä¸æç«¯

3. **èµ„é‡‘è´¹ç‡å¥åº·**
   - æ¡ä»¶ï¼š`-0.05% <= funding_rate <= 0.1%`
   - é¿å…ï¼šè´¹ç‡è¿‡é«˜ï¼ˆå¤šå¤´æ‹¥æŒ¤ï¼‰

4. **çŸ­æ—¶ä¹°ç›˜æ¨åŠ¨**
   - æ¡ä»¶ï¼š`aggressive_buy_ratio >= 60%`
   - RANGEå¸‚åœºï¼š`>= 65%`

#### **ç»¼åˆåˆ¤æ–­**
- **TRENDå¸‚åœº**ï¼š4ä¸ªæ¡ä»¶å…¨éƒ¨æ»¡è¶³
- **RANGEå¸‚åœº**ï¼š4ä¸ªæ¡ä»¶å…¨éƒ¨æ»¡è¶³ï¼ˆä½†é˜ˆå€¼æ›´ä¸¥æ ¼ï¼‰
- **EXTREMEå¸‚åœº**ï¼šç›´æ¥è¿”å› False

### åšç©ºæ¡ä»¶ï¼ˆallow_shortï¼‰

#### **æ ¸å¿ƒé€»è¾‘**
```
å¤šå¤´æ˜¯å¦å·²ç»éš¾ä»¥ç»§ç»­å¸å¼•æ–°èµ„é‡‘ï¼Ÿ
```

#### **åˆ¤æ–­è§„åˆ™ï¼ˆ4ä¸ªæ¡ä»¶ï¼‰**

1. **ä¸Šæ¶¨åŠ¨èƒ½è¡°ç«­**
   - æ¡ä»¶ï¼š`price_trend_6h < 0.5% AND volume < volume_avg * 0.7`
   - è¯´æ˜ï¼šä»·æ ¼æ»æ¶¨ + æˆäº¤é‡èç¼©

2. **OI å †ç§¯**
   - æ¡ä»¶ï¼š`oi_change_6h > 0 AND oi_delta_rate < 30%`
   - è¯´æ˜ï¼šå¤šå¤´ä»“ä½å †ç§¯ä½†ä»·æ ¼ä¸æ¶¨

3. **èµ„é‡‘è´¹ç‡è¿‡çƒ­**
   - æ¡ä»¶ï¼š`funding_rate > 0.2%`
   - è¯´æ˜ï¼šåšå¤šæˆæœ¬è¿‡é«˜

4. **çŸ­æ—¶å–ç›˜å¢å¼ºæˆ–ä¹°ç›˜å¼±åŠ¿**
   - æ¡ä»¶ï¼š`aggressive_sell_ratio >= 60% OR aggressive_buy_ratio <= 45%`

#### **ç»¼åˆåˆ¤æ–­**
- **TRENDå¸‚åœº**ï¼š4ä¸ªæ¡ä»¶å…¨éƒ¨æ»¡è¶³
- **RANGEå¸‚åœº**ï¼š4ä¸ªæ¡ä»¶å…¨éƒ¨æ»¡è¶³ï¼ˆä½†é˜ˆå€¼æ›´ä¸¥æ ¼ï¼‰
- **EXTREMEå¸‚åœº**ï¼šç›´æ¥è¿”å› False

### å¤±æ•ˆæ¡ä»¶

#### **åšå¤šå¤±æ•ˆï¼ˆlong_invalidationï¼‰**

è§¦å‘æ¡ä»¶ï¼ˆä»»ä¸€ï¼‰ï¼š
1. ä»·æ ¼è·Œç ´ç»“æ„ï¼š`price_trend_6h < -1%`
2. èµ„é‡‘è´¹ç‡è½¬æç«¯ï¼š`funding_rate > 0.5%`
3. OIå´©æºƒï¼š`oi_change_6h < -20%`
4. ä¹°ç›˜æ¯ç«­ï¼š`aggressive_buy_ratio < 45%`

#### **åšç©ºå¤±æ•ˆï¼ˆshort_invalidationï¼‰**

è§¦å‘æ¡ä»¶ï¼ˆä»»ä¸€ï¼‰ï¼š
1. å–å‹è€—å°½æˆ–ä¹°ç›˜å¢å¼ºï¼š`aggressive_sell_ratio < 45% OR aggressive_buy_ratio > 60%`
2. èµ„é‡‘è´¹ç‡è½¬è´Ÿï¼š`funding_rate < -0.1%`
3. OIå´©æºƒï¼š`oi_change_6h < -20%`
4. ä»·æ ¼å¼ºåŠ²åå¼¹ï¼š`price_trend_6h > 1%`

### ç»“æ„æ€§å¤±è´¥æ£€æµ‹

#### **è§¦å‘æ¡ä»¶ï¼ˆä»»ä¸€ï¼‰**

1. **OIæç«¯æ³¢åŠ¨**
   - æ¡ä»¶ï¼š`abs(oi_delta_rate) > 30%`

2. **èµ„é‡‘è´¹ç‡æç«¯**
   - æ¡ä»¶ï¼š`abs(funding_rate) > 0.5%`

3. **æ ¸å¿ƒæŒ‡æ ‡èƒŒç¦»**
   - ä»·æ ¼æ¶¨ + OI/æˆäº¤é‡è·Œ
   - ä»·æ ¼è·Œ + OI/æˆäº¤é‡æ¶¨

#### **åæœ**
- ç«‹å³è¿›å…¥ COOL_DOWN
- å†·å´æœŸï¼š3ä¸ªå‘¨æœŸ
- è¾“å‡ºï¼šNO_TRADE

---

## ğŸ“Š æ•°æ®å¤„ç†æµç¨‹

### æ•°æ®è·å–

#### **1. å®æ—¶è¡Œæƒ…æ•°æ®**
```python
# Binance API: futures_ticker
{
    'symbol': 'BTCUSDT',
    'lastPrice': 45000.0,
    'priceChange': 500.0,
    'priceChangePercent': 1.12,
    'volume': 1234567.89,
    'quoteVolume': 55566778899.0
}
```

#### **2. Kçº¿æ•°æ®**
```python
# Binance API: futures_klines
# ç”¨é€”ï¼šè®¡ç®—6å°æ—¶ä»·æ ¼è¶‹åŠ¿ã€æˆäº¤é‡å˜åŒ–
[
    timestamp,      # å¼€ç›˜æ—¶é—´
    open,          # å¼€ç›˜ä»·
    high,          # æœ€é«˜ä»·
    low,           # æœ€ä½ä»·
    close,         # æ”¶ç›˜ä»·
    volume,        # æˆäº¤é‡
    close_time,    # æ”¶ç›˜æ—¶é—´
    quote_volume,  # æˆäº¤é¢
    ...
]
```

#### **3. èµ„é‡‘è´¹ç‡**
```python
# Binance API: futures_mark_price
{
    'symbol': 'BTCUSDT',
    'markPrice': 45010.0,
    'lastFundingRate': 0.0001,  # å½“å‰èµ„é‡‘è´¹ç‡
    'nextFundingTime': 1706601600000
}
```

#### **4. æŒä»“é‡å†å²**
```python
# Binance API: futures_open_interest_hist
[
    {
        'symbol': 'BTCUSDT',
        'sumOpenInterest': 123456.78,  # æ€»æŒä»“é‡
        'timestamp': 1706601600000
    },
    ...
]
```

#### **5. æœ€è¿‘æˆäº¤ï¼ˆ1å°æ—¶ï¼‰**
```python
# Binance API: futures_recent_trades
# ç”¨é€”ï¼šè®¡ç®—ä¸»åŠ¨ä¹°å–æ¯”ä¾‹
[
    {
        'id': 123456,
        'price': 45000.0,
        'qty': 1.5,
        'quoteQty': 67500.0,
        'time': 1706601600000,
        'isBuyerMaker': False  # False=ä¸»åŠ¨ä¹°ï¼ŒTrue=ä¸»åŠ¨å–
    },
    ...
]
```

### æ•°æ®é¢„å¤„ç†

#### **è®¡ç®—6å°æ—¶å˜åŒ–ç‡**

```python
def calculate_6h_change(current_value, klines_6h):
    """
    è®¡ç®—é€»è¾‘ï¼š
    1. è·å–æœ€è¿‘6æ ¹1å°æ—¶Kçº¿
    2. å‰3æ ¹æ±‚å’Œä½œä¸ºåŸºå‡†
    3. å3æ ¹æ±‚å’Œä½œä¸ºå½“å‰
    4. è®¡ç®—å˜åŒ–ç‡
    """
    baseline = sum(klines_6h[0:3])
    current = sum(klines_6h[3:6])
    change_rate = (current - baseline) / baseline
    return change_rate
```

#### **ä¸»åŠ¨ä¹°å–åˆ†æ**

```python
def analyze_aggressive_trades(trades_1h):
    """
    ä¸»åŠ¨ä¹°å•ï¼šisBuyerMaker = False
    ä¸»åŠ¨å–å•ï¼šisBuyerMaker = True
    """
    buy_amount = sum(t['quoteQty'] for t in trades_1h 
                     if not t['isBuyerMaker'])
    sell_amount = sum(t['quoteQty'] for t in trades_1h 
                      if t['isBuyerMaker'])
    
    total = buy_amount + sell_amount
    buy_ratio = buy_amount / total * 100
    sell_ratio = sell_amount / total * 100
    
    return {
        'buy_ratio': buy_ratio,
        'sell_ratio': sell_ratio,
        'total_amount': total
    }
```

### æ•°æ®æ±‡æ€»

#### **è¾“å…¥åˆ°çŠ¶æ€æœºçš„æ•°æ®å­—å…¸**

```python
input_data = {
    # ä»·æ ¼æ•°æ®
    'price': 45000.0,
    'price_change_24h': 1.12,          # 24å°æ—¶æ¶¨è·Œå¹… (%)
    'price_trend_6h': 0.5,             # 6å°æ—¶ä»·æ ¼è¶‹åŠ¿ (%)
    
    # æˆäº¤é‡æ•°æ®
    'volume': 1234567.89,
    'volume_avg': 1000000.0,           # 24å°æ—¶å¹³å‡1å°æ—¶æˆäº¤é‡
    'volume_change_6h': 15.5,          # 6å°æ—¶æˆäº¤é‡å˜åŒ– (%)
    
    # æŒä»“é‡æ•°æ®
    'oi': 123456.78,
    'oi_delta': 5000.0,                # OI å˜åŒ–é‡
    'oi_delta_rate': 4.05,             # OI å˜åŒ–ç‡ (%)
    'oi_change_6h': 4.05,              # 6å°æ—¶OIå˜åŒ– (%)
    
    # èµ„é‡‘è´¹ç‡
    'funding_rate': 0.0001,            # å½“å‰èµ„é‡‘è´¹ç‡
    
    # ä¸»åŠ¨ä¹°å–ï¼ˆ1å°æ—¶ï¼‰
    'aggressive_buy_ratio': 62.5,      # ä¸»åŠ¨ä¹°å•å æ¯” (%)
    'aggressive_sell_ratio': 37.5,     # ä¸»åŠ¨å–å•å æ¯” (%)
    'total_amount_1h': 67500000.0,     # 1å°æ—¶æ€»æˆäº¤é¢ (USDT)
    
    # å¸‚åœºç¯å¢ƒæŒ‡æ ‡
    'volatility': 3.5,                 # 24å°æ—¶æ³¢åŠ¨ç‡ (%)
    'price_structure_continuous': True  # ä»·æ ¼ç»“æ„è¿ç»­æ€§
}
```

---

## ğŸ’» æŠ€æœ¯å®ç°ç»†èŠ‚

### åç«¯å®ç°

#### **Flask API ç«¯ç‚¹**

```python
# 1. å¸‚åœºä¿¡æ¯
@app.route('/api/markets')
def api_markets():
    """è¿”å›æ”¯æŒçš„å¸‚åœºåˆ—è¡¨"""
    pass

# 2. è¡Œæƒ…æ•°æ®
@app.route('/api/ticker/<market_type>/<symbol>')
def api_ticker(market_type, symbol):
    """è¿”å›å®æ—¶è¡Œæƒ…"""
    pass

# 3. Kçº¿æ•°æ®
@app.route('/api/klines/<market_type>/<symbol>')
def api_klines(market_type, symbol):
    """è¿”å›Kçº¿æ•°æ®ï¼ˆå«æˆäº¤é‡/æŒä»“é‡/æˆäº¤é¢ï¼‰"""
    pass

# 4. å¸‚åœºåˆ†æï¼ˆæ ¸å¿ƒï¼‰
@app.route('/api/market-analysis/<market_type>/<symbol>')
def api_market_analysis(market_type, symbol):
    """
    è¿”å›å¸‚åœºåˆ†æç»“æœ
    - è°ƒç”¨çŠ¶æ€æœº
    - è‡ªåŠ¨ä¿å­˜ä¿¡å·åˆ°æ•°æ®åº“
    """
    pass

# 5. å†å²ä¿¡å·
@app.route('/api/signal-history')
def api_signal_history():
    """æŸ¥è¯¢å†å²ä¿¡å·è®°å½•"""
    pass

# 6. ä¿¡å·ç»Ÿè®¡
@app.route('/api/signal-stats')
def api_signal_stats():
    """è·å–ä¿¡å·ç»Ÿè®¡æ•°æ®"""
    pass
```

#### **çŠ¶æ€æœºè°ƒç”¨**

```python
def analyze_futures_market(self, symbol):
    """
    å¸‚åœºåˆ†æå…¥å£å‡½æ•°
    
    æµç¨‹ï¼š
    1. è·å–æ‰€æœ‰å¸‚åœºæ•°æ®
    2. æ•°æ®é¢„å¤„ç†å’Œè®¡ç®—
    3. æ„å»ºinput_dataå­—å…¸
    4. è°ƒç”¨çŠ¶æ€æœºï¼šstate_machine.on_new_tick(symbol, input_data)
    5. å°è£…è¿”å›ç»“æœ
    6. è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    """
    
    # è·å–æ•°æ®
    ticker = self.get_futures_ticker(symbol)
    klines = self.get_futures_klines(symbol, interval='1h', limit=24)
    funding = self.get_futures_funding_rate(symbol)
    oi_history = self.get_futures_oi_history(symbol)
    trades = self.get_futures_trades(symbol, limit=1000)
    
    # è®¡ç®—æŒ‡æ ‡
    price_trend_6h = calculate_6h_trend(klines)
    volume_change_6h = calculate_6h_change(klines, 'volume')
    oi_change_6h = calculate_6h_change(oi_history)
    buy_sell_analysis = analyze_aggressive_trades(trades)
    
    # æ„å»ºè¾“å…¥æ•°æ®
    input_data = {
        'price': ticker['lastPrice'],
        'price_change_24h': ticker['priceChangePercent'],
        'price_trend_6h': price_trend_6h,
        'volume': ticker['volume'],
        'volume_avg': calculate_avg_volume(klines),
        'volume_change_6h': volume_change_6h,
        'oi_change_6h': oi_change_6h,
        'funding_rate': funding['lastFundingRate'],
        'aggressive_buy_ratio': buy_sell_analysis['buy_ratio'],
        'aggressive_sell_ratio': buy_sell_analysis['sell_ratio'],
        'total_amount_1h': buy_sell_analysis['total_amount'],
        'volatility': calculate_volatility(klines),
        'price_structure_continuous': check_price_structure(klines)
    }
    
    # è°ƒç”¨çŠ¶æ€æœº
    result = state_machine.on_new_tick(symbol, input_data)
    
    # ä¿å­˜ä¿¡å·
    if DB_ENABLED:
        signal_db.save_signal(symbol, result)
    
    return result
```

### å‰ç«¯å®ç°

#### **å¸‚åœºåˆ†æåŠ è½½**

```javascript
async function loadMarketAnalysis() {
    try {
        // é‡ç½®å€’è®¡æ—¶
        analysisCountdown = 60;
        
        // è°ƒç”¨API
        const response = await fetch(
            `/api/market-analysis/${currentMarketType}/${currentSymbol}`
        );
        const result = await response.json();
        
        if (result.success) {
            const analysis = result.analysis;
            
            // æ›´æ–°äº¤æ˜“å†³ç­–å¡ç‰‡
            updateTradeActionCard(analysis.trade_action);
            
            // æ›´æ–°ç³»ç»ŸçŠ¶æ€å’Œå¸‚åœºç¯å¢ƒ
            updateSystemInfo(
                analysis.system_state,
                analysis.market_regime
            );
            
            // æ›´æ–°è¯¦ç»†åˆ†æï¼ˆå¤šè¡Œæ˜¾ç¤ºï¼‰
            updateDetailedAnalysis(analysis.detailed_analysis);
            
            // æ›´æ–°æ•°æ®æ‘˜è¦
            updateDataSummary(analysis.data_summary);
        }
    } catch (error) {
        console.error('åŠ è½½å¸‚åœºåˆ†æå¤±è´¥:', error);
    }
}
```

#### **è‡ªåŠ¨åˆ·æ–°æœºåˆ¶**

```javascript
// å…¨å±€å€’è®¡æ—¶å˜é‡
let analysisCountdown = 60;

// å€’è®¡æ—¶æ˜¾ç¤º
setInterval(() => {
    analysisCountdown--;
    
    const countdownElement = document.getElementById('analysisCountdown');
    countdownElement.textContent = `è‡ªåŠ¨åˆ·æ–°ï¼š${analysisCountdown}ç§’`;
    
    // å€’è®¡æ—¶<=10ç§’æ—¶å˜çº¢è‰²
    if (analysisCountdown <= 10) {
        countdownElement.style.color = '#ff4444';
    } else {
        countdownElement.style.color = '#888';
    }
    
    // å€’è®¡æ—¶å½’é›¶æ—¶é‡ç½®
    if (analysisCountdown <= 0) {
        analysisCountdown = 60;
    }
}, 1000);

// 60ç§’è‡ªåŠ¨åˆ·æ–°
setInterval(() => {
    loadMarketAnalysis();
}, 60000);
```

#### **ç»¼åˆKçº¿å›¾**

```javascript
function renderCombinedChart(klines) {
    const ctx = document.getElementById('combinedChart').getContext('2d');
    
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: klines.map(k => k.time),
            datasets: [
                {
                    label: 'ä»·æ ¼',
                    data: klines.map(k => k.close),
                    yAxisID: 'y-price',
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    fill: true
                },
                {
                    label: 'æˆäº¤é‡',
                    data: klines.map(k => k.volume),
                    yAxisID: 'y-volume',
                    type: 'bar',
                    backgroundColor: 'rgba(118, 215, 196, 0.5)'
                },
                {
                    label: 'æŒä»“é‡',
                    data: klines.map(k => k.openInterest),
                    yAxisID: 'y-oi',
                    borderColor: '#f39c12',
                    borderDash: [5, 5]
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                'y-price': { position: 'left' },
                'y-volume': { position: 'right' },
                'y-oi': { position: 'right' }
            }
        }
    });
}
```

### æ•°æ®åº“å®ç°

#### **çŠ¶æ€æŒä¹…åŒ–ï¼ˆStateStorageï¼‰**

```python
class StateStorage:
    def __init__(self, db_path='market_state.db'):
        self.db_path = db_path
        self._init_database()
    
    def save_state(self, symbol, system_state, market_regime, 
                   cooldown_counter, last_decision, extra_data=None):
        """ä¿å­˜çŠ¶æ€"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # è¿½åŠ åˆ°å†å²è®°å½•
        state_history = self.get_state_history(symbol)
        state_history.append({
            'timestamp': datetime.now().isoformat(),
            'system_state': system_state,
            'market_regime': market_regime,
            'decision': last_decision
        })
        
        # åªä¿ç•™æœ€è¿‘100æ¡
        state_history = state_history[-100:]
        
        cursor.execute("""
            INSERT OR REPLACE INTO system_state 
            (symbol, system_state, market_regime, cooldown_counter, 
             last_decision, state_entry_time, last_update_time, 
             state_history, extra_data)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
        """, (symbol, system_state, market_regime, cooldown_counter,
              last_decision, state_entry_time, datetime.now(),
              json.dumps(state_history), json.dumps(extra_data)))
        
        conn.commit()
        conn.close()
    
    def get_state(self, symbol):
        """è¯»å–çŠ¶æ€"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute("""
            SELECT * FROM system_state WHERE symbol = ?
        """, (symbol,))
        
        row = cursor.fetchone()
        conn.close()
        
        if row:
            return {
                'symbol': row[0],
                'system_state': row[1],
                'market_regime': row[2],
                'cooldown_counter': row[3],
                'last_decision': row[4],
                'state_entry_time': row[5],
                'last_update_time': row[6],
                'state_history': json.loads(row[7]),
                'extra_data': json.loads(row[8])
            }
        return None
```

#### **å†å²ä¿¡å·è®°å½•ï¼ˆSignalDBï¼‰**

```python
class SignalDB:
    def __init__(self, db_path='market_signals.db'):
        self.db_path = db_path
        self._init_database()
    
    def save_signal(self, symbol, analysis_data):
        """ä¿å­˜åˆ†æä¿¡å·"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        analysis = analysis_data['analysis']
        data_summary = analysis['data_summary']
        
        cursor.execute("""
            INSERT INTO market_signals 
            (timestamp, symbol, trade_action, state_reason,
             system_state, market_regime, price, price_change_24h,
             price_trend_6h, volume_change_6h, oi_change_6h,
             funding_rate, buy_ratio_1h, sell_ratio_1h, total_amount_1h)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        """, (
            datetime.now().isoformat(),
            symbol,
            analysis['trade_action'],
            analysis['state_reason'],
            analysis.get('system_state'),
            analysis.get('market_regime'),
            data_summary.get('price'),
            data_summary.get('price_change_24h'),
            data_summary.get('price_trend_6h'),
            data_summary.get('volume_change_6h'),
            data_summary.get('oi_change_6h'),
            data_summary.get('funding_rate'),
            data_summary.get('buy_ratio_1h'),
            data_summary.get('sell_ratio_1h'),
            data_summary.get('total_amount_1h')
        ))
        
        conn.commit()
        conn.close()
    
    def get_latest_signals(self, symbol=None, limit=10):
        """æŸ¥è¯¢æœ€è¿‘ä¿¡å·"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        if symbol:
            cursor.execute("""
                SELECT * FROM market_signals 
                WHERE symbol = ? 
                ORDER BY timestamp DESC 
                LIMIT ?
            """, (symbol, limit))
        else:
            cursor.execute("""
                SELECT * FROM market_signals 
                ORDER BY timestamp DESC 
                LIMIT ?
            """, (limit,))
        
        rows = cursor.fetchall()
        conn.close()
        
        return [dict(zip([col[0] for col in cursor.description], row)) 
                for row in rows]
    
    def get_signal_stats(self, symbol=None, days=7):
        """ç»Ÿè®¡ä¿¡å·åˆ†å¸ƒ"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        start_date = (datetime.now() - timedelta(days=days)).isoformat()
        
        query = """
            SELECT 
                trade_action,
                COUNT(*) as count,
                AVG(price_change_24h) as avg_price_change
            FROM market_signals 
            WHERE timestamp >= ?
        """
        params = [start_date]
        
        if symbol:
            query += " AND symbol = ?"
            params.append(symbol)
        
        query += " GROUP BY trade_action"
        
        cursor.execute(query, params)
        rows = cursor.fetchall()
        conn.close()
        
        stats = {
            'total': 0,
            'LONG': 0, 'SHORT': 0, 'NO_TRADE': 0,
            'long_pct': 0.0, 'short_pct': 0.0, 'no_trade_pct': 0.0
        }
        
        for row in rows:
            stats['total'] += row[1]
            stats[row[0]] = row[1]
        
        if stats['total'] > 0:
            stats['long_pct'] = stats['LONG'] / stats['total'] * 100
            stats['short_pct'] = stats['SHORT'] / stats['total'] * 100
            stats['no_trade_pct'] = stats['NO_TRADE'] / stats['total'] * 100
        
        return stats
```

---

## ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤æœºåˆ¶

### 1. æ•°æ®å¼‚å¸¸ä¿æŠ¤

```python
def check_data_anomaly(data):
    """
    æ£€æŸ¥é¡¹ï¼š
    1. æ•°æ®ç¼ºå¤±
    2. æ•°æ®è·³å˜
    3. å¼‚å¸¸å€¼
    """
    
    anomalies = []
    
    # ä»·æ ¼å¼‚å¸¸
    if data['price'] <= 0:
        anomalies.append('ä»·æ ¼æ•°æ®å¼‚å¸¸')
    
    # æŒä»“é‡å¼‚å¸¸
    if data['oi'] <= 0:
        anomalies.append('æŒä»“é‡æ•°æ®å¼‚å¸¸')
    
    # æˆäº¤é‡å¼‚å¸¸
    if data['volume'] <= 0:
        anomalies.append('æˆäº¤é‡æ•°æ®å¼‚å¸¸')
    
    # å¦‚æœæœ‰å¼‚å¸¸ï¼Œç«‹å³è¿”å› NO_TRADE
    if anomalies:
        return {
            'trade_action': 'NO_TRADE',
            'state_reason': 'æ•°æ®å¼‚å¸¸ä¿æŠ¤',
            'risk_warning': anomalies
        }
```

### 2. æç«¯å¸‚åœºä¿æŠ¤

```python
if market_regime == MarketRegime.EXTREME:
    # å¼ºåˆ¶è¿›å…¥å†·å´æœŸ
    system_state = SystemState.COOL_DOWN
    cooldown_counter = 3
    
    return {
        'trade_action': 'NO_TRADE',
        'state_reason': 'å¸‚åœºç¯å¢ƒæç«¯ï¼Œå¼ºåˆ¶è¿›å…¥å†·å´æœŸ'
    }
```

### 3. ç»“æ„æ€§å¤±è´¥ä¿æŠ¤

```python
if detect_structural_failure(data):
    # ä»»ä½•çŠ¶æ€éƒ½è½¬åˆ°å†·å´æœŸ
    system_state = SystemState.COOL_DOWN
    cooldown_counter = 3
    
    return {
        'trade_action': 'NO_TRADE',
        'state_reason': 'æ£€æµ‹åˆ°ç»“æ„æ€§å¤±è´¥ï¼Œè¿›å…¥å†·å´æœŸ'
    }
```

### 4. å†·å´æœŸæœºåˆ¶

```python
if system_state == SystemState.COOL_DOWN:
    cooldown_counter -= 1
    
    if cooldown_counter > 0:
        # ç»§ç»­å†·å´
        return {
            'trade_action': 'NO_TRADE',
            'state_reason': f'å†·å´æœŸä¸­ï¼Œå‰©ä½™{cooldown_counter}ä¸ªå‘¨æœŸ'
        }
    else:
        # å†·å´å®Œæˆï¼Œè¿”å›ç­‰å¾…çŠ¶æ€
        system_state = SystemState.WAIT
        return {
            'trade_action': 'NO_TRADE',
            'state_reason': 'å†·å´æœŸç»“æŸï¼Œè¿”å›ç­‰å¾…çŠ¶æ€'
        }
```

### 5. çŠ¶æ€è½¬æ¢çº¦æŸ

```python
# é“å¾‹1ï¼šLONG_ACTIVE ä¸èƒ½ç›´æ¥è½¬åˆ° SHORT_ACTIVE
if current_state == SystemState.LONG_ACTIVE:
    # åªèƒ½è½¬åˆ° WAIT æˆ– COOL_DOWN
    if allow_short(data, market_regime):
        # å³ä½¿æ»¡è¶³åšç©ºæ¡ä»¶ï¼Œä¹Ÿå¿…é¡»å…ˆè½¬åˆ° WAIT
        system_state = SystemState.WAIT
        return {'trade_action': 'NO_TRADE'}

# é“å¾‹2ï¼šSHORT_ACTIVE ä¸èƒ½ç›´æ¥è½¬åˆ° LONG_ACTIVE
if current_state == SystemState.SHORT_ACTIVE:
    # åªèƒ½è½¬åˆ° WAIT æˆ– COOL_DOWN
    if allow_long(data, market_regime):
        # å³ä½¿æ»¡è¶³åšå¤šæ¡ä»¶ï¼Œä¹Ÿå¿…é¡»å…ˆè½¬åˆ° WAIT
        system_state = SystemState.WAIT
        return {'trade_action': 'NO_TRADE'}
```

### 6. ä¼˜å…ˆçº§ä¿æŠ¤

```text
å†³ç­–ä¼˜å…ˆçº§ï¼šNO_TRADE > SHORT > LONG

å«ä¹‰ï¼š
1. ä»»ä½•å¼‚å¸¸æƒ…å†µï¼Œä¼˜å…ˆè¾“å‡º NO_TRADE
2. åšç©ºæ¡ä»¶æ£€æŸ¥ä¼˜å…ˆäºåšå¤š
3. ä¿å®ˆåŸåˆ™ï¼šå®å¯é”™è¿‡ï¼Œä¸å¯åšé”™
```

---

## ğŸ“ˆ ç³»ç»Ÿè¾“å‡ºæ ¼å¼

### APIå“åº”ç»“æ„

```json
{
  "success": true,
  "symbol": "TA",
  "analysis": {
    "trade_action": "NO_TRADE",
    "system_state": "COOL_DOWN",
    "market_regime": "EXTREME",
    "state_reason": "å¸‚åœºç¯å¢ƒæç«¯ï¼ˆEXTREMEï¼‰ï¼Œå¼ºåˆ¶è¿›å…¥å†·å´æœŸ",
    "data_summary": {
      "price": 0.03734,
      "price_change_24h": 0.00647,
      "price_trend_6h": -0.0026709401709402473,
      "volume_change_6h": -0.1724766647774633,
      "oi_change_6h": -0.01053720061597865,
      "funding_rate": 5e-05,
      "buy_ratio_1h": 33.60598523196442,
      "sell_ratio_1h": 66.39401476803558,
      "total_amount_1h": 10937.51293
    },
    "detailed_analysis": [
      "============================================================",
      "ğŸ¤– ç³»ç»ŸçŠ¶æ€ï¼šCOOL_DOWN",
      "ğŸŒ å¸‚åœºç¯å¢ƒï¼šEXTREME",
      "ğŸ“Š äº¤æ˜“å†³ç­–ï¼šNO_TRADE",
      "ğŸ’¡ å†³ç­–åŸå› ï¼šå¸‚åœºç¯å¢ƒæç«¯ï¼ˆEXTREMEï¼‰ï¼Œå¼ºåˆ¶è¿›å…¥å†·å´æœŸ",
      "============================================================",
      "",
      "ğŸ“ ã€å¸‚åœºç¯å¢ƒåˆ¤å®šã€‘",
      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
      "âš ï¸ å¸‚åœºç¯å¢ƒï¼šEXTREMEï¼ˆæç«¯å¸‚åœºï¼‰",
      "  â€¢ æ³¢åŠ¨ç‡ï¼š8.5% > 8.0%ï¼ˆæç«¯æ³¢åŠ¨ï¼‰",
      "  â‡’ ç³»ç»Ÿå¼ºåˆ¶ä¿æŠ¤ï¼Œç¦æ­¢å¼€ä»“",
      "",
      "ğŸ“Š ã€æ ¸å¿ƒæŒ‡æ ‡æ£€æŸ¥ã€‘",
      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
      "ğŸ’¹ ä»·æ ¼è¶‹åŠ¿ï¼š",
      "  â€¢ 6hè¶‹åŠ¿ï¼š-0.27%",
      "  â€¢ 24hæ¶¨è·Œï¼š+0.65%",
      "ğŸ“Š æˆäº¤é‡åˆ†æï¼š",
      "  â€¢ 6hå˜åŒ–ï¼š-17.25%",
      "  â€¢ å½“å‰/å¹³å‡ï¼š0.85x",
      "  âœ— é‡èƒ½ä¸è¶³ï¼ˆ< 1.5xï¼‰",
      "ğŸ“ˆ æŒä»“é‡ï¼ˆOIï¼‰åˆ†æï¼š",
      "  â€¢ 6hå˜åŒ–ï¼š-1.05%",
      "  â€¢ å˜åŒ–é€Ÿç‡ï¼š0.18%",
      "  âœ— OI ä¸‹é™",
      "ğŸ’° èµ„é‡‘è´¹ç‡åˆ†æï¼š",
      "  â€¢ å½“å‰è´¹ç‡ï¼š+0.0050%",
      "  âœ“ è´¹ç‡å¥åº·ï¼ˆ-0.05% ~ 0.10%ï¼‰",
      "ğŸ”„ ä¹°å–åŠ›é‡åˆ†æï¼ˆ1hï¼‰ï¼š",
      "  â€¢ ä¸»åŠ¨ä¹°å•ï¼š33.6%",
      "  â€¢ ä¸»åŠ¨å–å•ï¼š66.4%",
      "  âœ“ å–å•ä¸»å¯¼ (60.0% / 60.0%)",
      "",
      "âš™ï¸ ã€çŠ¶æ€æœºå†³ç­–è¿‡ç¨‹ã€‘",
      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
      "â„ï¸ ã€å†·å´çŠ¶æ€ - å¼ºåˆ¶ä¼‘çœ ã€‘",
      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
      "â° å‰©ä½™å†·å´å‘¨æœŸï¼š2",
      "ğŸš« å†·å´æœŸé—´ç¦æ­¢æ‰€æœ‰äº¤æ˜“æ“ä½œ",
      "",
      "  â‡’ ç»§ç»­å†·å´ï¼Œè¿˜éœ€ç­‰å¾… 2 ä¸ªå‘¨æœŸ",
      "",
      "============================================================",
      "ğŸ“‹ ã€æ•°æ®æ‘˜è¦ã€‘",
      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
      "ğŸ’¹ ä»·æ ¼ï¼š$0.0373",
      "ğŸ“Š 24hæ¶¨è·Œï¼š+0.65%",
      "ğŸ“ˆ 6hè¶‹åŠ¿ï¼š-0.27%",
      "ğŸ“Š æˆäº¤é‡6hï¼š-17.25%",
      "ğŸ“ˆ æŒä»“é‡6hï¼š-1.05%",
      "ğŸ’° èµ„é‡‘è´¹ç‡ï¼š+0.0050%",
      "ğŸ”„ 1hä¹°å–ï¼šä¹°33.6% vs å–66.4%",
      "ğŸ’µ 1hæˆäº¤é¢ï¼š$0.01M",
      "============================================================"
    ],
    "risk_warning": []
  }
}
```

### å‰ç«¯æ˜¾ç¤ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ å¸‚åœºåˆ†æ [ğŸ”„ æ›´æ–°åˆ†æ] è‡ªåŠ¨åˆ·æ–°ï¼š45ç§’    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ¤– ç³»ç»ŸçŠ¶æ€ï¼šCOOL_DOWN                      â”‚
â”‚  ğŸŒ å¸‚åœºç¯å¢ƒï¼šEXTREME                        â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     äº¤æ˜“å†³ç­–ï¼šNO_TRADE               â”‚  â”‚
â”‚  â”‚     å†³ç­–åŸå› ï¼šå¸‚åœºç¯å¢ƒæç«¯ï¼Œå¼ºåˆ¶å†·å´   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  ğŸ“ ã€å¸‚åœºç¯å¢ƒåˆ¤å®šã€‘                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âš ï¸ å¸‚åœºç¯å¢ƒï¼šEXTREMEï¼ˆæç«¯å¸‚åœºï¼‰            â”‚
â”‚    â€¢ æ³¢åŠ¨ç‡ï¼š8.5% > 8.0%ï¼ˆæç«¯æ³¢åŠ¨ï¼‰         â”‚
â”‚    â‡’ ç³»ç»Ÿå¼ºåˆ¶ä¿æŠ¤ï¼Œç¦æ­¢å¼€ä»“                 â”‚
â”‚                                             â”‚
â”‚  ğŸ“Š ã€æ ¸å¿ƒæŒ‡æ ‡æ£€æŸ¥ã€‘                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ’¹ ä»·æ ¼è¶‹åŠ¿ï¼š                               â”‚
â”‚    â€¢ 6hè¶‹åŠ¿ï¼š-0.27%                         â”‚
â”‚    â€¢ 24hæ¶¨è·Œï¼š+0.65%                        â”‚
â”‚  ğŸ“Š æˆäº¤é‡åˆ†æï¼š                             â”‚
â”‚    â€¢ 6hå˜åŒ–ï¼š-17.25%                        â”‚
â”‚    â€¢ å½“å‰/å¹³å‡ï¼š0.85x                       â”‚
â”‚    âœ— é‡èƒ½ä¸è¶³ï¼ˆ< 1.5xï¼‰                     â”‚
â”‚  ...                                        â”‚
â”‚                                             â”‚
â”‚  âš™ï¸ ã€çŠ¶æ€æœºå†³ç­–è¿‡ç¨‹ã€‘                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â„ï¸ ã€å†·å´çŠ¶æ€ - å¼ºåˆ¶ä¼‘çœ ã€‘                  â”‚
â”‚  â° å‰©ä½™å†·å´å‘¨æœŸï¼š2                          â”‚
â”‚  ğŸš« å†·å´æœŸé—´ç¦æ­¢æ‰€æœ‰äº¤æ˜“æ“ä½œ                 â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ é…ç½®å‚æ•°æ€»è§ˆ

### MarketRegime å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `VOLATILITY_EXTREME_THRESHOLD` | 8% | æç«¯æ³¢åŠ¨ç‡é˜ˆå€¼ |
| `VOLUME_EXTREME_MULTIPLIER` | 5.0x | å¼‚å¸¸æ”¾é‡å€æ•° |
| `VOLATILITY_NORMAL_RANGE` | 1%-5% | æ­£å¸¸æ³¢åŠ¨ç‡èŒƒå›´ |

### OI å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `OI_EXTREME_RATE` | 30% | OIæç«¯å˜åŒ–ç‡ |
| `OI_COLLAPSE_RATE` | -20% | OIå´©æºƒé˜ˆå€¼ |

### èµ„é‡‘è´¹ç‡å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `FUNDING_RATE_HEALTHY_RANGE` | -0.05% ~ 0.1% | å¥åº·èŒƒå›´ |
| `FUNDING_RATE_OVERHEATED` | 0.2% | è¿‡çƒ­é˜ˆå€¼ |
| `FUNDING_RATE_EXTREME` | 0.5% | æç«¯é˜ˆå€¼ |
| `FUNDING_RATE_NEGATIVE` | -0.1% | è´Ÿèµ„é‡‘è´¹ç‡é˜ˆå€¼ |

### ä¹°å–åŠ›é‡å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `AGGRESSIVE_BUY_STRONG` | 60% | ä¹°å•å¼ºåŠ¿é˜ˆå€¼ |
| `AGGRESSIVE_BUY_WEAK` | 45% | ä¹°å•å¼±åŠ¿é˜ˆå€¼ |
| `AGGRESSIVE_SELL_STRONG` | 60% | å–å•å¼ºåŠ¿é˜ˆå€¼ |

### æˆäº¤é‡å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `VOLUME_BREAKOUT_MULTIPLIER` | 1.5x | çªç ´æ”¾é‡å€æ•° |
| `VOLUME_STALL_MULTIPLIER` | 0.7x | æ»æ¶¨ç¼©é‡å€æ•° |

### ç³»ç»Ÿå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `COOLDOWN_LENGTH` | 3å‘¨æœŸ | å†·å´æœŸé•¿åº¦ |
| `RANGE_STRICTER_MULTIPLIER` | 1.5x | RANGEå¸‚åœºé˜ˆå€¼å€æ•° |

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ•°æ®åˆ·æ–°é¢‘ç‡

| æ•°æ®ç±»å‹ | åˆ·æ–°é¢‘ç‡ | æ¥æº |
|---------|---------|------|
| **å®æ—¶è¡Œæƒ…** | 10ç§’ | Binance API |
| **Kçº¿æ•°æ®** | 30ç§’ | Binance API |
| **å¸‚åœºåˆ†æ** | 60ç§’ | çŠ¶æ€æœºè®¡ç®— |
| **ç»¼åˆæ¦‚è§ˆ** | 10ç§’ | Binance API |

### APIå“åº”æ—¶é—´

| ç«¯ç‚¹ | å¹³å‡å“åº”æ—¶é—´ | è¯´æ˜ |
|------|-------------|------|
| `/api/ticker` | ~200ms | å®æ—¶è¡Œæƒ… |
| `/api/klines` | ~500ms | Kçº¿æ•°æ® |
| `/api/market-analysis` | ~2000ms | å¸‚åœºåˆ†æï¼ˆå«è®¡ç®—ï¼‰ |
| `/api/signal-history` | ~100ms | æ•°æ®åº“æŸ¥è¯¢ |

### æ•°æ®åº“æ€§èƒ½

| æ“ä½œ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| **çŠ¶æ€ä¿å­˜** | <10ms | INSERT/UPDATE |
| **çŠ¶æ€è¯»å–** | <5ms | SELECT |
| **ä¿¡å·ä¿å­˜** | <10ms | INSERT |
| **å†å²æŸ¥è¯¢** | <50ms | SELECT with LIMIT |
| **ç»Ÿè®¡æŸ¥è¯¢** | <100ms | GROUP BY èšåˆ |

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“

### 1. çŠ¶æ€æœºæ¶æ„
- âœ… æœ‰è®°å¿†ï¼šåŸºäºå†å²çŠ¶æ€å†³ç­–
- âœ… æœ‰è€å¿ƒï¼šä¸è¿½æ±‚é«˜é¢‘ï¼Œç­‰å¾…ç¡®è®¤
- âœ… ä¼šæ‹’ç»ï¼šå¤šæ•°æ—¶å€™è¾“å‡º NO_TRADE

### 2. å¤šå±‚ä¿æŠ¤æœºåˆ¶
- âœ… æ•°æ®å¼‚å¸¸ä¿æŠ¤
- âœ… æç«¯å¸‚åœºä¿æŠ¤
- âœ… ç»“æ„æ€§å¤±è´¥ä¿æŠ¤
- âœ… å†·å´æœŸå¼ºåˆ¶ä¼‘çœ 

### 3. ç¯å¢ƒè‡ªé€‚åº”
- âœ… æ ¹æ®å¸‚åœºç¯å¢ƒåŠ¨æ€è°ƒæ•´é˜ˆå€¼
- âœ… EXTREME å¸‚åœºç¦æ­¢å¼€ä»“
- âœ… RANGE å¸‚åœºæ›´ä¸¥æ ¼è¦æ±‚

### 4. å®Œæ•´æ•°æ®é“¾
- âœ… å¤šç»´åº¦æ•°æ®é‡‡é›†ï¼ˆä»·æ ¼/æˆäº¤é‡/OI/èµ„é‡‘è´¹ç‡ï¼‰
- âœ… 6å°æ—¶å˜åŒ–ç‡è®¡ç®—
- âœ… 1å°æ—¶ä¸»åŠ¨ä¹°å–åˆ†æ
- âœ… æ•°æ®é¢„å¤„ç†å’Œå¼‚å¸¸æ£€æµ‹

### 5. çŠ¶æ€æŒä¹…åŒ–
- âœ… SQLite æ•°æ®åº“å­˜å‚¨
- âœ… çŠ¶æ€å†å²è®°å½•ï¼ˆæœ€è¿‘100æ¡ï¼‰
- âœ… ä¿¡å·è‡ªåŠ¨ä¿å­˜
- âœ… ç»Ÿè®¡åˆ†æåŠŸèƒ½

### 6. ç”¨æˆ·å‹å¥½
- âœ… 60ç§’è‡ªåŠ¨åˆ·æ–°
- âœ… å€’è®¡æ—¶æ˜¾ç¤º
- âœ… è¯¦ç»†åˆ†æè¿‡ç¨‹è¯´æ˜
- âœ… ç»¼åˆKçº¿å›¾å±•ç¤º

---

## ğŸš€ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Python 3.12**
- **Flask** - Webæ¡†æ¶
- **python-binance** - Binance API SDK
- **SQLite3** - è½»é‡çº§æ•°æ®åº“
- **Pandas** - æ•°æ®å¤„ç†ï¼ˆå¦‚éœ€è¦ï¼‰

### å‰ç«¯æŠ€æœ¯
- **HTML5 / CSS3**
- **JavaScript ES6+**
- **Chart.js** - å›¾è¡¨åº“
- **Fetch API** - AJAXè¯·æ±‚

### éƒ¨ç½²æŠ€æœ¯
- **Docker** - å®¹å™¨åŒ–
- **Docker Compose** - å®¹å™¨ç¼–æ’
- **Gunicorn** - WSGIæœåŠ¡å™¨ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### å¼€å‘å·¥å…·
- **Git** - ç‰ˆæœ¬æ§åˆ¶
- **GitHub** - ä»£ç æ‰˜ç®¡
- **VSCode / Cursor** - IDE

---

## ğŸ“ ç‰ˆæœ¬æ¼”è¿›

### v1.0 - è§„åˆ™å‹ä¿¡å·æ‰«æå™¨
- ç®€å•æ¡ä»¶åˆ¤æ–­
- æ— çŠ¶æ€è®°å¿†
- é«˜é¢‘è¾“å‡ºä¿¡å·

### v2.0 - è§„åˆ™å‹å¸‚åœºåˆ†æï¼ˆ2024-12ï¼‰
- å¢åŠ åšå¤š/åšç©ºæ¨¡å‹è¯„åˆ†
- ä¸‰æ€å†³ç­–ï¼ˆLONG/SHORT/NO_TRADEï¼‰
- ä¼˜å…ˆçº§ï¼šNO_TRADE > SHORT > LONG
- ç»“æ„åŒ–é£é™©æç¤º

### v3.0 - çŠ¶æ€æœºæ¶æ„ï¼ˆ2025-01ï¼Œå½“å‰ç‰ˆæœ¬ï¼‰
- **çŠ¶æ€æœºè®¾è®¡**ï¼š5ç§ç³»ç»ŸçŠ¶æ€
- **å¸‚åœºç¯å¢ƒæ„ŸçŸ¥**ï¼š3ç§å¸‚åœºç¯å¢ƒ
- **çŠ¶æ€æŒä¹…åŒ–**ï¼šSQLiteæ•°æ®åº“
- **å†å²ä¿¡å·è®°å½•**ï¼šè‡ªåŠ¨ä¿å­˜
- **å†·å´æœŸæœºåˆ¶**ï¼šå¼ºåˆ¶ä¼‘çœ ä¿æŠ¤
- **è¯¦ç»†åˆ†ææè¿°**ï¼šå¤šç»´åº¦è¯´æ˜
- **60ç§’è‡ªåŠ¨åˆ·æ–°**ï¼šå¸¦å€’è®¡æ—¶æ˜¾ç¤º

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### å¯¹äºäº¤æ˜“è€…

1. **ç†è§£ç³»ç»Ÿè¾“å‡º**
   - LONG/SHORT â‰  ç«‹å³è¿›åœºä¿¡å·
   - åªè¡¨ç¤ºå½“å‰å¸‚åœºçŠ¶æ€
   - éœ€ç»“åˆè‡ªå·±çš„äº¤æ˜“ç­–ç•¥

2. **å…³æ³¨NO_TRADE**
   - ç³»ç»Ÿå¤§éƒ¨åˆ†æ—¶å€™ä¼šè¾“å‡º NO_TRADE
   - è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œä¸æ˜¯æ•…éšœ
   - è¡¨ç¤ºå¸‚åœºæ¡ä»¶ä¸æ˜ç¡®

3. **å°Šé‡å†·å´æœŸ**
   - å†·å´æœŸè¡¨ç¤ºå¸‚åœºå¼‚å¸¸
   - è‡³å°‘ç­‰å¾…3åˆ†é’Ÿï¼ˆ3ä¸ªå‘¨æœŸï¼‰
   - ä¸è¦æ€¥äºäº¤æ˜“

4. **æŸ¥çœ‹è¯¦ç»†åˆ†æ**
   - ä¸è¦åªçœ‹äº¤æ˜“å†³ç­–
   - é˜…è¯»è¯¦ç»†åˆ†æè¿‡ç¨‹
   - ç†è§£å†³ç­–åŸå› 

### å¯¹äºå¼€å‘è€…

1. **å‚æ•°è°ƒæ•´**
   - æ‰€æœ‰é˜ˆå€¼åœ¨ `StateMachineConfig` ä¸­
   - å»ºè®®ä¿ç•™é»˜è®¤å€¼
   - è°ƒæ•´éœ€è¦å……åˆ†æµ‹è¯•

2. **çŠ¶æ€æœºæ‰©å±•**
   - å¯ä»¥æ·»åŠ æ–°çš„ SystemState
   - ä½†è¦ä¿è¯è½¬æ¢é€»è¾‘æ­£ç¡®
   - ä¸ç ´åæ ¸å¿ƒçº¦æŸ

3. **æ•°æ®æºæ‰©å±•**
   - å¯ä»¥å¢åŠ æ–°çš„æ•°æ®ç»´åº¦
   - ç»Ÿä¸€é€šè¿‡ `input_data` ä¼ é€’
   - ä¿æŒæ•°æ®æ ¼å¼ä¸€è‡´

4. **å‰ç«¯å®šåˆ¶**
   - UIå¯ä»¥è‡ªç”±è°ƒæ•´
   - APIæ¥å£ä¿æŒç¨³å®š
   - æ³¨æ„åˆ·æ–°é¢‘ç‡

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

1. **é¡¹ç›®æ–‡æ¡£**
   - `doc/å¿«é€Ÿå¼€å§‹.md` - å¿«é€Ÿå…¥é—¨
   - `doc/å¸‚åœºåˆ†æv3.0çŠ¶æ€æœºè¯´æ˜.md` - çŠ¶æ€æœºè¯¦ç»†è¯´æ˜
   - `doc/Dockerä½¿ç”¨è¯´æ˜.md` - Dockeréƒ¨ç½²
   - `doc/Binance_APIä½¿ç”¨è¯´æ˜.md` - APIä½¿ç”¨

2. **æŠ€æœ¯æ–‡æ¡£**
   - `doc/å†å²ä¿¡å·è®°å½•ä½¿ç”¨è¯´æ˜.md` - æ•°æ®åº“ä½¿ç”¨
   - `doc/æ•°æ®æ›´æ–°æœºåˆ¶è¯´æ˜.md` - æ•°æ®åˆ·æ–°
   - `doc/BTRæŒä»“é‡è®¡ç®—è¯¦è§£.md` - OIè®¡ç®—

3. **æºä»£ç **
   - `market_state_machine.py` - çŠ¶æ€æœºæ ¸å¿ƒ
   - `btc_web_app_multi.py` - Flaskåç«¯
   - `database.py` - æ•°æ®åº“æ“ä½œ
   - `static/js/app_multi.js` - å‰ç«¯é€»è¾‘

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub**: https://github.com/qiang0723/trade-test
- **é—®é¢˜åé¦ˆ**: GitHub Issues

---

**æœ€åæ›´æ–°ï¼š2026-01-20**  
**ç‰ˆæœ¬ï¼šv3.0 çŠ¶æ€æœºæ¶æ„**  
**çŠ¶æ€ï¼šç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸­** âœ…
