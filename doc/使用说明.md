# BTC行情数据获取工具 - 使用说明

## 🎯 快速开始

### 第一步：激活虚拟环境

```bash
cd /Users/wangqiang/learning/cursor-project
source venv/bin/activate
```

### 第二步：选择运行方式

#### 方式1️⃣：快速查看行情（推荐新手）

```bash
python3 btc_market_simple.py
```

**适用场景：** 快速查看当前BTC行情，在终端直接显示

**输出内容：**
- 💰 当前价格
- 📊 24小时统计（最高/最低/涨跌幅）
- 📖 订单深度（买卖盘）
- 💹 最近成交记录
- 📈 K线数据（1小时和日线）

---

#### 方式2️⃣：导出数据分析（推荐数据分析）

```bash
python3 btc_market_export.py
```

**适用场景：** 需要保存数据进行后续分析，或用Excel查看

**输出内容：**
- 自动创建 `btc_market_data/` 目录
- 生成7个文件（1个JSON + 6个CSV）
- CSV文件可直接用Excel打开

**生成的文件：**
```
btc_market_data/
├── btc_market_20260117_174323.json          # 完整JSON数据
├── btc_ticker_24h_20260117_174323.csv       # 24小时统计
├── btc_orderbook_bids_20260117_174323.csv   # 买单深度
├── btc_orderbook_asks_20260117_174323.csv   # 卖单深度
├── btc_recent_trades_20260117_174323.csv    # 最近成交
├── btc_klines_1h_20260117_174323.csv        # 1小时K线
└── btc_klines_1d_20260117_174323.csv        # 日线K线
```

---

#### 方式3️⃣：交互式查询（推荐高级用户）

```bash
python3 btc_market_data.py
```

**适用场景：** 需要灵活选择查看不同数据，可自定义参数

**功能菜单：**
```
1. 获取当前价格
2. 获取24小时行情统计
3. 获取订单深度（可自定义档位数）
4. 获取最近成交记录（可自定义数量）
5. 获取K线数据（可自定义时间间隔和数量）
6. 获取完整市场报告
0. 退出
```

---

## 📊 数据说明

### 1. 当前价格
```
💰 BTC 当前价格: $95,224.99 USDT
```

### 2. 24小时行情统计
```
当前价格:       $      95,224.98
24h最高价:      $      95,809.08
24h最低价:      $      94,293.46
24h涨跌幅:      📉          -0.47%
24h涨跌额:      $        -444.73
24h成交量:             8,238.26 BTC
24h成交额:      $ 783,801,238.57
```

### 3. 订单深度
显示买卖盘的挂单情况：
- **卖单（Ask）**：价格从低到高排列，想要卖出的订单
- **买单（Bid）**：价格从高到低排列，想要买入的订单

### 4. 最近成交
显示最近的真实成交记录：
- 🟢 买入：主动买入成交（买方吃掉卖单）
- 🔴 卖出：主动卖出成交（卖方吃掉买单）

### 5. K线数据
每根K线包含：
- **开盘价**：该时间段的第一笔成交价
- **最高价**：该时间段的最高成交价
- **最低价**：该时间段的最低成交价
- **收盘价**：该时间段的最后一笔成交价
- **成交量**：该时间段的总成交量（BTC数量）

支持的时间间隔：
- `1m` - 1分钟
- `5m` - 5分钟
- `15m` - 15分钟
- `1h` - 1小时 ⭐
- `4h` - 4小时
- `1d` - 1天 ⭐
- `1w` - 1周
- `1M` - 1月

---

## 💡 使用技巧

### 1. 定时获取数据

可以使用cron定时任务定期获取数据：

```bash
# 编辑crontab
crontab -e

# 每小时执行一次
0 * * * * cd /Users/wangqiang/learning/cursor-project && source venv/bin/activate && python3 btc_market_export.py >> logs/btc_data.log 2>&1

# 每5分钟执行一次
*/5 * * * * cd /Users/wangqiang/learning/cursor-project && source venv/bin/activate && python3 btc_market_export.py >> logs/btc_data.log 2>&1
```

### 2. 用Excel分析CSV数据

1. 打开Excel
2. 文件 → 打开 → 选择CSV文件
3. 选择"分隔符" → UTF-8编码
4. 即可查看和分析数据

### 3. 修改交易对

如果想获取其他币种的数据，修改代码中的 `symbol`：

```python
# 在脚本中找到这一行
self.symbol = "BTCUSDT"

# 修改为其他交易对
self.symbol = "ETHUSDT"   # 以太坊
self.symbol = "BNBUSDT"   # 币安币
self.symbol = "SOLUSDT"   # Solana
```

### 4. 批量获取多个币种

可以创建一个循环脚本：

```python
symbols = ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT"]

for symbol in symbols:
    btc = BTCMarketExporter()
    btc.symbol = symbol
    data = btc.get_all_data()
    if data:
        btc.export_json(data)
        btc.export_csv(data)
```

---

## ⚠️ 注意事项

### 1. 网络要求
- 需要能够访问币安API（api.binance.com）
- 如果在中国大陆，可能需要使用代理

### 2. API限制
- 币安API有请求频率限制
- 建议不要过于频繁调用（建议间隔至少1秒）
- 超过限制会被暂时封禁IP

### 3. 数据延迟
- 市场数据可能有轻微延迟（通常<1秒）
- 不建议用于高频交易

### 4. 免责声明
- 本工具仅供学习和研究使用
- 数据仅供参考，不构成投资建议
- 加密货币投资有风险，请谨慎决策

---

## 🔧 常见问题

### Q1: 提示"No module named 'binance'"
**A:** 需要先安装依赖包
```bash
source venv/bin/activate
pip install -r requirements.txt
```

### Q2: 提示网络连接错误
**A:** 检查网络连接，确保能访问币安API
```bash
# 测试连接
curl https://api.binance.com/api/v3/ping
```

### Q3: 想获取更多历史数据
**A:** 修改 `limit` 参数
```python
# 获取更多K线数据
btc.get_klines(interval='1d', limit=100)  # 获取100天的数据
```

### Q4: CSV文件中文乱码
**A:** 用Excel打开时选择UTF-8编码，或使用记事本/VSCode打开

### Q5: 想要实时更新数据
**A:** 可以添加循环和延时
```python
import time

while True:
    btc = BTCMarketData()
    btc.get_all_market_data()
    time.sleep(60)  # 每60秒更新一次
```

---

## 📞 技术支持

如有问题或建议，欢迎：
- 提交Issue
- 发起Pull Request
- 联系开发者

---

## 📚 相关资源

- [币安API文档](https://binance-docs.github.io/apidocs/)
- [python-binance库文档](https://python-binance.readthedocs.io/)
- [Pandas数据分析教程](https://pandas.pydata.org/docs/)

---

**祝你使用愉快！📈**
