# åŠ å¯†è´§å¸äº¤æ˜“å†³ç­–å¹³å°è¯¦è§£ 3.0

**ç‰ˆæœ¬**: 3.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-20  
**ç³»ç»Ÿåç§°**: L1 Advisory Layer (äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ)  
**æ›´æ–°å†…å®¹**: PR-B/C/Då†³ç­–è´¨é‡å¢å¼ºã€é¢‘ç‡æ§åˆ¶ã€ç½®ä¿¡åº¦æ··åˆæ¨¡å¼ã€å¸ç§å®šåˆ¶åŒ–

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [ç‰ˆæœ¬æ¼”è¿›](#2-ç‰ˆæœ¬æ¼”è¿›)
3. [æ ¸å¿ƒåŠŸèƒ½](#3-æ ¸å¿ƒåŠŸèƒ½)
4. [å£å¾„è§„èŒƒï¼ˆPR-Aä¿®å¤ï¼‰](#4-å£å¾„è§„èŒƒpr-aä¿®å¤)
5. [PR-B: è´¨é‡è¯­ä¹‰é’‰æ­»](#5-pr-b-è´¨é‡è¯­ä¹‰é’‰æ­»)
6. [PR-C: å†³ç­–é¢‘ç‡æ§åˆ¶](#6-pr-c-å†³ç­–é¢‘ç‡æ§åˆ¶)
7. [PR-D: ç½®ä¿¡åº¦æ··åˆæ¨¡å¼](#7-pr-d-ç½®ä¿¡åº¦æ··åˆæ¨¡å¼)
8. [å†³ç­–ç®¡é“](#8-å†³ç­–ç®¡é“)
9. [æŠ€æœ¯æ¶æ„](#9-æŠ€æœ¯æ¶æ„)
10. [é…ç½®ç®¡ç†](#10-é…ç½®ç®¡ç†)
11. [Webç•Œé¢](#11-webç•Œé¢)
12. [APIæ¥å£](#12-apiæ¥å£)
13. [éƒ¨ç½²æ¶æ„](#13-éƒ¨ç½²æ¶æ„)
14. [æµ‹è¯•è¦†ç›–](#14-æµ‹è¯•è¦†ç›–)
15. [ä½¿ç”¨æŒ‡å—](#15-ä½¿ç”¨æŒ‡å—)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä½

**L1 Advisory Layer** æ˜¯ä¸€ä¸ªåŸºäºå¤šç»´åº¦å¸‚åœºæ•°æ®çš„**äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿ**ï¼Œä¸“æ³¨äºä¸ºåŠ å¯†è´§å¸äº¤æ˜“æä¾›**å®‰å…¨ã€å¯è¿½æº¯ã€é«˜è´¨é‡**çš„æ–¹å‘æ€§å»ºè®®ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ›¡ï¸ **Safety First**: å®‰å…¨ä¼˜å…ˆï¼Œå¤šå±‚é—¸é—¨é˜²æŠ¤
- ğŸ¯ **å•ä¸€èŒè´£**: ä»…è¾“å‡ºæ–¹å‘å†³ç­–ï¼ˆLONG/SHORT/NO_TRADEï¼‰ï¼Œä¸æ¶‰åŠæ‰§è¡Œ
- ğŸ“Š **æ•°æ®é©±åŠ¨**: åŸºäºå®æ—¶Binanceåˆçº¦å¸‚åœºæ•°æ®
- ğŸ” **å¯è¿½æº¯æ€§**: æ¯ä¸ªå†³ç­–éƒ½æœ‰æ˜ç¡®çš„reason_tagså’Œ8æ­¥ç®¡é“è¿½æº¯
- âš™ï¸ **å¯é…ç½®**: æ‰€æœ‰é˜ˆå€¼å¤–éƒ¨åŒ–ï¼Œæ”¯æŒçƒ­æ›´æ–°
- ğŸŒ **å¤šå¸ç§**: æ”¯æŒAIAã€GPSã€ETHç­‰è‡ªå®šä¹‰å¸ç§
- ğŸš€ **ç”Ÿäº§å°±ç»ª**: Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼ŒAWSç”Ÿäº§ç¯å¢ƒè¿è¡Œ
- ğŸšï¸ **ç²¾ç»†æ§åˆ¶**: ExecutabilityLevelä¸‰çº§æ§åˆ¶ã€å†³ç­–é¢‘ç‡é™åˆ¶ã€ç½®ä¿¡åº¦æ··åˆæ¨¡å¼

### 1.2 ç³»ç»Ÿè¾¹ç•Œ

**L1åšä»€ä¹ˆ**ï¼š
- âœ… æ•°æ®è´¨é‡éªŒè¯ï¼ˆæ–°é²œåº¦ã€è§„èŒƒåŒ–ï¼‰
- âœ… åˆ†æå¸‚åœºç¯å¢ƒï¼ˆTREND/RANGE/EXTREMEï¼‰
- âœ… è¯„ä¼°é£é™©å‡†å…¥ï¼ˆæ¸…ç®—/æ‹¥æŒ¤/æç«¯æˆäº¤é‡ï¼‰
- âœ… è¯„ä¼°äº¤æ˜“è´¨é‡ï¼ˆGOOD/UNCERTAIN/POORï¼‰
- âœ… åˆ¤æ–­äº¤æ˜“æ–¹å‘ï¼ˆLONG/SHORT/NO_TRADEï¼‰
- âœ… å†³ç­–é¢‘ç‡æ§åˆ¶ï¼ˆæœ€å°é—´éš”ã€ç¿»è½¬å†·å´ï¼‰
- âœ… è®¡ç®—ç½®ä¿¡åº¦ï¼ˆULTRA/HIGH/MEDIUM/LOW + æ··åˆæ¨¡å¼ï¼‰
- âœ… æä¾›æ‰§è¡Œè®¸å¯ï¼ˆexecutableæ ‡å¿— + ä¸‰çº§æ§åˆ¶ï¼‰
- âœ… å†³ç­–ç®¡é“è¿½æº¯ï¼ˆ8æ­¥å¯è§†åŒ–ï¼‰

**L1ä¸åšä»€ä¹ˆ**ï¼š
- âŒ ä¸è¾“å‡ºä»“ä½å¤§å°
- âŒ ä¸è¾“å‡ºå…¥åœºç‚¹ä½
- âŒ ä¸è¾“å‡ºæ­¢æŸæ­¢ç›ˆ
- âŒ ä¸è®¡ç®—æ æ†å€æ•°
- âŒ ä¸ä¸‹å•æ‰§è¡Œ
- âŒ ä¸ç®¡ç†æŒä»“

### 1.3 ä¸‰å±‚æ¶æ„æ„¿æ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1 Advisory Layer (âœ… v3.0å®Œæˆ)         â”‚
â”‚  - æ–¹å‘å†³ç­–å’¨è¯¢                          â”‚
â”‚  - å®‰å…¨é—¸é—¨ï¼ˆé£é™©+è´¨é‡ï¼‰                  â”‚
â”‚  - 4å±‚ç½®ä¿¡åº¦è¯„ä¼° + æ··åˆæ¨¡å¼               â”‚
â”‚  - 8æ­¥å†³ç­–ç®¡é“ + é¢‘ç‡æ§åˆ¶                â”‚
â”‚  - å¤šå¸ç§æ”¯æŒ + ExecutabilityLevel       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2 Selection Layer (è§„åˆ’ä¸­)             â”‚
â”‚  - è‡ªåŠ¨é€‰å¸                              â”‚
â”‚  - å€™é€‰æ± ç®¡ç†                            â”‚
â”‚  - å¤šå¸ç§æ’åº                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3 Execution Layer (è§„åˆ’ä¸­)             â”‚
â”‚  - è‡ªåŠ¨äº¤æ˜“                              â”‚
â”‚  - ä»“ä½ç®¡ç†                              â”‚
â”‚  - é£æ§æ‰§è¡Œ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç‰ˆæœ¬æ¼”è¿›

### 2.1 ç‰ˆæœ¬å¯¹æ¯”

| ç»´åº¦ | 1.0 | 2.0 | 3.0 (å½“å‰) |
|------|-----|-----|-----------|
| **é…ç½®å£å¾„** | âŒ æ··ç”¨ç™¾åˆ†ç‚¹/å°æ•° | âŒ æ··ç”¨ç™¾åˆ†ç‚¹/å°æ•° | âœ… **ç»Ÿä¸€å°æ•°æ ¼å¼ï¼ˆä¿®å¤ç³»ç»Ÿæ€§é”™è¯¯ï¼‰** |
| **ç½®ä¿¡åº¦æ¡£ä½** | 3æ¡£ (HIGH/MEDIUM/LOW) | 4æ¡£ (ULTRA/HIGH/MEDIUM/LOW) | 4æ¡£ + æ··åˆæ¨¡å¼ (åŸºç¡€åŠ åˆ†+cap+boost) |
| **è´¨é‡è¯„çº§** | 2æ¡£ (GOOD/POOR) | 3æ¡£ (GOOD/UNCERTAIN/POOR) | 3æ¡£ + ExecutabilityLevelæ˜ å°„ |
| **å†³ç­–æ§åˆ¶** | æ—  | æ—  | âœ… æœ€å°é—´éš”(300s) + ç¿»è½¬å†·å´(600s) |
| **ReasonTag** | åŸºç¡€æ ‡ç­¾ | ç»Ÿä¸€è§„èŒƒ | âœ… ALLOW/DEGRADE/BLOCKä¸‰çº§æ§åˆ¶ |
| **Confidenceè®¡ç®—** | ç®€å•åŠ åˆ† | 4å±‚é€»è¾‘æ ‘ | âœ… æ··åˆæ¨¡å¼ï¼šåŠ åˆ†+cap+boost |
| **æ–¹å‘è§¦å‘** | âŒ ä»æœªè§¦å‘ | âŒ ä»æœªè§¦å‘ | âœ… **ä¿®å¤åé¦–æ¬¡è§¦å‘LONG/SHORT** |
| **æ•°æ®è´¨é‡** | åŸºç¡€éªŒè¯ | è§„èŒƒåŒ–+æ–°é²œåº¦ | æŒç»­ä¼˜åŒ– |
| **å¤šå¸ç§** | å•å¸ç§ | 5å¸ç§ | âœ… è‡ªå®šä¹‰ï¼ˆAIA/GPS/ETHï¼‰ |
| **å‰ç«¯ç•Œé¢** | å®Œæ•´ | å¸‚åœºæ•°æ®æ¦‚è§ˆ | âœ… ç®€æ´ç‰ˆï¼ˆåˆ é™¤å¸‚åœºæ•°æ®ï¼‰ |
| **æµ‹è¯•è¦†ç›–** | åŸºç¡€ | 10ä¸ªPRæµ‹è¯• | âœ… 14ä¸ªPRæµ‹è¯•ï¼ˆå«å£å¾„éªŒè¯ï¼‰ |
| **éƒ¨ç½²** | æœ¬åœ° | æœ¬åœ°+AWS | æœ¬åœ°+AWS |

### 2.2 v3.0æ ¸å¿ƒå‡çº§

#### **2.2.0 PR-Aå£å¾„é—®é¢˜ä¿®å¤ï¼ˆç³»ç»Ÿæ€§é”™è¯¯ï¼‰**

**é—®é¢˜å‘ç°**ï¼š
- é…ç½®æ–‡ä»¶ä¸­ç™¾åˆ†æ¯”é˜ˆå€¼æ··ç”¨**ç™¾åˆ†ç‚¹æ ¼å¼**ï¼ˆ5.0è¡¨ç¤º5%ï¼‰å’Œ**å°æ•°æ ¼å¼**ï¼ˆ0.05è¡¨ç¤º5%ï¼‰
- MetricsNormalizerå·²å°†è¾“å…¥æ•°æ®ç»Ÿä¸€ä¸ºå°æ•°æ ¼å¼
- ä½†é…ç½®é˜ˆå€¼ä»ä½¿ç”¨ç™¾åˆ†ç‚¹æ ¼å¼
- **å¯¼è‡´æ–¹å‘æ¡ä»¶æ°¸è¿œä¸è§¦å‘çš„ç³»ç»Ÿæ€§é”™è¯¯**

**å½±å“èŒƒå›´**ï¼š
```
æ•°æ®å±‚é¢: 0.05 (5%)
é˜ˆå€¼å±‚é¢: 5.0 (å®é™…å˜æˆ500%ï¼)
ç»“æœ: 0.05 < 5.0 â†’ æ¡ä»¶æ°¸è¿œä¸æ»¡è¶³ â†’ æ–¹å‘è¯„ä¼°æ°¸è¿œä¸è§¦å‘
```

**ä¿®å¤å†…å®¹**ï¼š
| é…ç½®é¡¹ | ä¿®å¤å‰ | ä¿®å¤å | è¯´æ˜ |
|--------|--------|--------|------|
| `extreme_price_change_1h` | 5.0 | 0.05 | 5% |
| `trend_price_change_6h` | 3.0 | 0.03 | 3% |
| `liquidation.price_change` | 5.0 | 0.05 | 5% |
| `liquidation.oi_drop` | -15.0 | -0.15 | -15% |
| `crowding.oi_growth` | 30.0 | 0.30 | 30% |
| `rotation.price_threshold` | 2.0 | 0.02 | 2% |
| `rotation.oi_threshold` | 5.0 | 0.05 | 5% |
| `range_weak.oi` | 10.0 | 0.10 | 10% |
| `direction.*.*.oi_change` | 5.0/10.0 | 0.05/0.10 | 5%/10% |
| `direction.*.*.price_change` | 1.0 | 0.01 | 1% |

**éªŒè¯ç»“æœ**ï¼ˆæ–°å¢æµ‹è¯•ï¼‰ï¼š
```
âœ… Test 1: é…ç½®é˜ˆå€¼ä½¿ç”¨å°æ•°æ ¼å¼
âœ… Test 2: æ•°æ®è§„èŒƒåŒ–æ­£ç¡®
âœ… Test 3: å¸‚åœºç¯å¢ƒè¯†åˆ«èƒ½æ­£å¸¸è§¦å‘ï¼ˆEXTREME/TREND/RANGEï¼‰
âœ… Test 4: æ–¹å‘è¯„ä¼°èƒ½æ­£å¸¸è§¦å‘ï¼ˆLONG/SHORTï¼‰
âœ… Test 5: å®Œæ•´å†³ç­–æµç¨‹ï¼ˆé¦–æ¬¡æˆåŠŸè§¦å‘LONGå†³ç­–ï¼ï¼‰

å…³é”®éªŒè¯:
å¼ºTREND+å¼ºLONGä¿¡å· â†’ decision=LONG, confidence=ULTRA, executable=True
```

**å£å¾„è§„èŒƒï¼ˆæœ€ç»ˆç¡®å®šï¼‰**ï¼š
- **å†…éƒ¨å­˜å‚¨/è®¡ç®—**: ç»Ÿä¸€å°æ•°æ ¼å¼ï¼ˆ0.05è¡¨ç¤º5%ï¼‰
- **é…ç½®æ–‡ä»¶**: ç»Ÿä¸€å°æ•°æ ¼å¼ + æ³¨é‡Šè¯´æ˜
- **MetricsNormalizer**: è‡ªåŠ¨è½¬æ¢ç™¾åˆ†ç‚¹â†’å°æ•°
- **å‰ç«¯å±•ç¤º**: å¯è½¬æ¢ä¸ºç™¾åˆ†æ¯”æ˜¾ç¤ºï¼ˆå¦‚éœ€è¦ï¼‰

**é‡è¦æ€§**ï¼šâš ï¸ è¿™æ˜¯v3.0æœ€å…³é”®çš„ä¿®å¤ï¼Œè§£å†³äº†**v1.0/v2.0ä»¥æ¥çš„ç³»ç»Ÿæ€§é”™è¯¯**ï¼

---

#### **2.2.1 PR-B: TradeQualityè¯­ä¹‰é’‰æ­»**
- **ExecutabilityLevelä¸‰çº§æ§åˆ¶**: ALLOWï¼ˆå…è®¸ï¼‰ã€DEGRADEï¼ˆé™çº§ï¼‰ã€BLOCKï¼ˆé˜»æ–­ï¼‰
- **23ä¸ªReasonTagç²¾ç»†æ˜ å°„**: æ¯ä¸ªæ ‡ç­¾æ˜ç¡®å®šä¹‰æ‰§è¡Œç­‰çº§
- **POORè´¨é‡ç¡¬çŸ­è·¯**: é‡åˆ°POORç›´æ¥NO_TRADEï¼Œä¸å¯é™çº§
- **UNCERTAINè´¨é‡é™çº§æ‰§è¡Œ**: å…è®¸ç»§ç»­ä½†ç½®ä¿¡åº¦å—é™ï¼ˆâ‰¤MEDIUMï¼‰
- **executableç»¼åˆåˆ¤å®š**: å¤šç»´åº¦åˆ¤æ–­ï¼ˆé£é™©+æ ‡ç­¾+ç½®ä¿¡åº¦+è´¨é‡ï¼‰

#### **2.2.2 PR-C: å†³ç­–é¢‘ç‡æ§åˆ¶**
- **DecisionMemoryç®¡ç†**: å¤šå¸ç§ç‹¬ç«‹è®°å¿†ï¼Œè®°å½•last_decision_timeå’Œlast_decision_side
- **æœ€å°å†³ç­–é—´éš”**: é»˜è®¤300ç§’ï¼Œé˜²æ­¢çŸ­æ—¶é—´é‡å¤å»ºè®®
- **ç¿»è½¬å†·å´**: é»˜è®¤600ç§’ï¼Œé˜²æ­¢LONGâ†”SHORTé¢‘ç¹åˆ‡æ¢
- **NO_TRADEä¸æ›´æ–°è®°å¿†**: åªæœ‰LONG/SHORTæ‰ä¼šæ›´æ–°å†³ç­–è®°å¿†
- **å¯é…ç½®å¼€å…³**: æ”¯æŒenable_min_intervalå’Œenable_flip_cooldownç‹¬ç«‹æ§åˆ¶

#### **2.2.3 PR-D: Confidenceæ··åˆæ¨¡å¼**
- **ä¸‰æ­¥æµç¨‹**: åŸºç¡€åŠ åˆ† â†’ åº”ç”¨cap â†’ å¼ºä¿¡å·çªç ´
- **ç¡¬é™çº§ä¸Šé™ï¼ˆcapï¼‰**: UNCERTAINè´¨é‡â‰¤MEDIUMï¼Œé™çº§æ ‡ç­¾â‰¤MEDIUM
- **å¼ºä¿¡å·çªç ´**: +1æ¡£ä½†ä¸å¯çªç ´capé™åˆ¶
- **é…ç½®åŒ–ç®¡ç†**: åŸºç¡€åˆ†ã€é˜ˆå€¼ã€capè§„åˆ™ã€boostè§„åˆ™å…¨éƒ¨å¯é…ç½®
- **ä¿ç•™åŸæœ‰é€»è¾‘**: ä¸æ¨ç¿»PR-005çš„4æ¡£åŠ åˆ†åˆ¶ï¼Œå¢é‡ä¼˜åŒ–

#### **2.2.4 å¸ç§å®šåˆ¶åŒ–**
- **ä»BTCç­‰ä¸»æµå¸æ”¹ä¸º**: AIAã€GPSã€ETH
- **é»˜è®¤å¸ç§**: AIA
- **å¸ç§æ•°é‡**: ä»5ä¸ªç¼©å‡åˆ°3ä¸ª
- **é…ç½®è·¯å¾„**: `config/l1_thresholds.yaml` â†’ `symbol_universe`

#### **2.2.5 å‰ç«¯ç®€åŒ–**
- **åˆ é™¤å¸‚åœºæ•°æ®æ¦‚è§ˆ**: ç§»é™¤ä»·æ ¼ã€æˆäº¤é‡ã€èµ„é‡‘è´¹ç‡ç­‰8ä¸ªæ•°æ®å¡ç‰‡
- **èšç„¦æ ¸å¿ƒåŠŸèƒ½**: å†³ç­–ä¿¡å·ã€å®‰å…¨é—¸é—¨ã€åŸå› æ ‡ç­¾ã€å†å²è®°å½•
- **ä»£ç ä¼˜åŒ–**: åˆ é™¤165è¡ŒHTML/CSS/JSä»£ç 

---

## 3. æ ¸å¿ƒåŠŸèƒ½

### 3.1 åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½æ¨¡å— | å­åŠŸèƒ½ | çŠ¶æ€ | ç‰ˆæœ¬ |
|---------|--------|------|------|
| **æ•°æ®éªŒè¯** | å¿…éœ€å­—æ®µæ£€æŸ¥ | âœ… | v1.0 |
| | æŒ‡æ ‡è§„èŒƒåŒ– | âœ… | v2.0 PR-001 |
| | æ•°æ®æ–°é²œåº¦æ£€æŸ¥ | âœ… | v2.0 PR-002 |
| **å¸‚åœºåˆ†æ** | ç¯å¢ƒè¯†åˆ«(TREND/RANGE/EXTREME) | âœ… | v1.0 |
| **é£é™©å‡†å…¥** | æç«¯è¡Œæƒ… | âœ… | v1.0 |
| | æ¸…ç®—é˜¶æ®µæ£€æµ‹ | âœ… | v1.0 |
| | æ‹¥æŒ¤é£é™©æ£€æµ‹ | âœ… | v1.0 |
| | æç«¯æˆäº¤é‡æ£€æµ‹ | âœ… | v1.0 |
| **è´¨é‡è¯„ä¼°** | å¸çº³é£é™© | âœ… | v1.0 |
| | å™ªéŸ³å¸‚åœº | âœ… | v2.0 PR-004 |
| | è½®åŠ¨é£é™© | âœ… | v1.0 |
| | éœ‡è¡å¼±ä¿¡å· | âœ… | v1.0 |
| | ExecutabilityLevelæ˜ å°„ | âœ… | v3.0 PR-B |
| **æ–¹å‘è¯„ä¼°** | LONGæ¡ä»¶åˆ¤æ–­ | âœ… | v1.0 |
| | SHORTæ¡ä»¶åˆ¤æ–­ | âœ… | v1.0 |
| | èµ„é‡‘è´¹ç‡é™çº§ | âœ… | v1.0 |
| **å†³ç­–æ§åˆ¶** | æœ€å°å†³ç­–é—´éš” | âœ… | v3.0 PR-C |
| | ç¿»è½¬å†·å´ | âœ… | v3.0 PR-C |
| **ç½®ä¿¡åº¦è®¡ç®—** | 4å±‚æ¡£ä½ | âœ… | v2.0 PR-005 |
| | æ··åˆæ¨¡å¼(åŠ åˆ†+cap+boost) | âœ… | v3.0 PR-D |
| **æ‰§è¡Œè®¸å¯** | HIGH/ULTRAå¯æ‰§è¡Œ | âœ… | v2.0 PR-006 |
| | ç»¼åˆåˆ¤å®š(æ ‡ç­¾+è´¨é‡) | âœ… | v3.0 PR-B |
| **å¯è§‚æµ‹æ€§** | Step TraceæŒä¹…åŒ– | âœ… | v2.0 PR-007 |
| | å†³ç­–ç®¡é“å¯è§†åŒ– | âœ… | v2.0 PR-009 |
| **æ•°æ®ç®¡ç†** | 24hçƒ­å­˜å‚¨ | âœ… | v2.0 PR-008 |
| **å¤šå¸ç§** | Symbol Universe | âœ… | v2.0 PR-010 |
| | AIA/GPS/ETHå®šåˆ¶ | âœ… | v3.0 |

---

## 4. å£å¾„è§„èŒƒï¼ˆPR-Aä¿®å¤ï¼‰

### 4.1 é—®é¢˜èƒŒæ™¯

**å†å²é—ç•™é—®é¢˜**ï¼ˆv1.0/v2.0ï¼‰ï¼š
- PR-001å®ç°äº†MetricsNormalizerï¼Œå°†è¾“å…¥æ•°æ®ç»Ÿä¸€ä¸ºå°æ•°æ ¼å¼
- ä½†é…ç½®æ–‡ä»¶ä¸­çš„é˜ˆå€¼ä»ä½¿ç”¨ç™¾åˆ†ç‚¹æ ¼å¼
- **å¯¼è‡´é˜ˆå€¼æ¯”è¾ƒæ°¸è¿œä¸æˆç«‹**

**é—®é¢˜ç¤ºä¾‹**ï¼š
```python
# æ•°æ®å±‚é¢ï¼ˆå·²è§„èŒƒåŒ–ï¼‰
data['price_change_1h'] = 0.05  # 5%ï¼ˆå°æ•°æ ¼å¼ï¼‰

# é…ç½®å±‚é¢ï¼ˆæœªä¿®å¤å‰ï¼‰
thresholds['trend_price_change_6h'] = 3.0  # å®é™…å˜æˆ300%ï¼

# æ¯”è¾ƒç»“æœ
0.05 > 3.0  # False â†’ æ°¸è¿œä¸è§¦å‘TREND
```

**å½±å“**ï¼š
- âŒ å¸‚åœºç¯å¢ƒè¯†åˆ«å¼‚å¸¸ï¼ˆEXTREME/TRENDæ°¸è¿œä¸è§¦å‘ï¼‰
- âŒ æ–¹å‘è¯„ä¼°å¼‚å¸¸ï¼ˆLONG/SHORTæ°¸è¿œä¸è§¦å‘ï¼‰
- âŒ é£é™©å‡†å…¥å¼‚å¸¸ï¼ˆæ¸…ç®—/æ‹¥æŒ¤æ£€æµ‹å¤±æ•ˆï¼‰
- âŒ è´¨é‡è¯„ä¼°å¼‚å¸¸ï¼ˆè½®åŠ¨/å¼±ä¿¡å·æ£€æµ‹å¤±æ•ˆï¼‰
- **ç»“æœ**: ç³»ç»Ÿåªä¼šè¾“å‡ºNO_TRADEï¼Œæ ¸å¿ƒå†³ç­–é€»è¾‘å®Œå…¨å¤±æ•ˆ

### 4.2 ä¿®å¤æ–¹æ¡ˆ

**ç»Ÿä¸€å£å¾„åŸåˆ™**ï¼š
```
å†…éƒ¨å­˜å‚¨: å°æ•°æ ¼å¼ï¼ˆ0.05 = 5%ï¼‰
é…ç½®æ–‡ä»¶: å°æ•°æ ¼å¼ï¼ˆ0.05 = 5%ï¼‰
è®¡ç®—é€»è¾‘: å°æ•°æ ¼å¼ï¼ˆ0.05 > 0.03 = Trueï¼‰
å‰ç«¯å±•ç¤º: ç™¾åˆ†æ¯”æ ¼å¼ï¼ˆ5% = 0.05 Ã— 100ï¼‰
```

### 4.3 ä¿®å¤æ¸…å•

#### å¸‚åœºç¯å¢ƒè¯†åˆ«
```yaml
# ä¿®å¤å‰
market_regime:
  extreme_price_change_1h: 5.0    # âŒ ç™¾åˆ†ç‚¹æ ¼å¼
  trend_price_change_6h: 3.0      # âŒ ç™¾åˆ†ç‚¹æ ¼å¼

# ä¿®å¤å
market_regime:
  extreme_price_change_1h: 0.05   # âœ… å°æ•°æ ¼å¼ï¼ˆ5%ï¼‰
  trend_price_change_6h: 0.03     # âœ… å°æ•°æ ¼å¼ï¼ˆ3%ï¼‰
```

#### é£é™©å‡†å…¥é˜ˆå€¼
```yaml
# ä¿®å¤å‰
risk_exposure:
  liquidation:
    price_change: 5.0             # âŒ ç™¾åˆ†ç‚¹
    oi_drop: -15.0                # âŒ ç™¾åˆ†ç‚¹
  crowding:
    oi_growth: 30.0               # âŒ ç™¾åˆ†ç‚¹

# ä¿®å¤å
risk_exposure:
  liquidation:
    price_change: 0.05            # âœ… å°æ•°ï¼ˆ5%ï¼‰
    oi_drop: -0.15                # âœ… å°æ•°ï¼ˆ-15%ï¼‰
  crowding:
    oi_growth: 0.30               # âœ… å°æ•°ï¼ˆ30%ï¼‰
```

#### äº¤æ˜“è´¨é‡é˜ˆå€¼
```yaml
# ä¿®å¤å‰
trade_quality:
  rotation:
    price_threshold: 2.0          # âŒ ç™¾åˆ†ç‚¹
    oi_threshold: 5.0             # âŒ ç™¾åˆ†ç‚¹
  range_weak:
    oi: 10.0                      # âŒ ç™¾åˆ†ç‚¹

# ä¿®å¤å
trade_quality:
  rotation:
    price_threshold: 0.02         # âœ… å°æ•°ï¼ˆ2%ï¼‰
    oi_threshold: 0.05            # âœ… å°æ•°ï¼ˆ5%ï¼‰
  range_weak:
    oi: 0.10                      # âœ… å°æ•°ï¼ˆ10%ï¼‰
```

#### æ–¹å‘è¯„ä¼°é˜ˆå€¼ï¼ˆæœ€å…³é”®ï¼‰
```yaml
# ä¿®å¤å‰
direction:
  trend:
    long:
      oi_change: 5.0              # âŒ ç™¾åˆ†ç‚¹
      price_change: 1.0           # âŒ ç™¾åˆ†ç‚¹
  range:
    long:
      oi_change: 10.0             # âŒ ç™¾åˆ†ç‚¹

# ä¿®å¤å
direction:
  trend:
    long:
      oi_change: 0.05             # âœ… å°æ•°ï¼ˆ5%ï¼‰
      price_change: 0.01          # âœ… å°æ•°ï¼ˆ1%ï¼‰
  range:
    long:
      oi_change: 0.10             # âœ… å°æ•°ï¼ˆ10%ï¼‰
```

### 4.4 éªŒè¯ç»“æœ

**æ–°å¢æµ‹è¯•**: `tests/test_decimal_calibration.py`

```
âœ… Test 1: é…ç½®é˜ˆå€¼å£å¾„æ£€æŸ¥
  - æ‰€æœ‰ç™¾åˆ†æ¯”é˜ˆå€¼ä½¿ç”¨å°æ•°æ ¼å¼
  - extreme=0.05, trend=0.03, liquidation=0.05
  - oi_change=0.05, price_change=0.01

âœ… Test 2: æ•°æ®è§„èŒƒåŒ–æ£€æŸ¥
  - ç™¾åˆ†ç‚¹è¾“å…¥è‡ªåŠ¨è½¬æ¢: 5.0 â†’ 0.05
  - å°æ•°è¾“å…¥ä¿æŒä¸å˜: 0.05 â†’ 0.05

âœ… Test 3: å¸‚åœºç¯å¢ƒè¯†åˆ«è§¦å‘
  - 6%å˜åŒ– â†’ EXTREME âœ“
  - 4%å˜åŒ–(6h) â†’ TREND âœ“
  - 1%å˜åŒ– â†’ RANGE âœ“

âœ… Test 4: æ–¹å‘è¯„ä¼°è§¦å‘
  - TREND+å¼ºå¤šæ–¹ â†’ allow_long=True âœ“
  - TREND+å¼ºç©ºæ–¹ â†’ allow_short=True âœ“
  - TREND+å¼±ä¿¡å· â†’ allow_long=False âœ“

âœ… Test 5: å®Œæ•´å†³ç­–æµç¨‹
  - å¼ºTREND+å¼ºLONG â†’ decision=LONG âœ“
  - confidence=ULTRA âœ“
  - executable=True âœ“
```

**å…³é”®è¯æ˜**ï¼š
```
ä¿®å¤å‰: æ‰€æœ‰å†³ç­–éƒ½æ˜¯NO_TRADEï¼ˆæ–¹å‘æ¡ä»¶ä»æœªè§¦å‘ï¼‰
ä¿®å¤å: å¼ºä¿¡å·å¯è§¦å‘LONG/SHORTå†³ç­–ï¼ˆç³»ç»Ÿæ­£å¸¸å·¥ä½œï¼‰
```

### 4.5 é‡è¦æ€§è¯„ä¼°

âš ï¸ **è¿™æ˜¯v3.0æœ€å…³é”®çš„ä¿®å¤ï¼**

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ **è‡´å‘½çº§åˆ«**
- v1.0/v2.0çš„æ–¹å‘è¯„ä¼°å®Œå…¨å¤±æ•ˆ
- æ‰€æœ‰LONG/SHORTå†³ç­–ä»æœªè¢«è§¦å‘è¿‡
- ç³»ç»Ÿå®é™…ä¸Šåªæ˜¯ä¸ª"æ°¸è¿œNO_TRADE"çš„ç©ºå£³

**ä¿®å¤å½±å“**:
- âœ… å¸‚åœºç¯å¢ƒè¯†åˆ«æ¢å¤æ­£å¸¸
- âœ… æ–¹å‘è¯„ä¼°æ¢å¤æ­£å¸¸
- âœ… **é¦–æ¬¡æˆåŠŸè§¦å‘LONG/SHORTå†³ç­–**
- âœ… ç³»ç»ŸçœŸæ­£å¼€å§‹å‘æŒ¥ä½œç”¨

**ç»éªŒæ•™è®­**ï¼š
1. å£å¾„ç»Ÿä¸€å¿…é¡»åœ¨æ•´ä¸ªç³»ç»Ÿç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´
2. é…ç½®æ–‡ä»¶æ³¨é‡Šè¦æ˜ç¡®è¯´æ˜æ ¼å¼ï¼ˆå°æ•° vs ç™¾åˆ†ç‚¹ï¼‰
3. å¿…é¡»æœ‰ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯é˜ˆå€¼è§¦å‘é€»è¾‘
4. MetricsNormalizerä¸é…ç½®é˜ˆå€¼å¿…é¡»åŒæ­¥ä¿®æ”¹

---

## 5. PR-B: è´¨é‡è¯­ä¹‰é’‰æ­»

### 4.1 è®¾è®¡ç›®æ ‡

**é—®é¢˜**ï¼š
- TradeQualityä¸executableçš„è¯­ä¹‰ä¸æ¸…æ™°
- UNCERTAINæ˜¯å¦é˜»æ–­æ‰§è¡Œå­˜åœ¨æ­§ä¹‰
- ReasonTagå¯¹æ‰§è¡Œçš„å½±å“ç¼ºä¹ç»Ÿä¸€è§„åˆ™

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¼•å…¥ExecutabilityLevelä¸‰çº§æ§åˆ¶
2. POORå¿…é¡»ç¡¬çŸ­è·¯ä¸ºNO_TRADE
3. UNCERTAINå…è®¸é™çº§æ‰§è¡Œä½†æœ‰ä¸Šé™
4. executableç”±å¤šç»´åº¦ç»¼åˆåˆ¤å®š

### 4.2 ExecutabilityLevelå®šä¹‰

```python
class ExecutabilityLevel(Enum):
    ALLOW = "allow"      # ä¸å½±å“æ‰§è¡Œ
    DEGRADE = "degrade"  # é™çº§ä½†å…è®¸ï¼ˆå¦‚NOISY_MARKETï¼‰
    BLOCK = "block"      # é˜»æ–­æ‰§è¡Œï¼ˆå¦‚LIQUIDATION_PHASEï¼‰
```

### 4.3 ReasonTagæ˜ å°„è§„åˆ™

| ReasonTag | Level | è¯´æ˜ |
|-----------|-------|------|
| **æ•°æ®éªŒè¯** |
| INVALID_DATA | BLOCK | æ•°æ®æ— æ•ˆ |
| DATA_STALE | BLOCK | æ•°æ®è¿‡æœŸ |
| **é£é™©å¦å†³ç±»** |
| EXTREME_REGIME | BLOCK | æç«¯è¡Œæƒ… |
| LIQUIDATION_PHASE | BLOCK | æ¸…ç®—é˜¶æ®µ |
| CROWDING_RISK | BLOCK | æ‹¥æŒ¤é£é™© |
| EXTREME_VOLUME | BLOCK | æç«¯æˆäº¤é‡ |
| **è´¨é‡å¦å†³ç±»** |
| ABSORPTION_RISK | BLOCK | å¸çº³é£é™©ï¼ˆPOORï¼‰ |
| ROTATION_RISK | BLOCK | è½®åŠ¨é£é™©ï¼ˆPOORï¼‰ |
| NOISY_MARKET | DEGRADE | å™ªéŸ³å¸‚åœºï¼ˆUNCERTAINï¼‰ |
| WEAK_SIGNAL_IN_RANGE | DEGRADE | éœ‡è¡å¼±ä¿¡å·ï¼ˆUNCERTAINï¼‰ |
| **æ–¹å‘å†²çªç±»** |
| CONFLICTING_SIGNALS | BLOCK | ä¿¡å·å†²çª |
| NO_CLEAR_DIRECTION | BLOCK | æ–¹å‘ä¸æ˜ |
| **çŠ¶æ€æœºçº¦æŸç±»** |
| COOL_DOWN_ACTIVE | BLOCK | å†·å´æœŸ |
| STATE_TRANSITION_DENIED | BLOCK | çŠ¶æ€çº¦æŸ |
| MIN_INTERVAL_BLOCK | BLOCK | é—´éš”è¿‡çŸ­ï¼ˆPR-Cï¼‰ |
| FLIP_COOLDOWN_BLOCK | BLOCK | ç¿»è½¬å†·å´ï¼ˆPR-Cï¼‰ |
| **è¾…åŠ©ä¿¡æ¯ç±»** |
| HIGH_FUNDING_RATE | ALLOW | é«˜èµ„é‡‘è´¹ç‡ |
| LOW_FUNDING_RATE | ALLOW | ä½èµ„é‡‘è´¹ç‡ |
| STRONG_BUY_PRESSURE | ALLOW | å¼ºä¹°å‹ |
| STRONG_SELL_PRESSURE | ALLOW | å¼ºå–å‹ |
| OI_GROWING | ALLOW | æŒä»“å¢é•¿ |
| OI_DECLINING | ALLOW | æŒä»“ä¸‹é™ |

### 4.4 è´¨é‡è¯„çº§ä¸ç½®ä¿¡åº¦å…³ç³»

```
GOODè´¨é‡:
  - ç½®ä¿¡åº¦: æ— é™åˆ¶ï¼ˆå¯è¾¾ULTRAï¼‰
  - executable: å–å†³äºç½®ä¿¡åº¦å’Œæ ‡ç­¾

UNCERTAINè´¨é‡:
  - ç½®ä¿¡åº¦: â‰¤ MEDIUMï¼ˆç¡¬ä¸Šé™ï¼‰
  - executable: å¯ä»¥ä¸ºTrueï¼ˆå¦‚æœHIGHä¸”æ— BLOCKæ ‡ç­¾ï¼‰
  - ReasonTag: NOISY_MARKETæˆ–WEAK_SIGNAL_IN_RANGE

POORè´¨é‡:
  - å†³ç­–: ç¡¬çŸ­è·¯ä¸ºNO_TRADE
  - executable: å¼ºåˆ¶False
  - ReasonTag: ABSORPTION_RISKæˆ–ROTATION_RISK
```

### 4.5 executableç»¼åˆåˆ¤å®šé€»è¾‘

```python
def compute_executable(self) -> bool:
    # 1. å†³ç­–å¿…é¡»æ˜¯LONGæˆ–SHORT
    if self.decision == Decision.NO_TRADE:
        return False
    
    # 2. é£é™©å¿…é¡»é€šè¿‡
    if not self.risk_exposure_allowed:
        return False
    
    # 3. PR-B: æ£€æŸ¥é˜»æ–­æ€§æ ‡ç­¾
    if has_blocking_tags(self.reason_tags):
        return False
    
    # 4. ç½®ä¿¡åº¦å¿…é¡»è¾¾æ ‡ï¼ˆULTRAæˆ–HIGHï¼‰
    if self.confidence not in [Confidence.ULTRA, Confidence.HIGH]:
        return False
    
    # 5. è´¨é‡ä¸èƒ½æ˜¯POORï¼ˆç†è®ºä¸Šå·²åœ¨é˜»æ–­æ ‡ç­¾ä¸­æ’é™¤ï¼‰
    if self.trade_quality == TradeQuality.POOR:
        return False
    
    return True
```

### 4.6 è¾…åŠ©å‡½æ•°

```python
def has_blocking_tags(reason_tags: list) -> bool:
    """æ£€æŸ¥æ˜¯å¦æœ‰é˜»æ–­æ€§æ ‡ç­¾"""
    return any(
        REASON_TAG_EXECUTABILITY.get(tag, ExecutabilityLevel.ALLOW) == ExecutabilityLevel.BLOCK
        for tag in reason_tags
    )

def has_degrading_tags(reason_tags: list) -> bool:
    """æ£€æŸ¥æ˜¯å¦æœ‰é™çº§æ ‡ç­¾"""
    return any(
        REASON_TAG_EXECUTABILITY.get(tag, ExecutabilityLevel.ALLOW) == ExecutabilityLevel.DEGRADE
        for tag in reason_tags
    )
```

### 4.7 æµ‹è¯•è¦†ç›–

```
âœ… Test 1: ExecutabilityLevelæ˜ å°„æ­£ç¡®æ€§
âœ… Test 2: has_blocking_tagså‡½æ•°
âœ… Test 3: has_degrading_tagså‡½æ•°
âœ… Test 4: POORè´¨é‡ç¡¬çŸ­è·¯
âœ… Test 5: UNCERTAINè´¨é‡é™çº§
âœ… Test 6: é™çº§æ ‡ç­¾é™åˆ¶ç½®ä¿¡åº¦ä¸Šé™
âœ… Test 7: executableç»¼åˆåˆ¤å®š
```

---

## 5. PR-C: å†³ç­–é¢‘ç‡æ§åˆ¶

### 5.1 è®¾è®¡ç›®æ ‡

**é—®é¢˜**ï¼š
- L1æ˜¯å’¨è¯¢å±‚ï¼Œä¸åº”ç»´æŠ¤å¤æ‚æŒä»“/ACTIVE/CLOSEçŠ¶æ€
- ä½†éœ€è¦é˜²æ­¢çŸ­æ—¶é—´å†…é‡å¤ç»™å»ºè®®æˆ–æ–¹å‘é¢‘ç¹ç¿»è½¬

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æœ€å°å†³ç­–é—´éš”ï¼ˆMin Decision Intervalï¼‰
2. ç¿»è½¬å†·å´ï¼ˆFlip Cooldownï¼‰
3. æç®€è®°å¿†ç®¡ç†ï¼ˆåªè®°å½•æ—¶é—´å’Œæ–¹å‘ï¼‰

### 5.2 DecisionMemoryè®¾è®¡

```python
class DecisionMemory:
    """å†³ç­–è®°å¿†ç®¡ç†"""
    
    def __init__(self):
        self._memory = {}  # {symbol: {"time": datetime, "side": Decision}}
    
    def get_last_decision(self, symbol: str) -> Optional[Dict]:
        """è·å–æŒ‡å®šå¸ç§çš„ä¸Šæ¬¡å†³ç­–è®°å½•"""
        return self._memory.get(symbol)
    
    def update_decision(self, symbol: str, decision: Decision, timestamp: datetime):
        """æ›´æ–°å†³ç­–è®°å¿†ï¼ˆä»…LONG/SHORTï¼‰"""
        if decision in [Decision.LONG, Decision.SHORT]:
            self._memory[symbol] = {"time": timestamp, "side": decision}
```

**å…³é”®è®¾è®¡**ï¼š
- **å¤šå¸ç§ç‹¬ç«‹**: æ¯ä¸ªsymbolç‹¬ç«‹è®°å¿†
- **NO_TRADEä¸æ›´æ–°**: åªæœ‰LONG/SHORTæ‰æ›´æ–°è®°å¿†
- **è½»é‡çº§**: åªè®°å½•2ä¸ªå­—æ®µï¼ˆtime, sideï¼‰

### 5.3 æœ€å°å†³ç­–é—´éš”

**è§„åˆ™**ï¼š
```
IF è·ç¦»ä¸Šæ¬¡è¾“å‡ºLONG/SHORTæœªè¶…è¿‡min_decision_interval_seconds:
    æœ¬æ¬¡ç›´æ¥è¾“å‡ºNO_TRADEï¼ˆåŸå› ï¼šMIN_INTERVAL_BLOCKï¼‰
```

**ç¤ºä¾‹**ï¼š
```
T0: LONGå†³ç­–è¾“å‡ºï¼Œè®°å½•æ—¶é—´
T0+2min: å°è¯•LONG â†’ è¢«é˜»æ–­ â†’ NO_TRADE (MIN_INTERVAL_BLOCK)
T0+6min: å°è¯•LONG â†’ é€šè¿‡ï¼ˆè¶…è¿‡5åˆ†é’Ÿï¼‰
```

**é…ç½®**ï¼š
```yaml
decision_control:
  min_decision_interval_seconds: 300  # 5åˆ†é’Ÿ
  enable_min_interval: true
```

### 5.4 ç¿»è½¬å†·å´

**è§„åˆ™**ï¼š
```
IF æœ¬æ¬¡æ–¹å‘ä¸ä¸Šæ¬¡éNO_TRADEæ–¹å‘ç›¸å:
    AND é—´éš”æœªè¶…è¿‡flip_cooldown_seconds:
        æœ¬æ¬¡è¾“å‡ºNO_TRADEï¼ˆåŸå› ï¼šFLIP_COOLDOWN_BLOCKï¼‰
```

**ç¤ºä¾‹**ï¼š
```
T0: LONGå†³ç­–è¾“å‡º
T0+3min: å°è¯•SHORT â†’ è¢«é˜»æ–­ â†’ NO_TRADE (FLIP_COOLDOWN_BLOCK)
T0+11min: å°è¯•SHORT â†’ é€šè¿‡ï¼ˆè¶…è¿‡10åˆ†é’Ÿï¼‰
```

**é…ç½®**ï¼š
```yaml
decision_control:
  flip_cooldown_seconds: 600  # 10åˆ†é’Ÿ
  enable_flip_cooldown: true
```

### 5.5 å†³ç­–æµç¨‹é›†æˆ

åœ¨å†³ç­–ç®¡é“çš„Step 7æ’å…¥é¢‘ç‡æ§åˆ¶ï¼š

```
Step 1: æ•°æ®éªŒè¯
Step 2: å¸‚åœºç¯å¢ƒè¯†åˆ«
Step 3: é£é™©å‡†å…¥è¯„ä¼°
Step 4: äº¤æ˜“è´¨é‡è¯„ä¼°
Step 5: æ–¹å‘è¯„ä¼°
Step 6: å†³ç­–ä¼˜å…ˆçº§åˆ¤æ–­
Step 7: å†³ç­–é¢‘ç‡æ§åˆ¶ â† æ–°å¢ï¼ˆPR-Cï¼‰
Step 8: æ„é€ ç»“æœ
```

```python
def _apply_decision_control(
    self, symbol: str, decision: Decision, 
    reason_tags: List[ReasonTag], timestamp: datetime
) -> Tuple[Decision, List[ReasonTag]]:
    control_tags = []
    
    if decision == Decision.NO_TRADE:
        return decision, control_tags
    
    last = self.decision_memory.get_last_decision(symbol)
    if last is None:
        return decision, control_tags
    
    elapsed = (timestamp - last['time']).total_seconds()
    
    # æ£€æŸ¥1: æœ€å°å†³ç­–é—´éš”
    if enable_min_interval and elapsed < min_interval:
        control_tags.append(ReasonTag.MIN_INTERVAL_BLOCK)
        return Decision.NO_TRADE, control_tags
    
    # æ£€æŸ¥2: ç¿»è½¬å†·å´
    if enable_flip_cooldown:
        is_flip = (decision != last['side'])
        if is_flip and elapsed < flip_cooldown:
            control_tags.append(ReasonTag.FLIP_COOLDOWN_BLOCK)
            return Decision.NO_TRADE, control_tags
    
    return decision, control_tags
```

### 5.6 æ–°å¢ReasonTag

```python
# å†³ç­–é¢‘ç‡æ§åˆ¶ç±»ï¼ˆPR-Cï¼‰
MIN_INTERVAL_BLOCK = "min_interval_block"
FLIP_COOLDOWN_BLOCK = "flip_cooldown_block"

# ä¸­æ–‡è§£é‡Š
"min_interval_block": "â±ï¸ é—´éš”è¿‡çŸ­ï¼šè·ç¦»ä¸Šæ¬¡å†³ç­–æ—¶é—´è¿‡çŸ­ï¼Œé˜²æ­¢é¢‘ç¹è¾“å‡º"
"flip_cooldown_block": "ğŸ”„ ç¿»è½¬å†·å´ï¼šæ–¹å‘ç¿»è½¬å†·å´æœŸå†…ï¼Œé˜²æ­¢é¢‘ç¹åˆ‡æ¢"
```

### 5.7 æµ‹è¯•è¦†ç›–

```
âœ… Test 1: DecisionMemoryåŸºæœ¬åŠŸèƒ½
âœ… Test 2: æœ€å°é—´éš”é˜»æ–­
âœ… Test 3: ç¿»è½¬å†·å´é˜»æ–­
âœ… Test 4: ç¦ç”¨æ§åˆ¶åŠŸèƒ½
```

---

## 6. PR-D: ç½®ä¿¡åº¦æ··åˆæ¨¡å¼

### 6.1 è®¾è®¡ç›®æ ‡

**é—®é¢˜**ï¼š
- PR-005çš„çº¯åŠ åˆ†åˆ¶å¯èƒ½è®©UNCERTAIN+TREND+å¼ºä¿¡å·è¾¾åˆ°ULTRAï¼ˆä¸åˆç†ï¼‰
- PR-Bçš„é™çº§æ ‡ç­¾å·²ç»é™åˆ¶ï¼Œä½†PR-Déœ€è¦æ›´ç³»ç»Ÿçš„capæœºåˆ¶
- éœ‡è¡å¸‚+å¼ºä¿¡å·åº”è¯¥æœ‰çªç ´èƒ½åŠ›ï¼ˆä¸è¢«çŸ­æ¿å®Œå…¨å‹æ­»ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¿ç•™ç°æœ‰4æ¡£åŠ åˆ†åˆ¶ï¼ˆä¸æ¨ç¿»PR-005ï¼‰
2. æ–°å¢ç¡¬é™çº§ä¸Šé™ï¼ˆcapsï¼‰
3. æ–°å¢å¼ºä¿¡å·çªç ´ï¼ˆboostï¼‰
4. ä¸‰æ­¥æµç¨‹ï¼šåŠ åˆ† â†’ cap â†’ boost

### 6.2 ä¸‰æ­¥æµç¨‹

```
Step 1: åŸºç¡€åŠ åˆ†
  - decision_score: 30åˆ†ï¼ˆLONG/SHORTï¼‰
  - regime_score: TREND=30, RANGE=10, EXTREME=0
  - quality_score: GOOD=30, UNCERTAIN=15, POOR=0
  - strong_signal_bonus: 10åˆ†
  - æ€»åˆ†æ˜ å°„: â‰¥90â†’ULTRA, â‰¥65â†’HIGH, â‰¥40â†’MEDIUM, <40â†’LOW

Step 2: åº”ç”¨capï¼ˆç¡¬é™çº§ä¸Šé™ï¼‰
  - UNCERTAINè´¨é‡ â†’ â‰¤MEDIUM
  - reduce_tags (NOISY_MARKETç­‰) â†’ â‰¤MEDIUM
  - deny_tags (LIQUIDATION_PHASEç­‰) â†’ LOWï¼ˆå·²åœ¨Step 3çŸ­è·¯ï¼‰

Step 3: å¼ºä¿¡å·çªç ´
  - å¦‚æœæœ‰STRONG_BUY_PRESSUREæˆ–STRONG_SELL_PRESSURE
  - ç½®ä¿¡åº¦+1æ¡£ï¼ˆä½†ä¸å¯çªç ´capé™åˆ¶ï¼‰
```

### 6.3 åŸºç¡€åŠ åˆ†é…ç½®

```yaml
confidence_scoring:
  # åŸºç¡€åˆ†
  decision_score: 30               # å†³ç­–ç±»å‹åˆ†
  regime_trend_score: 30           # TRENDç¯å¢ƒåˆ†
  regime_range_score: 10           # RANGEç¯å¢ƒåˆ†
  regime_extreme_score: 0          # EXTREMEç¯å¢ƒåˆ†
  quality_good_score: 30           # GOODè´¨é‡åˆ†
  quality_uncertain_score: 15      # UNCERTAINè´¨é‡åˆ†ï¼ˆé™çº§ï¼‰
  quality_poor_score: 0            # POORè´¨é‡åˆ†
  strong_signal_bonus: 10          # å¼ºä¿¡å·åŠ åˆ†
  
  # æ¡£ä½æ˜ å°„
  thresholds:
    ultra: 90                      # â‰¥90åˆ† â†’ ULTRA
    high: 65                       # â‰¥65åˆ† â†’ HIGH
    medium: 40                     # â‰¥40åˆ† â†’ MEDIUM
```

### 6.4 ç¡¬é™çº§ä¸Šé™ï¼ˆcapsï¼‰

```yaml
confidence_scoring:
  caps:
    # UNCERTAINè´¨é‡çš„ä¸Šé™
    uncertain_quality_max: "MEDIUM"
    
    # ç‰¹å®šReasonTagçš„ä¸Šé™
    tag_caps:
      noisy_market: "MEDIUM"
      weak_signal_in_range: "MEDIUM"
```

**é€»è¾‘**ï¼š
```python
def _apply_confidence_caps(
    self, confidence: Confidence, quality: TradeQuality, reason_tags: List[ReasonTag]
) -> Tuple[Confidence, bool]:
    has_cap = False
    
    # 1. UNCERTAINè´¨é‡ä¸Šé™
    if quality == TradeQuality.UNCERTAIN:
        max_level = self._string_to_confidence("MEDIUM")
        if self._confidence_level(confidence) > self._confidence_level(max_level):
            confidence = max_level
            has_cap = True
    
    # 2. reduce_tagsä¸Šé™
    for tag in reason_tags:
        if tag.value in reduce_tags or tag.value in tag_caps:
            max_level = self._string_to_confidence(tag_caps.get(tag.value, "MEDIUM"))
            if self._confidence_level(confidence) > self._confidence_level(max_level):
                confidence = max_level
                has_cap = True
    
    return confidence, has_cap
```

### 6.5 å¼ºä¿¡å·çªç ´ï¼ˆboostï¼‰

```yaml
confidence_scoring:
  strong_signal_boost:
    enabled: true                  # æ˜¯å¦å¯ç”¨
    boost_levels: 1                # æå‡æ¡£æ•°
    
    # è§¦å‘çªç ´çš„æ ‡ç­¾
    required_tags:
      - strong_buy_pressure
      - strong_sell_pressure
```

**é€»è¾‘**ï¼š
```python
def _apply_strong_signal_boost(
    self, confidence: Confidence, reason_tags: List[ReasonTag],
    cap_limit: Confidence, has_strong_signal: bool
) -> Confidence:
    if not has_strong_signal:
        return confidence
    
    # æå‡1æ¡£
    boosted = self._boost_confidence(confidence, 1)
    
    # ä¸èƒ½çªç ´cap
    if self._confidence_level(boosted) > self._confidence_level(cap_limit):
        return cap_limit
    
    return boosted
```

**å…³é”®**ï¼š
- å¼ºä¿¡å·å¯ä»¥+1æ¡£
- ä½†**ä¸èƒ½çªç ´capé™åˆ¶**

### 6.6 ç¤ºä¾‹åœºæ™¯

#### åœºæ™¯1: TREND + GOOD + å¼ºä¿¡å·
```
åŸºç¡€åŠ åˆ†: 30+30+30+10 = 100åˆ† â†’ ULTRA
åº”ç”¨cap: æ— cap
å¼ºä¿¡å·çªç ´: å·²æ˜¯ULTRAï¼Œæ— éœ€çªç ´
æœ€ç»ˆ: ULTRA
```

#### åœºæ™¯2: TREND + UNCERTAIN + å¼ºä¿¡å·
```
åŸºç¡€åŠ åˆ†: 30+30+15+10 = 85åˆ† â†’ HIGH
åº”ç”¨cap: UNCERTAIN â†’ capåˆ°MEDIUM
å¼ºä¿¡å·çªç ´: å°è¯•MEDIUM+1â†’HIGHï¼Œä½†è¢«capé™åˆ¶
æœ€ç»ˆ: MEDIUM ï¼ˆä¸å¯çªç ´capï¼‰
```

#### åœºæ™¯3: RANGE + GOOD + å¼ºä¿¡å·
```
åŸºç¡€åŠ åˆ†: 30+10+30+10 = 80åˆ† â†’ HIGH
åº”ç”¨cap: æ— cap
å¼ºä¿¡å·çªç ´: HIGH+1 â†’ ULTRA ï¼ˆæ— capæ—¶å¯çªç ´ï¼‰
æœ€ç»ˆ: ULTRA
```

#### åœºæ™¯4: TREND + GOOD + NOISY_MARKET
```
åŸºç¡€åŠ åˆ†: 30+30+30+10 = 100åˆ† â†’ ULTRA
åº”ç”¨cap: NOISY_MARKET â†’ capåˆ°MEDIUM
å¼ºä¿¡å·çªç ´: å°è¯•MEDIUM+1â†’HIGHï¼Œä½†è¢«capé™åˆ¶
æœ€ç»ˆ: MEDIUM
```

### 6.7 é…ç½®åŒ–ç®¡ç†

æ‰€æœ‰è§„åˆ™éƒ½å¯ä»¥é€šè¿‡`config/l1_thresholds.yaml`é…ç½®ï¼š

```yaml
# ==================
# ç½®ä¿¡åº¦é…ç½®ï¼ˆPR-Dæ··åˆæ¨¡å¼ï¼‰
# ==================
confidence_scoring:
  # åŸºç¡€åˆ†ï¼ˆä¿æŒç°æœ‰è¯„åˆ†ä½“ç³»ï¼‰
  decision_score: 30
  regime_trend_score: 30
  regime_range_score: 10
  quality_good_score: 30
  quality_uncertain_score: 15
  strong_signal_bonus: 10
  
  # æ¡£ä½æ˜ å°„
  thresholds:
    ultra: 90
    high: 65
    medium: 40
  
  # ç¡¬é™çº§ä¸Šé™
  caps:
    uncertain_quality_max: "MEDIUM"
    tag_caps:
      noisy_market: "MEDIUM"
      weak_signal_in_range: "MEDIUM"
  
  # å¼ºä¿¡å·çªç ´
  strong_signal_boost:
    enabled: true
    boost_levels: 1
    required_tags:
      - strong_buy_pressure
      - strong_sell_pressure

# ==================
# ReasonTagåˆ†ç±»è§„åˆ™ï¼ˆPR-Dï¼‰
# ==================
reason_tag_rules:
  # é™çº§æ ‡ç­¾ï¼ˆè§¦å‘capï¼‰
  reduce_tags:
    - noisy_market
    - weak_signal_in_range
  
  # å¦å†³æ ‡ç­¾ï¼ˆå¼ºåˆ¶LOWï¼‰
  deny_tags:
    - liquidation_phase
    - crowding_risk
    - extreme_volume
    - data_stale
    - extreme_regime
    - absorption_risk
    - rotation_risk
```

### 6.8 æµ‹è¯•è¦†ç›–

```
âœ… Test 1: åŸºç¡€åŠ åˆ†åˆ¶æ­£å¸¸
âœ… Test 2: UNCERTAINè´¨é‡ä¸Šé™ç”Ÿæ•ˆ
âœ… Test 3: é™çº§æ ‡ç­¾ä¸Šé™ç”Ÿæ•ˆ
âœ… Test 4: å¼ºä¿¡å·çªç ´åŠŸèƒ½æ­£å¸¸
âœ… Test 5: å¼ºä¿¡å·æ— æ³•çªç ´cap
âœ… Test 6: ç½®ä¿¡åº¦æ¡£ä½æ¯”è¾ƒåŠŸèƒ½
âœ… Test 7: å­—ç¬¦ä¸²è½¬ç½®ä¿¡åº¦åŠŸèƒ½
```

---

## 7. å†³ç­–ç®¡é“

### 7.1 å®Œæ•´8æ­¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: æ•°æ®éªŒè¯ + æŒ‡æ ‡è§„èŒƒåŒ– + æ–°é²œåº¦æ£€æŸ¥              â”‚
â”‚  - å¿…éœ€å­—æ®µæ£€æŸ¥                                         â”‚
â”‚  - ç™¾åˆ†æ¯”ç»Ÿä¸€ä¸ºå°æ•°æ ¼å¼                                 â”‚
â”‚  - æ•°æ®å¹´é¾„æ£€æŸ¥ï¼ˆâ‰¤120ç§’ï¼‰                               â”‚
â”‚  - å¤±è´¥ â†’ NO_TRADE + INVALID_DATA/DATA_STALE           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: å¸‚åœºç¯å¢ƒè¯†åˆ«                                     â”‚
â”‚  - EXTREME: 1hä»·æ ¼å˜åŒ– > 5%                            â”‚
â”‚  - TREND: 6hä»·æ ¼å˜åŒ– > 3%                              â”‚
â”‚  - RANGE: å…¶ä»–æƒ…å†µï¼ˆé»˜è®¤ï¼‰                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: é£é™©å‡†å…¥è¯„ä¼°ï¼ˆç¬¬ä¸€é“é—¸é—¨ï¼‰                       â”‚
â”‚  - EXTREMEè¡Œæƒ… â†’ æ‹’ç»                                   â”‚
â”‚  - æ¸…ç®—é˜¶æ®µï¼ˆä»·æ ¼æ€¥å˜+OIéª¤é™ï¼‰â†’ æ‹’ç»                    â”‚
â”‚  - æ‹¥æŒ¤é£é™©ï¼ˆæç«¯è´¹ç‡+é«˜OIå¢é•¿ï¼‰â†’ æ‹’ç»                  â”‚
â”‚  - æç«¯æˆäº¤é‡ï¼ˆ1h > 24hå‡å€¼Ã—10ï¼‰â†’ æ‹’ç»                 â”‚
â”‚  - å¤±è´¥ â†’ NO_TRADE + é£é™©æ ‡ç­¾                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: äº¤æ˜“è´¨é‡è¯„ä¼°ï¼ˆç¬¬äºŒé“é—¸é—¨ï¼‰                       â”‚
â”‚  - å¸çº³é£é™© â†’ POOR                                      â”‚
â”‚  - å™ªéŸ³å¸‚åœº â†’ UNCERTAIN                                 â”‚
â”‚  - è½®åŠ¨é£é™© â†’ POOR                                      â”‚
â”‚  - éœ‡è¡å¼±ä¿¡å· â†’ UNCERTAIN                               â”‚
â”‚  - POOR â†’ ç¡¬çŸ­è·¯ä¸ºNO_TRADEï¼ˆPR-Bï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: æ–¹å‘è¯„ä¼°ï¼ˆSHORTä¼˜å…ˆï¼‰                           â”‚
â”‚  - TRENDå¸‚: ä»·æ ¼+å¤±è¡¡+OIç»¼åˆåˆ¤æ–­                        â”‚
â”‚  - RANGEå¸‚: æ›´é«˜é˜ˆå€¼è¦æ±‚                                â”‚
â”‚  - èµ„é‡‘è´¹ç‡é™çº§: HIGHâ†’SHORT, LOWâ†’LONG                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: å†³ç­–ä¼˜å…ˆçº§åˆ¤æ–­                                   â”‚
â”‚  - LONG&SHORTåŒæ—¶æ»¡è¶³ â†’ CONFLICTING_SIGNALS â†’ NO_TRADE â”‚
â”‚  - ä»…SHORTæ»¡è¶³ â†’ SHORTï¼ˆä¼˜å…ˆçº§é«˜ï¼‰                      â”‚
â”‚  - ä»…LONGæ»¡è¶³ â†’ LONG                                    â”‚
â”‚  - å‡ä¸æ»¡è¶³ â†’ NO_CLEAR_DIRECTION â†’ NO_TRADE            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: å†³ç­–é¢‘ç‡æ§åˆ¶ï¼ˆPR-Cæ–°å¢ï¼‰                        â”‚
â”‚  - æœ€å°å†³ç­–é—´éš”æ£€æŸ¥ï¼ˆé»˜è®¤300ç§’ï¼‰                        â”‚
â”‚  - ç¿»è½¬å†·å´æ£€æŸ¥ï¼ˆé»˜è®¤600ç§’ï¼‰                            â”‚
â”‚  - å¤±è´¥ â†’ NO_TRADE + MIN_INTERVAL_BLOCK/FLIP_COOLDOWN   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: æ„é€ ç»“æœ                                         â”‚
â”‚  1. ç½®ä¿¡åº¦è®¡ç®—ï¼ˆPR-Dæ··åˆæ¨¡å¼ï¼‰:                         â”‚
â”‚     - åŸºç¡€åŠ åˆ†ï¼ˆdecision+regime+quality+strong_signalï¼‰ â”‚
â”‚     - åº”ç”¨capï¼ˆUNCERTAINâ‰¤MEDIUM, reduce_tagsâ‰¤MEDIUMï¼‰   â”‚
â”‚     - å¼ºä¿¡å·çªç ´ï¼ˆ+1æ¡£ä½†ä¸çªç ´capï¼‰                     â”‚
â”‚  2. executableåˆ¤å®šï¼ˆPR-Bç»¼åˆï¼‰:                         â”‚
â”‚     - å†³ç­–=LONG/SHORT                                   â”‚
â”‚     - é£é™©é€šè¿‡                                          â”‚
â”‚     - æ— BLOCKæ ‡ç­¾                                       â”‚
â”‚     - ç½®ä¿¡åº¦â‰¥HIGH                                       â”‚
â”‚     - è´¨é‡â‰ POOR                                         â”‚
â”‚  3. æ›´æ–°å†³ç­–è®°å¿†ï¼ˆä»…LONG/SHORTï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç®¡é“æ­¥éª¤æ•°æ®ç»“æ„

```python
{
    "step": 1,
    "name": "validate_data",
    "status": "success",  # success | warning | failed | pending
    "message": "æ•°æ®éªŒè¯é€šè¿‡ï¼ˆå«è§„èŒƒåŒ–+æ–°é²œåº¦æ£€æŸ¥ï¼‰",
    "result": "Valid"
}
```

### 7.3 å¯è§†åŒ–å±•ç¤º

å‰ç«¯é€šè¿‡`/api/l1/pipeline/{symbol}`æ¥å£è·å–ç®¡é“æ­¥éª¤ï¼Œå¹¶å±•ç¤ºï¼š
- âœ… æˆåŠŸæ­¥éª¤ï¼ˆç»¿è‰²ï¼‰
- âš ï¸ è­¦å‘Šæ­¥éª¤ï¼ˆé»„è‰²ï¼‰
- âŒ å¤±è´¥æ­¥éª¤ï¼ˆçº¢è‰²ï¼‰
- â³ å¾…å¤„ç†æ­¥éª¤ï¼ˆç°è‰²ï¼‰

---

## 8. æŠ€æœ¯æ¶æ„

### 8.1 æŠ€æœ¯æ ˆ

| å±‚æ¬¡ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **åç«¯** | Python | 3.12 | æ ¸å¿ƒå†³ç­–å¼•æ“ |
| | Flask | 3.0+ | WebæœåŠ¡æ¡†æ¶ |
| | APScheduler | - | å®šæ—¶ä»»åŠ¡ã€æ•°æ®ç¼“å­˜ |
| | Watchdog | - | é…ç½®çƒ­æ›´æ–° |
| **æ•°æ®åº“** | SQLite | - | å†³ç­–ç»“æœæŒä¹…åŒ– |
| **å‰ç«¯** | HTML5 + CSS3 | - | Webç•Œé¢ |
| | JavaScript (Vanilla) | ES6+ | åŠ¨æ€äº¤äº’ |
| **æ•°æ®æº** | Binance API | - | åˆçº¦å¸‚åœºæ•°æ® |
| **å®¹å™¨åŒ–** | Docker | - | æœåŠ¡å®¹å™¨åŒ– |
| | Docker Compose | - | æœåŠ¡ç¼–æ’ |
| **éƒ¨ç½²** | AWS EC2 | - | ç”Ÿäº§ç¯å¢ƒ |

### 8.2 æ ¸å¿ƒæ¨¡å—

```
trade-info/
â”œâ”€â”€ market_state_machine_l1.py    # æ ¸å¿ƒå†³ç­–å¼•æ“
â”‚   â”œâ”€â”€ L1AdvisoryEngine          # ä¸»å¼•æ“ç±»
â”‚   â”œâ”€â”€ DecisionMemory            # å†³ç­–è®°å¿†ï¼ˆPR-Cï¼‰
â”‚   â”œâ”€â”€ _validate_data()          # Step 1
â”‚   â”œâ”€â”€ _detect_market_regime()   # Step 2
â”‚   â”œâ”€â”€ _eval_risk_exposure_allowed()  # Step 3
â”‚   â”œâ”€â”€ _eval_trade_quality()     # Step 4
â”‚   â”œâ”€â”€ _eval_long/short_direction()   # Step 5
â”‚   â”œâ”€â”€ _decide_priority()        # Step 6
â”‚   â”œâ”€â”€ _apply_decision_control() # Step 7ï¼ˆPR-Cï¼‰
â”‚   â””â”€â”€ _compute_confidence()     # Step 8ï¼ˆPR-Dï¼‰
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ enums.py                  # æšä¸¾å®šä¹‰
â”‚   â”œâ”€â”€ advisory_result.py        # å†³ç­–ç»“æœæ•°æ®ç±»
â”‚   â””â”€â”€ reason_tags.py            # åŸå› æ ‡ç­¾ï¼ˆPR-Bæ‰©å±•ï¼‰
â”‚       â”œâ”€â”€ ExecutabilityLevel    # ä¸‰çº§æ§åˆ¶
â”‚       â”œâ”€â”€ ReasonTag             # æ ‡ç­¾æšä¸¾
â”‚       â”œâ”€â”€ REASON_TAG_EXECUTABILITY  # æ˜ å°„è§„åˆ™
â”‚       â”œâ”€â”€ has_blocking_tags()   # è¾…åŠ©å‡½æ•°
â”‚       â””â”€â”€ has_degrading_tags()  # è¾…åŠ©å‡½æ•°
â”‚
â”œâ”€â”€ btc_web_app_l1.py             # Flask WebæœåŠ¡
â”œâ”€â”€ database_l1.py                # æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ data_cache.py                 # æ•°æ®ç¼“å­˜
â”œâ”€â”€ binance_data_fetcher.py       # Binance APIå°è£…
â”œâ”€â”€ metrics_normalizer.py         # æŒ‡æ ‡è§„èŒƒåŒ–
â”œâ”€â”€ logger_config.py              # æ—¥å¿—é…ç½®
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ l1_thresholds.yaml        # é…ç½®æ–‡ä»¶ï¼ˆPR-Dæ‰©å±•ï¼‰
â”‚
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/style_l1.css          # æ ·å¼ï¼ˆPR-åˆ é™¤å¸‚åœºæ•°æ®æ¦‚è§ˆï¼‰
â”‚   â””â”€â”€ js/app_l1.js              # å‰ç«¯é€»è¾‘
â”‚
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index_l1.html             # Webé¡µé¢ï¼ˆPR-ç®€åŒ–ï¼‰
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ test_pr_b_trade_quality.py       # PR-Bæµ‹è¯•
    â”œâ”€â”€ test_pr_c_decision_control.py    # PR-Cæµ‹è¯•
    â””â”€â”€ test_pr_d_confidence_hybrid.py   # PR-Dæµ‹è¯•
```

### 8.3 æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Binance API â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ åŸå§‹å¸‚åœºæ•°æ®
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DataCache   â”‚ â† å®šæ—¶åˆ·æ–°ï¼ˆ60sï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è§„èŒƒåŒ–æ•°æ®
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ L1AdvisoryEngine â”‚ â† 8æ­¥å†³ç­–ç®¡é“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ AdvisoryResult
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ L1Database   â”‚ â† æŒä¹…åŒ–ï¼ˆ24hçƒ­å­˜å‚¨ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flask API    â”‚ â† /api/l1/advisory/{symbol}
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ JSON
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web Frontend â”‚ â† å®æ—¶å±•ç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. é…ç½®ç®¡ç†

### 9.1 å®Œæ•´é…ç½®æ–‡ä»¶

`config/l1_thresholds.yaml`:

```yaml
# L1 Advisory Layer - é˜ˆå€¼é…ç½®æ–‡ä»¶

# ==================
# Symbol Universeï¼ˆå¸ç§å®‡å®™ï¼‰
# ==================
symbol_universe:
  enabled_symbols:
    - AIA    # AIA
    - GPS    # GPS
    - ETH    # ä»¥å¤ªåŠ
  default_symbol: AIA

# ==================
# æ•°æ®è´¨é‡é˜ˆå€¼
# ==================
data_quality:
  max_staleness_seconds: 120      # æ•°æ®æœ€å¤§è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰

# ==================
# å†³ç­–é¢‘ç‡æ§åˆ¶ï¼ˆPR-Cï¼‰
# ==================
decision_control:
  min_decision_interval_seconds: 300  # æœ€å°å†³ç­–é—´éš”ï¼ˆ5åˆ†é’Ÿï¼‰
  flip_cooldown_seconds: 600          # ç¿»è½¬å†·å´ï¼ˆ10åˆ†é’Ÿï¼‰
  enable_min_interval: true
  enable_flip_cooldown: true

# ==================
# å¸‚åœºç¯å¢ƒè¯†åˆ«é˜ˆå€¼
# ==================
market_regime:
  extreme_price_change_1h: 5.0    # 1å°æ—¶ä»·æ ¼å˜åŒ– > 5% â†’ EXTREME
  trend_price_change_6h: 3.0      # 6å°æ—¶ä»·æ ¼å˜åŒ– > 3% â†’ TREND

# ==================
# é£é™©å‡†å…¥é˜ˆå€¼
# ==================
risk_exposure:
  liquidation:
    price_change: 5.0             # ä»·æ ¼å˜åŒ–é˜ˆå€¼(%)
    oi_drop: -15.0                # OIä¸‹é™é˜ˆå€¼(%)
  crowding:
    funding_abs: 0.001            # è´¹ç‡ç»å¯¹å€¼é˜ˆå€¼ï¼ˆ0.1%ï¼‰
    oi_growth: 30.0               # 6h OIå¢é•¿é˜ˆå€¼(%)
  extreme_volume:
    multiplier: 10.0              # 1hæˆäº¤é‡è¶…è¿‡24hå‡å€¼çš„å€æ•°

# ==================
# äº¤æ˜“è´¨é‡é˜ˆå€¼
# ==================
trade_quality:
  absorption:
    imbalance: 0.7                # ä¹°å–å¤±è¡¡é˜ˆå€¼
    volume_ratio: 0.5             # æˆäº¤é‡æ¯”ä¾‹ï¼ˆç›¸å¯¹äº24hå‡å€¼ï¼‰
  noise:
    funding_volatility: 0.0005    # è´¹ç‡æ³¢åŠ¨é˜ˆå€¼ï¼ˆ0.05%ï¼‰
    funding_abs: 0.0001           # å½“å‰è´¹ç‡é˜ˆå€¼ï¼ˆ0.01%ï¼‰
  rotation:
    price_threshold: 2.0          # ä»·æ ¼å˜åŒ–é˜ˆå€¼(%)
    oi_threshold: 5.0             # OIå˜åŒ–é˜ˆå€¼(%)
  range_weak:
    imbalance: 0.6                # å¤±è¡¡é˜ˆå€¼
    oi: 10.0                      # OIå˜åŒ–é˜ˆå€¼(%)

# ==================
# æ–¹å‘è¯„ä¼°é˜ˆå€¼
# ==================
direction:
  trend:
    long:
      imbalance: 0.6              # ä¹°å–å¤±è¡¡é˜ˆå€¼ï¼ˆå¤šæ–¹ï¼‰
      oi_change: 5.0              # 1h OIå¢é•¿é˜ˆå€¼(%)
      price_change: 1.0           # 1hä»·æ ¼ä¸Šæ¶¨é˜ˆå€¼(%)
    short:
      imbalance: 0.6              # ä¹°å–å¤±è¡¡é˜ˆå€¼ï¼ˆç©ºæ–¹ï¼Œç»å¯¹å€¼ï¼‰
      oi_change: 5.0              # 1h OIå¢é•¿é˜ˆå€¼(%)
      price_change: 1.0           # 1hä»·æ ¼ä¸‹è·Œé˜ˆå€¼(%)ï¼ˆç»å¯¹å€¼ï¼‰
  range:
    long:
      imbalance: 0.7              # æ›´é«˜çš„å¤±è¡¡è¦æ±‚
      oi_change: 10.0             # æ›´é«˜çš„OIå¢é•¿è¦æ±‚
    short:
      imbalance: 0.7
      oi_change: 10.0

# ==================
# ç½®ä¿¡åº¦é…ç½®ï¼ˆPR-Dæ··åˆæ¨¡å¼ï¼‰
# ==================
confidence_scoring:
  # åŸºç¡€åˆ†ï¼ˆä¿æŒç°æœ‰è¯„åˆ†ä½“ç³»ï¼‰
  decision_score: 30
  regime_trend_score: 30
  regime_range_score: 10
  regime_extreme_score: 0
  quality_good_score: 30
  quality_uncertain_score: 15      # UNCERTAINé™çº§
  quality_poor_score: 0
  strong_signal_bonus: 10
  
  # æ¡£ä½æ˜ å°„
  thresholds:
    ultra: 90                      # â‰¥90åˆ† â†’ ULTRA
    high: 65                       # â‰¥65åˆ† â†’ HIGH
    medium: 40                     # â‰¥40åˆ† â†’ MEDIUM
  
  # ç¡¬é™çº§ä¸Šé™ï¼ˆcapsï¼‰
  caps:
    uncertain_quality_max: "MEDIUM"
    tag_caps:
      noisy_market: "MEDIUM"
      weak_signal_in_range: "MEDIUM"
  
  # å¼ºä¿¡å·çªç ´
  strong_signal_boost:
    enabled: true
    boost_levels: 1
    required_tags:
      - strong_buy_pressure
      - strong_sell_pressure

# ==================
# ReasonTagåˆ†ç±»è§„åˆ™ï¼ˆPR-Dï¼‰
# ==================
reason_tag_rules:
  reduce_tags:
    - noisy_market
    - weak_signal_in_range
  deny_tags:
    - liquidation_phase
    - crowding_risk
    - extreme_volume
    - data_stale
    - extreme_regime
    - absorption_risk
    - rotation_risk

# ==================
# çŠ¶æ€æœºé…ç½®
# ==================
state_machine:
  cool_down_minutes: 60           # å†·å´æœŸæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  signal_timeout_minutes: 30      # ä¿¡å·è¶…æ—¶æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
```

### 9.2 é…ç½®çƒ­æ›´æ–°

ç³»ç»Ÿä½¿ç”¨Watchdogç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼ˆæ— éœ€é‡å¯æœåŠ¡ï¼‰ã€‚

---

## 10. Webç•Œé¢

### 10.1 ç•Œé¢ç»„æˆ

**v3.0ç®€åŒ–ç‰ˆ**ï¼ˆåˆ é™¤å¸‚åœºæ•°æ®æ¦‚è§ˆï¼‰ï¼š

1. **å¤´éƒ¨** - ç³»ç»Ÿæ ‡é¢˜ã€æœ€åæ›´æ–°æ—¶é—´ã€åˆ·æ–°æŒ‰é’®
2. **å¸ç§é€‰æ‹©** - AIAã€GPSã€ETHæŒ‰é’®åˆ‡æ¢
3. **æ ¸å¿ƒå†³ç­–ä¿¡å·** - å†³ç­–æ–¹å‘ã€ç½®ä¿¡åº¦ã€æ—¶é—´æˆ³
4. **å®‰å…¨é—¸é—¨çŠ¶æ€** - é£é™©å‡†å…¥ã€äº¤æ˜“è´¨é‡ã€å¸‚åœºç¯å¢ƒã€ç³»ç»ŸçŠ¶æ€
5. **å†³ç­–åŸå› æ ‡ç­¾** - åˆ†ç±»å±•ç¤ºã€é¢œè‰²æ ‡è¯†
6. **å†å²å†³ç­–è®°å½•** - æœ€è¿‘30æ¡ã€å¯æŠ˜å å±•å¼€
7. **å†³ç­–ç®¡é“å¯è§†åŒ–** - 8æ­¥æµç¨‹çŠ¶æ€
8. **é¡µè„šä¿¡æ¯** - ç³»ç»Ÿè¯´æ˜ã€é£é™©æç¤º

**å·²åˆ é™¤**ï¼š
- âŒ å¸‚åœºæ•°æ®æ¦‚è§ˆï¼ˆä»·æ ¼ã€æˆäº¤é‡ã€èµ„é‡‘è´¹ç‡ç­‰8ä¸ªæ•°æ®å¡ç‰‡ï¼‰

### 10.2 è®¿é—®åœ°å€

- **æœ¬åœ°**: http://localhost:8001/
- **AWS**: http://43.212.176.169:8001/

### 10.3 è‡ªåŠ¨åˆ·æ–°

- åˆ·æ–°å‘¨æœŸ: 60ç§’
- å¯æ‰‹åŠ¨åˆ·æ–°

---

## 11. APIæ¥å£

### 11.1 æ ¸å¿ƒæ¥å£

#### 11.1.1 è·å–å†³ç­–å»ºè®®

```http
GET /api/l1/advisory/{symbol}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "decision": "no_trade",
    "confidence": "low",
    "market_regime": "range",
    "system_state": "wait",
    "risk_exposure_allowed": false,
    "trade_quality": "poor",
    "reason_tags": [
      "weak_signal_in_range"
    ],
    "timestamp": "2026-01-20T21:48:45.123456",
    "executable": false
  },
  "message": "Advisory generated successfully"
}
```

#### 11.1.2 è·å–å¸ç§åˆ—è¡¨

```http
GET /api/markets
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "markets": {
      "AIA": {"futures": true, "spot": false},
      "GPS": {"futures": true, "spot": false},
      "ETH": {"futures": true, "spot": false}
    },
    "default_symbol": "AIA"
  }
}
```

#### 11.1.3 è·å–å†³ç­–ç®¡é“

```http
GET /api/l1/pipeline/{symbol}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "steps": [
      {
        "step": 1,
        "name": "validate_data",
        "status": "success",
        "message": "æ•°æ®éªŒè¯é€šè¿‡",
        "result": "Valid"
      },
      {
        "step": 7,
        "name": "decision_control",
        "status": "failed",
        "message": "é¢‘ç‡æ§åˆ¶é˜»æ–­ï¼šmin_interval_block",
        "result": "Blocked"
      }
    ]
  }
}
```

---

## 12. éƒ¨ç½²æ¶æ„

### 12.1 éƒ¨ç½²ç¯å¢ƒ

| ç¯å¢ƒ | åœ°å€ | çŠ¶æ€ | ç”¨é€” |
|------|------|------|------|
| **æœ¬åœ°å¼€å‘** | localhost:8001 | æŒ‰éœ€å¯åŠ¨ | å¼€å‘è°ƒè¯•ã€æµ‹è¯• |
| **AWSç”Ÿäº§** | 43.212.176.169:8001 | æŒç»­è¿è¡Œ | ç”Ÿäº§æœåŠ¡ |

### 12.2 Dockeréƒ¨ç½²

#### æœ¬åœ°éƒ¨ç½²

```bash
# å¯åŠ¨æœåŠ¡
./docker-l1-run.sh

# åœæ­¢æœåŠ¡
./docker-l1-stop.sh

# æŸ¥çœ‹æ—¥å¿—
docker logs -f l1-advisory-layer

# é‡å¯æœåŠ¡
docker compose -f docker-compose-l1.yml restart
```

#### AWSéƒ¨ç½²

```bash
# åŒæ­¥ä»£ç 
rsync -avz --exclude 'data/db/*.db' \
  -e "ssh -i ../john-test.pem" \
  ./ ubuntu@43.212.176.169:~/trade-info-l1/

# SSHç™»å½•
ssh -i ../john-test.pem ubuntu@43.212.176.169

# éƒ¨ç½²æœåŠ¡
cd ~/trade-info-l1
docker compose -f docker-compose-l1.yml down
docker compose -f docker-compose-l1.yml build
docker compose -f docker-compose-l1.yml up -d

# æŸ¥çœ‹çŠ¶æ€
docker ps
docker logs -f l1-advisory-layer
```

### 12.3 æ•°æ®æŒä¹…åŒ–

```
./data/db/
â”œâ”€â”€ l1_advisory_results.db    # å†³ç­–ç»“æœæ•°æ®åº“
â””â”€â”€ l1_advisory_results.db-wal  # WALæ—¥å¿—

./config/
â””â”€â”€ l1_thresholds.yaml        # é…ç½®æ–‡ä»¶ï¼ˆçƒ­æ›´æ–°ï¼‰
```

---

## 13. æµ‹è¯•è¦†ç›–

### 13.1 æµ‹è¯•åˆ—è¡¨

| PR | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ•°é‡ | çŠ¶æ€ |
|----|---------|---------|------|
| **PR-001** | test_pr_batch1.py | 1 | âœ… |
| **PR-002** | test_pr_batch1.py | 1 | âœ… |
| **PR-003** | test_pr_batch1.py | 1 | âœ… |
| **PR-004** | test_pr_batch2.py | 1 | âœ… |
| **PR-005** | test_pr_batch2.py | 1 | âœ… |
| **PR-006** | test_pr_batch2.py | 1 | âœ… |
| **PR-007** | test_pr_batch3.py | 1 | âœ… |
| **PR-008** | test_pr_batch3.py | 1 | âœ… |
| **PR-009** | test_pr_batch3.py | 1 | âœ… |
| **PR-010** | test_pr_batch3.py | 1 | âœ… |
| **PR-B** | test_pr_b_trade_quality.py | 7 | âœ… |
| **PR-C** | test_pr_c_decision_control.py | 4 | âœ… |
| **PR-D** | test_pr_d_confidence_hybrid.py | 7 | âœ… |
| **PR-Aä¿®å¤** | test_decimal_calibration.py | 5 | âœ… |
| **æ€»è®¡** | - | **33** | âœ… |

### 13.2 æµ‹è¯•å‘½ä»¤

```bash
# åœ¨Dockerå®¹å™¨ä¸­è¿è¡Œ
docker exec l1-advisory-layer python tests/test_pr_b_trade_quality.py
docker exec l1-advisory-layer python tests/test_pr_c_decision_control.py
docker exec l1-advisory-layer python tests/test_pr_d_confidence_hybrid.py

# æˆ–æ‰¹é‡è¿è¡Œ
docker exec l1-advisory-layer bash -c "
  python tests/test_pr_b_trade_quality.py && \
  python tests/test_pr_c_decision_control.py && \
  python tests/test_pr_d_confidence_hybrid.py
"
```

### 13.3 æµ‹è¯•è¦†ç›–ç‡

```
æ ¸å¿ƒåŠŸèƒ½è¦†ç›–:
  - æ•°æ®éªŒè¯: âœ…
  - å¸‚åœºç¯å¢ƒè¯†åˆ«: âœ…
  - é£é™©å‡†å…¥: âœ…
  - è´¨é‡è¯„ä¼°: âœ…
  - æ–¹å‘è¯„ä¼°: âœ…
  - å†³ç­–é¢‘ç‡æ§åˆ¶: âœ… (PR-C)
  - ç½®ä¿¡åº¦è®¡ç®—: âœ… (PR-D)
  - executableåˆ¤å®š: âœ… (PR-B)
  - ç®¡é“è¿½æº¯: âœ…
  - å¤šå¸ç§æ”¯æŒ: âœ…

PR-Bä¸“é¡¹æµ‹è¯•:
  âœ… ExecutabilityLevelæ˜ å°„
  âœ… has_blocking_tagså‡½æ•°
  âœ… has_degrading_tagså‡½æ•°
  âœ… POORè´¨é‡ç¡¬çŸ­è·¯
  âœ… UNCERTAINè´¨é‡é™çº§
  âœ… é™çº§æ ‡ç­¾é™åˆ¶ç½®ä¿¡åº¦
  âœ… executableç»¼åˆåˆ¤å®š

PR-Cä¸“é¡¹æµ‹è¯•:
  âœ… DecisionMemoryåŸºæœ¬åŠŸèƒ½
  âœ… æœ€å°é—´éš”é˜»æ–­
  âœ… ç¿»è½¬å†·å´é˜»æ–­
  âœ… ç¦ç”¨æ§åˆ¶åŠŸèƒ½

PR-Dä¸“é¡¹æµ‹è¯•:
  âœ… åŸºç¡€åŠ åˆ†åˆ¶
  âœ… UNCERTAINè´¨é‡ä¸Šé™
  âœ… é™çº§æ ‡ç­¾ä¸Šé™
  âœ… å¼ºä¿¡å·çªç ´
  âœ… å¼ºä¿¡å·æ— æ³•çªç ´cap
  âœ… ç½®ä¿¡åº¦æ¡£ä½æ¯”è¾ƒ
  âœ… å­—ç¬¦ä¸²è½¬ç½®ä¿¡åº¦
```

---

## 14. ä½¿ç”¨æŒ‡å—

### 14.1 å¿«é€Ÿå¼€å§‹

#### æœ¬åœ°éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
cd /path/to/trade-info

# 2. å¯åŠ¨æœåŠ¡
./docker-l1-run.sh

# 3. è®¿é—®Webç•Œé¢
open http://localhost:8001

# 4. æµ‹è¯•API
curl http://localhost:8001/api/l1/advisory/AIA
```

#### AWSè®¿é—®

```bash
# ç›´æ¥è®¿é—®
open http://43.212.176.169:8001

# æˆ–ä½¿ç”¨curl
curl http://43.212.176.169:8001/api/l1/advisory/AIA
```

### 14.2 é…ç½®è°ƒæ•´

#### ä¿®æ”¹å¸ç§åˆ—è¡¨

ç¼–è¾‘ `config/l1_thresholds.yaml`:

```yaml
symbol_universe:
  enabled_symbols:
    - AIA    # æ”¹ä¸ºä½ çš„å¸ç§
    - GPS
    - ETH
  default_symbol: AIA  # æ”¹ä¸ºé»˜è®¤å¸ç§
```

é‡å¯æœåŠ¡ï¼š
```bash
docker compose -f docker-compose-l1.yml restart
```

#### è°ƒæ•´å†³ç­–é¢‘ç‡æ§åˆ¶

```yaml
decision_control:
  min_decision_interval_seconds: 300  # æ”¹ä¸ºä½ çš„é—´éš”ï¼ˆç§’ï¼‰
  flip_cooldown_seconds: 600          # æ”¹ä¸ºä½ çš„å†·å´ï¼ˆç§’ï¼‰
  enable_min_interval: true           # æ˜¯å¦å¯ç”¨
  enable_flip_cooldown: true
```

æ”¯æŒçƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯ã€‚

#### è°ƒæ•´ç½®ä¿¡åº¦è§„åˆ™

```yaml
confidence_scoring:
  # ä¿®æ”¹åŸºç¡€åˆ†
  quality_uncertain_score: 15  # UNCERTAINçš„åˆ†æ•°
  
  # ä¿®æ”¹capè§„åˆ™
  caps:
    uncertain_quality_max: "MEDIUM"  # æ”¹ä¸ºHIGHå…è®¸æ›´é«˜
  
  # ä¿®æ”¹å¼ºä¿¡å·çªç ´
  strong_signal_boost:
    enabled: true
    boost_levels: 1  # æ”¹ä¸º2æå‡2æ¡£
```

æ”¯æŒçƒ­æ›´æ–°ã€‚

### 14.3 ç›‘æ§ä¸æ—¥å¿—

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker logs -f l1-advisory-layer

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
docker logs --tail 100 l1-advisory-layer

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker ps --filter "name=l1-advisory-layer"

# æŸ¥çœ‹å¥åº·çŠ¶æ€
docker inspect l1-advisory-layer | grep -A 5 Health
```

### 14.4 æ•…éšœæ’æŸ¥

#### é—®é¢˜1: æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8001

# æ£€æŸ¥DockerçŠ¶æ€
docker ps -a

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker logs l1-advisory-layer
```

#### é—®é¢˜2: å¸ç§æ— æ³•é€‰æ‹©

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat config/l1_thresholds.yaml | grep -A 5 symbol_universe

# æ£€æŸ¥APIå“åº”
curl http://localhost:8001/api/markets

# é‡æ–°æ„å»ºé•œåƒ
docker compose -f docker-compose-l1.yml build
```

#### é—®é¢˜3: å†³ç­–æ€»æ˜¯NO_TRADE

```bash
# æŸ¥çœ‹å†³ç­–ç®¡é“
curl http://localhost:8001/api/l1/pipeline/AIA | python3 -m json.tool

# æ£€æŸ¥ReasonTag
curl http://localhost:8001/api/l1/advisory/AIA | python3 -c "
import sys, json
d = json.load(sys.stdin)
print('ReasonTags:', d['data']['reason_tags'])
"

# æŸ¥çœ‹é¢‘ç‡æ§åˆ¶
# å¦‚æœæœ‰MIN_INTERVAL_BLOCKæˆ–FLIP_COOLDOWN_BLOCKï¼Œç­‰å¾…å†·å´æ—¶é—´è¿‡å»
```

### 14.5 å¼€å‘æµç¨‹

```
1. æœ¬åœ°å¼€å‘è°ƒè¯•
   - ä¿®æ”¹ä»£ç 
   - ./docker-l1-stop.sh
   - docker compose -f docker-compose-l1.yml build
   - ./docker-l1-run.sh
   - æµ‹è¯•éªŒè¯

2. è¿è¡Œæµ‹è¯•
   - docker exec l1-advisory-layer python tests/test_xxx.py

3. æäº¤ä»£ç 
   - git add .
   - git commit -m "æè¿°"
   - ï¼ˆä¸è‡ªåŠ¨æ¨é€åˆ°GitHubï¼Œå¬ä»æŒ‡ä»¤ï¼‰

4. éƒ¨ç½²åˆ°AWSï¼ˆæŒ‰éœ€ï¼‰
   - rsyncåŒæ­¥ä»£ç 
   - SSHç™»å½•AWS
   - é‡æ–°æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
```

---

## 15. é™„å½•

### 15.1 æšä¸¾å®šä¹‰

#### Decision
```python
class Decision(Enum):
    LONG = "long"        # åšå¤šå»ºè®®
    SHORT = "short"      # åšç©ºå»ºè®®
    NO_TRADE = "no_trade"  # ä¸äº¤æ˜“
```

#### Confidence
```python
class Confidence(Enum):
    ULTRA = "ultra"      # è¶…é«˜ç½®ä¿¡åº¦ï¼ˆâ‰¥90åˆ†ï¼‰
    HIGH = "high"        # é«˜ç½®ä¿¡åº¦ï¼ˆ65-89åˆ†ï¼‰
    MEDIUM = "medium"    # ä¸­ç½®ä¿¡åº¦ï¼ˆ40-64åˆ†ï¼‰
    LOW = "low"          # ä½ç½®ä¿¡åº¦ï¼ˆ<40åˆ†ï¼‰
```

#### TradeQuality
```python
class TradeQuality(Enum):
    GOOD = "good"            # è‰¯å¥½è´¨é‡
    UNCERTAIN = "uncertain"  # ä¸ç¡®å®šï¼ˆå™ªå£°ï¼‰
    POOR = "poor"            # å·®è´¨é‡ï¼ˆé£é™©ï¼‰
```

#### MarketRegime
```python
class MarketRegime(Enum):
    TREND = "trend"      # è¶‹åŠ¿å¸‚
    RANGE = "range"      # éœ‡è¡å¸‚
    EXTREME = "extreme"  # æç«¯å¸‚
```

#### SystemState
```python
class SystemState(Enum):
    INIT = "init"        # åˆå§‹åŒ–
    WAIT = "wait"        # ç­‰å¾…çŠ¶æ€ï¼ˆL1ä¸»è¦çŠ¶æ€ï¼‰
    # LONG_ACTIVE = "long_active"    # L1ä¸ç»´æŠ¤
    # SHORT_ACTIVE = "short_active"  # L1ä¸ç»´æŠ¤
    # COOL_DOWN = "cool_down"        # L1ä¸ç»´æŠ¤
```

#### ExecutabilityLevel (PR-B)
```python
class ExecutabilityLevel(Enum):
    ALLOW = "allow"      # å…è®¸æ‰§è¡Œ
    DEGRADE = "degrade"  # é™çº§ä½†å…è®¸
    BLOCK = "block"      # é˜»æ–­æ‰§è¡Œ
```

### 15.2 å®Œæ•´ReasonTagåˆ—è¡¨ï¼ˆv3.0ï¼‰

```python
# æ•°æ®éªŒè¯
INVALID_DATA = "invalid_data"
DATA_STALE = "data_stale"

# é£é™©å¦å†³ç±»
EXTREME_REGIME = "extreme_regime"
LIQUIDATION_PHASE = "liquidation_phase"
CROWDING_RISK = "crowding_risk"
EXTREME_VOLUME = "extreme_volume"

# è´¨é‡å¦å†³ç±»
ABSORPTION_RISK = "absorption_risk"
NOISY_MARKET = "noisy_market"
ROTATION_RISK = "rotation_risk"
WEAK_SIGNAL_IN_RANGE = "weak_signal_in_range"

# æ–¹å‘å†²çªç±»
CONFLICTING_SIGNALS = "conflicting_signals"
NO_CLEAR_DIRECTION = "no_clear_direction"

# çŠ¶æ€æœºçº¦æŸç±»
COOL_DOWN_ACTIVE = "cool_down_active"
STATE_TRANSITION_DENIED = "state_transition_denied"

# å†³ç­–é¢‘ç‡æ§åˆ¶ç±»ï¼ˆPR-Cï¼‰
MIN_INTERVAL_BLOCK = "min_interval_block"
FLIP_COOLDOWN_BLOCK = "flip_cooldown_block"

# è¾…åŠ©ä¿¡æ¯ç±»
HIGH_FUNDING_RATE = "high_funding_rate"
LOW_FUNDING_RATE = "low_funding_rate"
STRONG_BUY_PRESSURE = "strong_buy_pressure"
STRONG_SELL_PRESSURE = "strong_sell_pressure"
OI_GROWING = "oi_growing"
OI_DECLINING = "oi_declining"
```

### 15.3 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¸»è¦æ›´æ–° |
|------|------|---------|
| **v1.0** | 2025-12 | åŸºç¡€å†³ç­–ç³»ç»Ÿã€3æ¡£ç½®ä¿¡åº¦ã€2æ¡£è´¨é‡ |
| **v2.0** | 2026-01-19 | 10ä¸ªPRä¼˜åŒ–ã€4æ¡£ç½®ä¿¡åº¦ã€3æ¡£è´¨é‡ã€å¤šå¸ç§ã€AWSéƒ¨ç½² |
| **v3.0** | 2026-01-20 | PR-B/C/Då¢å¼ºã€ExecutabilityLevelã€é¢‘ç‡æ§åˆ¶ã€ç½®ä¿¡åº¦æ··åˆæ¨¡å¼ |

### 15.4 å¼€å‘å›¢é˜Ÿä¸è”ç³»

- **ç³»ç»Ÿæ¶æ„**: L1 Advisory Layer
- **å¼€å‘è¯­è¨€**: Python 3.12
- **æ¡†æ¶**: Flask + Docker
- **éƒ¨ç½²**: AWS EC2
- **æ–‡æ¡£ç‰ˆæœ¬**: 3.0
- **æœ€åæ›´æ–°**: 2026-01-20

---

## ğŸ“Œ æ€»ç»“

### v3.0æ ¸å¿ƒäº®ç‚¹

**ğŸ”´ æœ€é‡è¦ï¼šPR-Aå£å¾„ä¿®å¤ï¼ˆç³»ç»Ÿæ€§é”™è¯¯ï¼‰**
- ç»Ÿä¸€é…ç½®å£å¾„ä¸ºå°æ•°æ ¼å¼ï¼ˆ0.05=5%ï¼‰
- ä¿®å¤æ–¹å‘è¯„ä¼°ä»æœªè§¦å‘çš„è‡´å‘½Bug
- ä¿®å¤å¸‚åœºç¯å¢ƒè¯†åˆ«å¼‚å¸¸
- **é¦–æ¬¡æˆåŠŸè§¦å‘LONG/SHORTå†³ç­–**
- æµ‹è¯•éªŒè¯ï¼šå¼ºTREND+å¼ºLONG â†’ decision=LONG, confidence=ULTRA, executable=True

1. **PR-B: è´¨é‡è¯­ä¹‰é’‰æ­»**
   - ExecutabilityLevelä¸‰çº§æ§åˆ¶ï¼ˆALLOW/DEGRADE/BLOCKï¼‰
   - 23ä¸ªReasonTagç²¾ç»†æ˜ å°„
   - POORç¡¬çŸ­è·¯ã€UNCERTAINé™çº§æ‰§è¡Œ
   - executableç»¼åˆåˆ¤å®šï¼ˆ5ä¸ªç»´åº¦ï¼‰

2. **PR-C: å†³ç­–é¢‘ç‡æ§åˆ¶**
   - DecisionMemoryè½»é‡çº§ç®¡ç†
   - æœ€å°é—´éš”ï¼ˆ300sï¼‰+ ç¿»è½¬å†·å´ï¼ˆ600sï¼‰
   - å¤šå¸ç§ç‹¬ç«‹æ§åˆ¶
   - å¯é…ç½®å¼€å…³

3. **PR-D: ç½®ä¿¡åº¦æ··åˆæ¨¡å¼**
   - ä¸‰æ­¥æµç¨‹ï¼šåŠ åˆ† â†’ cap â†’ boost
   - UNCERTAINâ‰¤MEDIUMã€é™çº§æ ‡ç­¾â‰¤MEDIUM
   - å¼ºä¿¡å·+1æ¡£ï¼ˆä½†ä¸çªç ´capï¼‰
   - å®Œå…¨é…ç½®åŒ–

4. **å®šåˆ¶åŒ–ä¼˜åŒ–**
   - å¸ç§ï¼šAIAã€GPSã€ETH
   - å‰ç«¯ç®€åŒ–ï¼šåˆ é™¤å¸‚åœºæ•°æ®æ¦‚è§ˆ
   - æµ‹è¯•è¦†ç›–ï¼š28ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

5. **ç”Ÿäº§å°±ç»ª**
   - æœ¬åœ°å¼€å‘ç¯å¢ƒ
   - AWSç”Ÿäº§ç¯å¢ƒ
   - Dockerå®¹å™¨åŒ–
   - é…ç½®çƒ­æ›´æ–°

---

**L1 Advisory Layer v3.0 - æ›´æ™ºèƒ½ã€æ›´å®‰å…¨ã€æ›´å¯æ§çš„äº¤æ˜“å†³ç­–å’¨è¯¢ç³»ç»Ÿï¼** ğŸš€
