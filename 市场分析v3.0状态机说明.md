# å¸‚åœºåˆ†æ v3.0 çŠ¶æ€æœºè¯´æ˜

## ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: v3.0ï¼ˆçŠ¶æ€æœºæ¶æ„ï¼‰
- **æ›´æ–°æ—¥æœŸ**: 2026-01-20
- **æ¶æ„å˜åŒ–**: ä»æ— çŠ¶æ€åˆ†æ â†’ æœ‰çŠ¶æ€çŠ¶æ€æœº

---

## æ ¸å¿ƒè®¾è®¡çº¦æŸ

> **è¿™æ˜¯ä¸€ä¸ª"æœ‰è®°å¿†ã€æœ‰è€å¿ƒã€ä¼šæ‹’ç»äº¤æ˜“"çš„çŠ¶æ€æœºï¼Œä¸æ˜¯ä¿¡å·æ‰«æå™¨ã€‚**

### å››å¤§é“å¾‹

1. **ç³»ç»Ÿæ˜¯çŠ¶æ€æœºï¼Œä¸æ˜¯ä¸€æ¬¡æ€§åˆ¤æ–­å™¨**
2. **æ‰€æœ‰ä¿¡å·å¿…é¡»ç»è¿‡ System_State**
3. **æ‰€æœ‰é˜ˆå€¼è§£é‡Šå¿…é¡»æœä» Market_Regime**
4. **ä»»ä¸€å¼‚å¸¸ï¼Œé»˜è®¤ NO_TRADE**

---

## æ¶æ„å¯¹æ¯”

| ç»´åº¦ | v2.0ï¼ˆè§„åˆ™ç‰ˆï¼‰ | v3.0ï¼ˆçŠ¶æ€æœºç‰ˆï¼‰ |
|------|---------------|-----------------|
| **æ¶æ„** | æ— çŠ¶æ€åˆ†æ | æœ‰çŠ¶æ€çŠ¶æ€æœº |
| **è®°å¿†** | âŒ æ— è®°å¿† | âœ… æŒä¹…åŒ–çŠ¶æ€ |
| **çŠ¶æ€è½¬æ¢** | ç›´æ¥è¾“å‡ºå†³ç­– | çŠ¶æ€é©±åŠ¨å†³ç­– |
| **æ–¹å‘åˆ‡æ¢** | å¯ç›´æ¥åˆ‡æ¢ | å¿…é¡»ç»è¿‡WAIT |
| **å¼‚å¸¸å¤„ç†** | å³æ—¶åˆ¤æ–­ | è¿›å…¥COOL_DOWN |
| **å¸‚åœºç¯å¢ƒ** | éšå¼åˆ¤æ–­ | æ˜¾å¼Regime |
| **å†·å´æœºåˆ¶** | âŒ æ—  | âœ… å¼ºåˆ¶ä¼‘çœ  |

---

## æšä¸¾å®šä¹‰

### 1. MarketRegimeï¼ˆå¸‚åœºç¯å¢ƒï¼‰

```python
class MarketRegime(Enum):
    TREND = "TREND"      # è¶‹åŠ¿å¸‚åœº
    RANGE = "RANGE"      # éœ‡è¡å¸‚åœº
    EXTREME = "EXTREME"  # æç«¯å¸‚åœº
```

**åˆ¤å®šé€»è¾‘ï¼š**

| ç¯å¢ƒ | æ¡ä»¶ | è¡Œä¸ºå½±å“ |
|------|------|----------|
| **EXTREME** | æ³¢åŠ¨ç‡ > 8% æˆ– æˆäº¤é‡ > å¹³å‡5å€ | å¼ºåˆ¶NO_TRADE + COOL_DOWN |
| **TREND** | ä»·æ ¼ç»“æ„è¿ç»­ + æ³¢åŠ¨ç‡æ­£å¸¸(1%-5%) | ä½¿ç”¨æ ‡å‡†é˜ˆå€¼ |
| **RANGE** | å…¶ä»–æƒ…å†µ | ä½¿ç”¨ä¸¥æ ¼é˜ˆå€¼ï¼ˆ1.5å€ï¼‰ |

---

### 2. SystemStateï¼ˆç³»ç»ŸçŠ¶æ€ï¼‰

```python
class SystemState(Enum):
    INIT = "INIT"                # åˆå§‹åŒ–
    WAIT = "WAIT"                # ç­‰å¾…ï¼ˆå¯ä»¥å¼€æ–¹å‘ï¼‰
    LONG_ACTIVE = "LONG_ACTIVE"  # åšå¤šçŠ¶æ€æ¿€æ´»
    SHORT_ACTIVE = "SHORT_ACTIVE" # åšç©ºçŠ¶æ€æ¿€æ´»
    COOL_DOWN = "COOL_DOWN"      # å†·å´æœŸï¼ˆå¼ºåˆ¶ä¼‘çœ ï¼‰
```

---

### 3. Decisionï¼ˆäº¤æ˜“å†³ç­–ï¼‰

```python
class Decision(Enum):
    LONG = "LONG"
    SHORT = "SHORT"
    NO_TRADE = "NO_TRADE"
```

---

## çŠ¶æ€æœºæµç¨‹å›¾

```
INIT
  â†“
WAIT â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â†“               â”‚
  â”œâ”€â†’ LONG_ACTIVE â”€â”¤
  â”‚                â”‚
  â””â”€â†’ SHORT_ACTIVE â”€â”¤
       â†“           â”‚
    COOL_DOWN â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ€è½¬æ¢è§„åˆ™

| å½“å‰çŠ¶æ€ | æ¡ä»¶ | ä¸‹ä¸€çŠ¶æ€ | å†³ç­– |
|---------|------|----------|------|
| **INIT** | ä»»æ„ | WAIT | NO_TRADE |
| **WAIT** | æ£€æµ‹åˆ°æç«¯/ç»“æ„å¤±è´¥ | WAIT | NO_TRADE |
| **WAIT** | æ»¡è¶³åšç©ºæ¡ä»¶ | SHORT_ACTIVE | SHORT |
| **WAIT** | æ»¡è¶³åšå¤šæ¡ä»¶ | LONG_ACTIVE | LONG |
| **LONG_ACTIVE** | ç»“æ„æ€§å¤±è´¥ | COOL_DOWN | NO_TRADE |
| **LONG_ACTIVE** | åšå¤šå¤±æ•ˆ | WAIT | NO_TRADE |
| **LONG_ACTIVE** | æ¡ä»¶ä¿æŒ | LONG_ACTIVE | LONG |
| **SHORT_ACTIVE** | ç»“æ„æ€§å¤±è´¥ | COOL_DOWN | NO_TRADE |
| **SHORT_ACTIVE** | åšç©ºå¤±æ•ˆ | WAIT | NO_TRADE |
| **SHORT_ACTIVE** | æ¡ä»¶ä¿æŒ | SHORT_ACTIVE | SHORT |
| **COOL_DOWN** | å†·å´è®¡æ•° > 0 | COOL_DOWN | NO_TRADE |
| **COOL_DOWN** | å†·å´è®¡æ•° = 0 | WAIT | NO_TRADE |
| **ä»»æ„** | å¸‚åœºç¯å¢ƒ = EXTREME | COOL_DOWN | NO_TRADE |

### å…³é”®çº¦æŸ

1. **ç¦æ­¢ LONG_ACTIVE â†” SHORT_ACTIVE ç›´æ¥åˆ‡æ¢**
2. **ä»»ä½•å¼‚å¸¸ä¼˜å…ˆè¿›å…¥ COOL_DOWN**
3. **System_State ä¼˜å…ˆçº§ > Market Regime > Signal Rule**
4. **è¿”å›å€¼æ˜¯"ç³»ç»Ÿæ€åº¦"ï¼Œä¸æ˜¯äº¤æ˜“æŒ‡ä»¤**

---

## æ ¸å¿ƒåˆ¤æ–­é€»è¾‘

### 1. Market Regime åˆ¤å®šï¼ˆç¯å¢ƒåˆ¤æ–­ï¼‰

```python
def detect_market_regime(data):
    if volatility > 8% or volume > volume_avg * 5:
        return EXTREME  # æç«¯å¸‚åœº
    
    if price_structure_continuous and 1% <= volatility <= 5%:
        return TREND  # è¶‹åŠ¿å¸‚åœº
    
    return RANGE  # éœ‡è¡å¸‚åœº
```

---

### 2. ç»“æ„æ€§å¤±è´¥æ£€æµ‹ï¼ˆä¿æŠ¤æœºåˆ¶ï¼‰

```python
def detect_structural_failure(data):
    # OI æç«¯æ³¢åŠ¨ï¼ˆ6hå˜åŒ– > 30%ï¼‰
    if abs(oi_delta_rate) > 0.30:
        return True
    
    # èµ„é‡‘è´¹ç‡æç«¯ï¼ˆ> 0.5%ï¼‰
    if abs(funding_rate) > 0.005:
        return True
    
    # å¤šä¸ªæ ¸å¿ƒæŒ‡æ ‡èƒŒç¦»
    # ä¾‹å¦‚ï¼šä»·æ ¼æ¶¨ä½†OIå’Œæˆäº¤é‡éƒ½è·Œ
    if price_trend > 2% and oi_change < -10% and volume_change < -10%:
        return True
    
    return False
```

---

### 3. åšå¤šæ¡ä»¶ï¼ˆLONGï¼‰

**æ ¸å¿ƒé€»è¾‘**: æ–°å¤šå¤´æ˜¯å¦åœ¨æ›´é«˜ä»·ä½æŒç»­è¿›åœº

```python
def allow_long(data, market_regime):
    if market_regime == EXTREME:
        return False
    
    # RANGEå¸‚åœºä½¿ç”¨æ›´ä¸¥æ ¼é˜ˆå€¼
    volume_threshold = 1.5 * (1.5 if market_regime == RANGE else 1.0)
    buy_ratio_threshold = 0.60 * (1.1 if market_regime == RANGE else 1.0)
    
    return (
        volume > volume_avg * volume_threshold  # çªç ´æ”¾é‡
        and oi_delta > 0                        # OIå¢é•¿
        and oi_delta_rate < 0.30                # OIå¢é•¿ä¸æç«¯
        and -0.05% <= funding_rate <= 0.1%      # èµ„é‡‘è´¹ç‡å¥åº·
        and aggressive_buy_ratio >= buy_ratio_threshold  # ä¹°å•ä¸»å¯¼
    )
```

---

### 4. åšç©ºæ¡ä»¶ï¼ˆSHORTï¼‰

**æ ¸å¿ƒé€»è¾‘**: å¤šå¤´æ˜¯å¦å·²ç»éš¾ä»¥ç»§ç»­å¸å¼•æ–°èµ„é‡‘

```python
def allow_short(data, market_regime):
    if market_regime == EXTREME:
        return False
    
    # RANGEå¸‚åœºä½¿ç”¨æ›´ä¸¥æ ¼é˜ˆå€¼
    sell_ratio_threshold = 0.60 * (1.1 if market_regime == RANGE else 1.0)
    
    return (
        price_trend_6h > 0 and volume < volume_avg * 0.7  # æ»æ¶¨ç¼©é‡
        and oi_delta > 0                                  # OIå †ç§¯
        and funding_rate > 0.2%                           # èµ„é‡‘è´¹ç‡è¿‡çƒ­
        and aggressive_buy_ratio < 0.45                   # ä¹°å•å¼±åŠ¿
    )
```

---

### 5. åšå¤šå¤±æ•ˆï¼ˆé€€å‡ºæ¡ä»¶ï¼‰

```python
def long_invalidation(data):
    return (
        price_trend_6h < -3%                # ä»·æ ¼è·Œç ´ç»“æ„
        or abs(funding_rate) > 0.5%         # èµ„é‡‘è´¹ç‡æç«¯
        or oi_change_6h < -20%              # OIå´©æºƒ
    )
```

---

### 6. åšç©ºå¤±æ•ˆï¼ˆé€€å‡ºæ¡ä»¶ï¼‰

```python
def short_invalidation(data):
    return (
        aggressive_sell_ratio < 0.40        # å–å‹è€—å°½
        or funding_rate < -0.1%             # èµ„é‡‘è´¹ç‡è½¬è´Ÿ
        or oi_change_6h < -20%              # OIå´©æºƒ
    )
```

---

## é…ç½®å‚æ•°

### Market Regime é˜ˆå€¼

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `VOLATILITY_EXTREME_THRESHOLD` | 0.08 | 8%æ³¢åŠ¨ç‡è®¤ä¸ºæç«¯ |
| `VOLUME_EXTREME_MULTIPLIER` | 5.0 | æˆäº¤é‡è¶…å¹³å‡5å€ |
| `VOLATILITY_NORMAL_RANGE` | (0.01, 0.05) | æ­£å¸¸æ³¢åŠ¨ç‡èŒƒå›´ |

### OI ç›¸å…³é˜ˆå€¼

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `OI_EXTREME_RATE` | 0.30 | OI 6hå˜åŒ–>30%æç«¯ |
| `OI_COLLAPSE_RATE` | -0.20 | OI 6hå˜åŒ–<-20%å´©æºƒ |

### èµ„é‡‘è´¹ç‡é˜ˆå€¼

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `FUNDING_RATE_HEALTHY_RANGE` | (-0.0005, 0.001) | å¥åº·èŒƒå›´ |
| `FUNDING_RATE_OVERHEATED` | 0.002 | è¿‡çƒ­é˜ˆå€¼ |
| `FUNDING_RATE_EXTREME` | 0.005 | æç«¯é˜ˆå€¼ |
| `FUNDING_RATE_NEGATIVE` | -0.001 | è´Ÿè´¹ç‡é˜ˆå€¼ |

### ä¹°å–åŠ›é‡é˜ˆå€¼

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `AGGRESSIVE_BUY_STRONG` | 0.60 | ä¹°å•å¼ºåŠ¿ |
| `AGGRESSIVE_BUY_WEAK` | 0.45 | ä¹°å•å¼±åŠ¿ |
| `AGGRESSIVE_SELL_STRONG` | 0.60 | å–å•å¼ºåŠ¿ |

### ç³»ç»Ÿä¿æŠ¤

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| `COOLDOWN_LENGTH` | 3 | å†·å´æœŸé•¿åº¦ï¼ˆå‘¨æœŸæ•°ï¼‰ |
| `RANGE_STRICTER_MULTIPLIER` | 1.5 | éœ‡è¡å¸‚åœºé˜ˆå€¼å€æ•° |

---

## çŠ¶æ€æŒä¹…åŒ–

### æ•°æ®åº“è¡¨ç»“æ„

```sql
CREATE TABLE system_state (
    symbol VARCHAR(10) PRIMARY KEY,
    system_state VARCHAR(20) NOT NULL,      -- INIT/WAIT/LONG_ACTIVE/SHORT_ACTIVE/COOL_DOWN
    market_regime VARCHAR(20) NOT NULL,     -- TREND/RANGE/EXTREME
    cooldown_counter INTEGER DEFAULT 0,     -- å†·å´è®¡æ•°å™¨
    last_decision VARCHAR(20),              -- LONG/SHORT/NO_TRADE
    state_entry_time DATETIME,              -- çŠ¶æ€è¿›å…¥æ—¶é—´
    last_update_time DATETIME,              -- æœ€åæ›´æ–°æ—¶é—´
    state_history TEXT,                     -- çŠ¶æ€å†å²ï¼ˆJSONï¼‰
    extra_data TEXT                         -- é¢å¤–æ•°æ®ï¼ˆJSONï¼‰
);
```

### æŸ¥è¯¢çŠ¶æ€

```bash
# æŸ¥çœ‹å½“å‰æ‰€æœ‰å¸ç§çš„çŠ¶æ€
docker exec trade-info-app python3 -c "
import sqlite3
conn = sqlite3.connect('market_state.db')
cursor = conn.cursor()
cursor.execute('SELECT symbol, system_state, market_regime, cooldown_counter, last_decision FROM system_state')
for row in cursor.fetchall():
    print(f'{row[0]}: State={row[1]}, Regime={row[2]}, Cooldown={row[3]}, Decision={row[4]}')
"
```

---

## API å“åº”æ ¼å¼

### v3.0 å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "symbol": "BTC",
  "analysis": {
    "trade_action": "NO_TRADE",
    "system_state": "COOL_DOWN",
    "market_regime": "EXTREME",
    "state_reason": "å¸‚åœºç¯å¢ƒæç«¯ï¼ˆEXTREMEï¼‰ï¼Œå¼ºåˆ¶è¿›å…¥å†·å´æœŸ",
    "data_summary": {
      "price": 93143.2,
      "price_change_24h": -0.02,
      "price_trend_6h": 0.13,
      "volume_change_6h": 0.34,
      "oi_change_6h": -0.0,
      "funding_rate": 0.0029,
      "buy_ratio_1h": 65.1,
      "sell_ratio_1h": 34.9,
      "total_amount_1h": 2760633.14
    },
    "detailed_analysis": [
      "ğŸ¤– ç³»ç»ŸçŠ¶æ€ï¼šCOOL_DOWN",
      "ğŸŒ å¸‚åœºç¯å¢ƒï¼šEXTREME",
      "ğŸ“Š äº¤æ˜“å†³ç­–ï¼šNO_TRADE",
      "ğŸ’¡ å†³ç­–åŸå› ï¼šå¸‚åœºç¯å¢ƒæç«¯ï¼ˆEXTREMEï¼‰ï¼Œå¼ºåˆ¶è¿›å…¥å†·å´æœŸ",
      "...",
      "ğŸ“‹ æ•°æ®æ‘˜è¦ï¼š",
      "ğŸ’¹ ä»·æ ¼ï¼š$93143.2000 (24h: -0.02%, 6h: +0.13%)",
      "..."
    ]
  }
}
```

### æ–°å¢å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `system_state` | string | ç³»ç»ŸçŠ¶æ€ï¼ˆv3.0æ–°å¢ï¼‰ |
| `market_regime` | string | å¸‚åœºç¯å¢ƒï¼ˆv3.0æ–°å¢ï¼‰ |
| `trade_action` | string | äº¤æ˜“å†³ç­–ï¼ˆLONG/SHORT/NO_TRADEï¼‰ |
| `state_reason` | string | å†³ç­–åŸå›  |

---

## å…¸å‹åœºæ™¯æ¼”ç¤º

### åœºæ™¯1ï¼šæç«¯å¸‚åœºä¿æŠ¤

```
åˆå§‹: BTCå¤„äºWAITçŠ¶æ€
â†“
æ£€æµ‹åˆ°: æ³¢åŠ¨ç‡ = 10% (> 8%)
â†“
åˆ¤å®š: market_regime = EXTREME
â†“
çŠ¶æ€è½¬æ¢: WAIT â†’ COOL_DOWN
â†“
å†³ç­–: NO_TRADE
â†“
å†·å´è®¡æ•°å™¨: 3 â†’ 2 â†’ 1 â†’ 0
â†“
çŠ¶æ€è½¬æ¢: COOL_DOWN â†’ WAIT
```

---

### åœºæ™¯2ï¼šåšå¤šä¿¡å·è§¦å‘

```
åˆå§‹: BTCå¤„äºWAITçŠ¶æ€
â†“
æ£€æµ‹åˆ°: 
- market_regime = TREND
- volume = 150% * volume_avg (çªç ´æ”¾é‡)
- oi_delta > 0 (OIå¢é•¿)
- funding_rate = 0.05% (å¥åº·)
- buy_ratio = 62% (ä¹°å•ä¸»å¯¼)
â†“
åˆ¤å®š: æ»¡è¶³åšå¤šæ¡ä»¶
â†“
çŠ¶æ€è½¬æ¢: WAIT â†’ LONG_ACTIVE
â†“
å†³ç­–: LONG
â†“
åç»­å‘¨æœŸ: æŒç»­æ£€æŸ¥åšå¤šå¤±æ•ˆæ¡ä»¶
```

---

### åœºæ™¯3ï¼šæ–¹å‘åˆ‡æ¢ï¼ˆå¿…é¡»ç»è¿‡WAITï¼‰

```
å½“å‰: LONG_ACTIVE
â†“
æ£€æµ‹åˆ°: åšå¤šå¤±æ•ˆï¼ˆprice_trend_6h < -3%ï¼‰
â†“
çŠ¶æ€è½¬æ¢: LONG_ACTIVE â†’ WAIT
â†“
å†³ç­–: NO_TRADE
â†“
ä¸‹ä¸€å‘¨æœŸ: 
  å¦‚æœæ»¡è¶³åšç©ºæ¡ä»¶:
    WAIT â†’ SHORT_ACTIVE, å†³ç­–=SHORT
  å¦åˆ™:
    ä¿æŒWAIT, å†³ç­–=NO_TRADE

âŒ ç¦æ­¢: LONG_ACTIVE â†’ SHORT_ACTIVEï¼ˆç›´æ¥åˆ‡æ¢ï¼‰
```

---

## ä¸ v2.0 çš„å¯¹æ¯”

### v2.0 è¡Œä¸ºï¼ˆæ— çŠ¶æ€ï¼‰

```
ç¬¬1æ¬¡åˆ†æ: 
  æ¡ä»¶æ»¡è¶³ â†’ è¾“å‡ºLONG

ç¬¬2æ¬¡åˆ†æ:
  æ¡ä»¶æ”¹å˜ â†’ è¾“å‡ºSHORTï¼ˆç›´æ¥åˆ‡æ¢ï¼‰

ç¬¬3æ¬¡åˆ†æ:
  æ¡ä»¶å†²çª â†’ è¾“å‡ºNO_TRADE
```

### v3.0 è¡Œä¸ºï¼ˆæœ‰çŠ¶æ€ï¼‰

```
ç¬¬1æ¬¡åˆ†æ:
  WAIT + æ»¡è¶³åšå¤š â†’ LONG_ACTIVE, è¾“å‡ºLONG

ç¬¬2æ¬¡åˆ†æ:
  LONG_ACTIVE + æ¡ä»¶æ”¹å˜ â†’ WAIT, è¾“å‡ºNO_TRADE
  ï¼ˆä¸ç›´æ¥åˆ‡æ¢åˆ°SHORTï¼‰

ç¬¬3æ¬¡åˆ†æ:
  WAIT + æ»¡è¶³åšç©º â†’ SHORT_ACTIVE, è¾“å‡ºSHORT

ç¬¬4æ¬¡åˆ†æ:
  æ£€æµ‹åˆ°æç«¯å¸‚åœº â†’ COOL_DOWN, è¾“å‡ºNO_TRADE
  ï¼ˆå¼ºåˆ¶ä¼‘çœ 3ä¸ªå‘¨æœŸï¼‰
```

---

## ä¼˜åŠ¿ä¸ç‰¹ç‚¹

### âœ… æ ¸å¿ƒä¼˜åŠ¿

1. **çŠ¶æ€è®°å¿†**: ç³»ç»Ÿæœ‰è®°å¿†ï¼Œä¸ä¼š"å¥å¿˜"
2. **å¼ºåˆ¶å†·å´**: æç«¯æƒ…å†µä¸‹å¼ºåˆ¶ä¼‘çœ ï¼Œé¿å…å†²åŠ¨äº¤æ˜“
3. **æ–¹å‘éš”ç¦»**: LONG/SHORTä¸ç›´æ¥åˆ‡æ¢ï¼Œå¿…é¡»ç»è¿‡WAIT
4. **ç¯å¢ƒæ„ŸçŸ¥**: æ ¹æ®å¸‚åœºç¯å¢ƒï¼ˆTREND/RANGE/EXTREMEï¼‰åŠ¨æ€è°ƒæ•´é˜ˆå€¼
5. **ç»“æ„ä¿æŠ¤**: å¤šé‡ç»“æ„æ€§å¤±è´¥æ£€æµ‹æœºåˆ¶
6. **æŒä¹…åŒ–**: çŠ¶æ€æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œé‡å¯ä¸ä¸¢å¤±

### ğŸ¯ è®¾è®¡å“²å­¦

- **æœ‰è®°å¿†**: è®°ä½å†å²çŠ¶æ€å’Œå†³ç­–
- **æœ‰è€å¿ƒ**: ä¸æ€¥äºå¼€ä»“ï¼Œç­‰å¾…æ˜ç¡®ä¿¡å·
- **ä¼šæ‹’ç»**: é‡åˆ°ä¸ç¡®å®šæ€§å°±è¯´NO_TRADE
- **çŠ¶æ€æœº**: ä¸æ˜¯ä¿¡å·æ‰«æå™¨ï¼Œæ˜¯çŠ¶æ€é©±åŠ¨çš„å†³ç­–ç³»ç»Ÿ

---

## ä½¿ç”¨å»ºè®®

### 1. ç†è§£ç³»ç»Ÿè¾“å‡º

- `LONG/SHORT`: ç³»ç»Ÿè®¤ä¸ºå½“å‰"å€¼å¾—å‚ä¸"è¯¥æ–¹å‘ï¼Œä¸æ˜¯ç«‹å³è¿›åœºæŒ‡ä»¤
- `NO_TRADE`: ç³»ç»Ÿè®¤ä¸ºå½“å‰"ä¸å€¼å¾—å‚ä¸"ï¼Œä¿æŒè§‚æœ›
- `system_state`: äº†è§£ç³»ç»Ÿå½“å‰å¤„äºä»€ä¹ˆçŠ¶æ€
- `market_regime`: äº†è§£å¸‚åœºå½“å‰ç¯å¢ƒ

### 2. ç»“åˆå®é™…ä½¿ç”¨

```python
# ç¤ºä¾‹ï¼šæ ¹æ®çŠ¶æ€æœºè¾“å‡ºåˆ¶å®šç­–ç•¥
response = get_market_analysis(symbol='BTC')
analysis = response['analysis']

if analysis['system_state'] == 'COOL_DOWN':
    print("ç³»ç»Ÿå†·å´ä¸­ï¼Œä¸äº¤æ˜“")

elif analysis['trade_action'] == 'LONG' and analysis['system_state'] == 'LONG_ACTIVE':
    print("åšå¤šä¿¡å·æœ‰æ•ˆä¸”çŠ¶æ€ä¿æŒï¼Œè€ƒè™‘å¼€å¤šæˆ–æŒå¤š")

elif analysis['trade_action'] == 'NO_TRADE' and analysis['system_state'] == 'WAIT':
    print("ç­‰å¾…ä¿¡å·ï¼Œè§‚æœ›")
```

### 3. ç›‘æ§çŠ¶æ€è½¬æ¢

```bash
# å®šæœŸæŸ¥çœ‹çŠ¶æ€å˜åŒ–
watch -n 60 "curl -s http://localhost:5001/api/market-analysis/futures/BTC | jq '.analysis | {trade_action, system_state, market_regime}'"
```

---

## æ–‡ä»¶æ¸…å•

- **market_state_machine.py**: çŠ¶æ€æœºæ ¸å¿ƒå®ç°
- **btc_web_app_multi.py**: ä¸»ç¨‹åºï¼ˆé›†æˆçŠ¶æ€æœºï¼‰
- **database.py**: ä¿¡å·è®°å½•æ•°æ®åº“
- **market_state.db**: çŠ¶æ€æŒä¹…åŒ–æ•°æ®åº“ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
- **market_signals.db**: å†å²ä¿¡å·æ•°æ®åº“ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰

---

## åç»­ä¼˜åŒ–æ–¹å‘

### å¯é€‰æ‰©å±•

1. **å¤šå‘¨æœŸæœä»å…³ç³»**: é«˜å‘¨æœŸ(1h) â†’ ä¸­å‘¨æœŸ(15m) â†’ ä½å‘¨æœŸ(5m)
2. **çŠ¶æ€å†å²å›æº¯**: å®Œæ•´è®°å½•çŠ¶æ€è½¬æ¢å†å²
3. **å‚æ•°è‡ªé€‚åº”**: æ ¹æ®å†å²è¡¨ç°è‡ªåŠ¨è°ƒæ•´é˜ˆå€¼
4. **Webç•Œé¢**: å¯è§†åŒ–çŠ¶æ€æœºçŠ¶æ€å’Œè½¬æ¢å†å²
5. **å›æµ‹åŠŸèƒ½**: åŸºäºå†å²æ•°æ®éªŒè¯çŠ¶æ€æœºè¡¨ç°

---

**æ›´æ–°æ—¥æœŸ**: 2026-01-20  
**ç‰ˆæœ¬**: v3.0ï¼ˆçŠ¶æ€æœºæ¶æ„ï¼‰  
**æ¶æ„**: Market Regime + System State Machine
