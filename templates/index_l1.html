<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L1 Advisory Layer - 交易决策咨询系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_l1.css') }}">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header>
            <div class="header-main">
                <h1>🎯 L1 Advisory Layer</h1>
                <p class="header-subtitle">交易决策咨询系统 | Safety First</p>
            </div>
            <div class="header-info">
                <div class="update-time">
                    <span class="label">最后更新</span>
                    <span id="lastUpdate" class="value">--</span>
                </div>
                <button onclick="refreshAdvisory()" class="refresh-btn">🔄 刷新决策</button>
            </div>
        </header>

        <!-- 所有币种决策并排显示 -->
        <div class="all-decisions-panel">
            <div class="decisions-header">
                <h2>🎯 L1 咨询决策（实时）<span class="tip-text">点击卡片查看详情</span></h2>
            </div>
            <div class="decisions-grid" id="decisionsGrid">
                <!-- 动态生成所有币种的决策卡片 -->
                <div class="loading-placeholder">正在加载决策...</div>
            </div>
        </div>
        
        <!-- 详情悬浮弹窗 -->
        <div class="detail-modal" id="detailModal" style="display:none;">
            <div class="detail-overlay" onclick="closeDetailModal()"></div>
            <div class="detail-content" id="detailContent">
                <!-- 动态内容 -->
            </div>
        </div>

        <!-- 旧版安全闸门和决策追溯（隐藏，改为在卡片详情中显示） -->
        <div class="safety-gates-panel" style="display:none;">
            <h3>🛡️ 安全闸门状态</h3>
            <div class="gates-grid">
                <!-- 风险准入 -->
                <div class="gate-card" id="riskGateCard">
                    <div class="gate-icon" id="riskGateIcon">⏳</div>
                    <div class="gate-info">
                        <div class="gate-label">风险准入</div>
                        <div class="gate-value" id="riskGateValue">--</div>
                    </div>
                </div>

                <!-- 交易质量 -->
                <div class="gate-card" id="qualityGateCard">
                    <div class="gate-icon" id="qualityGateIcon">⏳</div>
                    <div class="gate-info">
                        <div class="gate-label">交易质量</div>
                        <div class="gate-value" id="qualityGateValue">--</div>
                    </div>
                </div>

                <!-- 市场环境 -->
                <div class="gate-card" id="regimeCard">
                    <div class="gate-icon" id="regimeIcon">⏳</div>
                    <div class="gate-info">
                        <div class="gate-label">市场环境</div>
                        <div class="gate-value" id="regimeValue">--</div>
                    </div>
                </div>

                <!-- 系统状态 -->
                <div class="gate-card" id="stateCard">
                    <div class="gate-icon" id="stateIcon">⏳</div>
                    <div class="gate-info">
                        <div class="gate-label">系统状态</div>
                        <div class="gate-value" id="stateValue">--</div>
                    </div>
                </div>

                <!-- 执行许可级别 (方案D新增) -->
                <div class="gate-card" id="executionPermCard">
                    <div class="gate-icon" id="executionPermIcon">⏳</div>
                    <div class="gate-info">
                        <div class="gate-label">执行许可级别</div>
                        <div class="gate-value" id="executionPermValue">--</div>
                        <div class="gate-tip">ALLOW/ALLOW_REDUCED/DENY</div>
                    </div>
                </div>

                <!-- L3执行判定 (方案D双门槛) -->
                <div class="gate-card executable-card" id="executableCard">
                    <div class="gate-icon" id="executableIcon">⏳</div>
                    <div class="gate-info">
                        <div class="gate-label">L3执行判定</div>
                        <div class="gate-value" id="executableValue">--</div>
                        <div class="gate-tip">基于执行许可级别+置信度双门槛</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 旧版决策追溯（隐藏） -->
        <div class="reasoning-panel" style="display:none;">
            <h3>📋 决策追溯</h3>
            <div class="reason-tags-container" id="reasonTagsContainer">
                <div class="reason-tags-placeholder">正在加载决策依据...</div>
            </div>
        </div>

        <!-- 旧版决策管道（隐藏） -->
        <div class="pipeline-panel" style="display:none;">
            <h3>🔍 决策管道透视</h3>
            <div class="pipeline-flow" id="pipelineFlow">
                <div class="pipeline-step pending" data-step="1">
                    <div class="step-icon">📥</div>
                    <div class="step-label">数据验证</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
                <div class="pipeline-arrow">→</div>
                
                <div class="pipeline-step pending" data-step="2">
                    <div class="step-icon">🌡️</div>
                    <div class="step-label">环境识别</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
                <div class="pipeline-arrow">→</div>
                
                <div class="pipeline-step pending" data-step="3">
                    <div class="step-icon">🛡️</div>
                    <div class="step-label">风险评估</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
                <div class="pipeline-arrow">→</div>
                
                <div class="pipeline-step pending" data-step="4">
                    <div class="step-icon">✨</div>
                    <div class="step-label">质量评估</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
                <div class="pipeline-arrow">→</div>
                
                <div class="pipeline-step pending" data-step="5">
                    <div class="step-icon">🎯</div>
                    <div class="step-label">方向判断</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
                <div class="pipeline-arrow">→</div>
                
                <div class="pipeline-step pending" data-step="6">
                    <div class="step-icon">📊</div>
                    <div class="step-label">决策优先级</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
                <div class="pipeline-arrow">→</div>
                
                <div class="pipeline-step pending" data-step="7">
                    <div class="step-icon">🔀</div>
                    <div class="step-label">状态检查</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
                <div class="pipeline-arrow">→</div>
                
                <div class="pipeline-step pending" data-step="8">
                    <div class="step-icon">✅</div>
                    <div class="step-label">置信度计算</div>
                    <div class="step-status">⏳</div>
                    <div class="step-result"></div>
                </div>
            </div>
        </div>

        <!-- 历史决策列表 -->
        <div class="history-panel">
            <div class="history-header">
                <h3>📋 历史决策记录</h3>
                
                <!-- 查询筛选条件 -->
                <div class="history-filters">
                    <div class="filter-group">
                        <label>币种</label>
                        <select id="filterSymbol" onchange="applyHistoryFilters()">
                            <option value="all">全部币种</option>
                            <!-- 动态生成币种选项 -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>决策类型</label>
                        <select id="filterDecision" onchange="applyHistoryFilters()">
                            <option value="all">全部</option>
                            <option value="long">LONG (做多)</option>
                            <option value="short">SHORT (做空)</option>
                            <option value="no_trade">NO_TRADE (观望)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>置信度</label>
                        <select id="filterConfidence" onchange="applyHistoryFilters()">
                            <option value="all">全部</option>
                            <option value="high">HIGH (高)</option>
                            <option value="medium">MEDIUM (中)</option>
                            <option value="low">LOW (低)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>可执行</label>
                        <select id="filterExecutable" onchange="applyHistoryFilters()">
                            <option value="all">全部</option>
                            <option value="true">可执行</option>
                            <option value="false">不可执行</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>时间范围</label>
                        <select id="filterHours" onchange="applyHistoryFilters()">
                            <option value="1">最近1小时</option>
                            <option value="6">最近6小时</option>
                            <option value="24" selected>最近24小时</option>
                            <option value="48">最近48小时</option>
                        </select>
                    </div>
                    
                    <button class="filter-reset-btn" onclick="resetHistoryFilters()">
                        🔄 重置筛选
                    </button>
                </div>
            </div>
            
            <!-- 统计信息 -->
            <div class="history-stats" id="historyStats">
                <div class="stat-item">
                    <span class="stat-label">总记录数</span>
                    <span class="stat-value" id="statTotal">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">LONG</span>
                    <span class="stat-value long" id="statLong">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">SHORT</span>
                    <span class="stat-value short" id="statShort">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">NO_TRADE</span>
                    <span class="stat-value notrade" id="statNoTrade">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">可执行</span>
                    <span class="stat-value executable" id="statExecutable">0</span>
                </div>
            </div>
            
            <!-- 历史记录表格 -->
            <div class="history-table-container">
                <table class="history-table" id="historyTable">
                    <thead>
                        <tr>
                            <th width="8%">币种</th>
                            <th width="12%">时间</th>
                            <th width="10%">决策</th>
                            <th width="10%">置信度</th>
                            <th width="8%">可执行</th>
                            <th width="10%">市场环境</th>
                            <th width="10%">交易质量</th>
                            <th width="32%">决策说明</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <tr>
                            <td colspan="8" class="table-loading">正在加载历史记录...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 分页控制 -->
            <div class="history-pagination">
                <div class="pagination-info" id="paginationInfo">
                    显示 <span id="pageStart">0</span>-<span id="pageEnd">0</span> / 总共 <span id="pageTotal">0</span> 条
                </div>
                <div class="pagination-controls">
                    <button id="btnFirstPage" onclick="goToPage(1)" disabled>首页</button>
                    <button id="btnPrevPage" onclick="previousPage()" disabled>上一页</button>
                    <span class="page-number">
                        第 <input type="number" id="currentPageInput" value="1" min="1" onchange="goToPageInput()"> / 
                        <span id="totalPages">1</span> 页
                    </span>
                    <button id="btnNextPage" onclick="nextPage()" disabled>下一页</button>
                    <button id="btnLastPage" onclick="goToLastPage()" disabled>末页</button>
                </div>
                <div class="pagination-size">
                    <label>每页显示</label>
                    <select id="pageSizeSelect" onchange="changePageSize()">
                        <option value="10">10条</option>
                        <option value="20" selected>20条</option>
                        <option value="50">50条</option>
                        <option value="100">100条</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 页脚信息 -->
        <footer>
            <div class="footer-info">
                <p>💡 <strong>L1 Advisory Layer</strong>: 仅提供决策建议，不包含执行逻辑</p>
                <p>🛡️ <strong>Safety First</strong>: 风险准入 → 交易质量 → 方向判断</p>
                <p>📊 数据来源: 币安合约市场 (Binance Futures) | 🔄 自动刷新: 60秒 | 📅 数据保留: 24小时</p>
            </div>
            <div class="footer-warning">
                ⚠️ 本系统仅供参考，不构成投资建议。投资有风险，决策需谨慎。
            </div>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app_l1.js') }}"></script>
</body>
</html>
